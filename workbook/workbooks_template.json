{
    "$schema":  "http://schema.management.azure.com/schemas/2014-04-01-preview/deploymenttemplate.json#",
    "contentversion":  "1.0.0.0",
    "parameters":  {
                       "location":  {
                                        "type":  "string",
                                        "defaultvalue":  "chinaeast2"
                                    },
                       "workspacename":  {
                                             "type":  "string"
                                         },
                       "ASC-ComplianceandProtection_id":  {
                                                              "defaultValue":  "[newGuid()]",
                                                              "type":  "string"
                                                          },
                       "AzureActiveDirectoryAuditLogs_id":  {
                                                                "defaultValue":  "[newGuid()]",
                                                                "type":  "string"
                                                            },
                       "AzureActiveDirectorySignins_id":  {
                                                              "defaultValue":  "[newGuid()]",
                                                              "type":  "string"
                                                          },
                       "AzureAuditActivityAndSignin_id":  {
                                                              "defaultValue":  "[newGuid()]",
                                                              "type":  "string"
                                                          },
                       "AzureFirewall_id":  {
                                                "defaultValue":  "[newGuid()]",
                                                "type":  "string"
                                            },
                       "AzureNetworkWatcher_id":  {
                                                      "defaultValue":  "[newGuid()]",
                                                      "type":  "string"
                                                  },
                       "EventAnalyzer_id":  {
                                                "defaultValue":  "[newGuid()]",
                                                "type":  "string"
                                            },
                       "InsecureProtocols_id":  {
                                                    "defaultValue":  "[newGuid()]",
                                                    "type":  "string"
                                                },
                       "linux_id":  {
                                        "defaultValue":  "[newGuid()]",
                                        "type":  "string"
                                    },
                       "LinuxMachines_id":  {
                                                "defaultValue":  "[newGuid()]",
                                                "type":  "string"
                                            },
                       "linuxwindows_id":  {
                                               "defaultValue":  "[newGuid()]",
                                               "type":  "string"
                                           },
                       "OneIdentity_id":  {
                                              "defaultValue":  "[newGuid()]",
                                              "type":  "string"
                                          },
                       "SecurityStatus_id":  {
                                                 "defaultValue":  "[newGuid()]",
                                                 "type":  "string"
                                             },
                       "UserMap_id":  {
                                          "defaultValue":  "[newGuid()]",
                                          "type":  "string"
                                      },
                       "WebApplicationFirewallFirewallEvents_id":  {
                                                                       "defaultValue":  "[newGuid()]",
                                                                       "type":  "string"
                                                                   },
                       "WebApplicationFirewallGatewayAccessEvents_id":  {
                                                                            "defaultValue":  "[newGuid()]",
                                                                            "type":  "string"
                                                                        },
                       "WebApplicationFirewallOverview_id":  {
                                                                 "defaultValue":  "[newGuid()]",
                                                                 "type":  "string"
                                                             },
                       "WebApplicationFirewallWAFTypeEvents_id":  {
                                                                      "defaultValue":  "[newGuid()]",
                                                                      "type":  "string"
                                                                  },
                       "windows_id":  {
                                          "defaultValue":  "[newGuid()]",
                                          "type":  "string"
                                      }
                   },
    "resources":  [
                      {
                          "name":  "[parameters('ASC-ComplianceandProtection_id')]",
                          "properties":  {
                                             "displayName":  "Azure Security Center - Compliance and Protection",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 11,       \"content\": {         \"version\": \"LinkItem/1.0\",         \"style\": \"tabs\",         \"links\": [           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"General\",             \"subTarget\": \"General\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Alerts and Incidents\",             \"subTarget\": \"Alerts\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Compliance and Posture\",             \"subTarget\": \"Compliance\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Endpoint Updates and Protection\",             \"subTarget\": \"EP\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Qualys\",             \"subTarget\": \"Qualys\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"File Integrity Monitoring\",             \"subTarget\": \"FIM\",             \"style\": \"link\"           }         ]       },       \"name\": \"links - 9\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"crossComponentResources\": [           \"value::selected\"         ],         \"parameters\": [           {             \"id\": \"3218e2b0-1bcc-46d4-affa-d298e0cf90f6\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"DefaultSubscription_Internal\",             \"type\": 1,             \"isRequired\": true,             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| take 1\\r\\n| project subscriptionId\",             \"crossComponentResources\": [               \"value::selected\"             ],             \"isHiddenWhenLocked\": true,             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"e6ded9a1-a83c-4762-938d-5bf8ff3d3d38\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Subscription\",             \"type\": 6,             \"isRequired\": true,             \"query\": \"summarize by subscriptionId\\r\\n| project value = strcat(\\\"/subscriptions/\\\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)\",             \"crossComponentResources\": [               \"value::selected\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": []             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           }         ],         \"style\": \"above\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\"       },       \"customWidth\": \"33\",       \"name\": \"parameters - 10\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"parameters\": [           {             \"id\": \"6d2d5f84-767c-4d51-82d5-6981e96bacdc\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Workspace\",             \"type\": 5,             \"query\": \"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| order by name asc\\r\\n| summarize Selected = makelist(id, 10), All = makelist(id, 1000)\\r\\n| mvexpand All limit 100\\r\\n| project value = tostring(All), label = tostring(All), selected = iff(Selected contains All, true, false)\",             \"crossComponentResources\": [               \"{Subscription}\"             ],             \"value\": \"/subscriptions/\u003csubs_ID\u003e/resourcegroups/\u003crg_name\u003e/providers/microsoft.operationalinsights/workspaces/\u003cworkspace_name\u003e\",             \"typeSettings\": {               \"additionalResourceOptions\": []             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"befbf593-c171-4129-b890-7e642265ed0c\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 2592000000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2419200000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ]             },             \"resourceType\": \"microsoft.insights/components\"           }         ],         \"style\": \"above\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"customWidth\": \"50\",       \"name\": \"parameters - 8\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"search *\\r\\n| summarize count() by Type\\r\\n| render barchart\",         \"size\": 0,         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspace}\"         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"General\"       },       \"name\": \"General\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"items\": [           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityAlert \\r\\n| summarize AlertCount = count() by AlertSeverity\",               \"size\": 1,               \"title\": \"Alerts by Severity\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"piechart\"             },             \"customWidth\": \"50\",             \"name\": \"query - 0\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityAlert \\r\\n| summarize AlertCount = count() by ProviderName, IsIncident\",               \"size\": 1,               \"title\": \"Alerts by Provider\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"piechart\"             },             \"customWidth\": \"50\",             \"name\": \"query - 9\"           },           {             \"type\": 9,             \"content\": {               \"version\": \"KqlParameterItem/1.0\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"parameters\": [                 {                   \"id\": \"43415fb7-83e4-4b71-9e69-59c3acb598e3\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"ProductSelection\",                   \"type\": 5,                   \"isRequired\": true,                   \"multiSelect\": true,                   \"quote\": \"'\",                   \"delimiter\": \",\",                   \"query\": \"SecurityAlert \\r\\n| where isnotempty(ProductName)\\r\\n| summarize count() by  ProductName\\r\\n| order by count_ desc\",                   \"crossComponentResources\": [                     \"{Workspace}\"                   ],                   \"value\": [                     \"value::all\"                   ],                   \"typeSettings\": {                     \"additionalResourceOptions\": [                       \"value::all\"                     ]                   },                   \"timeContext\": {                     \"durationMs\": 0                   },                   \"timeContextFromParameter\": \"TimeRange\",                   \"queryType\": 0,                   \"resourceType\": \"microsoft.operationalinsights/workspaces\"                 },                 {                   \"id\": \"903503cc-f549-4d2c-bd6e-adebb0d91799\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"SeveritySelect\",                   \"type\": 2,                   \"isRequired\": true,                   \"multiSelect\": true,                   \"quote\": \"'\",                   \"delimiter\": \",\",                   \"query\": \"SecurityAlert \\r\\n| where isnotempty(AlertSeverity)\\r\\n| summarize by AlertSeverity\",                   \"crossComponentResources\": [                     \"{Workspace}\"                   ],                   \"value\": [                     \"value::all\"                   ],                   \"typeSettings\": {                     \"additionalResourceOptions\": [                       \"value::all\"                     ]                   },                   \"timeContext\": {                     \"durationMs\": 0                   },                   \"timeContextFromParameter\": \"TimeRange\",                   \"queryType\": 0,                   \"resourceType\": \"microsoft.operationalinsights/workspaces\"                 }               ],               \"style\": \"above\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\"             },             \"customWidth\": \"30\",             \"name\": \"parameters - 10\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityAlert\\r\\n| where ProductName in ( {ProductSelection} )\\r\\n| where AlertSeverity in ({SeveritySelect})\\r\\n| extend HostName = tostring(parse_json(Entities)[0].HostName) \\r\\n| summarize AlertCount = count() by AlertSeverity, VendorName, ProductName, SystemAlertId, ResourceId, AlertType, StartTime, EndTime, RemediationSteps, AlertLink\",               \"size\": 0,               \"title\": \"Alert Details for {TimeRange:label}\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"AlertSeverity\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"High\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Medium\",                           \"representation\": \"orange\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Low\",                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   },                   {                     \"columnMatch\": \"AlertLink\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true,                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               }             },             \"name\": \"query - 11\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityAlert\\r\\n| make-series count() default=0 on StartTime from {TimeRange:start} to {TimeRange:end} step 1d by ProductName\",               \"size\": 0,               \"title\": \"Alert Count by Product Over '{TimeRange:label}'\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"timechart\"             },             \"name\": \"query - 4\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityAlert\\r\\n| project TimeGenerated, DisplayName, AlertSeverity, ProductName, ResourceId, Entities, RemediationSteps, AlertLink\\r\\n| sort by TimeGenerated\",               \"size\": 0,               \"title\": \"Alerts Between '{TimeBrush:label}'\",               \"timeContext\": {                 \"durationMs\": 86400000               },               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"AlertSeverity\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"High\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Medium\",                           \"representation\": \"yellow\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Low\",                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Informational\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   },                   {                     \"columnMatch\": \"AlertLink\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true,                       \"showIcon\": true                     }                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"TimeGenerated\"                   },                   {                     \"columnId\": \"DisplayName\",                     \"label\": \"Alert Name\"                   },                   {                     \"columnId\": \"AlertSeverity\",                     \"label\": \"Severity\"                   },                   {                     \"columnId\": \"ProductName\",                     \"label\": \"Product\"                   },                   {                     \"columnId\": \"ResourceId\",                     \"label\": \"Resource\"                   },                   {                     \"columnId\": \"Entities\"                   },                   {                     \"columnId\": \"RemediationSteps\",                     \"label\": \"Remediation Steps\"                   },                   {                     \"columnId\": \"AlertLink\",                     \"label\": \"Link\"                   }                 ]               }             },             \"name\": \"query - 5\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Alerts\"       },       \"name\": \"Alerts\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"items\": [           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"securityresources\\r\\n | where type == \\\"microsoft.security/assessments\\\"\\r\\n | where * contains \\\"Remediate vulnerabilities found on your virtual machines (powered by Qualys)\\\"\\r\\n | summarize by assessmentKey=name //the ID of the assessment\\r\\n | join kind=inner (\\r\\n    securityresources\\r\\n     | where type == \\\"microsoft.security/assessments/subassessments\\\"\\r\\n     | extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1,  id)\\r\\n ) on assessmentKey\\r\\n| project assessmentKey, subassessmentKey=name, id, parse_json(properties), resourceGroup, subscriptionId, tenantId\\r\\n| extend description = properties.description,\\r\\n         displayName = properties.displayName,\\r\\n         resourceId = properties.resourceDetails.id,\\r\\n         resourceSource = properties.resourceDetails.source,\\r\\n         category = properties.category,\\r\\n         severity = properties.status.severity,\\r\\n         code = properties.status.code,\\r\\n         timeGenerated = properties.timeGenerated,\\r\\n         remediation = properties.remediation,\\r\\n         impact = properties.impact,\\r\\n         vulnId = properties.id,\\r\\n         additionalData = properties.additionalData\\r\\n| summarize count() by  tostring(severity), tostring(category)\",               \"size\": 0,               \"title\": \"Severity\",               \"queryType\": 1,               \"resourceType\": \"microsoft.resourcegraph/resources\",               \"crossComponentResources\": [                 \"{Subscription}\"               ],               \"visualization\": \"piechart\"             },             \"customWidth\": \"50\",             \"name\": \"query - 0\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"securityresources\\r\\n | where type == \\\"microsoft.security/assessments\\\"\\r\\n | where * contains \\\"Remediate vulnerabilities found on your virtual machines (powered by Qualys)\\\"\\r\\n | summarize by assessmentKey=name //the ID of the assessment\\r\\n | join kind=inner (\\r\\n    securityresources\\r\\n     | where type == \\\"microsoft.security/assessments/subassessments\\\"\\r\\n     | extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1,  id)\\r\\n ) on assessmentKey\\r\\n| project assessmentKey, subassessmentKey=name, id, parse_json(properties), resourceGroup, subscriptionId, tenantId\\r\\n| extend description = properties.description,\\r\\n         displayName = properties.displayName,\\r\\n         resourceId = properties.resourceDetails.id,\\r\\n         resourceSource = properties.resourceDetails.source,\\r\\n         category = properties.category,\\r\\n         severity = properties.status.severity,\\r\\n         code = properties.status.code,\\r\\n         timeGenerated = properties.timeGenerated,\\r\\n         remediation = properties.remediation,\\r\\n         impact = properties.impact,\\r\\n         vulnId = properties.id,\\r\\n         additionalData = properties.additionalData\\r\\n| summarize count() by   tostring(category)\",               \"size\": 0,               \"title\": \"Category\",               \"queryType\": 1,               \"resourceType\": \"microsoft.resourcegraph/resources\",               \"crossComponentResources\": [                 \"{Subscription}\"               ],               \"visualization\": \"piechart\"             },             \"customWidth\": \"50\",             \"name\": \"query - 2\"           },           {             \"type\": 9,             \"content\": {               \"version\": \"KqlParameterItem/1.0\",               \"crossComponentResources\": [                 \"{Subscription}\"               ],               \"parameters\": [                 {                   \"id\": \"7f84ceda-dbeb-48da-b90e-e595824197cf\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"Severity\",                   \"type\": 5,                   \"isRequired\": true,                   \"multiSelect\": true,                   \"quote\": \"'\",                   \"delimiter\": \",\",                   \"query\": \"securityresources\\r\\n | where type == \\\"microsoft.security/assessments\\\"\\r\\n | where * contains \\\"Remediate vulnerabilities found on your virtual machines (powered by Qualys)\\\"\\r\\n | summarize by assessmentKey=name //the ID of the assessment\\r\\n | join kind=inner (\\r\\n    securityresources\\r\\n     | where type == \\\"microsoft.security/assessments/subassessments\\\"\\r\\n     | extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1,  id)\\r\\n ) on assessmentKey\\r\\n| project assessmentKey, subassessmentKey=name, id, parse_json(properties), resourceGroup, subscriptionId, tenantId\\r\\n| extend severity = tostring(properties.status.severity)\\r\\n| distinct severity\\r\\n| order by severity asc\\r\\n\",                   \"crossComponentResources\": [                     \"{Subscription}\"                   ],                   \"value\": [],                   \"typeSettings\": {                     \"additionalResourceOptions\": []                   },                   \"queryType\": 1,                   \"resourceType\": \"microsoft.resourcegraph/resources\"                 }               ],               \"style\": \"above\",               \"queryType\": 1,               \"resourceType\": \"microsoft.resourcegraph/resources\"             },             \"name\": \"parameters - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"securityresources\\r\\n | where type == \\\"microsoft.security/assessments\\\"\\r\\n | where * contains \\\"Remediate vulnerabilities found on your virtual machines (powered by Qualys)\\\"\\r\\n | summarize by assessmentKey=name //the ID of the assessment\\r\\n | join kind=inner (\\r\\n    securityresources\\r\\n     | where type == \\\"microsoft.security/assessments/subassessments\\\"\\r\\n     | extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1,  id)\\r\\n ) on assessmentKey\\r\\n| parse id with * \\\"/virtualMachines/\\\" strCompName \\\"/providers\\\" * \\r\\n| project assessmentKey, subassessmentKey=name, id, parse_json(properties), resourceGroup, subscriptionId, tenantId, strCompName\\r\\n| extend description = properties.description,\\r\\n         displayName = properties.displayName,\\r\\n         resourceId = properties.resourceDetails.id,\\r\\n         resourceSource = properties.resourceDetails.source,\\r\\n         category = properties.category,\\r\\n         severity = properties.status.severity,\\r\\n         code = properties.status.code,\\r\\n         timeGenerated = properties.timeGenerated,\\r\\n         remediation = properties.remediation,\\r\\n         impact = properties.impact,\\r\\n         vulnId = properties.id,\\r\\n         additionalData = properties.additionalData,\\r\\n         assessedResourceType  = tostring(properties.additionalData.assessedResourceType),\\r\\n\\t\\t vendorReferences      = tostring(properties.additionalData.vendorReferences),\\r\\n\\t\\t patchable\\t\\t       = tostring(properties.additionalData.patchable),\\r\\n\\t\\t atype      \\t\\t   = tostring(properties.additionalData.type),\\r\\n\\t\\t threat      \\t\\t   = tostring(properties.additionalData.threat)\\r\\n//| project severity, '{Severity:name}'\\r\\n| where severity in ({Severity})\\r\\n| summarize by Severity = tostring(severity), ['Computer Name']=strCompName, Description = tostring(displayName) , Category = tostring(category) ,  tostring(remediation), tostring(impact), tostring(vulnId),  assessedResourceType, vendorReferences, patchable, Type=atype, threat\\r\\n\\r\\n\",               \"size\": 0,               \"showExportToExcel\": true,               \"queryType\": 1,               \"resourceType\": \"microsoft.resourcegraph/resources\",               \"crossComponentResources\": [                 \"{Subscription}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Severity\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"High\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Medium\",                           \"representation\": \"orange\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Low\",                           \"representation\": \"green\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   },                   {                     \"columnMatch\": \"patchable\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"true\",                           \"representation\": \"green\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"false\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   }                 ],                 \"filter\": true               }             },             \"name\": \"query - 3\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Qualys\"       },       \"name\": \"Qualys\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"items\": [           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"securityresources\\r\\n| where type == \\\"microsoft.security/regulatorycompliancestandards\\\"\\r\\n| extend \\r\\n\\tpassedControls = trim (' ', tostring(properties.passedControls)), \\r\\n\\tfailedControls = trim(' ',tostring(properties.failedControls)), \\r\\n\\tstate \\t\\t   = trim(' ', tostring(properties.state)), \\r\\n\\tunsupportedControls = trim(' ', tostring(properties.unsupportedControls)), \\r\\n\\tskippedControls     = trim(' ', tostring(properties.skippedControls))\\r\\n| project name, passedControls, failedControls, unsupportedControls, skippedControls , subscriptionId\\r\\n| order by passedControls desc\",               \"size\": 0,               \"title\": \"Current Compliance Details\",               \"showExportToExcel\": true,               \"queryType\": 1,               \"resourceType\": \"microsoft.resourcegraph/resources\",               \"crossComponentResources\": [                 \"{Subscription}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"passedControls\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"palette\": \"hotCold\",                       \"showIcon\": true                     },                     \"numberFormat\": {                       \"unit\": 0,                       \"options\": {                         \"style\": \"decimal\",                         \"useGrouping\": false                       }                     }                   },                   {                     \"columnMatch\": \"failedControls\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"palette\": \"coldHot\",                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"unsupportedControls\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"palette\": \"coldHot\",                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"skippedControls\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"palette\": \"coldHot\",                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               }             },             \"name\": \"query - 12\"           },           {             \"type\": 9,             \"content\": {               \"version\": \"KqlParameterItem/1.0\",               \"crossComponentResources\": [                 \"{Subscription}\"               ],               \"parameters\": [                 {                   \"id\": \"dd8f4188-2076-4696-ba56-8418a3fcc6f5\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"SelectCompliance\",                   \"type\": 5,                   \"query\": \"securityresources\\r\\n| where type == \\\"microsoft.security/regulatorycompliancestandards\\\"\\r\\n| project name\\r\\n\",                   \"crossComponentResources\": [                     \"{Subscription}\"                   ],                   \"value\": \"ISO-27001\",                   \"typeSettings\": {                     \"additionalResourceOptions\": []                   },                   \"timeContextFromParameter\": \"TimeRange\",                   \"queryType\": 1,                   \"resourceType\": \"microsoft.resourcegraph/resources\"                 },                 {                   \"id\": \"bd9c3eae-84af-42b5-8c93-e281788948d7\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"selectState\",                   \"type\": 5,                   \"query\": \"securityresources\\r\\n| where type == \\\"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\\\"\\r\\n | extend  state \\t\\t   = trim(' ', tostring(properties.state))\\r\\n| summarize by state\",                   \"crossComponentResources\": [                     \"{Subscription}\"                   ],                   \"value\": \"Failed\",                   \"typeSettings\": {                     \"additionalResourceOptions\": []                   },                   \"timeContext\": {                     \"durationMs\": 0                   },                   \"timeContextFromParameter\": \"TimeRange\",                   \"queryType\": 1,                   \"resourceType\": \"microsoft.resourcegraph/resources\"                 }               ],               \"style\": \"above\",               \"queryType\": 1,               \"resourceType\": \"microsoft.resourcegraph/resources\"             },             \"name\": \"parameters - 13\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"securityresources\\r\\n| where type == \\\"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\\\"\\r\\n| parse id with *\\\"/regulatoryComplianceStandards/\\\" strControlName \\\"/regulatory\\\"*\\r\\n | extend \\r\\n\\t state \\t\\t   = trim(' ', tostring(properties.state))\\r\\n\\t,description    = trim(' ', tostring(properties.description))\\r\\n| where  strControlName startswith '{SelectCompliance}'\\r\\n| extend isState = iif(isempty('{selectState}'),\\\"All states\\\",'{selectState}')\\r\\n//| where isSstate == '{selectState}'\\r\\n| summarize by  ControlName = strControlName, name, Status = isState, description\\r\\n\",               \"size\": 0,               \"showExportToExcel\": true,               \"queryType\": 1,               \"resourceType\": \"microsoft.resourcegraph/resources\",               \"crossComponentResources\": [                 \"{Subscription}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Status\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"failed\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Failed\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Passed\",                           \"representation\": \"green\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Unsupported\",                           \"representation\": \"orange\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     },                     \"numberFormat\": {                       \"unit\": 0,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   }                 ],                 \"filter\": true               }             },             \"name\": \"query - 14\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityRecommendation\\r\\n| where RecommendationState contains 'unhealthy'\\r\\n| summarize count() by RecommendationSeverity\\r\\n| render piechart\",               \"size\": 4,               \"title\": \"Security Recommendations By Severity\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"chartSettings\": {                 \"seriesLabelSettings\": [                   {                     \"seriesName\": \"Low\",                     \"color\": \"blue\"                   },                   {                     \"seriesName\": \"Medium\",                     \"color\": \"yellow\"                   },                   {                     \"seriesName\": \"High\",                     \"color\": \"redBright\"                   }                 ]               }             },             \"name\": \"query - 4\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityRecommendation\\r\\n| make-series count() default=0 on DiscoveredTimeUTC from {TimeRange:start} to {TimeRange:end} step 1d by RecommendationSeverity\",               \"size\": 0,               \"title\": \"Security Recommendation Severity For Past 30 Days\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"timechart\",               \"chartSettings\": {                 \"seriesLabelSettings\": [                   {                     \"seriesName\": \"Low\",                     \"color\": \"blue\"                   },                   {                     \"seriesName\": \"Medium\",                     \"color\": \"yellow\"                   },                   {                     \"seriesName\": \"High\",                     \"color\": \"redBright\"                   }                 ]               }             },             \"name\": \"query - 8\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityRecommendation\\r\\n| where RecommendationState contains 'unhealthy'\\r\\n| extend Resource = AssessedResourceId\\r\\n| summarize count() by Resource, RecommendationState\\r\\n| project-away RecommendationState\\r\\n| sort by count_ desc\\r\\n\",               \"size\": 0,               \"title\": \"Resources with Recommendations in '{TimeBrush:label}'\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"exportMultipleValues\": true,               \"exportedParameters\": [                 {                   \"fieldName\": \"Resource\",                   \"parameterName\": \"Resource\",                   \"delimiter\": \"\",                   \"quote\": \"\\\"\"                 }               ],               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"Resource\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Number of Logs\"                   }                 ]               },               \"sortBy\": []             },             \"customWidth\": \"30\",             \"showPin\": false,             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let Resource_ = dynamic({Resource});\\r\\nSecurityRecommendation\\r\\n| where RecommendationState contains 'unhealthy'\\r\\n| where AssessedResourceId contains tostring(Resource_)\\r\\n| extend Link = strcat(\\\"https://\\\", RecommendationLink)\\r\\n| project TimeGenerated, Resource_, RecommendationName, Link, RecommendationSeverity\\r\\n| summarize arg_max(TimeGenerated, *) by RecommendationName\\r\\n\\r\\n\",               \"size\": 0,               \"title\": \"Recommendations for Selected Resource\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Resource_\",                     \"formatter\": 13,                     \"formatOptions\": {                       \"linkTarget\": \"Resource\",                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"Link\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"Url\",                       \"linkIsContextBlade\": false,                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"RecommendationSeverity\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"High\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Medium\",                           \"representation\": \"yellow\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Low\",                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Informational\",                           \"representation\": \"gray\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   },                   {                     \"columnMatch\": \"RecommendationLink\",                     \"formatter\": 13,                     \"formatOptions\": {                       \"linkTarget\": \"Url\",                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true,                 \"sortBy\": [                   {                     \"itemKey\": \"RecommendationName\",                     \"sortOrder\": 1                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"RecommendationName\",                     \"label\": \"Recommendation\"                   },                   {                     \"columnId\": \"TimeGenerated\",                     \"label\": \"Time Generated\"                   },                   {                     \"columnId\": \"Resource_\",                     \"label\": \"Resource\"                   },                   {                     \"columnId\": \"RecommendationSeverity\",                     \"label\": \"Severity\"                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"RecommendationName\",                   \"sortOrder\": 1                 }               ]             },             \"customWidth\": \"70\",             \"name\": \"query - 4\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let Resource_ = dynamic({Resource});\\r\\nSecurityAlert\\r\\n| where ResourceId contains tostring(Resource_)\\r\\n| project TimeGenerated, Resource_, AlertName, AlertSeverity, ProductName\\r\\n| summarize arg_max(TimeGenerated, *) by TimeGenerated\\r\\n| project-away TimeGenerated1\",               \"size\": 0,               \"title\": \"Related Alerts to Resource in '{TimeBrush:label})\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Resource_\",                     \"formatter\": 13,                     \"formatOptions\": {                       \"linkTarget\": \"Resource\",                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"AlertSeverity\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"High\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Medium\",                           \"representation\": \"yellow\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"low\",                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Informational\",                           \"representation\": \"gray\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   },                   {                     \"columnMatch\": \"ResourceId\",                     \"formatter\": 1,                     \"formatOptions\": {                       \"showIcon\": true                     }                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"TimeGenerated\"                   },                   {                     \"columnId\": \"Resource_\",                     \"label\": \"Resource Impacted\"                   },                   {                     \"columnId\": \"AlertName\",                     \"label\": \"Alert Title\"                   },                   {                     \"columnId\": \"AlertSeverity\",                     \"label\": \"Severity\"                   },                   {                     \"columnId\": \"ProductName\",                     \"label\": \"Product\"                   }                 ]               },               \"sortBy\": [],               \"graphSettings\": {                 \"type\": 0               }             },             \"name\": \"query - 6\",             \"styleSettings\": {               \"showBorder\": true             }           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Compliance\"       },       \"name\": \"Compliance\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"items\": [           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"ProtectionStatus\\r\\n| extend Protection = iff(ThreatStatusRank == 150, \\\"Protected\\\", \\\"Security Event Should Be Addressed\\\")\\r\\n| extend Resource = Computer\\r\\n| project TimeGenerated, Resource, TypeofProtection, Protection, ThreatStatus ,ProtectionStatus, SignatureVersion\\r\\n| summarize arg_max(TimeGenerated,*) by Resource\\r\\n\",               \"size\": 1,               \"showAnalytics\": true,               \"title\": \"Endpoint Protection Status\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportMultipleValues\": true,               \"exportedParameters\": [                 {                   \"fieldName\": \"Resource\",                   \"parameterName\": \"Resource\",                   \"parameterType\": 1,                   \"delimiter\": \"\"                 }               ],               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"filter\": true,                 \"sortBy\": [                   {                     \"itemKey\": \"ThreatStatus\",                     \"sortOrder\": 1                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"TimeGenerated\",                     \"label\": \"Time Generated\"                   },                   {                     \"columnId\": \"TypeofProtection\",                     \"label\": \"Endpoint Protection\"                   },                   {                     \"columnId\": \"Protection\",                     \"label\": \"Protection Status\"                   },                   {                     \"columnId\": \"ThreatStatus\",                     \"label\": \"Threat Status\"                   },                   {                     \"columnId\": \"ProtectionStatus\",                     \"label\": \"Protection Status\"                   },                   {                     \"columnId\": \"SignatureVersion\",                     \"label\": \"Signature Version\"                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"ThreatStatus\",                   \"sortOrder\": 1                 }               ]             },             \"name\": \"query - 6\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let Resource_ = dynamic({Resource});\\r\\nProtectionStatus\\r\\n| where ThreatStatusRank != 150\\r\\n| where Computer contains tostring(Resource_)\\r\\n| project TimeGenerated, Resource_, ThreatStatus, ProtectionStatus, Threat, ThreatStatusDetails\",               \"size\": 1,               \"title\": \"Threats Over Last '{TimeRange:label}'\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"sortBy\": [                   {                     \"itemKey\": \"ThreatStatusDetails\",                     \"sortOrder\": 1                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"TimeGenerated\",                     \"label\": \"Time Generated\"                   },                   {                     \"columnId\": \"Resource_\",                     \"label\": \"Resource\"                   },                   {                     \"columnId\": \"ThreatStatus\",                     \"label\": \"Action Taken\"                   },                   {                     \"columnId\": \"ProtectionStatus\",                     \"label\": \"Event Summary\"                   },                   {                     \"columnId\": \"Threat\",                     \"label\": \"Malicious Artifact\",                     \"comment\": \"File or Process\"                   },                   {                     \"columnId\": \"ThreatStatusDetails\",                     \"label\": \"Details\"                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"ThreatStatusDetails\",                   \"sortOrder\": 1                 }               ]             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"ProtectionStatus\\r\\n| where ProtectionStatusRank != 150\\r\\n| extend Protection = case( ProtectionStatusRank == 250, \\\"Signatures out of date\\\"\\r\\n                            , ProtectionStatusRank == 270, \\\"No real-time protction detected\\\"\\r\\n                            , ProtectionStatusRank == 470, \\\"No endpoint protection detected\\\"\\r\\n                            , ProtectionStatusRank == 550, \\\"Threat detected\\\"\\r\\n                            , \\\"No threats detected\\\"\\r\\n                            )\\r\\n| summarize count() by DeviceName, Protection\\r\\n| sort by count_ desc \",               \"size\": 0,               \"title\": \"Most Vulnerable Machines\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"DeviceName\",                     \"label\": \"Device\"                   },                   {                     \"columnId\": \"Protection\",                     \"label\": \"Endpoint Protection\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Trend Over Last 30 Days\"                   }                 ]               }             },             \"name\": \"query - 1\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityBaseline\\r\\n| where AnalyzeResult != 'Passed'\\r\\n| extend Resource = ResourceId\\r\\n| summarize count() by Resource\\r\\n| sort by count_ desc\",               \"size\": 0,               \"title\": \"Resources with Failed Baselines Within '{TimeRange:label}'\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportMultipleValues\": true,               \"exportedParameters\": [                 {                   \"fieldName\": \"Resource\",                   \"parameterName\": \"Resource\",                   \"parameterType\": 1,                   \"delimiter\": \"\"                 }               ],               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"Resource\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Number of Logs\"                   }                 ]               }             },             \"customWidth\": \"25\",             \"name\": \"query - 0\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let Resource_ = dynamic({Resource});\\r\\nSecurityBaseline\\r\\n| where AnalyzeResult != 'Passed'\\r\\n| where ResourceId contains tostring(Resource_)\\r\\n| project TimeGenerated, Description, BaselineType, CceId, RuleSeverity, Resource_, AnalyzeResult\",               \"size\": 0,               \"title\": \"Failed Security Baselines for Machine\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Resource_\",                     \"formatter\": 13,                     \"formatOptions\": {                       \"linkTarget\": null,                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"RuleSeverity\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Critical\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Warning\",                           \"representation\": \"yellow\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Informational\",                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   }                 ],                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"TimeGenerated\",                     \"label\": \"Time Generated\"                   },                   {                     \"columnId\": \"Description\"                   },                   {                     \"columnId\": \"BaselineType\",                     \"label\": \"OS\"                   },                   {                     \"columnId\": \"CceId\"                   },                   {                     \"columnId\": \"RuleSeverity\",                     \"label\": \"Severity\"                   },                   {                     \"columnId\": \"Resource_\",                     \"label\": \"Resource\"                   },                   {                     \"columnId\": \"AnalyzeResult\",                     \"label\": \"Status\"                   }                 ]               }             },             \"customWidth\": \"75\",             \"name\": \"query - 1\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let Resource_ = dynamic({Resource});\\r\\nSecurityBaselineSummary\\r\\n| project TimeGenerated, Resource_, OSName, TotalAssessedRules, PercentageOfPassedRules, CriticalFailedRules, WarningFailedRules, InformationalFailedRules\\r\\n| summarize arg_max(TimeGenerated, *)\",               \"size\": 4,               \"title\": \"Resource Security Baselines Summary\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Resource_\",                     \"formatter\": 13,                     \"formatOptions\": {                       \"linkTarget\": null,                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"PercentageOfPassedRules\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"\u003c\",                           \"thresholdValue\": \"90\",                           \"representation\": \"yellow\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"\u003c\",                           \"thresholdValue\": \"80\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"\u003e\",                           \"thresholdValue\": \"90\",                           \"representation\": \"green\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     },                     \"numberFormat\": {                       \"unit\": 1,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   },                   {                     \"columnMatch\": \"CriticalFailedRules\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"\u003e\",                           \"thresholdValue\": \"5\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"\u003c\",                           \"thresholdValue\": \"5\",                           \"representation\": \"green\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   },                   {                     \"columnMatch\": \"WarningFailedRules\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"\u003e\",                           \"thresholdValue\": \"10\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"\u003c\",                           \"thresholdValue\": \"10\",                           \"representation\": \"green\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   },                   {                     \"columnMatch\": \"InformationalFailedRules\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"\u003c\",                           \"thresholdValue\": \"10\",                           \"representation\": \"green\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"\u003e\",                           \"thresholdValue\": \"10\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"TimeGenerated\",                     \"label\": \"Time Generated\"                   },                   {                     \"columnId\": \"Resource_\",                     \"label\": \"Resource\"                   },                   {                     \"columnId\": \"OSName\",                     \"label\": \"OS\"                   },                   {                     \"columnId\": \"TotalAssessedRules\",                     \"label\": \"Total Assessed Rules\"                   },                   {                     \"columnId\": \"PercentageOfPassedRules\",                     \"label\": \"Percent Passed\"                   },                   {                     \"columnId\": \"CriticalFailedRules\",                     \"label\": \"Critical Failed\"                   },                   {                     \"columnId\": \"WarningFailedRules\",                     \"label\": \"Warning Failed\"                   },                   {                     \"columnId\": \"InformationalFailedRules\",                     \"label\": \"Informational Failed\"                   }                 ]               }             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Update\\r\\n| where UpdateState != 'Installed'\\r\\n| extend Resource = Computer\\r\\n| summarize count() by Resource\\r\\n| sort by count_ desc\",               \"size\": 0,               \"title\": \"Resources with Updates within '{TimeRange:label}'\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportMultipleValues\": true,               \"exportedParameters\": [                 {                   \"fieldName\": \"Resource\",                   \"parameterName\": \"Resource\",                   \"parameterType\": 1,                   \"delimiter\": \"\"                 }               ],               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"sortBy\": [                   {                     \"itemKey\": \"Resource\",                     \"sortOrder\": 2                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"Resource\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Number of Logs\"                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"Resource\",                   \"sortOrder\": 2                 }               ]             },             \"customWidth\": \"25\",             \"name\": \"query - 8\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let Resource_ = dynamic({Resource});\\r\\nUpdate\\r\\n| where UpdateState != 'Installed'\\r\\n| where Computer contains tostring(Resource_)\\r\\n| project TimeGenerated, Product, Classification, Title, KBID, Resource_, UpdateState\\r\\n\",               \"size\": 0,               \"title\": \"Updates Needed for Resource\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Classification\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Updates\",                           \"representation\": \"orange\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Feature Packs\",                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Definition Packs\",                           \"representation\": \"yellow\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"contains\",                           \"thresholdValue\": \"Security\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Others\",                           \"representation\": \"gray\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   }                 ],                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"TimeGenerated\",                     \"label\": \"Time Generated\"                   },                   {                     \"columnId\": \"Product\"                   },                   {                     \"columnId\": \"Classification\"                   },                   {                     \"columnId\": \"Resource_\",                     \"label\": \"Resouce\"                   },                   {                     \"columnId\": \"UpdateState\",                     \"label\": \"Update Status\"                   }                 ]               }             },             \"customWidth\": \"75\",             \"name\": \"query - 9\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"EP\"       },       \"name\": \"Endpoint\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"items\": [           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"ConfigurationChange\\r\\n| extend Resource = Computer\\r\\n| summarize count() by Resource, ChangeCategory, ConfigChangeType\\r\\n| order by count_ desc \",               \"size\": 0,               \"title\": \"Events Per Resource within '{TimeRange:label}'\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportMultipleValues\": true,               \"exportedParameters\": [                 {                   \"fieldName\": \"Resource\",                   \"parameterName\": \"Resource\",                   \"parameterType\": 1,                   \"delimiter\": \"\"                 }               ],               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"ChangeCategory\",                     \"label\": \"Action\"                   },                   {                     \"columnId\": \"ConfigChangeType\",                     \"label\": \"Area\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Count\"                   }                 ]               }             },             \"customWidth\": \"33\",             \"showPin\": true,             \"name\": \"query - 0\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let Resource_ = dynamic({Resource});\\r\\nConfigurationChange\\r\\n| where Computer contains tostring(Resource_)\\r\\n| project Resource_, ChangeCategory, ConfigChangeType, RegistryKey, ValueName, FileSystemPath\",               \"size\": 0,               \"title\": \"Events for Resource\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"RegistryKey\",                     \"formatter\": 1,                     \"formatOptions\": {                       \"linkTarget\": \"Resource\",                       \"linkIsContextBlade\": false,                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               }             },             \"customWidth\": \"66\",             \"name\": \"query - 3\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"ConfigurationChange\\r\\n| summarize count() by ChangeCategory, bin (TimeGenerated, 1d)\",               \"size\": 0,               \"title\": \"File Integrity Monitor Events By Action\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"linechart\"             },             \"name\": \"query - 1\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"ConfigurationChange\\r\\n| summarize count() by ConfigChangeType, bin (TimeGenerated, 1d)\",               \"size\": 0,               \"title\": \"File Integrity Monitor Logs By Location\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"linechart\",               \"chartSettings\": {                 \"seriesLabelSettings\": [                   {                     \"seriesName\": \"Files\",                     \"color\": \"yellow\"                   },                   {                     \"seriesName\": \"Registry\",                     \"color\": \"redBright\"                   }                 ]               }             },             \"name\": \"query - 7\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"FIM\"       },       \"name\": \"FIM\"     }   ],   \"styleSettings\": {},   \"fromTemplateId\": \"ASC-ComplianceandProtection\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('AzureActiveDirectoryAuditLogs_id')]",
                          "properties":  {
                                             "displayName":  "Security - Azure Active Directory AuditLogs",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"## Azure AD audit logs\"       },       \"name\": \"text - 1\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"query\": \"\",         \"crossComponentResources\": [],         \"parameters\": [           {             \"id\": \"bc372bf5-2dcd-4efa-aa85-94b6e6fafe14\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 7776000000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2419200000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ],               \"allowCustom\": true             }           },           {             \"id\": \"e032b9f7-5449-4180-9c20-75760afa96f6\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"User\",             \"type\": 2,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"AuditLogs\\r\\n| where SourceSystem == \\\"Azure AD\\\"\\r\\n| extend initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \\\"\\\", tostring(InitiatedBy.user.userPrincipalName), \\\"unknown\\\")\\r\\n//| where initiator!= \\\"\\\"\\r\\n| summarize Count = count() by initiator\\r\\n| order by Count desc, initiator asc\\r\\n| project Value = initiator, Label = strcat(initiator, ' - ', Count), Selected = false\",             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"selectAllValue\": \"All\"             },             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\"           },           {             \"id\": \"0a59a0b3-6d93-4fee-bdbe-147383c510c6\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Category\",             \"type\": 2,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"AuditLogs\\r\\n| extend initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \\\"\\\", tostring(InitiatedBy.user.userPrincipalName), \\\"unknown\\\")\\r\\n| where \\\"{User:lable}\\\" == \\\"All\\\" or initiator in ({User})\\r\\n| summarize Count = count() by Category\\r\\n| order by Count desc, Category asc\\r\\n| project Value = Category, Label = strcat(Category, ' - ', Count)\",             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"selectAllValue\": \"All\"             },             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\"           },           {             \"id\": \"4d2b245b-5e59-4eb6-9f51-ba926581ab47\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Result\",             \"type\": 2,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"AuditLogs\\r\\n| extend initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \\\"\\\", tostring(InitiatedBy.user.userPrincipalName), \\\"unknown\\\")\\r\\n| where \\\"{User:lable}\\\" == \\\"All\\\" or initiator in ({User})\\r\\n| summarize Count = count() by Result\\r\\n| order by Count desc, Result asc\\r\\n| project Value = Result, Label = strcat(Result, ' - ', Count, ' sign-ins')\",             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"selectAllValue\": \"All\"             },             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\"           }         ],         \"style\": \"pills\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"name\": \"parameters - 1\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let data = AuditLogs\\r\\n| where \\\"{Category:lable}\\\" == \\\"All\\\" or Category in ({Category})\\r\\n| where \\\"{Result:lable}\\\" == \\\"All\\\" or Result in ({Result})\\r\\n| extend initiatingUserPrincipalName = tostring(InitiatedBy.user.userPrincipalName)\\r\\n| where initiatingUserPrincipalName != \\\"\\\" \\r\\n| where \\\"{User:lable}\\\" == \\\"All\\\" or initiatingUserPrincipalName in ({User});\\r\\ndata\\r\\n| summarize Count = count() by Category\\r\\n| join kind = fullouter (datatable(Category:string)['Medium', 'high', 'low']) on Category\\r\\n| project Category = iff(Category == '', Category1, Category), Count = iff(Category == '', 0, Count)\\r\\n| join kind = inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by Category)\\r\\n    on Category\\r\\n| project-away Category1, TimeGenerated\\r\\n| extend Category = Category\\r\\n| union (\\r\\n    data \\r\\n    | summarize Count = count() \\r\\n    | extend jkey = 1\\r\\n    | join kind=inner (data\\r\\n        | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n        | extend jkey = 1) on jkey\\r\\n    | extend Category = 'All', Categorys = '*'    \\r\\n)\\r\\n| order by Count desc\\r\\n| take 10\",         \"size\": 4,         \"exportFieldName\": \"Category\",         \"exportParameterName\": \"CategoryFIlter\",         \"exportDefaultValue\": \"All\",         \"exportToExcelOptions\": \"visible\",         \"title\": \"Categories volume\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"tiles\",         \"tileSettings\": {           \"titleContent\": {             \"columnMatch\": \"Category\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"leftContent\": {             \"columnMatch\": \"Count\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\",               \"showIcon\": true             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"style\": \"decimal\",                 \"maximumFractionDigits\": 2,                 \"maximumSignificantDigits\": 3               }             }           },           \"secondaryContent\": {             \"columnMatch\": \"Trend\",             \"formatter\": 21,             \"formatOptions\": {               \"palette\": \"purple\",               \"showIcon\": true             }           },           \"showBorder\": false         }       },       \"name\": \"query - 4\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let data = AuditLogs\\r\\n| where \\\"{Result:lable}\\\" == \\\"All\\\" or Result in ({Result})\\r\\n| extend initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \\\"\\\", tostring(InitiatedBy.user.userPrincipalName), \\\"unknown\\\")\\r\\n| where \\\"{User:lable}\\\" == \\\"All\\\" or initiator in ({User})\\r\\n| where \\\"{Category:lable}\\\" == \\\"All\\\" or Category in ({Category})\\r\\n| where Category == '{CategoryFIlter}' or '{CategoryFIlter}' == \\\"All\\\";\\r\\nlet appData = data\\r\\n| summarize TotalCount = count() by OperationName, Category\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by OperationName\\r\\n    | project-away TimeGenerated) on OperationName\\r\\n| order by TotalCount desc, OperationName asc\\r\\n| project OperationName, TotalCount, Trend, Category\\r\\n| serialize Id = row_number();\\r\\ndata\\r\\n| summarize TotalCount = count() by initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \\\"\\\", tostring(InitiatedBy.user.userPrincipalName), \\\"unknown\\\"), Category, OperationName\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by OperationName, initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \\\"\\\", tostring(InitiatedBy.user.userPrincipalName), \\\"unknown\\\")\\r\\n    | project-away TimeGenerated) on OperationName, initiator\\r\\n| order by TotalCount desc, OperationName asc\\r\\n| project OperationName, initiator, TotalCount, Category, Trend\\r\\n| serialize Id = row_number(1000000)\\r\\n| join kind=inner (appData) on OperationName\\r\\n| project Id, Name = initiator, Type = 'initiator', ['Operations Count'] = TotalCount, Trend, Category, ParentId = Id1\\r\\n| union (appData \\r\\n    | project Id, Name = OperationName, Type = 'Operation', ['Operations Count'] = TotalCount, Category, Trend)\\r\\n| order by ['Operations Count'] desc, Name asc\",         \"size\": 0,         \"exportParameterName\": \"UserInfo\",         \"exportDefaultValue\": \"{ \\\"Name\\\":\\\"\\\", \\\"Type\\\":\\\"*\\\"}\",         \"showAnalytics\": true,         \"showExportToExcel\": true,         \"exportToExcelOptions\": \"visible\",         \"title\": \"User activities\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Id\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Name\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Type\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Operations Count\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"blue\",                 \"showIcon\": true               },               \"numberFormat\": {                 \"unit\": 0,                 \"options\": {                   \"style\": \"decimal\"                 }               }             },             {               \"columnMatch\": \"Trend\",               \"formatter\": 9,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"turquoise\",                 \"showIcon\": true               },               \"numberFormat\": {                 \"unit\": 0,                 \"options\": {                   \"style\": \"decimal\"                 }               }             },             {               \"columnMatch\": \"Category\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ParentId\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"rowLimit\": 1000,           \"filter\": true,           \"hierarchySettings\": {             \"idColumn\": \"Id\",             \"parentColumn\": \"ParentId\",             \"treeType\": 0,             \"expanderColumn\": \"Name\"           },           \"labelSettings\": []         }       },       \"customWidth\": \"70\",       \"showPin\": true,       \"name\": \"query - 2\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let details = dynamic({UserInfo});\\r\\nAuditLogs\\r\\n| where \\\"{Category:lable}\\\" == \\\"All\\\" or Category in ({Category})\\r\\n| where \\\"{Result:lable}\\\" == \\\"All\\\" or Result in ({Result})\\r\\n| extend initiatingUserPrincipalName = iif (tostring(InitiatedBy.user.userPrincipalName) != \\\"\\\", tostring(InitiatedBy.user.userPrincipalName), \\\"unknown\\\")\\r\\n//| where initiatingUserPrincipalName != \\\"\\\" \\r\\n| where \\\"{User:lable}\\\" == \\\"All\\\" or initiatingUserPrincipalName in ({User})\\r\\n| where details.Type == '*' or (details.Type == 'initiator' and initiatingUserPrincipalName == details.Name) or (details.Type == 'Operation' and OperationName == details.Name)\\r\\n| summarize Activities = count() by initiatingUserPrincipalName\\r\\n| sort by Activities desc nulls last \",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Top active users\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"30\",       \"name\": \"query - 3\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let details = dynamic({UserInfo});\\r\\nlet data = AuditLogs\\r\\n| extend initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \\\"\\\", tostring(InitiatedBy.user.userPrincipalName), \\\"unknown\\\")\\r\\n| where details.Type == '*' or (details.Type == 'initiator' and initiator == details.Name) or (details.Type == 'Operation' and OperationName == details.Name)\\r\\n| where \\\"{Category:lable}\\\" == \\\"All\\\" or Category in ({Category})\\r\\n| where \\\"{Result:lable}\\\" == \\\"All\\\" or Result in ({Result})\\r\\n| where \\\"{User:lable}\\\" == \\\"All\\\" or initiator in ({User});\\r\\nlet appData = data\\r\\n| summarize TotalCount = count() by Result\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Result\\r\\n    | project-away TimeGenerated) on Result\\r\\n| order by TotalCount desc, Result asc\\r\\n| project Result, TotalCount, Trend\\r\\n| serialize Id = row_number();\\r\\ndata\\r\\n| summarize TotalCount = count() by OperationName, Result\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Result, OperationName\\r\\n    | project-away TimeGenerated) on Result, OperationName\\r\\n| order by TotalCount desc, Result asc\\r\\n| project Result, OperationName, TotalCount, Trend\\r\\n| serialize Id = row_number(1000000)\\r\\n| join kind=inner (appData) on Result\\r\\n| project Id, Name = OperationName, Type = 'Operation', ['Results Count'] = TotalCount, Trend, ParentId = Id1\\r\\n| union (appData \\r\\n    | project Id, Name = Result, Type = 'Result', ['Results Count'] = TotalCount, Trend)\\r\\n| order by ['Results Count'] desc, Name asc\",         \"size\": 0,         \"exportParameterName\": \"ResultInfo\",         \"exportDefaultValue\": \"{ \\\"Name\\\":\\\"\\\", \\\"Type\\\":\\\"*\\\"}\",         \"exportToExcelOptions\": \"visible\",         \"title\": \"Result status\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Id\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Name\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Type\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Results Count\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"grayBlue\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Trend\",               \"formatter\": 9,               \"formatOptions\": {                 \"palette\": \"greenDark\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ParentId\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Category\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"hierarchySettings\": {             \"idColumn\": \"Id\",             \"parentColumn\": \"ParentId\",             \"treeType\": 0,             \"expanderColumn\": \"Name\"           },           \"labelSettings\": []         }       },       \"customWidth\": \"70\",       \"name\": \"query - 5\"     }   ],   \"styleSettings\": {},   \"fromTemplateId\": \"sentinel-AzureActiveDirectoryAuditLogs\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('AzureActiveDirectorySignins_id')]",
                          "properties":  {
                                             "displayName":  "Security - Azure Active Directory Signins",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"## Sign-in Analysis\"       },       \"name\": \"text - 0\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"query\": \"\",         \"crossComponentResources\": [],         \"parameters\": [           {             \"id\": \"13f56671-7604-4427-a4d8-663f3da0cbc5\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 1209600000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000,                   \"createdTime\": \"2018-11-13T19:33:10.162Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 900000,                   \"createdTime\": \"2018-11-13T19:33:10.164Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 1800000,                   \"createdTime\": \"2018-11-13T19:33:10.164Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 3600000,                   \"createdTime\": \"2018-11-13T19:33:10.164Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 14400000,                   \"createdTime\": \"2018-11-13T19:33:10.164Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 43200000,                   \"createdTime\": \"2018-11-13T19:33:10.164Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 86400000,                   \"createdTime\": \"2018-11-13T19:33:10.165Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 172800000,                   \"createdTime\": \"2018-11-13T19:33:10.166Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 259200000,                   \"createdTime\": \"2018-11-13T19:33:10.166Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 604800000,                   \"createdTime\": \"2018-11-13T19:33:10.166Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 1209600000,                   \"createdTime\": \"2018-11-13T19:33:10.166Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 2592000000,                   \"createdTime\": \"2018-11-13T19:33:10.167Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 }               ],               \"allowCustom\": true             }           },           {             \"id\": \"3b5cc420-8ad8-4523-ba28-a54910756794\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Apps\",             \"type\": 2,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"SigninLogs\\r\\n| summarize Count = count() by AppDisplayName\\r\\n| order by Count desc, AppDisplayName asc\\r\\n| project Value = AppDisplayName, Label = strcat(AppDisplayName, ' - ', Count, ' sign-ins'), Selected = false\\r\\n\",             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"limitSelectTo\": 10,               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"selectAllValue\": \"*\"             },             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\"           },           {             \"id\": \"f7f7970b-58c1-474f-9043-62243d2d4edd\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Users\",             \"type\": 2,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"SigninLogs\\r\\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\\r\\n| summarize Count = count() by UserDisplayName\\r\\n| order by Count desc, UserDisplayName asc\\r\\n| project Value = UserDisplayName, Label = strcat(UserDisplayName, ' - ', Count, ' sign-ins'), Selected = false\\r\\n\",             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"limitSelectTo\": 20,               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"selectAllValue\": \"*\"             },             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\"           }         ],         \"style\": \"pills\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"name\": \"parameters - 1\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let data = SigninLogs\\r\\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\\r\\n|where UserDisplayName in ({Users}) or '*' in ({Users})\\r\\n|extend errorCode = Status.errorCode\\r\\n|extend SigninStatus = case(errorCode == 0, \\\"Success\\\", errorCode == 50058, \\\"Pending user action\\\",errorCode == 50140, \\\"Pending user action\\\", errorCode == 51006, \\\"Pending user action\\\", errorCode == 50059, \\\"Pending user action\\\",errorCode == 65001, \\\"Pending user action\\\", errorCode == 52004, \\\"Pending user action\\\", errorCode == 50055, \\\"Pending user action\\\", errorCode == 50144, \\\"Pending user action\\\", errorCode == 50072, \\\"Pending user action\\\", errorCode == 50074, \\\"Pending user action\\\", errorCode == 16000, \\\"Pending user action\\\", errorCode == 16001, \\\"Pending user action\\\", errorCode == 16003, \\\"Pending user action\\\", errorCode == 50127, \\\"Pending user action\\\", errorCode == 50125, \\\"Pending user action\\\", errorCode == 50129, \\\"Pending user action\\\", errorCode == 50143, \\\"Pending user action\\\", errorCode == 81010, \\\"Pending user action\\\", errorCode == 81014, \\\"Pending user action\\\", errorCode == 81012 ,\\\"Pending user action\\\", \\\"Failure\\\");\\r\\ndata\\r\\n| summarize Count = count() by SigninStatus\\r\\n| join kind = fullouter (datatable(SigninStatus:string)['Success', 'Pending action (Interrupts)', 'Failure']) on SigninStatus\\r\\n| project SigninStatus = iff(SigninStatus == '', SigninStatus1, SigninStatus), Count = iff(SigninStatus == '', 0, Count)\\r\\n| join kind = inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SigninStatus)\\r\\n    on SigninStatus\\r\\n| project-away SigninStatus1, TimeGenerated\\r\\n| extend Status = SigninStatus\\r\\n| union (\\r\\n    data \\r\\n    | summarize Count = count() \\r\\n    | extend jkey = 1\\r\\n    | join kind=inner (data\\r\\n        | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n        | extend jkey = 1) on jkey\\r\\n    | extend SigninStatus = 'All Sign-ins', Status = '*'    \\r\\n)\\r\\n| order by Count desc\\r\\n\\r\\n\\r\\n\\r\\n\",         \"size\": 3,         \"exportFieldName\": \"Status\",         \"exportParameterName\": \"SigninStatus\",         \"exportDefaultValue\": \"*\",         \"exportToExcelOptions\": \"visible\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"tiles\",         \"tileSettings\": {           \"titleContent\": {             \"columnMatch\": \"SigninStatus\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"leftContent\": {             \"columnMatch\": \"Count\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"blue\",               \"showIcon\": true             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"style\": \"decimal\",                 \"maximumFractionDigits\": 2,                 \"maximumSignificantDigits\": 3               }             }           },           \"secondaryContent\": {             \"columnMatch\": \"Trend\",             \"formatter\": 9,             \"formatOptions\": {               \"min\": 0,               \"palette\": \"blue\",               \"showIcon\": true             }           },           \"showBorder\": false         }       },       \"name\": \"query - 5\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"\u003cbr /\u003e\\r\\n?? _Click on a tile or a row in the grid to drill-in further_\"       },       \"name\": \"text - 6 - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let data = SigninLogs\\r\\n| extend AppDisplayName = iff(AppDisplayName == '', 'Unknown', AppDisplayName)\\r\\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\\r\\n|where UserDisplayName in ({Users}) or '*' in ({Users})\\r\\n| extend Country = iff(LocationDetails.countryOrRegion == '', 'Unknown country', tostring(LocationDetails.countryOrRegion))\\r\\n| extend City = iff(LocationDetails.city == '', 'Unknown city', tostring(LocationDetails.city))\\r\\n| extend errorCode = Status.errorCode\\r\\n| extend SigninStatus = case(errorCode == 0, \\\"Success\\\", errorCode == 50058, \\\"Pending user action\\\",errorCode == 50140, \\\"Pending user action\\\", errorCode == 51006, \\\"Pending user action\\\", errorCode == 50059, \\\"Pending user action\\\",errorCode == 65001, \\\"Pending user action\\\", errorCode == 52004, \\\"Pending user action\\\", errorCode == 50055, \\\"Pending user action\\\", errorCode == 50144, \\\"Pending user action\\\", errorCode == 50072, \\\"Pending user action\\\", errorCode == 50074, \\\"Pending user action\\\", errorCode == 16000, \\\"Pending user action\\\", errorCode == 16001, \\\"Pending user action\\\", errorCode == 16003, \\\"Pending user action\\\", errorCode == 50127, \\\"Pending user action\\\", errorCode == 50125, \\\"Pending user action\\\", errorCode == 50129, \\\"Pending user action\\\", errorCode == 50143, \\\"Pending user action\\\", errorCode == 81010, \\\"Pending user action\\\", errorCode == 81014, \\\"Pending user action\\\", errorCode == 81012 ,\\\"Pending user action\\\", \\\"Failure\\\")\\r\\n| where SigninStatus == '{SigninStatus}' or '{SigninStatus}' == '*' or '{SigninStatus}' == 'All Sign-ins';\\r\\nlet countryData = data\\r\\n| summarize TotalCount = count(), SuccessCount = countif(SigninStatus == \\\"Success\\\"), FailureCount = countif(SigninStatus == \\\"Failure\\\"), InterruptCount = countif(SigninStatus == \\\"Pending user action\\\") by Country\\r\\n| join kind=inner\\r\\n(\\r\\n    data\\r\\n   | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by  Country\\r\\n    | project-away TimeGenerated\\r\\n)\\r\\non Country\\r\\n| project Country, TotalCount, SuccessCount,FailureCount,InterruptCount,  Trend\\r\\n| order by TotalCount desc, Country asc;\\r\\ndata\\r\\n| summarize TotalCount = count(), SuccessCount = countif(SigninStatus == \\\"Success\\\"), FailureCount = countif(SigninStatus == \\\"Failure\\\"), InterruptCount = countif(SigninStatus == \\\"Pending user action\\\") by Country, City\\r\\n| join kind=inner\\r\\n(\\r\\n    data    \\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Country, City\\r\\n    | project-away TimeGenerated\\r\\n)\\r\\non Country, City\\r\\n| order by TotalCount desc, Country asc\\r\\n| project Country, City,TotalCount, SuccessCount,FailureCount,InterruptCount, Trend\\r\\n| join kind=inner\\r\\n(\\r\\n    countryData\\r\\n)\\r\\non Country\\r\\n| project Id = City, Name = City, Type = 'City', ['Sign-in Count'] = TotalCount, Trend, ['Failure Count'] = FailureCount, ['Interrupt Count'] = InterruptCount, ['Success Rate'] = 1.0 * SuccessCount / TotalCount, ParentId = Country\\r\\n| union (countryData\\r\\n| project Id = Country, Name = Country, Type = 'Country', ['Sign-in Count'] = TotalCount, Trend, ['Failure Count'] = FailureCount, ['Interrupt Count'] = InterruptCount, ['Success Rate'] = 1.0 * SuccessCount / TotalCount, ParentId = 'root')\\r\\n| order by ['Sign-in Count'] desc, Name asc\",         \"size\": 1,         \"exportParameterName\": \"LocationDetail\",         \"exportDefaultValue\": \"{ \\\"Name\\\":\\\"\\\", \\\"Type\\\":\\\"*\\\"}\",         \"showAnalytics\": true,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Sign-ins by Location\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Id\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Type\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Sign-in Count\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"blue\",                 \"showIcon\": true               },               \"numberFormat\": {                 \"unit\": 17,                 \"options\": {                   \"style\": \"decimal\"                 }               }             },             {               \"columnMatch\": \"Trend\",               \"formatter\": 9,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"blue\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Failure Count|Interrupt Count\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"orange\",                 \"showIcon\": true               },               \"numberFormat\": {                 \"unit\": 17,                 \"options\": {                   \"style\": \"decimal\"                 }               }             },             {               \"columnMatch\": \"Success Rate\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               },               \"numberFormat\": {                 \"unit\": 0,                 \"options\": {                   \"style\": \"percent\"                 }               }             },             {               \"columnMatch\": \"ParentId\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"filter\": true,           \"hierarchySettings\": {             \"idColumn\": \"Id\",             \"parentColumn\": \"ParentId\",             \"treeType\": 0,             \"expanderColumn\": \"Name\",             \"expandTopLevel\": false           },           \"labelSettings\": []         }       },       \"customWidth\": \"67\",       \"showPin\": true,       \"name\": \"query - 8\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let details = dynamic({LocationDetail});\\r\\nlet data = SigninLogs\\r\\n| extend AppDisplayName = iff(AppDisplayName == '', 'Unknown', AppDisplayName)\\r\\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\\r\\n|where UserDisplayName in ({Users}) or '*' in ({Users})\\r\\n| extend Country = tostring(LocationDetails.countryOrRegion)\\r\\n| extend City = tostring(LocationDetails.city)\\r\\n| extend errorCode = Status.errorCode\\r\\n| extend SigninStatus = case(errorCode == 0, \\\"Success\\\", errorCode == 50058, \\\"Pending user action\\\",errorCode == 50140, \\\"Pending user action\\\", errorCode == 51006, \\\"Pending user action\\\", errorCode == 50059, \\\"Pending user action\\\",errorCode == 65001, \\\"Pending user action\\\", errorCode == 52004, \\\"Pending user action\\\", errorCode == 50055, \\\"Pending user action\\\", errorCode == 50144, \\\"Pending user action\\\", errorCode == 50072, \\\"Pending user action\\\", errorCode == 50074, \\\"Pending user action\\\", errorCode == 16000, \\\"Pending user action\\\", errorCode == 16001, \\\"Pending user action\\\", errorCode == 16003, \\\"Pending user action\\\", errorCode == 50127, \\\"Pending user action\\\", errorCode == 50125, \\\"Pending user action\\\", errorCode == 50129, \\\"Pending user action\\\", errorCode == 50143, \\\"Pending user action\\\", errorCode == 81010, \\\"Pending user action\\\", errorCode == 81014, \\\"Pending user action\\\", errorCode == 81012 ,\\\"Pending user action\\\", \\\"Failure\\\")\\r\\n| where SigninStatus == '{SigninStatus}' or '{SigninStatus}' == '*' or '{SigninStatus}' == 'All Sign-ins'\\r\\n| where details.Type == '*' or (details.Type == 'Country' and Country == details.Name) or (details.Type == 'City' and City == details.Name);\\r\\ndata\\r\\n| top 200 by TimeGenerated desc\\r\\n| extend TimeFromNow = now() - TimeGenerated\\r\\n| extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n| project User = UserDisplayName, ['Sign-in Status'] = strcat(iff(SigninStatus == 'Success', '??', '?'), ' ', SigninStatus), ['Sign-in Time'] = TimeAgo, App = AppDisplayName, ['Error code'] = errorCode, ['Result type'] = ResultType, ['Result signature'] = ResultSignature, ['Result description'] = ResultDescription, ['Conditional access policies'] = ConditionalAccessPolicies, ['Conditional access status'] = ConditionalAccessStatus, ['Operating system'] = DeviceDetail.operatingSystem, Browser = DeviceDetail.browser, ['Country or region'] = LocationDetails.countryOrRegion, ['State'] = LocationDetails.state, ['City'] = LocationDetails.city, ['Time generated'] = TimeGenerated, Status, ['User principal name'] = UserPrincipalName\\r\\n\\r\\n\",         \"size\": 1,         \"showAnalytics\": true,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Location Sign-in details\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Sign-in Status\",               \"formatter\": 7,               \"formatOptions\": {                 \"linkTarget\": \"CellDetails\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"App\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Error code\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Result type\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Result signature\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Result description\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Conditional access policies\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Conditional access status\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Operating system\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Browser\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Country or region\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"State\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"City\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Time generated\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Status\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"User principal name\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"TimeGenerated\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"filter\": true,           \"labelSettings\": []         }       },       \"customWidth\": \"33\",       \"name\": \"query - 8\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"\"       },       \"name\": \"text - 5\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let data = SigninLogs\\r\\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\\r\\n|where UserDisplayName in ({Users}) or '*' in ({Users})\\r\\n| extend errorCode = Status.errorCode\\r\\n| extend SigninStatus = case(errorCode == 0, \\\"Success\\\", errorCode == 50058, \\\"Pending user action\\\",errorCode == 50140, \\\"Pending user action\\\", errorCode == 51006, \\\"Pending user action\\\", errorCode == 50059, \\\"Pending user action\\\",errorCode == 65001, \\\"Pending user action\\\", errorCode == 52004, \\\"Pending user action\\\", errorCode == 50055, \\\"Pending user action\\\", errorCode == 50144, \\\"Pending user action\\\", errorCode == 50072, \\\"Pending user action\\\", errorCode == 50074, \\\"Pending user action\\\", errorCode == 16000, \\\"Pending user action\\\", errorCode == 16001, \\\"Pending user action\\\", errorCode == 16003, \\\"Pending user action\\\", errorCode == 50127, \\\"Pending user action\\\", errorCode == 50125, \\\"Pending user action\\\", errorCode == 50129, \\\"Pending user action\\\", errorCode == 50143, \\\"Pending user action\\\", errorCode == 81010, \\\"Pending user action\\\", errorCode == 81014, \\\"Pending user action\\\", errorCode == 81012 ,\\\"Pending user action\\\", \\\"Failure\\\")\\r\\n| where SigninStatus == '{SigninStatus}' or '{SigninStatus}' == '*' or '{SigninStatus}' == 'All Sign-ins';\\r\\nlet appData = data\\r\\n| summarize TotalCount = count(), SuccessCount = countif(SigninStatus == \\\"Success\\\"), FailureCount = countif(SigninStatus == \\\"Failure\\\"), InterruptCount = countif(SigninStatus == \\\"Pending user action\\\") by Os = tostring(DeviceDetail.operatingSystem)\\r\\n| where Os != ''\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Os = tostring(DeviceDetail.operatingSystem)\\r\\n    | project-away TimeGenerated) on Os\\r\\n| order by TotalCount desc, Os asc\\r\\n| project Os, TotalCount, SuccessCount, FailureCount, InterruptCount, Trend\\r\\n| serialize Id = row_number();\\r\\ndata\\r\\n| summarize TotalCount = count(), SuccessCount = countif(SigninStatus == \\\"Success\\\"), FailureCount = countif(SigninStatus == \\\"Failure\\\"), InterruptCount = countif(SigninStatus == \\\"Pending user action\\\") by Os = tostring(DeviceDetail.operatingSystem), Browser = tostring(DeviceDetail.browser)\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Os = tostring(DeviceDetail.operatingSystem), Browser = tostring(DeviceDetail.browser)\\r\\n    | project-away TimeGenerated) on Os, Browser\\r\\n| order by TotalCount desc, Os asc\\r\\n| project Os, Browser, TotalCount, SuccessCount, FailureCount, InterruptCount, Trend\\r\\n| serialize Id = row_number(1000000)\\r\\n| join kind=inner (appData) on Os\\r\\n| project Id, Name = Browser, Type = 'Browser', ['Sign-in Count'] = TotalCount, Trend, ['Failure Count'] = FailureCount, ['Interrupt Count'] = InterruptCount, ['Success Rate'] = 1.0 * SuccessCount / TotalCount, ParentId = Id1\\r\\n| union (appData \\r\\n    | project Id, Name = Os, Type = 'Operating System', ['Sign-in Count'] = TotalCount, Trend, ['Failure Count'] = FailureCount, ['Interrupt Count'] = InterruptCount, ['Success Rate'] = 1.0 * SuccessCount / TotalCount, ParentId = -1)\\r\\n| order by ['Sign-in Count'] desc, Name asc\",         \"size\": 1,         \"exportParameterName\": \"DeviceDetail\",         \"exportDefaultValue\": \"{ \\\"Name\\\":\\\"\\\", \\\"Type\\\":\\\"*\\\"}\",         \"showAnalytics\": true,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Sign-ins by Device\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Id\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Type\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Sign-in Count\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"blue\",                 \"showIcon\": true               },               \"numberFormat\": {                 \"unit\": 17,                 \"options\": {                   \"style\": \"decimal\"                 }               }             },             {               \"columnMatch\": \"Trend\",               \"formatter\": 9,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"blue\",                 \"showIcon\": true               },               \"numberFormat\": {                 \"unit\": 17,                 \"options\": {                   \"style\": \"decimal\"                 }               }             },             {               \"columnMatch\": \"Failure Count|Interrupt Count\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"orange\",                 \"showIcon\": true               },               \"numberFormat\": {                 \"unit\": 17,                 \"options\": {                   \"style\": \"decimal\"                 }               }             },             {               \"columnMatch\": \"Success Rate\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               },               \"numberFormat\": {                 \"unit\": 0,                 \"options\": {                   \"style\": \"percent\"                 }               }             },             {               \"columnMatch\": \"ParentId\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"filter\": true,           \"hierarchySettings\": {             \"idColumn\": \"Id\",             \"parentColumn\": \"ParentId\",             \"treeType\": 0,             \"expanderColumn\": \"Name\",             \"expandTopLevel\": false           },           \"labelSettings\": []         }       },       \"customWidth\": \"67\",       \"showPin\": true,       \"name\": \"query - 9\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let details = dynamic({DeviceDetail});\\r\\nlet data = SigninLogs\\r\\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\\r\\n|where UserDisplayName in ({Users}) or '*' in ({Users})\\r\\n| extend errorCode = Status.errorCode\\r\\n| extend SigninStatus = case(errorCode == 0, \\\"Success\\\", errorCode == 50058, \\\"Pending user action\\\",errorCode == 50140, \\\"Pending user action\\\", errorCode == 51006, \\\"Pending user action\\\", errorCode == 50059, \\\"Pending user action\\\",errorCode == 65001, \\\"Pending user action\\\", errorCode == 52004, \\\"Pending user action\\\", errorCode == 50055, \\\"Pending user action\\\", errorCode == 50144, \\\"Pending user action\\\", errorCode == 50072, \\\"Pending user action\\\", errorCode == 50074, \\\"Pending user action\\\", errorCode == 16000, \\\"Pending user action\\\", errorCode == 16001, \\\"Pending user action\\\", errorCode == 16003, \\\"Pending user action\\\", errorCode == 50127, \\\"Pending user action\\\", errorCode == 50125, \\\"Pending user action\\\", errorCode == 50129, \\\"Pending user action\\\", errorCode == 50143, \\\"Pending user action\\\", errorCode == 81010, \\\"Pending user action\\\", errorCode == 81014, \\\"Pending user action\\\", errorCode == 81012 ,\\\"Pending user action\\\", \\\"Failure\\\")\\r\\n| where SigninStatus == '{SigninStatus}' or '{SigninStatus}' == '*' or '{SigninStatus}' == 'All Sign-ins'\\r\\n| extend Os = tostring(DeviceDetail.operatingSystem), Browser = tostring(DeviceDetail.browser)\\r\\n| where details.Type == '*' or (details.Type == 'Operating System' and Os == details.Name) or (details.Type == 'Browser' and Browser == details.Name);\\r\\ndata\\r\\n| order by TimeGenerated desc\\r\\n| top 200 by TimeGenerated desc\\r\\n| extend TimeFromNow = now() - TimeGenerated\\r\\n| extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n| project User = UserDisplayName, ['Sign-in Status'] = strcat(iff(SigninStatus == 'Success', '??', '?'), ' ', SigninStatus), ['Sign-in Time'] = TimeAgo, App = AppDisplayName, ['Error code'] = errorCode, ['Result type'] = ResultType, ['Result signature'] = ResultSignature, ['Result description'] = ResultDescription, ['Conditional access policies'] = ConditionalAccessPolicies, ['Conditional access status'] = ConditionalAccessStatus, ['Operating system'] = DeviceDetail.operatingSystem, Browser = DeviceDetail.browser, ['Country or region'] = LocationDetails.countryOrRegion, ['State'] = LocationDetails.state, ['City'] = LocationDetails.city, ['Time generated'] = TimeGenerated, Status, ['User principal name'] = UserPrincipalName\\r\\n\\r\\n\",         \"size\": 1,         \"showAnalytics\": true,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Device Sign-in details\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Sign-in Status\",               \"formatter\": 7,               \"formatOptions\": {                 \"linkTarget\": \"CellDetails\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"App\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Error code\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Result type\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Result signature\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Result description\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Conditional access policies\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Conditional access status\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Operating system\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Browser\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Country or region\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"State\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"City\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Time generated\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Status\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"User principal name\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"filter\": true,           \"labelSettings\": []         }       },       \"customWidth\": \"33\",       \"name\": \"query - 8 - Copy\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Sign-ins using Conditional Access\"       },       \"name\": \"text - 12\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let data = SigninLogs\\r\\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\\r\\n|where UserDisplayName in ({Users}) or '*' in ({Users})\\r\\n|extend CAStatus = case(ConditionalAccessStatus ==\\\"success\\\",\\\"Successful\\\",\\r\\n                    ConditionalAccessStatus == \\\"failure\\\", \\\"Failed\\\",                                     \\r\\n                    ConditionalAccessStatus == \\\"notApplied\\\", \\\"Not applied\\\",                                     \\r\\n                    isempty(ConditionalAccessStatus), \\\"Not applied\\\", \\r\\n                    \\\"Disabled\\\")\\r\\n|mvexpand ConditionalAccessPolicies\\r\\n|extend CAGrantControlName = tostring(ConditionalAccessPolicies.enforcedGrantControls[0])\\r\\n|extend CAGrantControl = case(CAGrantControlName contains \\\"MFA\\\", \\\"Require MFA\\\", \\r\\n                            CAGrantControlName contains \\\"Terms of Use\\\", \\\"Require Terms of Use\\\", \\r\\n                            CAGrantControlName contains \\\"Privacy\\\", \\\"Require Privacy Statement\\\", \\r\\n                            CAGrantControlName contains \\\"Device\\\", \\\"Require Device Compliant\\\", \\r\\n                            CAGrantControlName contains \\\"Azure AD Joined\\\", \\\"Require Hybird Azure AD Joined Device\\\", \\r\\n                            CAGrantControlName contains \\\"Apps\\\", \\\"Require Approved Apps\\\",\\r\\n                            \\\"Other\\\");\\r\\ndata\\r\\n| summarize Count = dcount(Id) by CAStatus\\r\\n| join kind = inner (data\\r\\n                    | make-series Trend = dcount(Id) default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by CAStatus\\r\\n                    ) on CAStatus\\r\\n| project-away CAStatus1, TimeGenerated\\r\\n| order by Count desc\",         \"size\": 4,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Conditional access status\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"tiles\",         \"tileSettings\": {           \"titleContent\": {             \"columnMatch\": \"CAStatus\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"leftContent\": {             \"columnMatch\": \"Count\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\",               \"showIcon\": true             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           },           \"secondaryContent\": {             \"columnMatch\": \"Trend\",             \"formatter\": 9,             \"formatOptions\": {               \"showIcon\": true             }           },           \"showBorder\": false         }       },       \"name\": \"query - 9\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let data = SigninLogs\\r\\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\\r\\n|where UserDisplayName in ({Users}) or '*' in ({Users})\\r\\n|extend errorCode = toint(Status.errorCode)\\r\\n|extend Reason = tostring(Status.failureReason)\\r\\n|extend CAStatus = case(ConditionalAccessStatus ==0,\\\"?? Success\\\",                                     \\r\\n                        ConditionalAccessStatus == 1, \\\"? Failure\\\",                                     \\r\\n                        ConditionalAccessStatus == 2, \\\"?? Not Applied\\\",                                     \\r\\n                        ConditionalAccessStatus == \\\"\\\", \\\"?? Not Applied\\\", \\r\\n                        \\\"?? Disabled\\\")\\r\\n|mvexpand ConditionalAccessPolicies\\r\\n|extend CAGrantControlName = tostring(ConditionalAccessPolicies.enforcedGrantControls[0])\\r\\n|extend CAGrantControl = case(CAGrantControlName contains \\\"MFA\\\", \\\"Require MFA\\\", \\r\\n                            CAGrantControlName contains \\\"Terms of Use\\\", \\\"Require Terms of Use\\\", \\r\\n                            CAGrantControlName contains \\\"Privacy\\\", \\\"Require Privacy Statement\\\", \\r\\n                            CAGrantControlName contains \\\"Device\\\", \\\"Require Device Compliant\\\", \\r\\n                            CAGrantControlName contains \\\"Azure AD Joined\\\", \\\"Require Hybird Azure AD Joined Device\\\", \\r\\n                            CAGrantControlName contains \\\"Apps\\\", \\\"Require Approved Apps\\\",\\\"Other\\\");\\r\\ndata\\r\\n| summarize Count = dcount(Id) by CAStatus, CAGrantControl\\r\\n| project Id = strcat(CAStatus, '/', CAGrantControl), Name = CAGrantControl, Parent = CAStatus, Count, Type = 'CAGrantControl'\\r\\n| join kind = inner (data\\r\\n                    | make-series Trend = dcount(Id) default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by CAStatus, CAGrantControl\\r\\n                    | project Id = strcat(CAStatus, '/', CAGrantControl), Trend\\r\\n                    ) on Id\\r\\n| project-away Id1\\r\\n| union (data\\r\\n    | summarize Count = dcount(Id) by CAStatus\\r\\n    | project Id = CAStatus, Name = CAStatus, Parent = '', Count, Type = 'CAStatus'\\r\\n    | join kind = inner (data\\r\\n                        | make-series Trend = dcount(Id) default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by CAStatus\\r\\n                        | project Id = CAStatus, Trend\\r\\n                        ) on Id\\r\\n    | project-away Id1)\\r\\n| order by Count desc\",         \"size\": 0,         \"exportParameterName\": \"Detail\",         \"exportDefaultValue\": \"{ \\\"Name\\\":\\\"\\\", \\\"Type\\\":\\\"*\\\", \\\"Parent\\\":\\\"*\\\"}\",         \"exportToExcelOptions\": \"visible\",         \"title\": \"Conditional access status\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Id\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Name\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Parent\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Count\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"blue\",                 \"showIcon\": true               },               \"numberFormat\": {                 \"unit\": 0,                 \"options\": {                   \"style\": \"decimal\"                 }               }             },             {               \"columnMatch\": \"Type\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Trend\",               \"formatter\": 9,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"blue\",                 \"showIcon\": true               }             }           ],           \"hierarchySettings\": {             \"idColumn\": \"Id\",             \"parentColumn\": \"Parent\",             \"treeType\": 0,             \"expanderColumn\": \"Name\",             \"expandTopLevel\": true           },           \"labelSettings\": []         }       },       \"customWidth\": \"50\",       \"name\": \"query - 10\",       \"styleSettings\": {         \"margin\": \"50\"       }     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let details = dynamic({Detail});\\r\\nlet data = SigninLogs\\r\\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\\r\\n|where UserDisplayName in ({Users}) or '*' in ({Users})\\r\\n|extend errorCode = toint(Status.errorCode)\\r\\n|extend Reason = tostring(Status.failureReason)\\r\\n|extend CAStatus = case(ConditionalAccessStatus ==\\\"success\\\",\\\"?? Success\\\",                                     \\r\\n                        ConditionalAccessStatus == \\\"failure\\\", \\\"? Failure\\\",                                     \\r\\n                        ConditionalAccessStatus == \\\"notApplied\\\", \\\"?? Not Applied\\\",                                     \\r\\n                        ConditionalAccessStatus == \\\"\\\", \\\"?? Not Applied\\\", \\r\\n                        \\\"?? Disabled\\\")\\r\\n|mvexpand ConditionalAccessPolicies\\r\\n|extend CAGrantControlName = tostring(ConditionalAccessPolicies.enforcedGrantControls[0])\\r\\n|extend CAGrantControl = case(CAGrantControlName contains \\\"MFA\\\", \\\"Require MFA\\\", \\r\\n                            CAGrantControlName contains \\\"Terms of Use\\\", \\\"Require Terms of Use\\\", \\r\\n                            CAGrantControlName contains \\\"Privacy\\\", \\\"Require Privacy Statement\\\", \\r\\n                            CAGrantControlName contains \\\"Device\\\", \\\"Require Device Compliant\\\", \\r\\n                            CAGrantControlName contains \\\"Azure AD Joined\\\", \\\"Require Hybird Azure AD Joined Device\\\", \\r\\n                            CAGrantControlName contains \\\"Apps\\\", \\\"Require Approved Apps\\\",\\r\\n                            \\\"Other\\\")\\r\\n|extend CAGrantControlRank = case(CAGrantControlName contains \\\"MFA\\\", 1, \\r\\n                            CAGrantControlName contains \\\"Terms of Use\\\", 2, \\r\\n                            CAGrantControlName contains \\\"Privacy\\\", 3, \\r\\n                            CAGrantControlName contains \\\"Device\\\", 4, \\r\\n                            CAGrantControlName contains \\\"Azure AD Joined\\\", 5, \\r\\n                            CAGrantControlName contains \\\"Apps\\\", 6,\\r\\n                            7)\\r\\n| where details.Type == '*' or (details.Type == 'CAStatus' and CAStatus == details.Name) or (details.Type == 'CAGrantControl' and CAGrantControl == details.Name and CAStatus == details.Parent);\\r\\ndata\\r\\n| order by CAGrantControlRank desc\\r\\n| summarize CAGrantControls = make_set(CAGrantControl) by AppDisplayName, CAStatus, TimeGenerated, UserDisplayName\\r\\n| extend CAGrantControlText = replace(@\\\",\\\", \\\", \\\", replace(@'\\\"', @'', replace(@\\\"\\\\]\\\", @\\\"\\\", replace(@\\\"\\\\[\\\", @\\\"\\\", tostring(CAGrantControls)))))\\r\\n| extend CAGrantControlSummary = case(array_length(CAGrantControls) \u003e 1, strcat(CAGrantControls[0], ' + ', array_length(CAGrantControls) - 1, ' more'), array_length(CAGrantControls) == 1, tostring(CAGrantControls[0]), 'None')\\r\\n| top 200 by TimeGenerated desc\\r\\n| extend TimeFromNow = now() - TimeGenerated\\r\\n| extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n| project Application = AppDisplayName, ['CA Status'] = CAStatus, ['CA Grant Controls'] = CAGrantControlSummary, ['All CA Grant Controls'] = CAGrantControlText, ['Sign-in Time'] = TimeAgo, ['User'] = UserDisplayName\",         \"size\": 0,         \"showAnalytics\": true,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Recent sign-ins\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Application\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"CA Status\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"CA Grant Controls\",               \"formatter\": 1,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"All CA Grant Controls\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Sign-in Time\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"User\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"labelSettings\": []         }       },       \"customWidth\": \"50\",       \"showPin\": true,       \"name\": \"query - 7 - Copy\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Troubleshooting Sign-ins\"       },       \"name\": \"text - 13\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let data = SigninLogs\\r\\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\\r\\n|where UserDisplayName in ({Users}) or '*' in ({Users})\\r\\n|extend errorCode = Status.errorCode\\r\\n|extend SigninStatus = case(errorCode == 0, \\\"Success\\\", errorCode == 50058, \\\"Pending action (Interrupts)\\\",errorCode == 50140, \\\"Pending action (Interrupts)\\\", errorCode == 51006, \\\"Pending action (Interrupts)\\\", errorCode == 50059, \\\"Pending action (Interrupts)\\\",errorCode == 65001, \\\"Pending action (Interrupts)\\\", errorCode == 52004, \\\"Pending action (Interrupts)\\\", errorCode == 50055, \\\"Pending action (Interrupts)\\\", errorCode == 50144, \\\"Pending action (Interrupts)\\\", errorCode == 50072, \\\"Pending action (Interrupts)\\\", errorCode == 50074, \\\"Pending action (Interrupts)\\\", errorCode == 16000, \\\"Pending action (Interrupts)\\\", errorCode == 16001, \\\"Pending action (Interrupts)\\\", errorCode == 16003, \\\"Pending action (Interrupts)\\\", errorCode == 50127, \\\"Pending action (Interrupts)\\\", errorCode == 50125, \\\"Pending action (Interrupts)\\\", errorCode == 50129, \\\"Pending action (Interrupts)\\\", errorCode == 50143, \\\"Pending action (Interrupts)\\\", errorCode == 81010, \\\"Pending action (Interrupts)\\\", errorCode == 81014, \\\"Pending action (Interrupts)\\\", errorCode == 81012 ,\\\"Pending action (Interrupts)\\\", \\\"Failure\\\");\\r\\ndata\\r\\n| summarize Count = count() by SigninStatus\\r\\n| join kind = fullouter (datatable(SigninStatus:string)['Success', 'Pending action (Interrupts)', 'Failure']) on SigninStatus\\r\\n| project SigninStatus = iff(SigninStatus == '', SigninStatus1, SigninStatus), Count = iff(SigninStatus == '', 0, Count)\\r\\n| join kind = inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SigninStatus)\\r\\n    on SigninStatus\\r\\n| project-away SigninStatus1, TimeGenerated\\r\\n| extend Status = SigninStatus\\r\\n| union (\\r\\n    data \\r\\n    | summarize Count = count() \\r\\n    | extend jkey = 1\\r\\n    | join kind=inner (data\\r\\n        | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n        | extend jkey = 1) on jkey\\r\\n    | extend SigninStatus = 'All Sign-ins', Status = '*'    \\r\\n)\\r\\n| order by Count desc\\r\\n\\r\\n\\r\\n\\r\\n\",         \"size\": 3,         \"exportDefaultValue\": \"*\",         \"exportToExcelOptions\": \"visible\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"tiles\",         \"tileSettings\": {           \"titleContent\": {             \"columnMatch\": \"SigninStatus\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"leftContent\": {             \"columnMatch\": \"Count\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"blue\",               \"showIcon\": true             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"style\": \"decimal\",                 \"maximumFractionDigits\": 2,                 \"maximumSignificantDigits\": 3               }             }           },           \"secondaryContent\": {             \"columnMatch\": \"Trend\",             \"formatter\": 9,             \"formatOptions\": {               \"min\": 0,               \"palette\": \"blue\",               \"showIcon\": true             }           },           \"showBorder\": false         }       },       \"name\": \"query - 5\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"SigninLogs \\r\\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\\r\\n|where UserDisplayName in ({Users}) or '*' in ({Users})\\r\\n| extend ErrorCode = tostring(Status.errorCode) \\r\\n| extend FailureReason = tostring(Status.failureReason) \\r\\n| where ErrorCode !in (\\\"0\\\",\\\"50058\\\",\\\"50148\\\",\\\"50140\\\", \\\"51006\\\", \\\"50059\\\", \\\"65001\\\", \\\"52004\\\", \\\"50055\\\", \\\"50144\\\",\\\"50072\\\", \\\"50074\\\", \\\"16000\\\",\\\"16001\\\", \\\"16003\\\", \\\"50127\\\", \\\"50125\\\", \\\"50129\\\",\\\"50143\\\", \\\"81010\\\", \\\"81014\\\", \\\"81012\\\") \\r\\n|summarize errCount = count() by ErrorCode, tostring(FailureReason)| sort by errCount\\r\\n|project ['? Error Code'] = ErrorCode, ['Reason']= FailureReason, ['Error Count'] = toint(errCount)\",         \"size\": 1,         \"exportFieldName\": \"? Error Code\",         \"exportParameterName\": \"ErrorCode\",         \"exportDefaultValue\": \"*\",         \"showAnalytics\": true,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Summary of top errors\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Error Count\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"orange\",                 \"showIcon\": true               }             }           ],           \"filter\": true,           \"labelSettings\": []         }       },       \"customWidth\": \"67\",       \"showPin\": true,       \"name\": \"query - 5\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"SigninLogs \\r\\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\\r\\n|where UserDisplayName in ({Users}) or '*' in ({Users})\\r\\n| extend ErrorCode = tostring(Status.errorCode) \\r\\n| extend FailureReason = tostring(Status.failureReason) \\r\\n| where ErrorCode !in (\\\"0\\\",\\\"50058\\\",\\\"50148\\\",\\\"50140\\\", \\\"51006\\\", \\\"50059\\\", \\\"65001\\\", \\\"52004\\\", \\\"50055\\\", \\\"50144\\\",\\\"50072\\\", \\\"50074\\\", \\\"16000\\\",\\\"16001\\\", \\\"16003\\\", \\\"50127\\\", \\\"50125\\\", \\\"50129\\\",\\\"50143\\\", \\\"81010\\\", \\\"81014\\\", \\\"81012\\\") \\r\\n| where '{ErrorCode}' == '*' or '{ErrorCode}' == ErrorCode\\r\\n| top 200 by TimeGenerated desc\\r\\n| extend TimeFromNow = now() - TimeGenerated\\r\\n| extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n| project User = UserDisplayName, IPAddress, ['? Error Code'] = ErrorCode, ['Sign-in Time'] = TimeAgo, App = AppDisplayName, ['Error code'] = ErrorCode, ['Result type'] = ResultType, ['Result signature'] = ResultSignature, ['Result description'] = ResultDescription, ['Conditional access policies'] = ConditionalAccessPolicies, ['Conditional access status'] = ConditionalAccessStatus, ['Operating system'] = DeviceDetail.operatingSystem, Browser = DeviceDetail.browser, ['Country or region'] = LocationDetails.countryOrRegion, ['State'] = LocationDetails.state, ['City'] = LocationDetails.city, ['Time generated'] = TimeGenerated, Status, ['User principal name'] = UserPrincipalName\\r\\n\\r\\n\\r\\n\",         \"size\": 1,         \"showAnalytics\": true,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Sign-ins with errors\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"? Error Code\",               \"formatter\": 7,               \"formatOptions\": {                 \"linkTarget\": \"GenericDetails\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"App\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Error code\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Result type\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Result signature\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Result description\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Conditional access policies\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Conditional access status\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Operating system\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Browser\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Country or region\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"State\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"City\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Time generated\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Status\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"User principal name\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"filter\": true,           \"sortBy\": [             {               \"itemKey\": \"IPAddress\",               \"sortOrder\": 2             }           ],           \"labelSettings\": []         }       },       \"customWidth\": \"33\",       \"name\": \"query - 5 - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"SigninLogs \\r\\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\\r\\n|where UserDisplayName in ({Users}) or '*' in ({Users})\\r\\n| extend ErrorCode = tostring(Status.errorCode) \\r\\n| extend FailureReason = Status.failureReason \\r\\n| where ErrorCode in (\\\"50058\\\",\\\"50140\\\", \\\"51006\\\", \\\"50059\\\", \\\"65001\\\", \\\"52004\\\", \\\"50055\\\", \\\"50144\\\",\\\"50072\\\", \\\"50074\\\", \\\"16000\\\",\\\"16001\\\", \\\"16003\\\", \\\"50127\\\", \\\"50125\\\", \\\"50129\\\",\\\"50143\\\", \\\"81010\\\", \\\"81014\\\", \\\"81012\\\") \\r\\n|summarize errCount = count() by ErrorCode, tostring(FailureReason)\\r\\n| sort by errCount\\r\\n|project ['? Error Code'] = ErrorCode, ['Reason'] = FailureReason, ['Interrupt Count'] = toint(errCount)\",         \"size\": 1,         \"exportFieldName\": \"? Error Code\",         \"exportParameterName\": \"InterruptErrorCode\",         \"exportDefaultValue\": \"*\",         \"showAnalytics\": true,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Summary of sign-ins waiting on user action\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Interrupt Count\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"orange\"               }             }           ],           \"filter\": true,           \"labelSettings\": []         }       },       \"customWidth\": \"67\",       \"showPin\": true,       \"name\": \"query - 7\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"SigninLogs \\r\\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\\r\\n|where UserDisplayName in ({Users}) or '*' in ({Users})\\r\\n| extend ErrorCode = tostring(Status.errorCode) \\r\\n| extend FailureReason = Status.failureReason \\r\\n| where ErrorCode in (\\\"50058\\\",\\\"50140\\\", \\\"51006\\\", \\\"50059\\\", \\\"65001\\\", \\\"52004\\\", \\\"50055\\\", \\\"50144\\\",\\\"50072\\\", \\\"50074\\\", \\\"16000\\\",\\\"16001\\\", \\\"16003\\\", \\\"50127\\\", \\\"50125\\\", \\\"50129\\\",\\\"50143\\\", \\\"81010\\\", \\\"81014\\\", \\\"81012\\\") \\r\\n| where '{InterruptErrorCode}' == '*' or '{InterruptErrorCode}' == ErrorCode\\r\\n| top 200 by TimeGenerated desc\\r\\n| extend TimeFromNow = now() - TimeGenerated\\r\\n| extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n| project User = UserDisplayName, IPAddress, ['? Error Code'] = ErrorCode, ['Sign-in Time'] = TimeAgo, App = AppDisplayName, ['Error code'] = ErrorCode, ['Result type'] = ResultType, ['Result signature'] = ResultSignature, ['Result description'] = ResultDescription, ['Conditional access policies'] = ConditionalAccessPolicies, ['Conditional access status'] = ConditionalAccessStatus, ['Operating system'] = DeviceDetail.operatingSystem, Browser = DeviceDetail.browser, ['Country or region'] = LocationDetails.countryOrRegion, ['State'] = LocationDetails.state, ['City'] = LocationDetails.city, ['Time generated'] = TimeGenerated, Status, ['User principal name'] = UserPrincipalName\\r\\n\\r\\n\",         \"size\": 1,         \"showAnalytics\": true,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Sign-ins waiting on user action\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"? Error Code\",               \"formatter\": 7,               \"formatOptions\": {                 \"linkTarget\": \"GenericDetails\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"App\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Error code\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Result type\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Result signature\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Result description\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Conditional access policies\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Conditional access status\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Operating system\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Browser\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Country or region\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"State\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"City\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Time generated\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Status\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"User principal name\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"filter\": true,           \"labelSettings\": []         }       },       \"customWidth\": \"33\",       \"showPin\": true,       \"name\": \"query - 7 - Copy\"     }   ],   \"styleSettings\": {},   \"fromTemplateId\": \"sentinel-AzureActiveDirectorySigninLogs\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('AzureAuditActivityAndSignin_id')]",
                          "properties":  {
                                             "displayName":  "Security - Azure Audit Activity And Signin",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"## Azure AD audit, sign-in and Azure Activity logs\\n---\\nThis workbook combines the following Azure Monitoring tables:\\n* Azure Active Directory audit logs\\n* Signin logs\\n* Azure Activity logs\\n\\n\\nEdit the parameter below to change the timerange used by the graphs\"       },       \"name\": \"text - 2\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"parameters\": [           {             \"id\": \"d1983eba-6224-4c08-b792-4910eff535ad\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"description\": \"Select the time range that will be used for the query's\",             \"value\": {               \"durationMs\": 604800000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ]             }           }         ],         \"style\": \"pills\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"name\": \"parameters\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"----\\n## Signin Logs\\n\\nWith the SigninLogs we can give a security analyst insight into the different login statuses and locations \u003cbr\u003e\\n\\nThese graphs give a quick representation of the Signin activity of the company's users. \u003cbr\u003e\\nA security team can easy view the Signin locations and most used applications\"       },       \"name\": \"text - 10\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"SigninLogs\\n| extend ResultText = case(isnotempty(ResultDescription), ResultDescription, ResultType == 0 and isempty(ResultDescription), \\\"Successfull login\\\", \\\"unknown\\\") // Create readable result text to include succesfull logins\\n| summarize dcount(CorrelationId) by ResultText // Signin results by unique CorrelationId\\n| render piechart\",         \"size\": 0,         \"title\": \"Login events by result\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"exportFieldName\": \"ResultText\",         \"exportParameterName\": \"Selected_ResultText\",         \"exportDefaultValue\": \"\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"chartSettings\": {           \"group\": \"ResultText\",           \"createOtherGroup\": null,           \"seriesLabelSettings\": [             {               \"seriesName\": \"Successfull login\",               \"color\": \"green\"             }           ],           \"ySettings\": {             \"unit\": 17,             \"min\": null,             \"max\": null           }         }       },       \"customWidth\": \"33\",       \"name\": \"query - 3\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"SigninLogs\\n| extend ResultText = case(isnotempty(ResultDescription), ResultDescription, ResultType == 0 and isempty(ResultDescription), \\\"Successfull login\\\", \\\"unknown\\\")\\n| summarize dcount(CorrelationId) by ResultText, bin(TimeGenerated,4h) // summarize the total Signin events per Description per hour (by unique CorrelationId's)\",         \"size\": 0,         \"title\": \"Count of login types per 4 hours\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"barchart\",         \"tileSettings\": {           \"showBorder\": false,           \"titleContent\": {             \"columnMatch\": \"ResultText\",             \"formatter\": 1           },           \"leftContent\": {             \"columnMatch\": \"dcount_CorrelationId\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\"             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         },         \"chartSettings\": {}       },       \"customWidth\": \"33\",       \"name\": \"query - 4\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"SigninLogs\\n| where isnotempty(LocationDetails['countryOrRegion']) and ResultType == 0// Where location details are available and login is successfull\\n| extend city = tostring(LocationDetails['city'])\\n| summarize count() by city, Location // Summarize by city name\\n| join (\\nSigninLogs\\n| extend city = tostring(LocationDetails['city'])\\n| make-series TrendList = count() on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by city \\n) on city\\n| project Location, city, [\\\"Total events\\\"] = count_, TrendLine = TrendList\\n| top 10 by [\\\"Total events\\\"] desc\",         \"size\": 0,         \"title\": \"Successfull login locations\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Location\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"city\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Total events\",               \"formatter\": 4,               \"formatOptions\": {                 \"palette\": \"blue\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"TrendLine\",               \"formatter\": 9,               \"formatOptions\": {                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Events\",               \"formatter\": 4,               \"formatOptions\": {                 \"palette\": \"blue\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"count_\",               \"formatter\": 4,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"TimeGenerated\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"id\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"hierarchySettings\": {             \"idColumn\": \"city\",             \"parentColumn\": \"Location\",             \"treeType\": 0,             \"expanderColumn\": \"city\",             \"expandTopLevel\": false           }         },         \"sortBy\": [],         \"tileSettings\": {           \"titleContent\": {             \"columnMatch\": \"city\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"leftContent\": {             \"columnMatch\": \"count_\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\",               \"showIcon\": true             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"style\": \"decimal\",                 \"maximumFractionDigits\": 2,                 \"maximumSignificantDigits\": 3               }             }           },           \"secondaryContent\": {             \"columnMatch\": \"Events\",             \"formatter\": 9,             \"formatOptions\": {               \"showIcon\": true             }           },           \"showBorder\": false         },         \"graphSettings\": {           \"type\": 0,           \"topContent\": {             \"columnMatch\": \"LocationDetails\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"centerContent\": {             \"columnMatch\": \"count_\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           },           \"nodeIdField\": \"count_\",           \"sourceIdField\": \"Location\",           \"targetIdField\": \"city\",           \"nodeSize\": null,           \"staticNodeSize\": 100,           \"colorSettings\": null,           \"hivesMargin\": 5         },         \"mapSettings\": {           \"locInfo\": \"LatLong\",           \"locInfoColumn\": \"GeoSelection\",           \"latitude\": \"latitude\",           \"longitude\": \"longitude\",           \"sizeSettings\": \"count_\",           \"sizeAggregation\": \"Sum\",           \"defaultSize\": 0,           \"labelSettings\": \"locationInfo\",           \"legendMetric\": \"count_\",           \"legendAggregation\": \"Sum\",           \"itemColorSettings\": {             \"nodeColorField\": \"count_\",             \"colorAggregation\": \"Sum\",             \"type\": \"heatmap\",             \"heatmapPalette\": \"redGreen\"           }         }       },       \"customWidth\": \"33\",       \"name\": \"query - 7\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"SigninLogs\\r\\n| where ResultType == 0 and AppDisplayName != \\\"\\\"\\r\\n| summarize count() by AppDisplayName\\r\\n| join (\\r\\nSigninLogs\\r\\n| make-series TrendList = count() on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, 4h) by AppDisplayName \\r\\n) on AppDisplayName\\r\\n| top 10 by count_ desc\",         \"size\": 4,         \"title\": \"Successfull logins by application\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"tiles\",         \"tileSettings\": {           \"titleContent\": {             \"columnMatch\": \"AppDisplayName\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"leftContent\": {             \"columnMatch\": \"count_\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\",               \"showIcon\": true             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           },           \"secondaryContent\": {             \"columnMatch\": \"TrendList\",             \"formatter\": 9,             \"formatOptions\": {               \"showIcon\": true             }           },           \"showBorder\": false         },         \"graphSettings\": {           \"type\": 0,           \"topContent\": {             \"columnMatch\": \"AppDisplayName\",             \"formatter\": 1           },           \"centerContent\": {             \"columnMatch\": \"count_\",             \"formatter\": 1,             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         }       },       \"name\": \"query - 14\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"----\\n## AuditLogs\\n\\nThese tables give an Azure administrators the information they needs to make sure that the services and user operations are successfullly executed. \u003cbr\u003e\\nIt also benefits the security operator by seeing which operations are perfomed by which users or services. Therefore he can act quickly on a suspicious operation.\"       },       \"name\": \"text - 9\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"\\nAuditLogs\\n| summarize Runs = count(), Success = countif(Result == 'success'), Fails = countif(Result != 'success') by OperationName // Summarize the total, successful and failed operations by name\\n| extend SuccessRate = (Success * 100 / Runs) // Calculate the percentage of succesful operations against the total\\n| join (\\nAuditLogs\\n| where Result == 'success'\\n| make-series TrendList = count() on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by OperationName \\n) on OperationName\\n| project OperationName, Runs, SuccessRate, TrendList\\n| top 10 by Runs desc // Show the top 10 of most run operations\",         \"size\": 0,         \"title\": \"Top 10 operation by successrate\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"OperationName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Runs\",               \"formatter\": 4,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SuccessRate\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"max\": 100,                 \"palette\": \"redGreen\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"TrendList\",               \"formatter\": 9,               \"formatOptions\": {                 \"showIcon\": true               }             }           ]         }       },       \"customWidth\": \"50\",       \"name\": \"query - 5\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"\\nAuditLogs\\n| summarize Runs = count(), Success = countif(Result == 'success'), Fails = countif(Result != 'success') by OperationName // Summarize the total, successful and failed operations by name\\n| extend SuccessRate = (Success * 100 / Runs) // Calculate the percentage of succesful operations against the total\\n| project OperationName, Runs, SuccessRate, Fails\\n| top 10 by SuccessRate asc // Show the 10 Operation by least SuccessRate\",         \"size\": 0,         \"title\": \"Top 10 most failed operations\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"OperationName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Runs\",               \"formatter\": 4,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SuccessRate\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"max\": 100,                 \"palette\": \"redGreen\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Fails\",               \"formatter\": 8,               \"formatOptions\": {                 \"palette\": \"redBright\",                 \"showIcon\": true               }             }           ]         }       },       \"customWidth\": \"50\",       \"name\": \"query - 5 - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureActivity \\n| union (AuditLogs) // Insert AuditLogs\\n| extend CallerUserName = case( Type == 'AuditLogs' and notempty(InitiatedBy['user']), InitiatedBy['user']['userPrincipalName'], // Find best initiator for data source\\n                                Type == 'AuditLogs' and InitiatedBy == \\\"{}\\\", Identity,\\n                                Type == 'AzureActivity'   ,Caller, 'Unknown')\\n| extend TargetResource =  case( Type == 'AuditLogs' and TargetResources[0]['type'] == 'User', strcat(TargetResources[0]['type'], \\\": \\\", TargetResources[0]['userPrincipalName']), // Find the best resource name for the data source\\n                                Type == 'AuditLogs' and TargetResources[0]['type'] == 'Group', strcat(TargetResources[0]['type'], \\\": \\\", TargetResources[0]['displayName']),\\n                                Type == 'AzureActivity'   ,Resource, 'Unknown')\\n| extend ResultStatus =  case( Type == 'AuditLogs' and Result == 'failure', 'failed', // Change the result value to failure for the icon\\n                               Type == 'AuditLogs' and Result == 'success', Result, // Only resutl that directly matches icon name\\n                               Type == 'AzureActivity' and ActivityStatus == 'Started', 'info', // There is no started icon so using info instead.\\n                               Type == 'AzureActivity' and ActivityStatus == 'Failed', 'failed', // change to failed\\n                               Type == 'AzureActivity' and ActivityStatus == 'Succeeded', 'success', // Change to success\\n                               'unknown')\\n| sort by TimeGenerated desc // Sort descending on TimeGenerated to see latest events\\n| project Time = TimeGenerated, ['From data source'] = Type, Operation = OperationName, ['Initiated by'] = CallerUserName, TargetResource, ResultStatus\\n\",         \"size\": 0,         \"title\": \"Latest operation from audit and activity logs\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Time\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Operation\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"InitiatedByName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Target\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Result\",               \"formatter\": 11,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"sortBy\": [             {               \"itemKey\": \"Time\",               \"sortOrder\": 1             }           ]         },         \"sortBy\": [           {             \"itemKey\": \"Time\",             \"sortOrder\": 1           }         ]       },       \"name\": \"query - 2\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"---\\n## Azure Activity\"       },       \"name\": \"text - 13\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureActivity\\r\\n| summarize count() by ResourceProvider\",         \"size\": 0,         \"title\": \"Most activity by ResourceProvider\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"ResourceProvider\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"TotalEvents\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ResourceProvider1\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Events\",               \"formatter\": 19,               \"formatOptions\": {                 \"showIcon\": true,                 \"timelineSettings\": {                   \"timelineStartColumn\": \"TimeGenerated\"                 }               }             },             {               \"columnMatch\": \"TimeGenerated\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ]         },         \"tileSettings\": {           \"titleContent\": {             \"columnMatch\": \"ExtendedLocation\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"leftContent\": {             \"columnMatch\": \"LoginEvents\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\",               \"showIcon\": true             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"style\": \"decimal\",                 \"maximumFractionDigits\": 2,                 \"maximumSignificantDigits\": 3               }             }           },           \"secondaryContent\": {             \"columnMatch\": \"Events\",             \"formatter\": 19,             \"formatOptions\": {               \"palette\": \"blueOrange\",               \"showIcon\": true,               \"timelineSettings\": {                 \"timelineStartColumn\": \"TimeGenerated\",                 \"timestampIsEndTime\": true               }             }           },           \"showBorder\": false,           \"sortCriteriaField\": \"TotalEvents\",           \"sortOrderField\": 2         },         \"graphSettings\": {           \"type\": 0,           \"topContent\": {             \"columnMatch\": \"ResourceProvider\",             \"formatter\": 1           },           \"centerContent\": {             \"columnMatch\": \"TotalEvents\",             \"formatter\": 1,             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         },         \"chartSettings\": {}       },       \"customWidth\": \"35\",       \"name\": \"query - 3\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureActivity\\r\\n| summarize Activities = count() by User = Caller\",         \"size\": 0,         \"title\": \"Activities by user\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\"       },       \"customWidth\": \"25\",       \"name\": \"query - 16\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureActivity\\n| extend ActivityType = case(OperationName contains \\\"delete\\\", \\\"Delete\\\",\\n                             OperationName contains \\\"create\\\", \\\"Create\\\",\\n                             OperationName contains \\\"Update\\\", \\\"Update\\\", \\\"Other\\\")\\n| summarize Succeeded = countif(ActivityStatus == \\\"Succeeded\\\"), Failed = countif(ActivityStatus == \\\"Failed\\\") by ResourceProvider, ActivityType\\n| extend SuccesRate = Succeeded * 100 / (Succeeded + Failed)\\n| where isnotempty(SuccesRate)\\n| top 10 by SuccesRate asc \\n| project ActivityType, ResourceProvider, SuccesRate, Succeeded, Failed \",         \"size\": 0,         \"title\": \"Least successrate by Action and ResourceProvider\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"ActivityType\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ResourceProvider\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SuccesRate\",               \"formatter\": 8,               \"formatOptions\": {                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Succeeded\",               \"formatter\": 4,               \"formatOptions\": {                 \"palette\": \"blue\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Failed\",               \"formatter\": 8,               \"formatOptions\": {                 \"palette\": \"redBright\",                 \"showIcon\": true               }             }           ]         },         \"tileSettings\": {           \"showBorder\": false,           \"titleContent\": {             \"columnMatch\": \"OperationName\",             \"formatter\": 1           },           \"leftContent\": {             \"columnMatch\": \"Runs\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\"             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         }       },       \"customWidth\": \"40\",       \"name\": \"query - 13\",       \"styleSettings\": {         \"maxWidth\": \"100%\"       }     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureActivity\\r\\n| summarize count() by OperationName, bin(TimeGenerated, 4h)\",         \"size\": 0,         \"title\": \"Timechart count activitytypes by 4 hours\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"areachart\"       },       \"customWidth\": \"50\",       \"name\": \"query - 15\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureActivity\\r\\n//| where ActivityStatus == 'Succeeded'\\r\\n| summarize Actions = count() by OperationName, Id = strcat(Caller, ' - ', CallerIpAddress)\\r\\n| extend Name = Id\\r\\n| union ( AzureActivity\\r\\n//| where ActivityStatus == 'Succeeded'\\r\\n| summarize Actions = count() by Id = OperationName\\r\\n| extend Name = Id)\\r\\n| project Name, Actions, Id, OperationName\\r\\n| order by Actions desc\",         \"size\": 0,         \"title\": \"Tree view for users by operations\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Name\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Actions\",               \"formatter\": 4,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Id\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OperationName\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"hierarchySettings\": {             \"idColumn\": \"Id\",             \"parentColumn\": \"OperationName\",             \"treeType\": 0,             \"expanderColumn\": \"Name\",             \"expandTopLevel\": true           }         },         \"sortBy\": []       },       \"customWidth\": \"50\",       \"name\": \"query - 14\"     }   ],   \"fromTemplateId\": \"AzureAuditActivityAndSigninWorkbook\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('AzureFirewall_id')]",
                          "properties":  {
                                             "displayName":  "Security - Azure Firewall logs",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"query\": \"\",         \"crossComponentResources\": [],         \"parameters\": [           {             \"id\": \"ab7d6c51-d7df-436c-96a2-429163aa50ec\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 7776000000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2419200000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ],               \"allowCustom\": true             }           }         ],         \"style\": \"pills\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"name\": \"parameters - 1\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"# Azure Firewall - overview\"       },       \"name\": \"Main title\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics \\r\\n| where ResourceType == \\\"AZUREFIREWALLS\\\" \\r\\n| summarize Volume=count() by bin(TimeGenerated, {TimeRange:grain})\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Events, by time\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\"       },       \"customWidth\": \"50\",       \"name\": \"query - 16\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics \\r\\n| where ResourceType == \\\"AZUREFIREWALLS\\\" \\r\\n| summarize Volume=count() by Category, bin(TimeGenerated, {TimeRange:grain})\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Events categories, by time\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\"       },       \"customWidth\": \"50\",       \"name\": \"Events categories by time\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where Category == \\\"AzureFirewallApplicationRule\\\"\\r\\n| summarize amount = count() by Resource, ResourceGroup\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Firewall per resource group\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\"       },       \"customWidth\": \"50\",       \"name\": \"Firewall per resource group\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics \\r\\n| where ResourceType == \\\"AZUREFIREWALLS\\\" \\r\\n| summarize Volume=count() by Category\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Events, by category\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"50\",       \"name\": \"Events by category\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"---\\r\\n# Azure Firewall - Application rule log statitics\"       },       \"name\": \"text - 14\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let ActivityData = AzureDiagnostics\\r\\n| where Category == \\\"AzureFirewallApplicationRule\\\"\\r\\n| parse msg_s with Protocol \\\" request from \\\" SourceIP \\\":\\\" SourcePortInt:int \\\" \\\" TempDetails\\r\\n| parse TempDetails with \\\"was \\\" Action1 \\\". Reason: \\\" Rule1\\r\\n| parse TempDetails with \\\"to \\\" FQDN \\\":\\\" TargetPortInt:int \\\". Action: \\\" Action2 \\\".\\\" *\\r\\n| parse TempDetails with * \\\". Rule Collection: \\\" RuleCollection2a \\\". Rule:\\\" Rule2a\\r\\n| parse TempDetails with * \\\"Deny.\\\" RuleCollection2b \\\". Proceeding with\\\" Rule2b\\r\\n| extend SourcePort = tostring(SourcePortInt)\\r\\n| extend TargetPort = tostring(TargetPortInt)\\r\\n| extend Action1 = case(Action1 == \\\"denied\\\",\\\"Deny\\\",\\\"Unknown Action\\\")\\r\\n| extend Action = case(Action2 == \\\"\\\",Action1,Action2),Rule = case(Rule2a == \\\"\\\", case(Rule1 == \\\"\\\",case(Rule2b == \\\"\\\",\\\"N/A\\\", Rule2b),Rule1),Rule2a),  RuleCollection = case(RuleCollection2b == \\\"\\\",case(RuleCollection2a == \\\"\\\",\\\"No rule matched\\\",RuleCollection2a), RuleCollection2b),FQDN = case(FQDN == \\\"\\\", \\\"N/A\\\", FQDN),TargetPort = case(TargetPort == \\\"\\\", \\\"N/A\\\", TargetPort)\\r\\n| where Action == \\\"Deny\\\";\\r\\nActivityData\\r\\n| summarize Amount=count() by SourceIP\\r\\n| join kind = inner\\r\\n(\\r\\n    ActivityData\\r\\n    | make-series Trend = count() default = 0 on bin(TimeGenerated, 1d) from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SourceIP) on SourceIP\\r\\n    | project-away SourceIP1, TimeGenerated\\r\\n    | top 10 by Amount\\r\\n    | sort by Amount\",         \"size\": 4,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Unique Source IP addresses\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"tiles\",         \"tileSettings\": {           \"titleContent\": {             \"columnMatch\": \"Amount\",             \"formatter\": 12,             \"formatOptions\": {               \"showIcon\": true             }           },           \"subtitleContent\": {             \"columnMatch\": \"SourceIP\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"secondaryContent\": {             \"columnMatch\": \"Trend\",             \"formatter\": 9,             \"formatOptions\": {               \"showIcon\": true             }           },           \"showBorder\": false         }       },       \"customWidth\": \"50\",       \"name\": \"query - 4\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics \\n| where Category == \\\"AzureFirewallApplicationRule\\\" \\n| parse msg_s with Protocol \\\" request from \\\" SourceIP \\\":\\\" SourcePortInt:int \\\" \\\" TempDetails \\n| parse TempDetails with \\\"was \\\" Action1 \\\". Reason: \\\" Rule1 \\n| parse TempDetails with \\\"to \\\" FQDN \\\":\\\" TargetPortInt:int \\\". Action: \\\" Action2 \\\".\\\" *\\n| parse TempDetails with * \\\". Rule Collection: \\\" RuleCollection2a \\\". Rule:\\\" Rule2a \\n| parse TempDetails with * \\\"Deny.\\\" RuleCollection2b \\\". Proceeding with\\\" Rule2b \\n| extend SourcePort = tostring(SourcePortInt) \\n| extend TargetPort = tostring(TargetPortInt) \\n| extend Action1 = case(Action1 == \\\"denied\\\",\\\"Deny\\\",\\\"Unknown Action\\\") \\n| extend Action = case(Action2 == \\\"\\\",Action1,Action2),Rule = case(Rule2a == \\\"\\\", case(Rule1 == \\\"\\\",case(Rule2b == \\\"\\\",\\\"N/A\\\", Rule2b),Rule1),Rule2a),  RuleCollection = case(RuleCollection2b == \\\"\\\",case(RuleCollection2a == \\\"\\\",\\\"No rule matched\\\",RuleCollection2a), RuleCollection2b),FQDN = case(FQDN == \\\"\\\", \\\"N/A\\\", FQDN),TargetPort = case(TargetPort == \\\"\\\", \\\"N/A\\\", TargetPort) \\n| where Action == \\\"Deny\\\" \\n|  summarize Amount=dcount(SourceIP) by SourceIP, Protocol, URL = FQDN, TargetPortInt, Action\\n\",         \"size\": 1,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Unique source IP addresses\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"SourceIP\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Count\",               \"formatter\": 3,               \"formatOptions\": {                 \"palette\": \"lightBlue\",                 \"showIcon\": true,                 \"aggregation\": \"Count\"               },               \"numberFormat\": {                 \"unit\": 17,                 \"options\": {                   \"style\": \"decimal\"                 }               }             }           ],           \"filter\": true,           \"labelSettings\": []         }       },       \"customWidth\": \"50\",       \"name\": \"query - 2\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics | where Category == \\\"AzureFirewallApplicationRule\\\" | parse msg_s with Protocol \\\" request from \\\" SourceIP \\\":\\\" SourcePortInt:int \\\" \\\" TempDetails | parse TempDetails with \\\"was \\\" Action1 \\\". Reason: \\\" Rule1 | parse TempDetails with \\\"to \\\" FQDN \\\":\\\" TargetPortInt:int \\\". Action: \\\" Action2 \\\".\\\" * | parse TempDetails with * \\\". Rule Collection: \\\" RuleCollection2a \\\". Rule:\\\" Rule2a | parse TempDetails with * \\\"Deny.\\\" RuleCollection2b \\\". Proceeding with\\\" Rule2b | extend SourcePort = tostring(SourcePortInt) | extend TargetPort = tostring(TargetPortInt) | extend Action1 = case(Action1 == \\\"denied\\\",\\\"Deny\\\",\\\"Unknown Action\\\") | extend Action = case(Action2 == \\\"\\\",Action1,Action2),Rule = case(Rule2a == \\\"\\\", case(Rule1 == \\\"\\\",case(Rule2b == \\\"\\\",\\\"N/A\\\", Rule2b),Rule1),Rule2a),  RuleCollection = case(RuleCollection2b == \\\"\\\",case(RuleCollection2a == \\\"\\\",\\\"No rule matched\\\",RuleCollection2a), RuleCollection2b),FQDN = case(FQDN == \\\"\\\", \\\"N/A\\\", FQDN),TargetPort = case(TargetPort == \\\"\\\", \\\"N/A\\\", TargetPort)| where Action == \\\"Deny\\\" \\r\\n| summarize count() by URL=FQDN, bin(TimeGenerated,{TimeRange:grain})\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Denied URLs over time\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\",         \"tileSettings\": {           \"showBorder\": false         }       },       \"customWidth\": \"70\",       \"name\": \"query - 3\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics \\r\\n| where Category == \\\"AzureFirewallApplicationRule\\\" \\r\\n| parse msg_s with Protocol \\\" request from \\\" SourceIP \\\":\\\" SourcePortInt:int \\\" \\\" TempDetails \\r\\n| parse TempDetails with \\\"was \\\" Action1 \\\". Reason: \\\" Rule1 \\r\\n| parse TempDetails with \\\"to \\\" FQDN \\\":\\\" TargetPortInt:int \\\". Action: \\\" Action2 \\\".\\\" * \\r\\n| parse TempDetails with * \\\". Rule Collection: \\\" RuleCollection2a \\\". Rule:\\\" Rule2a \\r\\n| parse TempDetails with * \\\"Deny.\\\" RuleCollection2b \\\". Proceeding with\\\" Rule2b \\r\\n| extend SourcePort = tostring(SourcePortInt) \\r\\n| extend TargetPort = tostring(TargetPortInt) \\r\\n| extend Action1 = case(Action1 == \\\"denied\\\",\\\"Deny\\\",\\\"Unknown Action\\\") \\r\\n| extend Action = case(Action2 == \\\"\\\",Action1,Action2),Rule = case(Rule2a == \\\"\\\", case(Rule1 == \\\"\\\",case(Rule2b == \\\"\\\",\\\"N/A\\\", Rule2b),Rule1),Rule2a),  RuleCollection = case(RuleCollection2b == \\\"\\\",case(RuleCollection2a == \\\"\\\",\\\"No rule matched\\\",RuleCollection2a), RuleCollection2b),FQDN = case(FQDN == \\\"\\\", \\\"N/A\\\", FQDN),TargetPort = case(TargetPort == \\\"\\\", \\\"N/A\\\", TargetPort)\\r\\n| where Action == \\\"Deny\\\" \\r\\n| summarize count() by URL=FQDN\\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"30\",       \"name\": \"query - 7\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics \\r\\n| where Category == \\\"AzureFirewallApplicationRule\\\" \\r\\n| parse msg_s with Protocol \\\" request from \\\" SourceIP \\\":\\\" SourcePortInt:int \\\" \\\" TempDetails \\r\\n| parse TempDetails with \\\"was \\\" Action1 \\\". Reason: \\\" Rule1 \\r\\n| parse TempDetails with \\\"to \\\" FQDN \\\":\\\" TargetPortInt:int \\\". Action: \\\" Action2 \\\".\\\" * \\r\\n| parse TempDetails with * \\\". Rule Collection: \\\" RuleCollection2a \\\". Rule:\\\" Rule2a \\r\\n| parse TempDetails with * \\\"Deny.\\\" RuleCollection2b \\\". Proceeding with\\\" Rule2b \\r\\n| extend SourcePort = tostring(SourcePortInt) \\r\\n| extend TargetPort = tostring(TargetPortInt)\\r\\n| extend Action1 = case(Action1 == \\\"denied\\\",\\\"Deny\\\",\\\"Unknown Action\\\") \\r\\n| extend Action = case(Action2 == \\\"\\\",Action1,Action2),Rule = case(Rule2a == \\\"\\\", case(Rule1 == \\\"\\\",case(Rule2b == \\\"\\\",\\\"N/A\\\", Rule2b),Rule1),Rule2a),  RuleCollection = case(RuleCollection2b == \\\"\\\",case(RuleCollection2a == \\\"\\\",\\\"No rule matched\\\",RuleCollection2a), RuleCollection2b),FQDN = case(FQDN == \\\"\\\", \\\"N/A\\\", FQDN),TargetPort = case(TargetPort == \\\"\\\", \\\"N/A\\\", TargetPort) \\r\\n| where Action == \\\"Allow\\\" \\r\\n| summarize count() by URL=FQDN, bin(TimeGenerated,{TimeRange:grain})\\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Allowed URLs over time\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\"       },       \"customWidth\": \"70\",       \"name\": \"query - 5\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics | where Category == \\\"AzureFirewallApplicationRule\\\" | parse msg_s with Protocol \\\" request from \\\" SourceIP \\\":\\\" SourcePortInt:int \\\" \\\" TempDetails | parse TempDetails with \\\"was \\\" Action1 \\\". Reason: \\\" Rule1 | parse TempDetails with \\\"to \\\" FQDN \\\":\\\" TargetPortInt:int \\\". Action: \\\" Action2 \\\".\\\" * | parse TempDetails with * \\\". Rule Collection: \\\" RuleCollection2a \\\". Rule:\\\" Rule2a | parse TempDetails with * \\\"Deny.\\\" RuleCollection2b \\\". Proceeding with\\\" Rule2b | extend SourcePort = tostring(SourcePortInt) | extend TargetPort = tostring(TargetPortInt) | extend Action1 = case(Action1 == \\\"denied\\\",\\\"Deny\\\",\\\"Unknown Action\\\") | extend Action = case(Action2 == \\\"\\\",Action1,Action2),Rule = case(Rule2a == \\\"\\\", case(Rule1 == \\\"\\\",case(Rule2b == \\\"\\\",\\\"N/A\\\", Rule2b),Rule1),Rule2a),  RuleCollection = case(RuleCollection2b == \\\"\\\",case(RuleCollection2a == \\\"\\\",\\\"No rule matched\\\",RuleCollection2a), RuleCollection2b),FQDN = case(FQDN == \\\"\\\", \\\"N/A\\\", FQDN),TargetPort = case(TargetPort == \\\"\\\", \\\"N/A\\\", TargetPort) | where Action == \\\"Allow\\\" \\r\\n| summarize count() by URL=FQDN\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"30\",       \"name\": \"query - 2\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics \\r\\n| where Category == \\\"AzureFirewallApplicationRule\\\" \\r\\n| parse msg_s with Protocol \\\" request from \\\" SourceIP \\\":\\\" SourcePortInt:int \\\" \\\" TempDetails \\r\\n| parse TempDetails with \\\"was \\\" Action1 \\\". Reason: \\\" Rule1 \\r\\n| parse TempDetails with \\\"to \\\" FQDN \\\":\\\" TargetPortInt:int \\\". Action: \\\" Action2 \\\".\\\" * \\r\\n| parse TempDetails with * \\\". Rule Collection: \\\" RuleCollection2a \\\". Rule:\\\" Rule2a \\r\\n| parse TempDetails with * \\\"Deny.\\\" RuleCollection2b \\\". Proceeding with\\\" Rule2b \\r\\n| extend SourcePort = tostring(SourcePortInt) \\r\\n| extend TargetPort = tostring(TargetPortInt)\\r\\n| extend Action1 = case(Action1 == \\\"denied\\\",\\\"Deny\\\",\\\"Unknown Action\\\") \\r\\n| extend Action = case(Action2 == \\\"\\\",Action1,Action2),Rule = case(Rule2a == \\\"\\\", case(Rule1 == \\\"\\\",case(Rule2b == \\\"\\\",\\\"N/A\\\", Rule2b),Rule1),Rule2a),  RuleCollection = case(RuleCollection2b == \\\"\\\",case(RuleCollection2a == \\\"\\\",\\\"No rule matched\\\",RuleCollection2a), RuleCollection2b),FQDN = case(FQDN == \\\"\\\", \\\"N/A\\\", FQDN),TargetPort = case(TargetPort == \\\"\\\", \\\"N/A\\\", TargetPort) \\r\\n| summarize count() by URL=FQDN, bin(TimeGenerated,{TimeRange:grain}), Action, SourcePort, TargetPort\\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"All IP addresses events\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"URL\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"TimeGenerated\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Action\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourcePort\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"TargetPort\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"count_\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"filter\": true,           \"labelSettings\": []         }       },       \"name\": \"query - 9\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"---\\r\\n# Azure Firewall - Network rule log statistics\"       },       \"name\": \"text - 14\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics \\r\\n| where Category == \\\"AzureFirewallNetworkRule\\\" \\r\\n| parse msg_s with Protocol \\\" request from \\\" SourceIP \\\":\\\" SourcePortInt:int \\\" to \\\" TargetIP \\\":\\\" TargetPortInt:int * \\r\\n| parse msg_s with * \\\". Action: \\\" Action1a \\r\\n| parse msg_s with * \\\"was \\\" Action1b \\\" to \\\" NatDestination \\r\\n| parse msg_s with Protocol2 \\\" request from \\\" SourceIP2 \\\" to \\\" TargetIP2 \\\". Action:\\\" Action2 \\r\\n| extend SourcePort = tostring(SourcePortInt),TargetPort = tostring(TargetPortInt) \\r\\n| extend Action = case(Action1a == \\\"\\\", case(Action1b == \\\"\\\",Action2,Action1b), Action1a),Protocol = case(Protocol == \\\"\\\", Protocol2, Protocol),SourceIP = case(SourceIP == \\\"\\\", SourceIP2, SourceIP),TargetIP = case(TargetIP == \\\"\\\", TargetIP2, TargetIP),SourcePort = case(SourcePort == \\\"\\\", \\\"N/A\\\", SourcePort),TargetPort = case(TargetPort == \\\"\\\", \\\"N/A\\\", TargetPort),NatDestination = case(NatDestination == \\\"\\\", \\\"N/A\\\", NatDestination)  \\r\\n| summarize count() by Action\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Rule actions\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"33\",       \"name\": \"query - 7\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics \\r\\n| where Category == \\\"AzureFirewallNetworkRule\\\" \\r\\n| parse msg_s with Protocol \\\" request from \\\" SourceIP \\\":\\\" SourcePortInt:int \\\" to \\\" TargetIP \\\":\\\" TargetPortInt:int * \\r\\n| parse msg_s with * \\\". Action: \\\" Action1a \\r\\n| parse msg_s with * \\\"was \\\" Action1b \\\" to \\\" NatDestination \\r\\n| parse msg_s with Protocol2 \\\" request from \\\" SourceIP2 \\\" to \\\" TargetIP2 \\\". Action: \\\" Action2 \\r\\n| extend SourcePort = tostring(SourcePortInt),TargetPort = tostring(TargetPortInt) \\r\\n| extend Action = case(Action1a == \\\"\\\", case(Action1b == \\\"\\\",Action2,Action1b), Action1a),Protocol = case(Protocol == \\\"\\\", Protocol2, Protocol),SourceIP = case(SourceIP == \\\"\\\", SourceIP2, SourceIP),TargetIP = case(TargetIP == \\\"\\\", TargetIP2, TargetIP),SourcePort = case(SourcePort == \\\"\\\", \\\"N/A\\\", SourcePort),TargetPort = case(TargetPort == \\\"\\\", \\\"N/A\\\", TargetPort), NatDestination = case(NatDestination == \\\"\\\", \\\"N/A\\\", NatDestination)  \\r\\n| summarize Count=count() by TargetPort\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Target ports\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"33\",       \"name\": \"query - 10\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics \\r\\n| where Category == \\\"AzureFirewallNetworkRule\\\" \\r\\n| parse msg_s with Protocol \\\" request from \\\" SourceIP \\\":\\\" SourcePortInt:int \\\" to \\\" TargetIP \\\":\\\" TargetPortInt:int * \\r\\n| parse msg_s with * \\\". Action: \\\" Action1a \\r\\n| parse msg_s with * \\\"was \\\" Action1b \\\" to \\\" NatDestination\\r\\n| parse msg_s with Protocol2 \\\" request from \\\" SourceIP2 \\\" to \\\" TargetIP2 \\\". Action:\\\" Action2 \\r\\n| extend SourcePort = tostring(SourcePortInt),TargetPort = tostring(TargetPortInt) \\r\\n| extend Action = case(Action1a == \\\"\\\", \\r\\ncase(Action1b == \\\"\\\",Action2,Action1b), Action1a),\\r\\nProtocol = case(Protocol == \\\"\\\", Protocol2, Protocol),\\r\\nSourceIP = case(SourceIP == \\\"\\\", SourceIP2, SourceIP),\\r\\nTargetIP = case(TargetIP == \\\"\\\", TargetIP2, TargetIP),\\r\\nSourcePort = case(SourcePort == \\\"\\\", \\\"N/A\\\", SourcePort),\\r\\nTargetPort = case(TargetPort == \\\"\\\", \\\"N/A\\\", TargetPort),\\r\\nNatDestination = case(NatDestination == \\\"\\\", \\\"N/A\\\", NatDestination)  \\r\\n| where Action == \\\"DNAT'ed\\\"\\r\\n| summarize Amount=count() by NatDestination\\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"DNAT actions\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"30\",       \"name\": \"query - 12\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics \\r\\n| where Category == \\\"AzureFirewallNetworkRule\\\" \\r\\n| parse msg_s with Protocol \\\" request from \\\" SourceIP \\\":\\\" SourcePortInt:int \\\" to \\\" TargetIP \\\":\\\" TargetPortInt:int * \\r\\n| parse msg_s with * \\\". Action: \\\" Action1a \\r\\n| parse msg_s with * \\\"was \\\" Action1b \\\" to \\\" NatDestination\\r\\n| parse msg_s with Protocol2 \\\" request from \\\" SourceIP2 \\\" to \\\" TargetIP2 \\\". Action:\\\" Action2 \\r\\n| extend SourcePort = tostring(SourcePortInt),TargetPort = tostring(TargetPortInt) \\r\\n| extend Action = case(Action1a == \\\"\\\", \\r\\ncase(Action1b == \\\"\\\",Action2,Action1b), Action1a),\\r\\nProtocol = case(Protocol == \\\"\\\", Protocol2, Protocol),\\r\\nSourceIP = case(SourceIP == \\\"\\\", SourceIP2, SourceIP),\\r\\nTargetIP = case(TargetIP == \\\"\\\", TargetIP2, TargetIP),\\r\\nSourcePort = case(SourcePort == \\\"\\\", \\\"N/A\\\", SourcePort),\\r\\nTargetPort = case(TargetPort == \\\"\\\", \\\"N/A\\\", TargetPort),\\r\\nNatDestination = case(NatDestination == \\\"\\\", \\\"N/A\\\", NatDestination)  \\r\\n| summarize amount = count() by Action , SourceIP\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Rule actions, by IP addresses\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"SourceIP\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"eventCount\",               \"formatter\": 3,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"blue\",                 \"showIcon\": true               }             }           ],           \"filter\": true,           \"labelSettings\": []         }       },       \"customWidth\": \"33\",       \"name\": \"query - 8\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics \\r\\n| where Category == \\\"AzureFirewallNetworkRule\\\" \\r\\n| parse msg_s with Protocol \\\" request from \\\" SourceIP \\\":\\\" SourcePortInt:int \\\" to \\\" TargetIP \\\":\\\" TargetPortInt:int * \\r\\n| parse msg_s with * \\\". Action: \\\" Action1a \\r\\n| parse msg_s with * \\\"was \\\" Action1b \\\" to \\\" NatDestination \\r\\n| parse msg_s with Protocol2 \\\" request from \\\" SourceIP2 \\\" to \\\" TargetIP2 \\\". Action: \\\" Action2 \\r\\n| extend SourcePort = tostring(SourcePortInt),TargetPort = tostring(TargetPortInt) \\r\\n| extend Action = case(Action1a == \\\"\\\", \\r\\ncase(Action1b == \\\"\\\",Action2,Action1b), Action1a),Protocol = case(Protocol == \\\"\\\", \\r\\nProtocol2, Protocol),SourceIP = case(SourceIP == \\\"\\\", SourceIP2, SourceIP),\\r\\nTargetIP = case(TargetIP == \\\"\\\", TargetIP2, TargetIP),\\r\\nSourcePort = case(SourcePort == \\\"\\\", \\\"N/A\\\", SourcePort),\\r\\nTargetPort = case(TargetPort == \\\"\\\", \\\"N/A\\\", TargetPort), \\r\\nNatDestination = case(NatDestination == \\\"\\\", \\r\\n\\\"N/A\\\", NatDestination)  \\r\\n| summarize AMOUNT=count() by TargetPort, SourceIP\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Target ports, by Source IP\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"filter\": true,           \"labelSettings\": []         }       },       \"customWidth\": \"33\",       \"name\": \"query - 11\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics \\r\\n| where Category == \\\"AzureFirewallNetworkRule\\\" \\r\\n| parse msg_s with Protocol \\\" request from \\\" SourceIP \\\":\\\" SourcePortInt:int \\\" to \\\" TargetIP \\\":\\\" TargetPortInt:int * \\r\\n| parse msg_s with * \\\". Action: \\\" Action1a \\r\\n| parse msg_s with * \\\"was \\\" Action1b \\\" to \\\" NatDestination\\r\\n| parse msg_s with Protocol2 \\\" request from \\\" SourceIP2 \\\" to \\\" TargetIP2 \\\". Action:\\\" Action2 \\r\\n| extend SourcePort = tostring(SourcePortInt),TargetPort = tostring(TargetPortInt) \\r\\n| extend Action = case(Action1a == \\\"\\\", \\r\\ncase(Action1b == \\\"\\\",Action2,Action1b), Action1a),\\r\\nProtocol = case(Protocol == \\\"\\\", Protocol2, Protocol),\\r\\nSourceIP = case(SourceIP == \\\"\\\", SourceIP2, SourceIP),\\r\\nTargetIP = case(TargetIP == \\\"\\\", TargetIP2, TargetIP),\\r\\nSourcePort = case(SourcePort == \\\"\\\", \\\"N/A\\\", SourcePort),\\r\\nTargetPort = case(TargetPort == \\\"\\\", \\\"N/A\\\", TargetPort),\\r\\nNatDestination = case(NatDestination == \\\"\\\", \\\"N/A\\\", NatDestination)  \\r\\n| where Action == \\\"DNAT'ed\\\"\\r\\n| summarize Amount=count() by NatDestination, TimeGenerated\\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"DNAT'ed over time\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\"       },       \"customWidth\": \"33\",       \"name\": \"query - 13\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where Category == \\\"AzureFirewallNetworkRule\\\"\\r\\n| parse msg_s with Protocol \\\" request from\\\" SourceIP \\\":\\\" SourcePortInt:int \\\" to\\\" TargetIP \\\":\\\" TargetPortInt:int *\\r\\n| parse msg_s with * \\\". Action: \\\" Action1a\\r\\n| parse msg_s with * \\\" was \\\" Action1b \\\" to \\\" NatDestination\\r\\n| parse msg_s with Protocol2 \\\" request from\\\" SourceIP2 \\\" to\\\" TargetIP2 \\\". Action:\\\" Action2\\r\\n| extend SourcePort = tostring(SourcePortInt),TargetPort = tostring(TargetPortInt)\\r\\n| extend Action = case(Action1a == \\\"\\\", case(Action1b == \\\"\\\",Action2,Action1b), Action1a),Protocol = case(Protocol == \\\"\\\", Protocol2, Protocol),SourceIP = case(SourceIP == \\\"\\\", SourceIP2, SourceIP),TargetIP = case(TargetIP == \\\"\\\", TargetIP2, TargetIP),SourcePort = case(SourcePort == \\\"\\\", \\\"N/A\\\", SourcePort),TargetPort = case(TargetPort == \\\"\\\", \\\"N/A\\\", TargetPort),NatDestination = case(NatDestination == \\\"\\\", \\\"N/A\\\", NatDestination)\\r\\n| summarize count() by Action, bin(TimeGenerated, {TimeRange:grain})\\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Actions, by time\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\"       },       \"name\": \"query - 15\"     }   ],   \"styleSettings\": {},   \"fromTemplateId\": \"sentinel-AzureFirewall\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('AzureNetworkWatcher_id')]",
                          "properties":  {
                                             "displayName":  "Security - Azure Network flow logs",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"## Azure Network Watcher\"       },       \"name\": \"text - 0\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"parameters\": [           {             \"id\": \"82e84ba4-91f1-4213-8c1e-43b772772f5e\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 1209600000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2419200000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ],               \"allowCustom\": true             }           }         ],         \"style\": \"pills\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"name\": \"parameters - 1\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL | where SubType_s == \\\"FlowLog\\\" | summarize TotalFlows = count() by TimeGenerated, VM_s\\r\\n| extend VM = strcat(split(VM_s, '/')[1], ' (', split(VM_s, '/')[0], ')')\\r\\n| project TimeGenerated, VM, TotalFlows\\r\\n\\r\\n\",         \"size\": 0,         \"title\": \"Traffic flows over time on virtual machines\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\",         \"tileSettings\": {           \"showBorder\": false,           \"titleContent\": {             \"columnMatch\": \"VMResourceId\",             \"formatter\": 1           },           \"leftContent\": {             \"columnMatch\": \"TotalFlows\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\"             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         },         \"graphSettings\": {           \"type\": 0,           \"topContent\": {             \"columnMatch\": \"VMResourceId\",             \"formatter\": 1           },           \"centerContent\": {             \"columnMatch\": \"TotalFlows\",             \"formatter\": 1,             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         }       },       \"customWidth\": \"70\",       \"name\": \"query - 3\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL | where SubType_s == \\\"FlowLog\\\" | summarize count() by FlowType_s\",         \"size\": 0,         \"title\": \"Traffic flow types\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"30\",       \"name\": \"query - 4\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"\\r\\nAzureNetworkAnalytics_CL\\r\\n| where SubType_s == 'StatusMessage' and ComponentType_s == 'Topology' and Status_s == 'Completed'\\r\\n| project Subscription_g, DiscoveryRegion_s, TimeProcessed_t\\r\\n| where isnotempty(Subscription_g) and isnotempty(DiscoveryRegion_s) and isnotempty(TimeProcessed_t)\\r\\n| summarize arg_max(TimeProcessed_t, *) by Subscription_g\\r\\n| project Subscription_g, DiscoveryRegion_s, TimeProcessed_t\\r\\n| join kind = inner\\r\\n(\\r\\n    AzureNetworkAnalytics_CL\\r\\n    | where SubType_s == 'Topology' and ResourceType == 'NetworkInterface'\\r\\n)\\r\\non Subscription_g,DiscoveryRegion_s, TimeProcessed_t\\r\\n| project Subscription_g, Name_s, VMName = VirtualMachine_s\\r\\n| join kind = leftouter\\r\\n(\\r\\n    AzureNetworkAnalytics_CL\\r\\n    | where SubType_s == 'FlowLog' and not(isempty(NIC1_s))\\r\\n    | summarize AllowedOutFlows = sum(AllowedOutFlows_d), DeniedOutFlows = sum(DeniedOutFlows_d) by Subscription_g = Subscription1_g, Name_s = NIC1_s\\r\\n)\\r\\non Subscription_g, Name_s \\r\\n| project-away Subscription_g1, Name_s1\\r\\n| join kind = leftouter\\r\\n(\\r\\n    AzureNetworkAnalytics_CL\\r\\n    | where SubType_s == 'FlowLog' and not(isempty(NIC2_s))\\r\\n    | summarize AllowedInFlows = sum(AllowedInFlows_d), DeniedInFlows = sum(DeniedInFlows_d) by Subscription_g = Subscription2_g, Name_s = NIC2_s\\r\\n) on Subscription_g, Name_s\\r\\n| project-away Subscription_g1, Name_s1\\r\\n| extend NICRGandName = split(Name_s, '/'), VMRGandName = split(VMName, '/')\\r\\n| extend NICResourceId = strcat('/subscriptions/', Subscription_g, '/resourceGroups/', NICRGandName[0], '/providers/Microsoft.Network/networkInterfaces/', NICRGandName[1]), \\r\\n            VMResourceId = strcat('/subscriptions/', Subscription_g, '/resourceGroups/', VMRGandName[0], '/providers/Microsoft.Compute/virtualMachines/', VMRGandName[1])\\r\\n| project NICResourceId, VMResourceId, AllowedOutFlows, DeniedOutFlows, AllowedInFlows, DeniedInFlows\\r\\n| sort by AllowedOutFlows + DeniedOutFlows + AllowedInFlows + DeniedInFlows desc nulls last\\r\\n\\r\\n\\r\\n\\r\\n\",         \"size\": 0,         \"title\": \"Flows on network interfaces and virtual machines\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Subscription_g\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Name_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"AllowedOutFlows\",               \"formatter\": 4,               \"formatOptions\": {                 \"palette\": \"green\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeniedOutFlows\",               \"formatter\": 4,               \"formatOptions\": {                 \"palette\": \"orange\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"AllowedInFlows\",               \"formatter\": 4,               \"formatOptions\": {                 \"palette\": \"green\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeniedInFlows\",               \"formatter\": 4,               \"formatOptions\": {                 \"palette\": \"orange\",                 \"showIcon\": true               }             }           ],           \"rowLimit\": 25,           \"filter\": true         }       },       \"customWidth\": \"70\",       \"name\": \"query - 2 - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL\\r\\n| where SubType_s == \\\"FlowLog\\\"\\r\\n| summarize count() by FlowDirection = iff(FlowDirection_s == 'I', 'Inbound', 'Outbound')\\r\\n\",         \"size\": 0,         \"title\": \"Traffic flow direction\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"30\",       \"name\": \"query - 4 - Copy\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Malicious actors\"       },       \"name\": \"text - 8\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL\\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend Subnet1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet1_s, iif(FlowDirection_s == 'O',  Subnet_s, '' )), Subnet2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet2_s, iif(FlowDirection_s == 'I', Subnet_s, '' ))\\r\\n| extend VM1 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM1_s, iif(FlowDirection_s == 'O', VM_s, '' )), VM2 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM2_s, iif(FlowDirection_s == 'I', VM_s, '' ))\\r\\n| extend Subscription1 = iif(FlowType_s == 'InterVNet',Subscription1_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'O', Subscription_g, '')), Subscription2 = iif(FlowType_s == 'InterVNet', Subscription2_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'I', Subscription_g, ''))\\r\\n| extend NIC1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC1_s, iif(FlowDirection_s == 'O', NIC_s, '')), NIC2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC2_s, iif(FlowDirection_s == 'I', NIC_s, ''))\\r\\n| extend SrcIP = iif(isnotempty(SrcIP_s), SrcIP_s, iif(FlowDirection_s == 'O', VMIP_s, '')), DestIP = iif(isnotempty(DestIP_s), DestIP_s, iif(FlowDirection_s == 'I', VMIP_s, ''))\\r\\n| extend CountryOrRegion = iif(FlowType_s == 'AzurePublic', AzureRegion_s, Country_s)\\r\\n| extend FlowDirection_s = iif(FlowType_s in ('InterVNet','IntraVNet'), '', FlowDirection_s)\\r\\n| where FlowDirection_s == \\\"I\\\"\\r\\n| summarize FlowCount = sum(FlowCount_d), AllowedInFlows = sum(AllowedInFlows_d), DeniedInFlows = sum(DeniedInFlows_d) by IPAdress = strcat(SrcIP, ' (', CountryOrRegion, ')') | sort by AllowedInFlows desc \\r\\n\",         \"size\": 0,         \"title\": \"Malicious IP address communication\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"IPAdress\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"FlowCount\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"AllowedInFlows\",               \"formatter\": 4,               \"formatOptions\": {                 \"palette\": \"red\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeniedInFlows\",               \"formatter\": 4,               \"formatOptions\": {                 \"palette\": \"red\",                 \"showIcon\": true               }             }           ]         }       },       \"customWidth\": \"50\",       \"name\": \"query - 6\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL\\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend Subnet1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet1_s, iif(FlowDirection_s == 'O',  Subnet_s, '' )), Subnet2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet2_s, iif(FlowDirection_s == 'I', Subnet_s, '' ))\\r\\n| extend VM1 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM1_s, iif(FlowDirection_s == 'O', VM_s, '' )), VM2 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM2_s, iif(FlowDirection_s == 'I', VM_s, '' ))\\r\\n| extend Subscription1 = iif(FlowType_s == 'InterVNet',Subscription1_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'O', Subscription_g, '')), Subscription2 = iif(FlowType_s == 'InterVNet', Subscription2_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'I', Subscription_g, ''))\\r\\n| extend NIC1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC1_s, iif(FlowDirection_s == 'O', NIC_s, '')), NIC2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC2_s, iif(FlowDirection_s == 'I', NIC_s, ''))\\r\\n| extend SrcIP = iif(isnotempty(SrcIP_s), SrcIP_s, iif(FlowDirection_s == 'O', VMIP_s, '')), DestIP = iif(isnotempty(DestIP_s), DestIP_s, iif(FlowDirection_s == 'I', VMIP_s, ''))\\r\\n| extend CountryOrRegion = iif(FlowType_s == 'AzurePublic', AzureRegion_s, Country_s)\\r\\n| extend FlowDirection_s = iif(FlowType_s in ('InterVNet','IntraVNet'), '', FlowDirection_s)\\r\\n| where FlowDirection_s == \\\"I\\\"\\r\\n| summarize FlowCount = sum(FlowCount_d) by Country = CountryOrRegion | sort by FlowCount desc \",         \"size\": 0,         \"title\": \"Traffic country of origin\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"50\",       \"name\": \"query - 7\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Attacked resources\"       },       \"name\": \"text - 9\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL\\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend Subnet1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet1_s, iif(FlowDirection_s == 'O',  Subnet_s, '' )), Subnet2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet2_s, iif(FlowDirection_s == 'I', Subnet_s, '' ))\\r\\n| extend VM1 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM1_s, iif(FlowDirection_s == 'O', VM_s, '' )), VM2 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM2_s, iif(FlowDirection_s == 'I', VM_s, '' ))\\r\\n| extend Subscription1 = iif(FlowType_s == 'InterVNet',Subscription1_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'O', Subscription_g, '')), Subscription2 = iif(FlowType_s == 'InterVNet', Subscription2_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'I', Subscription_g, ''))\\r\\n| extend NIC1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC1_s, iif(FlowDirection_s == 'O', NIC_s, '')), NIC2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC2_s, iif(FlowDirection_s == 'I', NIC_s, ''))\\r\\n| extend SrcIP = iif(isnotempty(SrcIP_s), SrcIP_s, iif(FlowDirection_s == 'O', VMIP_s, '')), DestIP = iif(isnotempty(DestIP_s), DestIP_s, iif(FlowDirection_s == 'I', VMIP_s, ''))\\r\\n| extend CountryOrRegion = iif(FlowType_s == 'AzurePublic', AzureRegion_s, Country_s)\\r\\n| extend FlowDirection_s = iif(FlowType_s in ('InterVNet','IntraVNet'), '', FlowDirection_s)\\r\\n| where FlowDirection_s == \\\"I\\\"\\r\\n| summarize AllowedInFlows = sum(AllowedInFlows_d) by Computer = strcat(DestIP, ' (', VM2, ' - ', Subscription2, ')') | sort by AllowedInFlows desc\\r\\n\",         \"size\": 0,         \"title\": \"Most attacked machines\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"50\",       \"name\": \"query - 10\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL\\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend Subnet1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet1_s, iif(FlowDirection_s == 'O',  Subnet_s, '' )), Subnet2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet2_s, iif(FlowDirection_s == 'I', Subnet_s, '' ))\\r\\n| extend VM1 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM1_s, iif(FlowDirection_s == 'O', VM_s, '' )), VM2 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM2_s, iif(FlowDirection_s == 'I', VM_s, '' ))\\r\\n| extend Subscription1 = iif(FlowType_s == 'InterVNet',Subscription1_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'O', Subscription_g, '')), Subscription2 = iif(FlowType_s == 'InterVNet', Subscription2_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'I', Subscription_g, ''))\\r\\n| extend NIC1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC1_s, iif(FlowDirection_s == 'O', NIC_s, '')), NIC2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC2_s, iif(FlowDirection_s == 'I', NIC_s, ''))\\r\\n| extend SrcIP = iif(isnotempty(SrcIP_s), SrcIP_s, iif(FlowDirection_s == 'O', VMIP_s, '')), DestIP = iif(isnotempty(DestIP_s), DestIP_s, iif(FlowDirection_s == 'I', VMIP_s, ''))\\r\\n| extend CountryOrRegion = iif(FlowType_s == 'AzurePublic', AzureRegion_s, Country_s)\\r\\n| extend FlowDirection_s = iif(FlowType_s in ('InterVNet','IntraVNet'), '', FlowDirection_s)\\r\\n| where FlowDirection_s == \\\"I\\\"\\r\\n| summarize AllowedInFlows = sum(AllowedInFlows_d) by Subnet = strcat(Subnet2, ' (', Subscription2, ')') | sort by AllowedInFlows desc\\r\\n\",         \"size\": 0,         \"title\": \"Most attacked subnets\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"50\",       \"name\": \"query - 11\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL\\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend Subnet1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet1_s, iif(FlowDirection_s == 'O',  Subnet_s, '' )), Subnet2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet2_s, iif(FlowDirection_s == 'I', Subnet_s, '' ))\\r\\n| extend VM1 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM1_s, iif(FlowDirection_s == 'O', VM_s, '' )), VM2 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM2_s, iif(FlowDirection_s == 'I', VM_s, '' ))\\r\\n| extend Subscription1 = iif(FlowType_s == 'InterVNet',Subscription1_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'O', Subscription_g, '')), Subscription2 = iif(FlowType_s == 'InterVNet', Subscription2_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'I', Subscription_g, ''))\\r\\n| extend NIC1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC1_s, iif(FlowDirection_s == 'O', NIC_s, '')), NIC2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC2_s, iif(FlowDirection_s == 'I', NIC_s, ''))\\r\\n| extend SrcIP = iif(isnotempty(SrcIP_s), SrcIP_s, iif(FlowDirection_s == 'O', VMIP_s, '')), DestIP = iif(isnotempty(DestIP_s), DestIP_s, iif(FlowDirection_s == 'I', VMIP_s, ''))\\r\\n| extend CountryOrRegion = iif(FlowType_s == 'AzurePublic', AzureRegion_s, Country_s)\\r\\n| extend FlowDirection_s = iif(FlowType_s in ('InterVNet','IntraVNet'), '', FlowDirection_s)\\r\\n| where FlowDirection_s == \\\"I\\\"\\r\\n| summarize FlowCount = sum(FlowCount_d), AllowedInFlows = sum(AllowedInFlows_d), DeniedInFlows = sum(DeniedInFlows_d) by IPAddress=DestIP, VM=VM2, Subnet=Subnet2, Subscription=Subscription2 | sort by AllowedInFlows desc\\r\\n| project IPAddress, VM, VNet = strcat(split(Subnet,'/')[0], '/', split(Subnet,'/')[0]), Subscription, FlowCount, AllowedInFlows, DeniedInFlows \\r\\n| extend VM = strcat('/subscriptions/', Subscription, '/resourceGroups/', split(VM,'/')[0], '/providers/Microsoft.Compute/virtualMachines/', split(VM,'/')[1])\\r\\n| extend VNet = strcat('/subscriptions/', Subscription, '/resourceGroups/', split(VNet,'/')[0], '/providers/Microsoft.Network/virtualNetworks/', split(VNet,'/')[1])\\r\\n\",         \"size\": 0,         \"title\": \"Attacked resources\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"IPAddress\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"VM\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Subnet\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Subscription\",               \"formatter\": 13,               \"formatOptions\": {                 \"linkTarget\": null,                 \"showIcon\": true               }             },             {               \"columnMatch\": \"FlowCount\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"AllowedInFlows\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeniedInFlows\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ]         }       },       \"name\": \"query - 12\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Malicious traffic target protocols\"       },       \"name\": \"text - 13\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL\\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend Subnet1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet1_s, iif(FlowDirection_s == 'O',  Subnet_s, '' )), Subnet2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet2_s, iif(FlowDirection_s == 'I', Subnet_s, '' ))\\r\\n| extend VM1 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM1_s, iif(FlowDirection_s == 'O', VM_s, '' )), VM2 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM2_s, iif(FlowDirection_s == 'I', VM_s, '' ))\\r\\n| extend Subscription1 = iif(FlowType_s == 'InterVNet',Subscription1_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'O', Subscription_g, '')), Subscription2 = iif(FlowType_s == 'InterVNet', Subscription2_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'I', Subscription_g, ''))\\r\\n| extend NIC1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC1_s, iif(FlowDirection_s == 'O', NIC_s, '')), NIC2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC2_s, iif(FlowDirection_s == 'I', NIC_s, ''))\\r\\n| extend SrcIP = iif(isnotempty(SrcIP_s), SrcIP_s, iif(FlowDirection_s == 'O', VMIP_s, '')), DestIP = iif(isnotempty(DestIP_s), DestIP_s, iif(FlowDirection_s == 'I', VMIP_s, ''))\\r\\n| extend CountryOrRegion = iif(FlowType_s == 'AzurePublic', AzureRegion_s, Country_s)\\r\\n| extend FlowDirection_s = iif(FlowType_s in ('InterVNet','IntraVNet'), '', FlowDirection_s)\\r\\n| where FlowDirection_s == \\\"I\\\"\\r\\n| summarize FlowCount = sum(FlowCount_d), AllowedInFlows = sum(AllowedInFlows_d), DeniedInFlows = sum(DeniedInFlows_d) by L7Protocol = strcat(L7Protocol_s, ' (', toint(DestPort_d), ')') | sort by AllowedInFlows desc | limit 10\\r\\n\",         \"size\": 0,         \"title\": \"Malicious traffic, by application ports\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"L7Protocol\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"FlowCount\",               \"formatter\": 4,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"AllowedInFlows\",               \"formatter\": 4,               \"formatOptions\": {                 \"palette\": \"red\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeniedInFlows\",               \"formatter\": 4,               \"formatOptions\": {                 \"palette\": \"blue\",                 \"showIcon\": true               }             }           ]         }       },       \"name\": \"query - 14\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL\\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend Subnet1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet1_s, iif(FlowDirection_s == 'O',  Subnet_s, '' )), Subnet2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet2_s, iif(FlowDirection_s == 'I', Subnet_s, '' ))\\r\\n| extend VM1 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM1_s, iif(FlowDirection_s == 'O', VM_s, '' )), VM2 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM2_s, iif(FlowDirection_s == 'I', VM_s, '' ))\\r\\n| extend Subscription1 = iif(FlowType_s == 'InterVNet',Subscription1_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'O', Subscription_g, '')), Subscription2 = iif(FlowType_s == 'InterVNet', Subscription2_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'I', Subscription_g, ''))\\r\\n| extend NIC1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC1_s, iif(FlowDirection_s == 'O', NIC_s, '')), NIC2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC2_s, iif(FlowDirection_s == 'I', NIC_s, ''))\\r\\n| extend SrcIP = iif(isnotempty(SrcIP_s), SrcIP_s, iif(FlowDirection_s == 'O', VMIP_s, '')), DestIP = iif(isnotempty(DestIP_s), DestIP_s, iif(FlowDirection_s == 'I', VMIP_s, ''))\\r\\n| extend CountryOrRegion = iif(FlowType_s == 'AzurePublic', AzureRegion_s, Country_s)\\r\\n| extend FlowDirection_s = iif(FlowType_s in ('InterVNet','IntraVNet'), '', FlowDirection_s)\\r\\n| where FlowDirection_s == \\\"I\\\"\\r\\n| summarize FlowCount = sum(FlowCount_d) by L4Protocol_s \\r\\n| extend L4Protocol_s = replace(\\\"T\\\", \\\"TCP\\\", L4Protocol_s)\\r\\n| extend L4Protocol = replace(\\\"U\\\", \\\"UDP\\\", L4Protocol_s)\\r\\n| project L4Protocol , FlowCount\\r\\n\",         \"size\": 0,         \"title\": \"Malicious traffic protocols\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"33\",       \"name\": \"query - 14 - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL\\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend Subnet1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet1_s, iif(FlowDirection_s == 'O',  Subnet_s, '' )), Subnet2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet2_s, iif(FlowDirection_s == 'I', Subnet_s, '' ))\\r\\n| extend VM1 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM1_s, iif(FlowDirection_s == 'O', VM_s, '' )), VM2 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM2_s, iif(FlowDirection_s == 'I', VM_s, '' ))\\r\\n| extend Subscription1 = iif(FlowType_s == 'InterVNet',Subscription1_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'O', Subscription_g, '')), Subscription2 = iif(FlowType_s == 'InterVNet', Subscription2_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'I', Subscription_g, ''))\\r\\n| extend NIC1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC1_s, iif(FlowDirection_s == 'O', NIC_s, '')), NIC2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC2_s, iif(FlowDirection_s == 'I', NIC_s, ''))\\r\\n| extend SrcIP = iif(isnotempty(SrcIP_s), SrcIP_s, iif(FlowDirection_s == 'O', VMIP_s, '')), DestIP = iif(isnotempty(DestIP_s), DestIP_s, iif(FlowDirection_s == 'I', VMIP_s, ''))\\r\\n| extend CountryOrRegion = iif(FlowType_s == 'AzurePublic', AzureRegion_s, Country_s)\\r\\n| extend FlowDirection_s = iif(FlowType_s in ('InterVNet','IntraVNet'), '', FlowDirection_s)\\r\\n| where FlowDirection_s == \\\"I\\\"\\r\\n| summarize AllowedInFlows = sum(AllowedInFlows_d) by L4Protocol_s | sort by AllowedInFlows desc\\r\\n| extend L4Protocol_s = replace(\\\"T\\\", \\\"TCP\\\", L4Protocol_s)\\r\\n| extend L4Protocol = replace(\\\"U\\\", \\\"UDP\\\", L4Protocol_s)\\r\\n| project L4Protocol, AllowedInFlows\\r\\n\",         \"size\": 0,         \"title\": \"Allowed malicious traffic\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"33\",       \"name\": \"query - 14 - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL\\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend Subnet1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet1_s, iif(FlowDirection_s == 'O',  Subnet_s, '' )), Subnet2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet2_s, iif(FlowDirection_s == 'I', Subnet_s, '' ))\\r\\n| extend VM1 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM1_s, iif(FlowDirection_s == 'O', VM_s, '' )), VM2 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM2_s, iif(FlowDirection_s == 'I', VM_s, '' ))\\r\\n| extend Subscription1 = iif(FlowType_s == 'InterVNet',Subscription1_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'O', Subscription_g, '')), Subscription2 = iif(FlowType_s == 'InterVNet', Subscription2_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'I', Subscription_g, ''))\\r\\n| extend NIC1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC1_s, iif(FlowDirection_s == 'O', NIC_s, '')), NIC2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC2_s, iif(FlowDirection_s == 'I', NIC_s, ''))\\r\\n| extend SrcIP = iif(isnotempty(SrcIP_s), SrcIP_s, iif(FlowDirection_s == 'O', VMIP_s, '')), DestIP = iif(isnotempty(DestIP_s), DestIP_s, iif(FlowDirection_s == 'I', VMIP_s, ''))\\r\\n| extend CountryOrRegion = iif(FlowType_s == 'AzurePublic', AzureRegion_s, Country_s)\\r\\n| extend FlowDirection_s = iif(FlowType_s in ('InterVNet','IntraVNet'), '', FlowDirection_s)\\r\\n| where FlowDirection_s == \\\"I\\\"\\r\\n| summarize DeniedInFlows = sum(DeniedInFlows_d) by L4Protocol_s | sort by DeniedInFlows desc\\r\\n| extend L4Protocol_s = replace(\\\"T\\\", \\\"TCP\\\", L4Protocol_s)\\r\\n| extend L4Protocol = replace(\\\"U\\\", \\\"UDP\\\", L4Protocol_s)\\r\\n| project L4Protocol, DeniedInFlows\\r\\n\",         \"size\": 0,         \"title\": \"Denied malicious traffic\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"33\",       \"name\": \"query - 14 - Copy - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL\\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend Subnet1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet1_s, iif(FlowDirection_s == 'O',  Subnet_s, '' )), Subnet2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet2_s, iif(FlowDirection_s == 'I', Subnet_s, '' ))\\r\\n| extend VM1 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM1_s, iif(FlowDirection_s == 'O', VM_s, '' )), VM2 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM2_s, iif(FlowDirection_s == 'I', VM_s, '' ))\\r\\n| extend Subscription1 = iif(FlowType_s == 'InterVNet',Subscription1_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'O', Subscription_g, '')), Subscription2 = iif(FlowType_s == 'InterVNet', Subscription2_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'I', Subscription_g, ''))\\r\\n| extend NIC1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC1_s, iif(FlowDirection_s == 'O', NIC_s, '')), NIC2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC2_s, iif(FlowDirection_s == 'I', NIC_s, ''))\\r\\n| extend SrcIP = iif(isnotempty(SrcIP_s), SrcIP_s, iif(FlowDirection_s == 'O', VMIP_s, '')), DestIP = iif(isnotempty(DestIP_s), DestIP_s, iif(FlowDirection_s == 'I', VMIP_s, ''))\\r\\n| extend CountryOrRegion = iif(FlowType_s == 'AzurePublic', AzureRegion_s, Country_s)\\r\\n| extend FlowDirection_s = iif(FlowType_s in ('InterVNet','IntraVNet'), '', FlowDirection_s)\\r\\n| where FlowDirection_s == \\\"I\\\"\\r\\n| summarize FlowCount = sum(FlowCount_d) by L7Protocol = strcat(L7Protocol_s, ' (', toint(DestPort_d), ')') | sort by FlowCount desc | limit 10\\r\\n\",         \"size\": 0,         \"title\": \"Malicious traffic, by application port\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"33\",       \"name\": \"query - 17\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL\\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend Subnet1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet1_s, iif(FlowDirection_s == 'O',  Subnet_s, '' )), Subnet2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet2_s, iif(FlowDirection_s == 'I', Subnet_s, '' ))\\r\\n| extend VM1 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM1_s, iif(FlowDirection_s == 'O', VM_s, '' )), VM2 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM2_s, iif(FlowDirection_s == 'I', VM_s, '' ))\\r\\n| extend Subscription1 = iif(FlowType_s == 'InterVNet',Subscription1_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'O', Subscription_g, '')), Subscription2 = iif(FlowType_s == 'InterVNet', Subscription2_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'I', Subscription_g, ''))\\r\\n| extend NIC1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC1_s, iif(FlowDirection_s == 'O', NIC_s, '')), NIC2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC2_s, iif(FlowDirection_s == 'I', NIC_s, ''))\\r\\n| extend SrcIP = iif(isnotempty(SrcIP_s), SrcIP_s, iif(FlowDirection_s == 'O', VMIP_s, '')), DestIP = iif(isnotempty(DestIP_s), DestIP_s, iif(FlowDirection_s == 'I', VMIP_s, ''))\\r\\n| extend CountryOrRegion = iif(FlowType_s == 'AzurePublic', AzureRegion_s, Country_s)\\r\\n| extend FlowDirection_s = iif(FlowType_s in ('InterVNet','IntraVNet'), '', FlowDirection_s)\\r\\n| where FlowDirection_s == \\\"I\\\"\\r\\n| summarize AllowedInFlows = sum(AllowedInFlows_d) by L7Protocol = strcat(L7Protocol_s, ' (', toint(DestPort_d), ')')  | sort by AllowedInFlows desc | limit 10\\r\\n\",         \"size\": 0,         \"title\": \"Allowed malicious traffic, by application port\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"33\",       \"name\": \"query - 17 - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL\\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend Subnet1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet1_s, iif(FlowDirection_s == 'O',  Subnet_s, '' )), Subnet2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), Subnet2_s, iif(FlowDirection_s == 'I', Subnet_s, '' ))\\r\\n| extend VM1 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM1_s, iif(FlowDirection_s == 'O', VM_s, '' )), VM2 = iif(FlowType_s in ('InterVNet','IntraVNet'), VM2_s, iif(FlowDirection_s == 'I', VM_s, '' ))\\r\\n| extend Subscription1 = iif(FlowType_s == 'InterVNet',Subscription1_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'O', Subscription_g, '')), Subscription2 = iif(FlowType_s == 'InterVNet', Subscription2_g, iif(FlowType_s == 'IntraVNet' or FlowDirection_s == 'I', Subscription_g, ''))\\r\\n| extend NIC1 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC1_s, iif(FlowDirection_s == 'O', NIC_s, '')), NIC2 = iif(FlowType_s in ('InterVNet', 'IntraVNet'), NIC2_s, iif(FlowDirection_s == 'I', NIC_s, ''))\\r\\n| extend SrcIP = iif(isnotempty(SrcIP_s), SrcIP_s, iif(FlowDirection_s == 'O', VMIP_s, '')), DestIP = iif(isnotempty(DestIP_s), DestIP_s, iif(FlowDirection_s == 'I', VMIP_s, ''))\\r\\n| extend CountryOrRegion = iif(FlowType_s == 'AzurePublic', AzureRegion_s, Country_s)\\r\\n| extend FlowDirection_s = iif(FlowType_s in ('InterVNet','IntraVNet'), '', FlowDirection_s)\\r\\n| where FlowDirection_s == \\\"I\\\"\\r\\n| summarize DeniedInFlows = sum(DeniedInFlows_d) by L7Protocol = strcat(L7Protocol_s, ' (', toint(DestPort_d), ')')  | sort by DeniedInFlows desc | limit 10\\r\\n\",         \"size\": 0,         \"title\": \"Denied malicious traffic, by application port\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"33\",       \"name\": \"query - 17 - Copy - Copy\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## NSG rule hits by malicious traffic\"       },       \"name\": \"text - 21\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL \\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend nsgList = split(NSGList_s, ' ') | extend nsgRuleList = split(NSGRules_s, ' ') | mvexpand nsgRule = nsgRuleList | extend nsgRuleSplit = split(nsgRule, '|') \\r\\n| extend nsg = tostring(nsgList[toint(nsgRuleSplit[0])]), rule = tostring(nsgRuleSplit[1]), countHits = nsgRuleSplit[4], direction = tostring(nsgRuleSplit[2]) \\r\\n| extend prefixStrippedRule = replace('defaultrule_','', replace('userrule_','', rule))\\r\\n| extend completeNsgRule = strcat(nsg, '/', prefixStrippedRule) \\r\\n| where direction == 'I' and FlowStatus_s  == 'A'\\r\\n| summarize rule_hits = sum(toint(countHits)) by nsg, rule, SourceIP=iif(isempty(SrcIP_s), 'N/A', SrcIP_s), DestIP=iif(isempty(DestIP_s),'N/A',DestIP_s), Country=iif(isempty(Country_s),'N/A',Country_s), Region=iif(isempty(Region_s),'N/A',Region_s), Subnet=iif(isempty(Subnet_s),'N/A',Subnet_s), NIC=iif(isempty(NIC_s),'N/A',NIC_s)\\r\\n| summarize TotalHits = sum(rule_hits) by  FullRule = strcat(nsg,'/',rule) | sort by TotalHits desc\\r\\n\",         \"size\": 0,         \"title\": \"NSG rules allowing inbound malicious traffic\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"categoricalbar\"       },       \"customWidth\": \"40\",       \"name\": \"query - 22\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL \\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend nsgList = split(NSGList_s, ' ') | extend nsgRuleList = split(NSGRules_s, ' ') | mvexpand nsgRule = nsgRuleList | extend nsgRuleSplit = split(nsgRule, '|') \\r\\n| extend nsg = tostring(nsgList[toint(nsgRuleSplit[0])]), rule = tostring(nsgRuleSplit[1]), countHits = nsgRuleSplit[4], direction = tostring(nsgRuleSplit[2]) \\r\\n| extend prefixStrippedRule = replace('defaultrule_','', replace('userrule_','', rule))\\r\\n| extend completeNsgRule = strcat(nsg, '/', prefixStrippedRule) \\r\\n| where direction == 'I' and FlowStatus_s  == 'A'\\r\\n| summarize rule_hits = sum(toint(countHits)) by nsg, rule, SourceIP=iif(isempty(SrcIP_s), 'N/A', SrcIP_s), DestIP=iif(isempty(DestIP_s),'N/A',DestIP_s), Country=iif(isempty(Country_s),'N/A',Country_s), Region=iif(isempty(Region_s),'N/A',Region_s), Subnet=iif(isempty(Subnet_s),'N/A',Subnet_s), NIC=iif(isempty(NIC_s),'N/A',NIC_s)\\r\\n| summarize TotalHits = sum(rule_hits) by  nsg, rule | sort by TotalHits desc\\r\\n| extend nsg = strcat('/subscriptions/', split(nsg,'/')[0], '/resourceGroups/', split(nsg, '/')[1], '/providers/Microsoft.Network/networkSecurityGroups/', split(nsg, '/')[2])\",         \"size\": 0,         \"title\": \"NSG rules allowing inbound malicious traffic\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"nsg\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"rule\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"TotalHits\",               \"formatter\": 4,               \"formatOptions\": {                 \"palette\": \"red\",                 \"showIcon\": true               }             }           ]         }       },       \"customWidth\": \"60\",       \"name\": \"query - 23\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL \\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend nsgList = split(NSGList_s, ' ') | extend nsgRuleList = split(NSGRules_s, ' ') | mvexpand nsgRule = nsgRuleList | extend nsgRuleSplit = split(nsgRule, '|') \\r\\n| extend nsg = tostring(nsgList[toint(nsgRuleSplit[0])]), rule = tostring(nsgRuleSplit[1]), countHits = nsgRuleSplit[4], direction = tostring(nsgRuleSplit[2]) \\r\\n| extend prefixStrippedRule = replace('defaultrule_','', replace('userrule_','', rule))\\r\\n| extend completeNsgRule = strcat(nsg, '/', prefixStrippedRule) \\r\\n| where direction == 'I' and FlowStatus_s  == 'D'\\r\\n| summarize rule_hits = sum(toint(countHits)) by nsg, rule, SourceIP=iif(isempty(SrcIP_s), 'N/A', SrcIP_s), DestIP=iif(isempty(DestIP_s),'N/A',DestIP_s), Country=iif(isempty(Country_s),'N/A',Country_s), Region=iif(isempty(Region_s),'N/A',Region_s), Subnet=iif(isempty(Subnet_s),'N/A',Subnet_s), NIC=iif(isempty(NIC_s),'N/A',NIC_s)\\r\\n| summarize TotalHits = sum(rule_hits) by  FullRule = strcat(nsg,'/',rule) | sort by TotalHits desc\\r\\n\",         \"size\": 0,         \"title\": \"NSG rules denying inbound malicious traffic\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"categoricalbar\"       },       \"customWidth\": \"40\",       \"name\": \"query - 22 - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureNetworkAnalytics_CL \\r\\n| where SubType_s == 'FlowLog' and  FASchemaVersion_s == '2' and FlowType_s == 'MaliciousFlow'\\r\\n| extend nsgList = split(NSGList_s, ' ') | extend nsgRuleList = split(NSGRules_s, ' ') | mvexpand nsgRule = nsgRuleList | extend nsgRuleSplit = split(nsgRule, '|') \\r\\n| extend nsg = tostring(nsgList[toint(nsgRuleSplit[0])]), rule = tostring(nsgRuleSplit[1]), countHits = nsgRuleSplit[4], direction = tostring(nsgRuleSplit[2]) \\r\\n| extend prefixStrippedRule = replace('defaultrule_','', replace('userrule_','', rule))\\r\\n| extend completeNsgRule = strcat(nsg, '/', prefixStrippedRule) \\r\\n| where direction == 'I' and FlowStatus_s  == 'D'\\r\\n| summarize rule_hits = sum(toint(countHits)) by nsg, rule, SourceIP=iif(isempty(SrcIP_s), 'N/A', SrcIP_s), DestIP=iif(isempty(DestIP_s),'N/A',DestIP_s), Country=iif(isempty(Country_s),'N/A',Country_s), Region=iif(isempty(Region_s),'N/A',Region_s), Subnet=iif(isempty(Subnet_s),'N/A',Subnet_s), NIC=iif(isempty(NIC_s),'N/A',NIC_s)\\r\\n| summarize TotalHits = sum(rule_hits) by  nsg, rule | sort by TotalHits desc\\r\\n| extend nsg = strcat('/subscriptions/', split(nsg,'/')[0], '/resourceGroups/', split(nsg, '/')[1], '/providers/Microsoft.Network/networkSecurityGroups/', split(nsg, '/')[2])\\r\\n\",         \"size\": 0,         \"title\": \"NSG rules denying inbound malicious traffic\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"nsg\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"rule\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"TotalHits\",               \"formatter\": 4,               \"formatOptions\": {                 \"palette\": \"blue\",                 \"showIcon\": true               }             }           ]         }       },       \"customWidth\": \"60\",       \"name\": \"query - 23 - Copy\"     }   ],   \"fromTemplateId\": \"sentinel-AzureNetworkWatcher\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('EventAnalyzer_id')]",
                          "properties":  {
                                             "displayName":  "Security - Event Analyzer",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"## Event Analyzer\\n---\\n\\nEvent Analyzer is a visualizing workbook to explore and audit Windows Event Log and explore all events details and attributes for viewing, analyzing and monitoring events recorded in Microsoft Windows event logs. The analyzer speeds up the analysis of event logs (security, application, system, setup, directory service, DNS and others).\"       },       \"name\": \"text - 2\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"crossComponentResources\": [           \"value::all\"         ],         \"parameters\": [           {             \"id\": \"6bdfb4ab-a58b-4035-bfca-4b4bdb67aa60\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"DefaultWorkspace\",             \"type\": 5,             \"isRequired\": true,             \"value\": \"/subscriptions/\u003csubs_ID\u003e/resourcegroups/\u003crg_name\u003e/providers/microsoft.operationalinsights/workspaces/\u003cworkspace_name\u003e\",             \"isHiddenWhenLocked\": true,             \"typeSettings\": {               \"resourceTypeFilter\": {                 \"microsoft.operationalinsights/workspaces\": true               },               \"additionalResourceOptions\": []             },             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"resourceType\": \"microsoft.insights/components\"           },           {             \"id\": \"66c96524-06de-4fb2-be22-3314ff7f96b0\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"ContextFree\",             \"type\": 1,             \"query\": \"{\\\"version\\\":\\\"1.0.0\\\",\\\"content\\\":\\\"\\\\\\\"{DefaultWorkspace}\\\\\\\"\\\",\\\"transformers\\\":null}\",             \"isHiddenWhenLocked\": true,             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 8           },           {             \"id\": \"9ecea5c4-8730-4503-a052-95a2418ddd70\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Selection\",             \"type\": 1,             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend match = strcat(\\\"'\\\", id, \\\"'\\\") =~ \\\"{DefaultWorkspace:value}\\\"\\r\\n| order by match desc, name asc\\r\\n| take 1\\r\\n| project value = tostring(pack('sub', subscriptionId, 'rg', resourceGroup, 'ws', id))\",             \"crossComponentResources\": [               \"value::all\"             ],             \"isHiddenWhenLocked\": true,             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           }         ],         \"style\": \"above\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\"       },       \"conditionalVisibility\": {         \"parameterName\": \"_\",         \"comparison\": \"isEqualTo\",         \"value\": \"_\"       },       \"name\": \"parameters - 3\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"crossComponentResources\": [           \"{Subscriptions}\"         ],         \"parameters\": [           {             \"id\": \"401c9381-d3bc-4594-be03-c322c0c6a135\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Subscriptions\",             \"type\": 6,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"summarize by subscriptionId\\r\\n| project value = strcat('/subscriptions/', subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ todynamic('{Selection}').sub, true, false)\",             \"crossComponentResources\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ]             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"8f5a2b0e-71bf-49f4-b570-c3d84c7cc7f6\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Workspaces\",             \"type\": 7,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| summarize by id, name\\r\\n| project id, selected = iff(id =~ todynamic('{Selection}').ws, true, false)\",             \"crossComponentResources\": [               \"{Subscriptions}\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"selectAllValue\": \"*\"             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"bcb5eb6b-b6a8-47c4-95a2-87753cb10ea8\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"value\": {               \"durationMs\": 86400000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2419200000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ]             },             \"resourceType\": \"microsoft.insights/components\"           },           {             \"id\": \"1c1b8f51-b434-468a-b256-29826c15d9e1\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TestConnectivity\",             \"type\": 1,             \"query\": \"InsightsMetrics\\r\\n| where TimeGenerated {TimeRange}\\r\\n| take 1\",             \"isHiddenWhenLocked\": true,             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\"           }         ],         \"style\": \"above\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"name\": \"parameters - 2\"     },     {       \"type\": 11,       \"content\": {         \"version\": \"LinkItem/1.0\",         \"style\": \"tabs\",         \"links\": [           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit File Share\",             \"subTarget\": \"1\",             \"preText\": \"\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit File System\",             \"subTarget\": \"2\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Filtering Platform Connection\",             \"subTarget\": \"3\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Handle Manipulation\",             \"subTarget\": \"4\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Kernel Object\",             \"subTarget\": \"5\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Other Object Access Events\",             \"subTarget\": \"6\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Registry\",             \"subTarget\": \"7\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Removable Storage\",             \"subTarget\": \"8\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit SAM\",             \"subTarget\": \"9\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Policy Change\",             \"subTarget\": \"10\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Sensitive Privilege Use\",             \"subTarget\": \"11\",             \"style\": \"link\"           }         ]       },       \"name\": \"links - 4\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- A network share object was accessed\\r\\n- A network share object was added\\r\\n- A network share object was modified\\r\\n- A network share object was deleted\\r\\n- SPN check for SMB/SMB2 failed\"             },             \"name\": \"text - 1\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (5140, 5142, 5143, 5144, 5168)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\",               \"tileSettings\": {                 \"showBorder\": false,                 \"titleContent\": {                   \"columnMatch\": \"Account\",                   \"formatter\": 1                 },                 \"leftContent\": {                   \"columnMatch\": \"Task\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\"                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               },               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"Account\",                   \"formatter\": 1                 },                 \"centerContent\": {                   \"columnMatch\": \"Task\",                   \"formatter\": 1,                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               },               \"chartSettings\": {                 \"xAxis\": \"TimeGenerated\",                 \"yAxis\": [                   \"EventID\"                 ],                 \"showLegend\": true,                 \"xSettings\": {},                 \"ySettings\": {}               }             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (5140, 5142, 5143, 5144, 5168)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 86400000               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"table\",               \"gridSettings\": {                 \"filter\": true               }             },             \"showPin\": false,             \"name\": \"query - 0\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"1\"       },       \"name\": \"AuditFileShare\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:  \\r\\n- A handle to an object was requested \\r\\n- The handle to an object was closed \\r\\n- An object was deleted- An attempt was made to access an object\\r\\n- An attempt was made to create a hard link- The state of a transaction has changed \\r\\n- A file was virtualized\\r\\n- Permissions on an object were changed\"             },             \"name\": \"text - 1\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4656, 4658, 4660, 4663, 4664, 4985, 5051, 4670)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\",               \"chartSettings\": {                 \"showLegend\": true,                 \"xSettings\": {},                 \"ySettings\": {}               }             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4656, 4658, 4660, 4663, 4664, 4985, 5051, 4670)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 86400000               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 0\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"2\"       },       \"name\": \"AuditFileSystem\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n - The handle to an object was closed\\r\\n - An attempt was made to duplicate a handle to an object\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4658, 4690)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 2592000000               },               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4658, 4690)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"4\"       },       \"name\": \"AuditHandleManipulation\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- The Windows Firewall Service blocked an application from accepting incoming connections on the network\\r\\n- The Windows Filtering Platform blocked a packet\\r\\n- A more restrictive Windows Filtering Platform filter has blocked a packet\\r\\n- The Windows Filtering Platform has permitted an application or service to listen on a port for incoming connections\\r\\n- The Windows Filtering Platform has blocked an application or service from listening on a port for incoming connections\\r\\n- The Windows Filtering Platform has permitted a connection\\r\\n- The Windows Filtering Platform has blocked a connection\\r\\n- The Windows Filtering Platform has permitted a bind to a local port\\r\\n- The Windows Filtering Platform has blocked a bind to a local port\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (5031, 5150, 5151, 5154, 5155, 5156, 5157, 5158, 5159)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity\",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 2592000000               },               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (5031, 5150, 5151, 5154, 5155, 5156, 5157, 5158, 5159)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity\",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"3\"       },       \"name\": \"AuditFilterPlatformConnection\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- A handle to an object was requested\\r\\n- The handle to an object was closed\\r\\n- An object was deleted\\r\\n- An attempt was made to access an object\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4656, 4658, 4660, 4663)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4656, 4658, 4660, 4663)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"5\"       },       \"name\": \"AuditKernelObject\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n-  An application attempted to access a blocked ordinal through the TBS\\r\\n- Indirect access to an object was requested\\r\\n- The Windows Filtering Platform has detected a DoS attack and entered a defensive mode; packets associated with this attack will be discarded\\r\\n- The DoS attack has subsided and normal processing is being resumed\\r\\n- A scheduled task was created\\r\\n- A scheduled task was deleted\\r\\n- A scheduled task was enabled\\r\\n- A scheduled task was disabled\\r\\n- A scheduled task was updated\\r\\n- An object in the COM+ Catalog was modified\\r\\n- An object was deleted from the COM+ Catalog\\r\\n- An object was added to the COM+ Catalog\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4671, 4691, 5148, 5149, 4698, 4699, 4700, 4701, 4702, 5888, 5889, 5890)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \\r\\n| top 1000 by TimeGenerated desc\",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"TImeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\",               \"tileSettings\": {                 \"showBorder\": false,                 \"titleContent\": {                   \"columnMatch\": \"Account\",                   \"formatter\": 1                 },                 \"leftContent\": {                   \"columnMatch\": \"EventID\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\"                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               }             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4671, 4691, 5148, 5149, 4698, 4699, 4700, 4701, 4702, 5888, 5889, 5890)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TImeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"6\"       },       \"name\": \"AuditOtherObject\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- An attempt was made to access an object\\r\\n- A handle to an object was requested\\r\\n- The handle to an object was closed\\r\\n- An object was deleted\\r\\n- A registry value was modified\\r\\n- A registry key was virtualized\\r\\n- Permissions on an object were changed\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4663, 4656, 4658, 4660, 4657, 5039, 4670)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \\r\\n| top 1000 by TimeGenerated desc\",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4663, 4656, 4658, 4660, 4657, 5039, 4670)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"7\"       },       \"name\": \"AuditRegistry\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- A handle to an object was requested\\r\\n- The handle to an object was closed\\r\\n- An attempt was made to access an object\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4656, 4658, 4663)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \\r\\n| top 1000 by TimeGenerated desc\",               \"size\": 4,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4656, 4658, 4663)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"8\"       },       \"name\": \"AuditRemovable\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- A handle to an object was requested\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4661\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 2592000000               },               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4661\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"9\"       },       \"name\": \"AuditSAM\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- The audit policy (SACL) on an object was changed\\r\\n- System audit policy was changed\\r\\n- Auditing settings on object were changed\\r\\n- The Per-user audit policy table was created\\r\\n- The CrashOnAuditFail value has changed\\r\\n- Auditing settings on object were changed\\r\\n- Special Groups Logon table modified\\r\\n- Per User Audit Policy was changed\\r\\n- An attempt was made to register a security event source\\r\\n- An attempt was made to unregister a security event source\"             },             \"name\": \"text - 0\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4715, 4719, 4817, 4902, 4906, 4907, 4908, 4912, 4904, 4905)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \\r\\n| top 1000 by TimeGenerated desc\",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 2592000000               },               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4715, 4719, 4817, 4902, 4906, 4907, 4908, 4912, 4904, 4905)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"10\"       },       \"name\": \"AuditPolicyChange\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- A privileged service was called\\r\\n- An operation was attempted on a privileged object\\r\\n-  The state of a transaction has changed\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4673, 4674, 4985)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 2592000000               },               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4673, 4674, 4985)\\r\\n| project Account , Computer , EventData , EventID , Activity \",               \"size\": 1,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"11\"       },       \"name\": \"AuditSensitive\",       \"styleSettings\": {         \"showBorder\": true       }     }   ],   \"styleSettings\": {     \"progressStyle\": \"loader\"   },   \"fromTemplateId\": \"sentinel-EventAnalyzerWorkbook\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('InsecureProtocols_id')]",
                          "properties":  {
                                             "displayName":  "Security - Insecure Protocols Analytics",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"## Insecure Protocols\\n\"       },       \"name\": \"text - 2\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"parameters\": [           {             \"id\": \"6b543dcb-ffbe-4fca-80d7-68d15257c377\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"DefaultSubscription_Internal\",             \"type\": 1,             \"isRequired\": true,             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| take 1\\r\\n| project subscriptionId\",             \"crossComponentResources\": [               \"value::selected\"             ],             \"isHiddenWhenLocked\": true,             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\",             \"value\": \"\"           },           {             \"id\": \"959662e2-5c74-4876-b5c7-0aaeb2de2ca5\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Subscription\",             \"type\": 6,             \"query\": \"resources\\r\\n| summarize by subscriptionId\\r\\n| project value = strcat(\\\"/subscriptions/\\\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)\",             \"crossComponentResources\": [               \"value::selected\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": []             },             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\",             \"value\": null           },           {             \"id\": \"d0ab5058-af8c-4ea2-b4a4-8d836769d278\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Workspace\",             \"type\": 5,             \"query\": \"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| project id\",             \"crossComponentResources\": [               \"{Subscription}\"             ],             \"value\": null,             \"typeSettings\": {               \"additionalResourceOptions\": []             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"020de58b-73ca-47fe-838e-bc3ac7afaef6\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 604800000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2419200000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ],               \"allowCustom\": true             }           },           {             \"id\": \"39b2b987-3569-4bc8-96b4-85c43f1c275b\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Help\",             \"label\": \"Show Help\",             \"type\": 10,             \"description\": \"Toggle to show Help for each tab.\",             \"isRequired\": true,             \"typeSettings\": {               \"additionalResourceOptions\": [],               \"showDefault\": false             },             \"jsonData\": \"[\\r\\n { \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true },\\r\\n { \\\"value\\\": \\\"Change Log\\\", \\\"label\\\": \\\"Change Log\\\"}\\r\\n]\\r\\n\"           }         ],         \"style\": \"above\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"name\": \"parameters - 7\"     },     {       \"type\": 11,       \"content\": {         \"version\": \"LinkItem/1.0\",         \"style\": \"tabs\",         \"links\": [           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Summary\",             \"subTarget\": \"Summary\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"LDAP\",             \"subTarget\": \"LDAP\",             \"preText\": \"LDAP\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"NTLM\",             \"subTarget\": \"NTLM\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"SMB\",             \"subTarget\": \"SMB\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Kerberos\",             \"subTarget\": \"Kerberos\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"WDigest\",             \"subTarget\": \"WDigest\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"AAD Legacy Auth \",             \"subTarget\": \"AADLegacy\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Vulnerable Secure Channel\",             \"subTarget\": \"NetlogonSC\",             \"style\": \"link\"           }         ]       },       \"name\": \"links - 34\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"### Change Log\\r\\nBrian Delaney, Clive Watson, Jon Shectman - Microsoft \u003cbr\u003e\\r\\n\\t\\r\\n\\tVersion v1.8\\r\\n\\tAdded Vulnerable Netlogon Secure Channel\\r\\n\\tAdded Legacy Authentication to Summary\\r\\n\\tFixed reporting of Weak Kerberos Cipher in summary\\r\\n\\t\\r\\n\\t\\r\\n\\tVersion v1.7\\r\\n\\tAdded Tabs\\r\\n\\tFixed a bug\\r\\n\\tAdded Timebrushing and Groupings\\r\\n\\tAdded Help sections\",         \"style\": \"info\"       },       \"conditionalVisibility\": {         \"parameterName\": \"Help\",         \"comparison\": \"isEqualTo\",         \"value\": \"Change Log\"       },       \"customWidth\": \"30\",       \"name\": \"text - 24\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: Summary\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### Welcome to Insecure Protocols Workbook\\r\\nThis workbook will help you audit and remove Insecure Protocols from your Active Directory and Azure Active Directory estates.\u003cbr\u003e\\r\\nFor more information about this workbook (and for help with audit settings), navigate to [here](https://aka.ms/sentinelipsetup).\u003cbr\u003e\\r\\nFor help as you navigate this workbook, toggle Show Help at the page top.\",               \"style\": \"info\"             },             \"customWidth\": \"70\",             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 24 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5827, 5828, 5829, 5830, 5831]);\\r\\nlet legacyAuth = SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize Count=count() by Protocol=\\\"AAD Legacy Auth\\\";\\r\\nSecurityEvent\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| union Event\\r\\n| where (EventID == 2889) or (EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit') or (EventID == 4624 and AuthenticationPackageName == 'NTLM' and LmPackageName == 'NTLM V1' and Account !contains 'ANONYMOUS LOGON') or ((EventID == 4624 or EventID == 4776) and Level == 8 and PackageName contains 'WDigest') or (EventID == 4768 or EventID == 4769) and Level == 8 and (TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\") or ((EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\") and EventID in (scEvents))\\r\\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), tostring(EventID)\\r\\n//| extend Protocol=replace(tostring(4776), 'WDigest', replace(tostring(4768), 'Kerberos weak cipher', replace(tostring(4769), 'Kerberos weak cipher', replace(tostring(2889), 'Insecure LDAP', replace(tostring(4624), 'NTLM v1', replace(tostring(3000), 'SMB v1', tostring(EventID)))))))\\r\\n| extend Protocol = case(EventID == 4776, \\\"WDigest\\\", EventID == 4768 or EventID == 4769, \\\"Weak Kerberos Cipher\\\", EventID == 2889, \\\"Insecure LDAP\\\", EventID == 4624, \\\"NTLM v1\\\", EventID == 3000, \\\"SMBv1\\\", EventID in (scEvents), \\\"Vulnerable Secure Channel\\\", \\\"Unknown\\\")\\r\\n| project Protocol, Count\\r\\n| union legacyAuth\\r\\n| sort by Count desc\\r\\n\",               \"size\": 0,               \"title\": \"Summary of Insecure Protocols: {TimeRange:label}\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"series\",               \"exportParameterName\": \"SelectedProtocol\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"piechart\",               \"gridSettings\": {                 \"sortBy\": [                   {                     \"itemKey\": \"Count\",                     \"sortOrder\": 2                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"Count\",                   \"sortOrder\": 2                 }               ]             },             \"customWidth\": \"40\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Summary\"             },             \"name\": \"IPbyTypePie\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5827, 5828, 5829, 5830, 5831]);\\r\\nlet legacyAuth = SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), Protocol=\\\"AAD Legacy Auth\\\";\\r\\nSecurityEvent\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| union Event\\r\\n| where (EventID == 2889) or (EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit') or (EventID == 4624 and AuthenticationPackageName == 'NTLM' and LmPackageName == 'NTLM V1' and Account !contains 'ANONYMOUS LOGON') or ((EventID == 4624 or EventID == 4776) and Level == 8 and PackageName contains 'WDigest') or (EventID == 4768 or EventID == 4769) and Level == 8 and (TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\") or ((EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\") and EventID in (scEvents))\\r\\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), tostring(EventID)\\r\\n//| extend Protocol=replace(tostring(4776), 'WDigest', replace(tostring(4768), 'Kerberos weak cipher', replace(tostring(4769), 'Kerberos weak cipher', replace(tostring(2889), 'Insecure LDAP', replace(tostring(4624), 'NTLM v1', replace(tostring(3000), 'SMB v1', tostring(EventID)))))))\\r\\n| extend Protocol = case(EventID == 4776, \\\"WDigest\\\", EventID == 4768 or EventID == 4769, \\\"Weak Kerberos Cipher\\\", EventID == 2889, \\\"Insecure LDAP\\\", EventID == 4624, \\\"NTLM v1\\\", EventID == 3000, \\\"SMBv1\\\", EventID in (scEvents), \\\"Vulnerable Secure Channel\\\", \\\"Unknown\\\")\\r\\n| project Protocol, Count, TimeGenerated\\r\\n| union legacyAuth\\r\\n| where Protocol =~ \\\"{SelectedProtocol}\\\" or \\\"{SelectedProtocol}\\\" =~ \\\"All\\\"\\r\\n| sort by Count desc\\r\\n\",               \"size\": 0,               \"title\": \"Summary of Insecure Protocols: {TimeRange:label}\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"barchart\",               \"gridSettings\": {                 \"sortBy\": [                   {                     \"itemKey\": \"Count\",                     \"sortOrder\": 2                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"Count\",                   \"sortOrder\": 2                 }               ]             },             \"customWidth\": \"60\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Summary\"             },             \"name\": \"IPbyTypeandTimeBar\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5827, 5828, 5829, 5830, 5831]);\\r\\nlet legacyAuth = SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by Protocol=\\\"AAD Legacy Auth\\\";\\r\\nSecurityEvent\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| union Event\\r\\n| where (EventID == 2889) or (EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit') or (EventID == 4624 and AuthenticationPackageName == 'NTLM' and LmPackageName == 'NTLM V1' and Account !contains 'ANONYMOUS LOGON') or ((EventID == 4624 or EventID == 4776) and Level == 8 and PackageName contains 'WDigest') or (EventID == 4768 or EventID == 4769) and Level == 8 and (TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\") or ((EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\") and EventID in (scEvents))\\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by tostring(EventID)\\r\\n//| extend Protocol=replace(tostring(4776), 'WDigest', replace(tostring(4768), 'Kerberos weak cipher', replace(tostring(4769), 'Kerberos weak cipher', replace(tostring(2889), 'Insecure LDAP', replace(tostring(4624), 'NTLM v1', replace(tostring(3000), 'SMB v1', tostring(EventID)))))))\\r\\n| extend Protocol = case(EventID == 4776, \\\"WDigest\\\", EventID == 4768 or EventID == 4769, \\\"Weak Kerberos Cipher\\\", EventID == 2889, \\\"Insecure LDAP\\\", EventID == 4624, \\\"NTLM v1\\\", EventID == 3000, \\\"SMBv1\\\", EventID in (scEvents), \\\"Vulnerable Secure Channel\\\", \\\"Unknown\\\")\\r\\n| summarize FirstOccurance=min(FirstOccurance), LastOccurance=max(LastOccurance), Count=sum(Count) by Protocol\\r\\n| union legacyAuth\\r\\n| sort by Count desc\\r\\n\",               \"size\": 1,               \"title\": \"Summary of Insecure Protobols found in: {TimeRange:label}\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"sortBy\": [],               \"tileSettings\": {                 \"showBorder\": false               },               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"TableName\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"centerContent\": {                   \"columnMatch\": \"Normal EventID\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"nodeIdField\": \"excellent_ok\",                 \"sourceIdField\": \"TableName\",                 \"targetIdField\": \"excellent_ok\",                 \"edgeLabel\": \"excellent_ok\",                 \"nodeSize\": null,                 \"staticNodeSize\": 100,                 \"colorSettings\": null,                 \"groupByField\": \"TableName\",                 \"hivesMargin\": 5               },               \"chartSettings\": {                 \"group\": \"Crucial EventID\",                 \"createOtherGroup\": null               }             },             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Summary\"             },             \"name\": \"SummaryByIP\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Summary\"       },       \"name\": \"group - Summary\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: Insecure LDAP\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### LDAP Help File\\r\\n\\r\\n**Protocol Risk**\\r\\n\\t* Clients are returning unsigned traffic, which is susceptible to replay or attacker-in-the-middle attacks.\\r\\n\\t* This may result in nefarious activity, such as modified packets, in which a server or even a person makes decisions based on forged data.\\r\\n\\t* The organization is exposing its highly-privileged authentication principals' credentials ??such as the ones for those that belong to the Domain Admins group. With a simple network capture, an attacker can steal these credentials and achieve an escalation path or even a domain dominance type scenario. In the case of simple binds, the organization is exposing plaintext authentication credentials.\\r\\n\\r\\n**Auditing Settings**\\r\\n\\t* Set auditing for 2889 on every DC - In the registry key ??KLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\NTDS\\\\Diagnostics??set a DWORD with name \\\"16 LDAP Interface Events??to a value of ??\\\"\\r\\n\\t* In Log Analytics/Sentinel, set log collection from the Directory Service log.\\r\\n\\r\\n**Mitigation Planning**\\r\\n\\t* Work with application owners, vendors, and users to use LDAP over TLS (LDAPS://) ??ports 636 and 3269.\\r\\n\\t* Once there is no more 2889 insecure LDAP traffic, set the DCs to no longer accept it. GPO: Computer Configuration\\\\Windows Settings\\\\Security Settings\\\\Local Policies\\\\Security Options\\r\\n\\t* If this is not possible, you can secure the entire exchange with IPSec. However, you will not be able to disallow insecure LDAP at the DCs; so using LDAPS is recommended.\\r\\n\\r\\n**Data Filters**\\r\\n\\t* Account\\r\\n\\t* Account timebrush\\r\\n\\t* IP\\r\\n\\t* IP timebrush\",               \"style\": \"info\"             },             \"customWidth\": \"100\",             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 11\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend Title = \\\"Number of events\\\"\\r\\n | summarize QueryCount = count(EventID) by Title//, NumberOfIPs = dcount(IPAddress), NumberOfAccounts = dcount(Account)\",               \"size\": 4,               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"tiles\",               \"tileSettings\": {                 \"titleContent\": {                   \"columnMatch\": \"Title\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"leftContent\": {                   \"columnMatch\": \"QueryCount\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\",                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"showBorder\": false               }             },             \"customWidth\": \"20\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 9\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend Title = \\\"Number of Accounts\\\"\\r\\n | summarize QueryCount = dcount(Account) by Title//, NumberOfIPs = dcount(IPAddress), NumberOfAccounts = dcount(Account)\",               \"size\": 4,               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"tiles\",               \"tileSettings\": {                 \"titleContent\": {                   \"columnMatch\": \"Title\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"leftContent\": {                   \"columnMatch\": \"QueryCount\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"min\": 0,                     \"palette\": \"purple\",                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"style\": \"decimal\",                       \"maximumFractionDigits\": 2,                       \"maximumSignificantDigits\": 3                     }                   }                 },                 \"showBorder\": false               }             },             \"customWidth\": \"20\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 10\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend Title = \\\"Number of IP Addresses\\\"\\r\\n | summarize QueryCount =  dcount(IPAddress) by Title//, NumberOfIPs = dcount(IPAddress), NumberOfAccounts = dcount(Account)\",               \"size\": 4,               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"tiles\",               \"tileSettings\": {                 \"titleContent\": {                   \"columnMatch\": \"Title\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"leftContent\": {                   \"columnMatch\": \"QueryCount\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\",                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"showBorder\": false               }             },             \"customWidth\": \"20\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 9 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | summarize QueryCount = count(EventID) by Account, IPAddress\\r\\n | order by QueryCount\\r\\n\",               \"size\": 0,               \"title\": \"By Account - click to filter\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"Account\",               \"exportParameterName\": \"Account\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"QueryCount\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 1,                       \"palette\": \"orange\",                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"TimeGenerated\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"showIcon\": true                     }                   }                 ],                 \"sortBy\": [                   {                     \"itemKey\": \"$gen_bar_QueryCount_2\",                     \"sortOrder\": 2                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"Account\"                   },                   {                     \"columnId\": \"IPAddress\",                     \"label\": \"Source IP\"                   },                   {                     \"columnId\": \"QueryCount\",                     \"label\": \"Number of Insecure Binds\"                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"$gen_bar_QueryCount_2\",                   \"sortOrder\": 2                 }               ]             },             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"LDAP by Account\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend TimeFromNow = now() - TimeGenerated\\r\\n | extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n | where Account == '{Account:escape}' or  '{Account:escape}' == \\\"All\\\"\\r\\n | project Account, IPAddress, Computer, RenderedDescription, UserName, EventID, Time_of_Bind=TimeAgo\",               \"size\": 0,               \"title\": \"Account Details\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Account\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true,                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"RenderedDescription\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"UserName\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"EventID\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"Account\"                   },                   {                     \"columnId\": \"IPAddress\",                     \"label\": \"Source IP\"                   },                   {                     \"columnId\": \"Computer\",                     \"label\": \"Domain Controller\"                   },                   {                     \"columnId\": \"Time_of_Bind\",                     \"label\": \"Binding Time\"                   }                 ]               }             },             \"conditionalVisibilities\": [               {                 \"parameterName\": \"selectedTab\",                 \"comparison\": \"isEqualTo\",                 \"value\": \"LDAP\"               },               {                 \"parameterName\": \"False\",                 \"comparison\": \"isEqualTo\",                 \"value\": \"Yes\"               }             ],             \"name\": \"query - 7\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend TimeFromNow = now() - TimeGenerated\\r\\n | extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n | where Account == '{Account:escape}' or  '{Account:escape}' == \\\"All\\\"\\r\\n | summarize count() by Account, bin(TimeGenerated, {TimeRange:grain})\",               \"size\": 0,               \"title\": \"Account events over time - select timebrush\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"LDAPTimebrushAccount\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"linechart\"             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 11\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend TimeFromNow = now() - TimeGenerated\\r\\n | extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n | where Account == '{Account:escape}' or  '{Account:escape}' == \\\"All\\\"\\r\\n | extend BindingType = case(BindingType==0,\\\"Unsigned\\\",BindingType==1,\\\"Simple\\\",\\\"Unknown\\\")\\r\\n | summarize Count=count() by Account, bin(TimeGenerated, {TimeRange:grain}), BindingType\\r\\n| order by Count\",               \"size\": 0,               \"title\": \"Account events over time ({LDAPTimebrushAccount:label})\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"LDAPTimebrushAccount\",               \"timeBrushParameterName\": \"LDAPTimebrushAccount\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"TimeGenerated\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"palette\": \"blue\"                     }                   }                 ]               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 11 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | summarize QueryCount = count(EventID) by IPAddress, Account\\r\\n\",               \"size\": 0,               \"title\": \"By Source IP - click to filter\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"IPAddress\",               \"exportParameterName\": \"IPAddress\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Account\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"QueryCount\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 1,                       \"palette\": \"blueDark\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   },                   {                     \"columnMatch\": \"Account Count\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"Trend\",                     \"formatter\": 9,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"magenta\",                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"ParentId\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"Computer\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"LDAPClient\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   }                 ],                 \"sortBy\": [                   {                     \"itemKey\": \"$gen_bar_QueryCount_2\",                     \"sortOrder\": 2                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"IPAddress\",                     \"label\": \"Source IP\"                   },                   {                     \"columnId\": \"Account\"                   },                   {                     \"columnId\": \"QueryCount\",                     \"label\": \"Number of Insedcure Binds\"                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"$gen_bar_QueryCount_2\",                   \"sortOrder\": 2                 }               ]             },             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 3\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Accounts '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend TimeFromNow = now() - TimeGenerated\\r\\n | extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n | where IPAddress == '{IPAddress:escape}' or '{IPAddress:escape}' == \\\"All\\\"\\r\\n | project IPAddress, Accounts, Computer, RenderedDescription, UserName, EventID, Time_of_Bind=TimeAgo\",               \"size\": 0,               \"title\": \"Source IP Details\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"IPAddress\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true,                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"RenderedDescription\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"UserName\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"EventID\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               }             },             \"customWidth\": \"50\",             \"conditionalVisibilities\": [               {                 \"parameterName\": \"selectedTab\",                 \"comparison\": \"isEqualTo\",                 \"value\": \"LDAP\"               },               {                 \"parameterName\": \"False\",                 \"comparison\": \"isEqualTo\",                 \"value\": \"Yes\"               }             ],             \"name\": \"query - 8\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Accounts '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend TimeFromNow = now() - TimeGenerated\\r\\n | extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n | where IPAddress == '{IPAddress:escape}' or '{IPAddress:escape}' == \\\"All\\\"\\r\\n | summarize count() by IPAddress, bin(TimeGenerated, {TimeRange:grain})\",               \"size\": 0,               \"title\": \"IP addresses events over time - select timebrush\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"LDAPTimebrushIP\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"linechart\"             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 12\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Accounts '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend TimeFromNow = now() - TimeGenerated\\r\\n | extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n | where IPAddress == '{IPAddress:escape}' or '{IPAddress:escape}' == \\\"All\\\"\\r\\n| extend BindingType = case(BindingType==0,\\\"Unsigned\\\",BindingType==1,\\\"Simple\\\",\\\"Unknown\\\")\\r\\n | summarize Count = count() by IPAddress, bin(TimeGenerated, {TimeRange:grain}), BindingType\\r\\n | order by Count\",               \"size\": 0,               \"title\": \"IP addresses events over time ({LDAPTimebrushIP:label})\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"LDAPTimebrushIP\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"QueryCount\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"palette\": \"blue\"                     }                   },                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"aggregation\": \"Sum\"                     }                   }                 ]               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 12 - Copy\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"LDAP\"       },       \"name\": \"group - LDAP\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: NTLMv1\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### NTLM Help File\\r\\n\\r\\n**Protocol Risk**\\r\\n\\t* It is far less complex for an attacker to anticipate the challenge length in NTLMv1, as it is always a 16-byte random number. NTLMv2, on the other hand, uses a challenge of variable length.\\r\\n\\t* Recall also that NTLMv1 uses DES encryption, whereas NTLMv2 uses the stronger HMAC-MD5. As of now, it?? less likely that an attacker can successfully brute-force HMAC-MD5.\\r\\n\\t* Also, because NTLMv1 is so much less secure, the only protocols that Windows Defender Credential Guard supports are Kerberos and NTLMv2. You??l have to address the sources of NTLMv1 before using Credential Guard.\\r\\n\\r\\n**Auditing Settings**\\r\\n\\t* Set auditing for 4624 and 4625, and also for 4776 via Group Policy.\\r\\n\\t\\t* Windows Settings/Security Settings/Advanced Audit Configuration/Account Logon/Logon/Logoff/Audit Credential Validation with value of ??uccess, Failure.??r\\n\\t\\t* Windows Settings/Security Settings/Advanced Audit Configuration/(Logon/Logoff)/Audit Logoff with value of \\\"Success, Failure.\\\"\\r\\n\\t\\t* Windows Settings/Security Settings/Advanced Audit Configuration/(Logon/Logoff)/Audit Logon with value of \\\"Success, Failure.\\\"\\r\\n\\r\\n**Mitigation Planning**\\r\\n\\t* Work with application owners and vendors to use a more secure protocol like Kerberos or NTLMv2.\\r\\n\\t* Where unsupported operating systems, old applications or outdated appliances cannot use Kerberos or NTLMv2, work with decision makers to understand the risks to the organization.\\r\\n\\t* Create a plan to remove the problem devices, applications and appliances from the network.\\r\\n\\r\\n**Data Filters**\\r\\n\\t* Source and server\\r\\n\\t* Timebrush\\r\\n\\t* NTLM v1 event details by time\",               \"style\": \"info\"             },             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 3\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent \\r\\n| where EventID == 4624 \\r\\n| where AuthenticationPackageName == 'NTLM' \\r\\n| where LmPackageName == 'NTLM V1'  \\r\\n| where Account !contains 'ANONYMOUS LOGON' \\r\\n| summarize Count = count() by WorkstationName, Computer \\r\\n| project WorkstationName, Computer, Count\\r\\n| order by Count desc\\r\\n\",               \"size\": 0,               \"title\": \"NTLM v1 events, by Source and server - click to filter\",               \"exportFieldName\": \"\",               \"exportParameterName\": \"WorkstationName\",               \"exportDefaultValue\": \"{\\\"WorkstationName\\\":\\\"All\\\"}\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"WorkstationName\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"Computer\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   }                 ],                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"WorkstationName\"                   ]                 },                 \"sortBy\": [                   {                     \"itemKey\": \"Computer\",                     \"sortOrder\": 2                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"Computer\",                   \"sortOrder\": 2                 }               ],               \"tileSettings\": {                 \"showBorder\": false,                 \"titleContent\": {                   \"columnMatch\": \"WorkstationName\",                   \"formatter\": 1                 },                 \"leftContent\": {                   \"columnMatch\": \"Count\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\"                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"NTLM\"             },             \"name\": \"query - 6\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent \\r\\n| where EventID == 4624 \\r\\n| where AuthenticationPackageName == 'NTLM' \\r\\n| where LmPackageName == 'NTLM V1'  \\r\\n| where Account !contains 'ANONYMOUS LOGON' \\r\\n| where '{WorkstationName:escape}' contains \\\"All\\\" or '{WorkstationName:escape}' contains WorkstationName\\r\\n| summarize Count=count() by WorkstationName, Day=bin(TimeGenerated, {TimeRange:grain}) \",               \"size\": 0,               \"title\": \"NTLM v1 events, by time - select to timebrush\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"NTLMTimebrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"areachart\"             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"NTLM\"             },             \"name\": \"query - 15\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent \\r\\n| where EventID == 4624 \\r\\n| where AuthenticationPackageName == 'NTLM' \\r\\n| where LmPackageName == 'NTLM V1'  \\r\\n| where Account !contains 'ANONYMOUS LOGON' \\r\\n| where '{WorkstationName:escape}' contains \\\"All\\\" or ('{WorkstationName:escape}' contains WorkstationName and '{WorkstationName:escape}' contains Computer)\\r\\n| summarize Count = count() by Account, WorkstationName, DC=Computer, LogonProcessName, TargetDomainName, TargetAccount, IpAddress\\r\\n| sort by Count desc  \",               \"size\": 0,               \"title\": \"NTLM v1 events details ({NTLMTimebrush:label})\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"NTLMTimebrush\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"palette\": \"greenRed\",                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               }             },             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"NTLM\"             },             \"name\": \"query - 16\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"NTLM\"       },       \"name\": \"Group - NTLM\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: SMBv1\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### SMB Help File\\r\\n\\r\\n**Protocol Risk**\\r\\n\\t* The security built into SMBv2 and SMBv3 is primarily around protecting against security downgrade attacks (Pre-authentication Integrity, Secure Dialect Negotiation) and attacker-in-the-middle attacks (Encryption, Insecure guest auth blocking). SMB1 simply doesn?? know about or contain any of these protections.\\r\\n\\t* If you have SMBv1 enabled on your file servers or domain controllers, then an attacker-in-the-middle can simply block SMB2/3 and force a downgrade attack. The net effect here will be that your computer(s) will gracefully flip over to SMBv1, thereby exposing the exchange?? data.\\r\\n\\t* SMBv1 continues to be a primary component in destructive ransomware attacks.\\r\\n\\r\\n**Auditing Settings**\\r\\n\\t* On the servers that you will audit, run the following Powershell command to enable auditing: Set-SmbServerConfiguration ??uditSmb1Access $true\\r\\n\\t* Note that this auditing is only supported on Sever 2016/Windows 10 and Server 2012 R2/Windcows 8.1 via an update.\\r\\n\\t* Finally, in the Log Analytics configuration, you will need to set ??ollect events from the following event logs??to Microsoft-Windows-SMBServer/Audit and set the log type to INFORMATION.\\\"\\r\\n\\r\\n**Mitigation Planning**\\r\\n\\t* Work with application owners and vendors to use a more secure SMB version, such as SMBv2 or SMBv3.\\r\\n\\t* Once there is no more SMBv1, set the DCs to no longer accept it. Registry key: HKEY_LOCAL_MACHINE\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\LanmanServer\\\\Parameters\\r\\n\\tSet this to a value SMB1 REG_DWORD: 0 = Disabled.\\r\\n\\r\\n**Data Filters**\\r\\n\\t* Events by client \\r\\n\\t* Server timebrush\\r\\n\\t* Events by server\",               \"style\": \"info\"             },             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 4\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let data = Event\\r\\n| where EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit' \\r\\n| parse ParameterXml with * '\u003cParam\u003e' ClientAddress '\u003c/' * \\r\\n| extend Client = replace(@'\u003e', @'', replace(@'\\\\]', @'', replace(@'\\\\[', @'', replace(@'\u003c!\\\\[CDATA', @'', ClientAddress))));\\r\\ndata\\r\\n| summarize Count = count() by Client\\r\\n| join kind = fullouter (datatable(Client:string)['Medium', 'high', 'low']) on Client\\r\\n| project Client = iff(Client == '', Client1, Client), Count = iff(Client == '', 0, Count)\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by Client)\\r\\n on Client\\r\\n| project-away Client1, TimeGenerated\\r\\n| extend Clients = Client\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend Client = 'All', Clients = '*' \\r\\n)\\r\\n| order by Count desc\\r\\n| take 10\\r\\n\",               \"size\": 4,               \"title\": \"SMB v1 events, by client - click to filter\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"Client\",               \"exportParameterName\": \"ClientFilter\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"tiles\",               \"tileSettings\": {                 \"titleContent\": {                   \"columnMatch\": \"Client\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"leftContent\": {                   \"columnMatch\": \"Count\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\",                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"secondaryContent\": {                   \"columnMatch\": \"Trend\",                   \"formatter\": 9,                   \"formatOptions\": {                     \"min\": 0,                     \"palette\": \"purple\",                     \"showIcon\": true                   }                 },                 \"showBorder\": false               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"SMB\"             },             \"name\": \"query - 18\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event\\r\\n| where EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit'\\r\\n| parse ParameterXml with * '\u003cParam\u003e' ClientAddress '\u003c/' *\\r\\n| extend Client = replace(@'\u003e', @'', replace(@'\\\\]', @'', replace(@'\\\\[', @'', replace(@'\u003c!\\\\[CDATA', @'', ClientAddress))))\\r\\n| where Client == '{ClientFilter}' or '{ClientFilter}' == \\\"All\\\"\\r\\n| summarize Count=count() by Client, SMBServer=Computer, ParameterXml, RenderedDescription, EventData\\r\\n| sort by Count desc\",               \"size\": 1,               \"title\": \"SMB v1 event details, by client\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"barchart\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Client\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true,                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"SMBServer\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"ParameterXml\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"RenderedDescription\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"EventData\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"greenBlue\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   },                   {                     \"columnMatch\": \"$gen_group\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true,                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true,                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"Client\"                   ]                 }               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"SMB\"             },             \"name\": \"query - 20\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n| where EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit' \\r\\n| parse ParameterXml with * '\u003cParam\u003e' ClientAddress '\u003c/' * \\r\\n| extend Client = replace(@'\u003e', @'', replace(@'\\\\]', @'', replace(@'\\\\[', @'', replace(@'\u003c!\\\\[CDATA', @'', ClientAddress)))) \\r\\n| where Client == '{ClientFilter}' or '{ClientFilter}' == \\\"All\\\"\\r\\n| summarize Count=count() by bin(TimeGenerated, 1h) , SMBServer=Computer \\r\\n\\r\\n\",               \"size\": 0,               \"title\": \"SMB v1 events, by server - select to timebrush\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"SMBtimebrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"linechart\"             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"SMB\"             },             \"name\": \"query - 19\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event\\r\\n| where EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit'\\r\\n| parse ParameterXml with * '\u003cParam\u003e' ClientAddress '\u003c/' *\\r\\n| extend Client = replace(@'\u003e', @'', replace(@'\\\\]', @'', replace(@'\\\\[', @'', replace(@'\u003c!\\\\[CDATA', @'', ClientAddress))))\\r\\n| where Client == '{ClientFilter}' or '{ClientFilter}' == \\\"All\\\"\\r\\n| summarize Count=count() by Client, SMBServer=Computer, ParameterXml, RenderedDescription, EventData\\r\\n| sort by Count desc\",               \"size\": 0,               \"title\": \"SMBv1 events, by server: {SMBtimebrush:label}\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"SMBtimebrush\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Client\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true,                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"SMBServer\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"ParameterXml\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"RenderedDescription\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"EventData\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"greenBlue\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   },                   {                     \"columnMatch\": \"$gen_group\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true,                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true,                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"Client\"                   ]                 }               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"SMB\"             },             \"name\": \"query - 20 - Copy\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"SMB\"       },       \"name\": \"group - SMBv1\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: Kerberos Ciphers\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### Kerberos Help File\\r\\n\\r\\n**Protocol Risk**\\r\\n\\t\\r\\n\\tWhen weak cipher suites are permitted for the Kerberos protocol, attackers can leverage encryption downgrades to their advantage and make the protocol easier to compromise.\\r\\n\\tPossible encryption types:\\r\\n\\t* DES_CBC_CRC | Weak\\r\\n\\t* DES_CBC_MD5 | Weak\\r\\n\\t* RC4_HMAC_MD5 | Moderate\\r\\n\\t* AES128_HMAC_SHA1 | Strong\\r\\n\\t* AES256_HMAC_SHA1 | Strong\\r\\n\\t\\r\\n\\tStarting in Windows Server 2008 / Windows Vista, AES encryption has been available for the Kerberos protocol. At present, all supported versions of Windows have DES encryption for Kerberos disabled by default. While DES can be enabled for backward compatibility, doing so will open up an attack vector.\\r\\n\\r\\n**Auditing Settings**\\r\\n\\t\\r\\n\\tUnder Account Logon, set the following audit settings to Success, Failure\\r\\n\\t\\t* Audit Kerberos Authentication Service\\r\\n\\t\\t* Audit Kerberos Service Ticket Operations\\r\\n\\tUnder Logon/Logoff set the following settings to Success, Failure\\r\\n\\t\\t* Audit Logon\\r\\n\\r\\n**Mitigation Planning**\\r\\n\\t* Weak Kerberos Ciphers can be caused by downlevel Operating Systems (Client or Server), Account Configuration issues, Trust Configuration Issues or 3rd party OS/Software configuration.\\r\\n\\t* Look for patterns in the data that will help identify the cause of the weak cipher, such as accessing a common service, or a common set of workstations.\\r\\n\\t* Once identified, work with the OS/Account/Trust owners to remediate the requirement for the weak cipher.\\r\\n\\t* When the weak ciphers have been eliminated from the environment, disable them across your Windows Computers in the policy Computer Configuration\\\\Windows Settings\\\\Security Setting\\\\Local Policies\\\\Security Options\\\\Network security: Configure encryption types allowed for Kerberos.\\r\\n\\r\\n**Data Filters**\\r\\n\\t* Timebrush\\r\\n\\t* Weak ciphers event details\\r\\n\\t* Weak ciphers event details by account\\r\\n\\r\\n** References **\\r\\n- [Network security: Configure encryption types allowed for Kerberos](https://docs.microsoft.com/windows/security/threat-protection/security-policy-settings/network-security-configure-encryption-types-allowed-for-kerberos)\\r\\n- [Advanced Security Audit Policy Settings](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn319056%28v=ws.11%29)\\r\\n\",               \"style\": \"info\"             },             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 4\",             \"styleSettings\": {               \"margin\": \"5\"             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4768 or EventID == 4769\\r\\n| where Level == 8\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| where TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\" //AES128/256, this filter needs to be activated\\r\\n| parse EventData with * '\\\"IpAddress\\\"\u003e' IpAddress '\u003c' *\\r\\n| parse EventData with * '\\\"TargetUserName\\\"\u003e' TargetUserName '\u003c' *\\r\\n| parse EventData with * '\\\"ServiceName\\\"\u003e' ServiceName '\u003c' *\\r\\n| extend Cipher=replace('0x18$', 'RC4-HMAC-EXP', replace('0x12$', 'AES256-CTS-HMAC-SHA1', replace('0x11$', 'AES128-CTS-HMAC-SHA1', replace('0x1$', 'DES_CBC_CRC', replace('0x2$', 'DES_CBC_MD4', replace('0x7$', 'DES3_CBC_SHA1', replace('0x5$', 'DES3_CBC_MD5', replace('0x3$', 'DES_CBC_MD5', replace('0x17$', 'RC4_HMAC', TicketEncryptionType)))))))))\\r\\n| summarize Count=count() by Cipher\\r\\n\",               \"size\": 0,               \"title\": \"Kerberos weak ciphers - click to filter\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"Cipher\",               \"exportParameterName\": \"CipherParameter\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 1,                       \"palette\": \"blue\"                     }                   }                 ]               },               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"Cipher\",                   \"formatter\": 1                 },                 \"centerContent\": {                   \"columnMatch\": \"Count\",                   \"formatter\": 1,                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Kerberos\"             },             \"name\": \"query - 22 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4768 or EventID == 4769\\r\\n| where Level == 8\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| where TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\" //AES128/256, this filter needs to be activated\\r\\n| parse EventData with * '\\\"IpAddress\\\"\u003e' IpAddress '\u003c' *\\r\\n| parse EventData with * '\\\"TargetUserName\\\"\u003e' TargetUserName '\u003c' *\\r\\n| parse EventData with * '\\\"ServiceName\\\"\u003e' ServiceName '\u003c' *\\r\\n| extend Cipher=replace('0x18$', 'RC4-HMAC-EXP', replace('0x12$', 'AES256-CTS-HMAC-SHA1', replace('0x11$', 'AES128-CTS-HMAC-SHA1', replace('0x1$', 'DES_CBC_CRC', replace('0x2$', 'DES_CBC_MD4', replace('0x7$', 'DES3_CBC_SHA1', replace('0x5$', 'DES3_CBC_MD5', replace('0x3$', 'DES_CBC_MD5', replace('0x17$', 'RC4_HMAC', TicketEncryptionType)))))))))\\r\\n| where Cipher == '{CipherParameter}' or '{CipherParameter}' == \\\"All\\\"\\r\\n| summarize Count=count() by Cipher, IpAddress, TargetUserName , ServiceName, Computer, Activity\\r\\n| sort by Count desc\\r\\n\",               \"size\": 0,               \"title\": \"Kerberos weak ciphers event details - filtered by cipher\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"TargetUserName\",               \"exportParameterName\": \"targetUserNameKerberosParameter\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Cipher\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true                     }                   },                   {                     \"columnMatch\": \"IpAddress\",                     \"formatter\": 5                   },                   {                     \"columnMatch\": \"ServiceName\",                     \"formatter\": 5                   },                   {                     \"columnMatch\": \"Computer\",                     \"formatter\": 5                   },                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"greenRed\"                     }                   }                 ],                 \"filter\": true               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Kerberos\"             },             \"name\": \"query - 23 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4768 or EventID == 4769\\r\\n| where Level == 8\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| where TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\" //AES128/256, this filter needs to be activated\\r\\n| parse EventData with * '\\\"IpAddress\\\"\u003e' IpAddress '\u003c' *\\r\\n| parse EventData with * '\\\"TargetUserName\\\"\u003e' TargetUserName '\u003c' *\\r\\n| parse EventData with * '\\\"ServiceName\\\"\u003e' ServiceName '\u003c' *\\r\\n| extend Cipher=replace('0x18$', 'RC4-HMAC-EXP', replace('0x12$', 'AES256-CTS-HMAC-SHA1', replace('0x11$', 'AES128-CTS-HMAC-SHA1', replace('0x1$', 'DES_CBC_CRC', replace('0x2$', 'DES_CBC_MD4', replace('0x7$', 'DES3_CBC_SHA1', replace('0x5$', 'DES3_CBC_MD5', replace('0x3$', 'DES_CBC_MD5', replace('0x17$', 'RC4_HMAC', TicketEncryptionType)))))))))\\r\\n| summarize Count=count() by Cipher, bin(TimeGenerated, 1h)\\r\\n\",               \"size\": 0,               \"title\": \"Kerberos weak ciphers - select to timebrush\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"KeberosTimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"areachart\"             },             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Kerberos\"             },             \"name\": \"query - 22\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4768 or EventID == 4769\\r\\n| where Level == 8\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| where TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\" //AES128/256, this filter needs to be activated\\r\\n| parse EventData with * '\\\"IpAddress\\\"\u003e' IpAddress '\u003c' *\\r\\n| parse EventData with * '\\\"TargetUserName\\\"\u003e' TargetUserName '\u003c' *\\r\\n| parse EventData with * '\\\"ServiceName\\\"\u003e' ServiceName '\u003c' *\\r\\n| extend Cipher=replace('0x18$', 'RC4-HMAC-EXP', replace('0x12$', 'AES256-CTS-HMAC-SHA1', replace('0x11$', 'AES128-CTS-HMAC-SHA1', replace('0x1$', 'DES_CBC_CRC', replace('0x2$', 'DES_CBC_MD4', replace('0x7$', 'DES3_CBC_SHA1', replace('0x5$', 'DES3_CBC_MD5', replace('0x3$', 'DES_CBC_MD5', replace('0x17$', 'RC4_HMAC', TicketEncryptionType)))))))))\\r\\n| summarize Count=count() by Cipher, IpAddress, TargetUserName , ServiceName, Computer, Activity\\r\\n| sort by Count desc\\r\\n\",               \"size\": 0,               \"title\": \"Kerberos weak ciphers event details: {KeberosTimeBrush:label} - select TargetUserName for details\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"KeberosTimeBrush\",               \"exportFieldName\": \"TargetUserName\",               \"exportParameterName\": \"targetUserNameKerberosParameter\",               \"exportDefaultValue\": \"All\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Cipher\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true                     }                   },                   {                     \"columnMatch\": \"IpAddress\",                     \"formatter\": 5                   },                   {                     \"columnMatch\": \"ServiceName\",                     \"formatter\": 5                   },                   {                     \"columnMatch\": \"Computer\",                     \"formatter\": 5                   },                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"greenRed\"                     }                   }                 ],                 \"filter\": true               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Kerberos\"             },             \"name\": \"query - 23\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4768 or EventID == 4769\\r\\n| where Level == 8\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| where TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\" //AES128/256, this filter needs to be activated\\r\\n| parse EventData with * '\\\"IpAddress\\\"\u003e' IpAddress '\u003c' *\\r\\n| extend IpAddress = tostring(split(IpAddress,\\\"f:\\\").[1])\\r\\n| parse EventData with * '\\\"TargetUserName\\\"\u003e' TargetUserName '\u003c' *\\r\\n| parse EventData with * '\\\"ServiceName\\\"\u003e' ServiceName '\u003c' *\\r\\n| extend Cipher=replace('0x18$', 'RC4-HMAC-EXP', replace('0x12$', 'AES256-CTS-HMAC-SHA1', replace('0x11$', 'AES128-CTS-HMAC-SHA1', replace('0x1$', 'DES_CBC_CRC', replace('0x2$', 'DES_CBC_MD4', replace('0x7$', 'DES3_CBC_SHA1', replace('0x5$', 'DES3_CBC_MD5', replace('0x3$', 'DES_CBC_MD5', replace('0x17$', 'RC4_HMAC', TicketEncryptionType)))))))))\\r\\n//| where TargetUserName in ('{targetUserNameKerberosParameter}')\\r\\n| where TargetUserName == '{targetUserNameKerberosParameter:escape}' or  '{targetUserNameKerberosParameter:escape}' == \\\"All\\\"\\r\\n| summarize OldestRecord = min(TimeGenerated), NewestRecord = max(TimeGenerated), Count=count() by TargetUserName, Cipher, IpAddress , ServiceName, Computer, Activity\\r\\n| sort by Count desc\\r\\n\",               \"size\": 0,               \"title\": \"Kerberos weak ciphers event details: {targetUserNameKerberosParameter}, {KeberosTimeBrush:label}\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"KeberosTimeBrush\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Cipher\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true                     }                   },                   {                     \"columnMatch\": \"EventData\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true                     }                   },                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"greenRed\"                     }                   }                 ],                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"TargetUserName\"                   },                   {                     \"columnId\": \"Cipher\"                   },                   {                     \"columnId\": \"IpAddress\"                   },                   {                     \"columnId\": \"ServiceName\"                   },                   {                     \"columnId\": \"Computer\"                   }                 ]               },               \"sortBy\": []             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Kerberos\"             },             \"name\": \"query - 23 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4768 or EventID == 4769\\r\\n| where Level == 8\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| where TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\" //AES128/256, this filter needs to be activated\\r\\n| parse EventData with * '\\\"IpAddress\\\"\u003e' IpAddress '\u003c' *\\r\\n| extend IpAddress = tostring(split(IpAddress,\\\"f:\\\").[1])\\r\\n| parse EventData with * '\\\"TargetUserName\\\"\u003e' TargetUserName '\u003c' *\\r\\n| parse EventData with * '\\\"ServiceName\\\"\u003e' ServiceName '\u003c' *\\r\\n| extend Cipher=replace('0x18$', 'RC4-HMAC-EXP', replace('0x12$', 'AES256-CTS-HMAC-SHA1', replace('0x11$', 'AES128-CTS-HMAC-SHA1', replace('0x1$', 'DES_CBC_CRC', replace('0x2$', 'DES_CBC_MD4', replace('0x7$', 'DES3_CBC_SHA1', replace('0x5$', 'DES3_CBC_MD5', replace('0x3$', 'DES_CBC_MD5', replace('0x17$', 'RC4_HMAC', TicketEncryptionType)))))))))\\r\\n| summarize OldestRecord = min(TimeGenerated), NewestRecord = max(TimeGenerated), Count=count() by TargetUserName, Cipher, IpAddress , ServiceName, Computer, Activity\\r\\n| sort by Count desc\\r\\n\",               \"size\": 0,               \"title\": \"Kerberos weak ciphers event details unfiltered\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Cipher\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true                     }                   },                   {                     \"columnMatch\": \"EventData\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true                     }                   },                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"greenRed\"                     }                   }                 ],                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"TargetUserName\"                   },                   {                     \"columnId\": \"Cipher\"                   },                   {                     \"columnId\": \"IpAddress\"                   },                   {                     \"columnId\": \"ServiceName\"                   },                   {                     \"columnId\": \"Computer\"                   }                 ]               },               \"sortBy\": []             },             \"conditionalVisibilities\": [               {                 \"parameterName\": \"selectedTab\",                 \"comparison\": \"isEqualTo\",                 \"value\": \"Kerberos\"               },               {                 \"parameterName\": \"targetUserNameKerberosParameter\",                 \"comparison\": \"isNotEqualTo\"               }             ],             \"name\": \"query - 23 - Copy - Copy\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Kerberos\"       },       \"name\": \"Group - Kerberos\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: WDigest\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### WDigest Help File\\r\\n\\r\\n**Protocol Risk**\\r\\n\\t* WDigest is a deprecated protocol. It injects plain-text passwords into memory.\\r\\n\\t* Attackers can simply read the plaintext passwords using commodity tools.\\r\\n\\t* Also, because WDigest is so much less secure, it is not supported in Windows Defender Credential Guard. You??l have to address the sources of WDigest before using Credential Guard.\\r\\n\\r\\n**Auditing Settings**\\r\\n\\t* Set auditing for 4776 (non-Kerberos logon) ??Windows Settings/Security Settings/Advanced Audit Configuration/Account Logon/ Logon/Logoff/Audit Credential Validation with value of ??uccess, Failure.??r\\n\\r\\n**Mitigation Planning**\\r\\n\\t* Work with application owners and vendors to use a more secure protocol like NTLMv2 or Kerberos.\\r\\n\\t* Once there is no more Digest, set the DCs to no longer accept it. Registry (may be done via GP Preferences): HKEY_LOCAL_MACHINE\\\\SYSTEM\\\\CurrentControlSet\\\\Control\\\\SecurityProviders\\\\WDigest\\\\ ??seLogonCredential\\r\\n\\t* Set this to a value of 0. A restart is required.\\r\\n\\r\\n**Data Filters**\\r\\n\\t* Account workstation\\r\\n\\t* Workstation over time\\r\\n\\t* Account timebrush\\r\\n\",               \"style\": \"info\"             },             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 3\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let data = SecurityEvent \\r\\n| where EventID == 4624 or EventID == 4776 \\r\\n| where Level == 8 \\r\\n| where PackageName contains 'WDigest';\\r\\nlet appData = data\\r\\n| summarize TotalCount = count() by TargetAccount\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by TargetAccount\\r\\n    | project-away TimeGenerated) on TargetAccount\\r\\n| order by TotalCount desc, TargetAccount asc\\r\\n| project TargetAccount, TotalCount, Trend\\r\\n| serialize Id = row_number();\\r\\ndata\\r\\n| summarize TotalCount = count() by Workstation , TargetAccount\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by TargetAccount, Workstation\\r\\n    | project-away TimeGenerated) on TargetAccount, Workstation\\r\\n| order by TotalCount desc, TargetAccount asc\\r\\n| project TargetAccount, Workstation, TotalCount, Trend\\r\\n| serialize Id = row_number(1000000)\\r\\n| join kind=inner (appData) on TargetAccount\\r\\n| project Id, Name = Workstation, Type = 'Workstation', ['TargetAccounts Count'] = TotalCount, Trend,  ParentId = Id1\\r\\n| union (appData \\r\\n    | project Id, Name = TargetAccount, Type = 'TargetAccount', ['TargetAccounts Count'] = TotalCount,  Trend)\\r\\n| order by ['TargetAccounts Count'] desc, Name asc\\r\\n\",               \"size\": 0,               \"title\": \"WDigest, by account workstation - click to filter\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportParameterName\": \"WDigest\",               \"exportDefaultValue\": \"{ \\\"Name\\\":\\\"\\\", \\\"Type\\\":\\\"*\\\"}\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Id\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"TargetAccounts Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"Trend\",                     \"formatter\": 10,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"orange\",                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"ParentId\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   }                 ],                 \"hierarchySettings\": {                   \"idColumn\": \"Id\",                   \"parentColumn\": \"ParentId\",                   \"treeType\": 0,                   \"expanderColumn\": \"Name\"                 }               },               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"Name\",                   \"formatter\": 1                 },                 \"centerContent\": {                   \"columnMatch\": \"Id\",                   \"formatter\": 1,                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"WDigest\"             },             \"name\": \"query - 25\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let details = dynamic({WDigest});\\r\\nSecurityEvent \\r\\n| where EventID == 4624 or EventID == 4776 \\r\\n| where Level == 8 \\r\\n| where PackageName contains 'WDigest' \\r\\n| where (details.Type == 'Workstation' and details.Name == Workstation) or (details.Type == 'TargetAccount' and details.Name == TargetAccount) or (details.Type == '*')\\r\\n| summarize Count=count() by Workstation,  bin(TimeGenerated, 1h)\",               \"size\": 0,               \"title\": \"WDigest Workstation over Time\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"wDigestTimeBrushAccount\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"areachart\"             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"WDigest\"             },             \"name\": \"query - 26\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let details = dynamic({WDigest});\\r\\nSecurityEvent\\r\\n| where EventID == 4624 or EventID == 4776\\r\\n| where Level == 8\\r\\n| where PackageName contains 'WDigest'\\r\\n| where (details.Type == 'Workstation' and details.Name == Workstation) or (details.Type == 'TargetAccount' and details.Name == TargetAccount) or (details.Type == '*')\\r\\n| summarize Count=count() by TargetAccount, Workstation, WDigestServer=Computer , Activity\\r\\n| sort by Count desc\",               \"size\": 0,               \"title\": \"WDigest Account over time {{wDigestTimeBrushAccount:label})\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"wDigestTimeBrushAccount\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"coldHot\",                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               }             },             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"WDigest\"             },             \"name\": \"query - 27\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"WDigest\"       },       \"name\": \"WDigest\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: AAD Legacy Auth\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### AAD Legacy Auth Help File\\r\\n\\r\\n**Protocol Risk**\\r\\n\\t* Legacy authentication protocols like POP, SMTP, IMAP, and MAPI can't enforce MFA, making them preferred entry points for adversaries attacking your organization.\\r\\n\\t* The numbers on legacy authentication from an analysis of Azure Active Directory (Azure AD) traffic are stark:\\r\\n\\t\\t* More than 99 percent of password spray attacks use legacy authentication protocols\\r\\n\\t\\t* More than 97 percent of credential stuffing attacks use legacy authentication\\r\\n\\t\\t* Azure AD accounts in organizations that have disabled legacy authentication experience 67 percent fewer compromises than those where legacy authentication is enabled\\r\\n\\r\\n**Legacy Authentication Protocols**\\r\\nThe following options are considered legacy authentication protocols\\r\\n\\t* Authenticated SMTP - Used by POP and IMAP client's to send email messages.\\r\\n\\t* Autodiscover - Used by Outlook and EAS clients to find and connect to mailboxes in Exchange Online.\\r\\n\\t* Exchange ActiveSync (EAS) - Used to connect to mailboxes in Exchange Online.\\r\\n\\t* Exchange Online PowerShell - Used to connect to Exchange Online with remote PowerShell. If you block Basic authentication for Exchange Online PowerShell, you need to use the Exchange Online PowerShell Module to connect. For instructions, see Connect to Exchange Online PowerShell using multi-factor authentication.\\r\\n\\t* Exchange Web Services (EWS) - A programming interface that's used by Outlook, Outlook for Mac, and third-party apps.\\r\\n\\t* IMAP4 - Used by IMAP email clients.\\r\\n\\t* MAPI over HTTP (MAPI/HTTP) - Used by Outlook 2010 and later.\\r\\n\\t* Offline Address Book (OAB) - A copy of address list collections that are downloaded and used by Outlook.\\r\\n\\t* Outlook Anywhere (RPC over HTTP) - Used by Outlook 2016 and earlier.\\r\\n\\t* Outlook Service - Used by the Mail and Calendar app for Windows 10.\\r\\n\\t* POP3 - Used by POP email clients.\\r\\n\\t* Reporting Web Services - Used to retrieve report data in Exchange Online.\\r\\n\\t* Other clients - Other protocols identified as utilizing legacy authentication.\\r\\n\\r\\n**Mitigation Planning**\\r\\n\\t* Before you can block legacy authentication in your directory, you need to first understand if your users have apps that use legacy authentication and how it affects your overall directory.\\r\\n\\t* Azure AD supports several of the most widely used authentication and authorization protocols including legacy authentication. Legacy authentication refers to protocols that use basic authentication. Typically, these protocols can't enforce any type of second factor authentication. * Examples for apps that are based on legacy authentication are:\\r\\n\\t\\t* Older Microsoft Office apps\\r\\n\\t\\t* Apps using mail protocols like POP, IMAP, and SMTP\\r\\n\\t\\t* Single factor authentication (for example, username and password) is not enough these days.\\r\\n\\t\\t* Passwords are bad as they are easy to guess and we (humans) are bad at choosing good passwords. Passwords are also vulnerable to a variety of attacks like phishing and password spray. One of the easiest things you can do to protect against password threats is to implement MFA. With MFA, even if an attacker gets in possession of a user's password, the password alone is not sufficient to successfully authenticate and access the data.\\r\\n\\r\\n\\tHow can you prevent apps using legacy authentication from accessing your tenant's resources? The recommendation is to just block them with a Conditional Access policy. If necessary, you allow only certain users and specific network locations to use apps that are based on legacy authentication.\\r\\n\\r\\n**Data Filters**\\r\\n\\t* Account\\r\\n\\t* IP address\\r\\n\\t* Account timebrush\\r\\n\\t* IP timebrush\\r\\n\\t* Auth type\\r\\n\\t* Country/region\\r\\n\\t* Full details\\r\\n\\r\\n** References   **\\r\\n- [How to: Block legacy authentication to Azure AD with Conditional Access](https://docs.microsoft.com/azure/active-directory/conditional-access/block-legacy-authentication#:~:text=To%20give%20your%20users%20easy%20access%20to%20your,environments%20a%20common%20requirement%20to%20address%20identity%20theft)\",               \"style\": \"info\"             },             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 9\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize Count=count() by UserPrincipalName, ClientAppUsed //doughnut\\r\\n| order by Count desc\",               \"size\": 0,               \"title\": \"Legacy authentications, by account\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"UserPrincipalName\",               \"exportParameterName\": \"UserPrincipalName\",               \"exportDefaultValue\": \"All\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 1,                       \"palette\": \"blue\"                     }                   }                 ],                 \"filter\": true               },               \"sortBy\": []             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 29\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize Count=count() by IPAddress,ClientAppUsed //doughnut\\r\\n| order by Count desc\",               \"size\": 0,               \"title\": \"Legacy authentications, by IP address\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 1,                       \"palette\": \"orange\"                     }                   }                 ],                 \"filter\": true               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 30\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize count() by UserPrincipalName, bin(TimeGenerated, {TimeRange:grain})\\r\\n| order by count_\\r\\n\",               \"size\": 1,               \"title\": \"Account events over time - select timebrush\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"AADTimebrushAccount\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"linechart\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"CountryOrRegion\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"ClientAppUsed\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"purple\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   }                 ],                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"CountryOrRegion\"                   ]                 },                 \"labelSettings\": [                   {                     \"columnId\": \"CountryOrRegion\"                   },                   {                     \"columnId\": \"ClientAppUsed\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Count\"                   }                 ]               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 31 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize Count=count() by UserPrincipalName, bin(TimeGenerated, {TimeRange:grain})\\r\\n| order by Count\\r\\n\",               \"size\": 1,               \"title\": \"Account events over time ({AADTimebrushAccount:label})\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"AADTimebrushAccount\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"aggregation\": \"Sum\"                     }                   }                 ],                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"UserPrincipalName\"                   ]                 }               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 26\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize count() by IPAddress, bin(TimeGenerated, {TimeRange:grain})\\r\\n| order by count_\\r\\n\",               \"size\": 1,               \"title\": \"IPAddresses over time - select timebrush\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"AADTimebrushIPAddress\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"linechart\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"CountryOrRegion\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"ClientAppUsed\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"purple\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   }                 ],                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"CountryOrRegion\"                   ]                 },                 \"labelSettings\": [                   {                     \"columnId\": \"CountryOrRegion\"                   },                   {                     \"columnId\": \"ClientAppUsed\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Count\"                   }                 ]               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"IP Timebrush\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize Count=count() by IPAddress\\r\\n| order by Count\\r\\n\",               \"size\": 1,               \"title\": \"IP events over time ({AADTimebrushIPAddress:label})\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"AADTimebrushIPAddress\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"aggregation\": \"Sum\"                     }                   }                 ],                 \"sortBy\": [                   {                     \"itemKey\": \"IPAddress\",                     \"sortOrder\": 2                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"IPAddress\",                   \"sortOrder\": 2                 }               ]             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 26 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize count() by ClientAppUsed, UserPrincipalName //bar\",               \"size\": 0,               \"title\": \"Legacy authentications, by authentication type\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"ClientAppUsed\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"UserPrincipalName\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"gray\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   }                 ],                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"ClientAppUsed\"                   ]                 },                 \"labelSettings\": [                   {                     \"columnId\": \"ClientAppUsed\"                   },                   {                     \"columnId\": \"UserPrincipalName\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Count\"                   }                 ]               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 32\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize count() by tostring(CountryOrRegion=LocationDetails.countryOrRegion), ClientAppUsed //bar\\r\\n| order by count_\\r\\n\",               \"size\": 0,               \"title\": \"Legacy authentications, by country/region\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"CountryOrRegion\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"ClientAppUsed\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"purple\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   }                 ],                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"CountryOrRegion\"                   ]                 },                 \"labelSettings\": [                   {                     \"columnId\": \"CountryOrRegion\"                   },                   {                     \"columnId\": \"ClientAppUsed\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Count\"                   }                 ]               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 31\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| extend mergeCountry = toupper(LocationDetails.countryOrRegion)\\r\\n| summarize  IPaddress = make_set(IPAddress), Count=count() by UserPrincipalName,  ClientAppUsed, tostring(CountryOrRegion=mergeCountry) //table\\r\\n| order by Count desc\",               \"size\": 0,               \"title\": \"Legacy authentications details\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"palette\": \"coldHot\"                     }                   }                 ],                 \"filter\": true               },               \"sortBy\": []             },             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 33\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"AADLegacy\"       },       \"name\": \"group - AAD\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: Vulnerable Secure Channel\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### Vulnerable Netlogon Secure Channel Help\\r\\n\\r\\n**Protocol Risk**\\r\\n\\t* An elevation of privilege vulnerability exists when an attacker establishes a vulnerable Netlogon secure channel connection to a domain controller\\r\\n\\t* An attacker who successfully exploited the vulnerability could run a specially crafted application on a device on the network\\r\\n\\r\\n**Auditing Settings**\\r\\n\\t* Apply relevant update from CVE-2020-1472 to enable logging\\r\\n\\t* In Log Analytics/Sentinel, set log collection to include Warning and Errors from the System Event log\\r\\n\\r\\n**Mitigation Planning**\\r\\n\\t* Review All Connections with an Insecure Netlogon Secure Channel\\r\\n\\t* Enforcement Mode is scheduled to be enabled on February 9, 2021\\r\\n\\t* Prior to Enforcement Mode enablement, ensure that all Netlogon clients are upgraded\\r\\n\\t* If upgrade is not possible at this time, grant an exemption in the Group Policy: Domain controller: Allow vulnerable Netlogon secure channel connections\\r\\n\\t* To enter Enforcement Mode ahead of schedule, configure the REG_DWORD FullSecureChannelProtection in key HKEY_LOCAL_MACHINE\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\Netlogon\\\\Parameters to a value of 1\\r\\n\\r\\n**Data Filters**\\r\\n\\t* Machine\\r\\n\\t* ClientIP\\r\\n\\t* Status\\r\\n\\r\\n** References   **\\r\\n- [How to manage the changes in Netlogon secure channel connections associated with CVE-2020-1472](https://support.microsoft.com/help/4557222/how-to-manage-the-changes-in-netlogon-secure-channel-connections-assoc)\",               \"style\": \"info\"             },             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 9 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5827, 5828, 5829, 5830, 5831]);\\r\\nEvent\\r\\n| where EventID in (scEvents)\\r\\n| where EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\"\\r\\n| extend Status = case(EventID == 5827 or EventID == 5828, \\\"Connection Denied\\\", EventID == 5829, \\\"Connection Allowed - Enforcement Mode Off\\\", EventID == 5830 or EventID == 5831, \\\"Connection Allowed - Policy\\\", \\\"Unknown\\\")\\r\\n| summarize Count=count() by Status\\r\\n| sort by Count desc\",               \"size\": 4,               \"title\": \"Secure Channel Status - click to filter\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"Status\",               \"exportParameterName\": \"Status\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"tiles\",               \"tileSettings\": {                 \"showBorder\": false,                 \"titleContent\": {                   \"columnMatch\": \"Status\",                   \"formatter\": 1                 },                 \"leftContent\": {                   \"columnMatch\": \"Count\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\"                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               }             },             \"customWidth\": \"50\",             \"name\": \"query - 4\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5827, 5828, 5829, 5830, 5831]);\\r\\nEvent\\r\\n| where EventID in (scEvents)\\r\\n| where EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\"\\r\\n| extend Status = case(EventID == 5827 or EventID == 5828, \\\"Connection Denied\\\", EventID == 5829, \\\"Connection Allowed - Enforcement Mode Off\\\", EventID == 5830 or EventID == 5831, \\\"Connection Allowed - Policy\\\", \\\"Unknown\\\")\\r\\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), Status\",               \"size\": 1,               \"title\": \"Secure Channel by Time - Select Time Range\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"SCTimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"customWidth\": \"50\",             \"name\": \"query - 8\"           },           {             \"type\": 1,             \"content\": {               \"json\": \"### Machine Accounts \\r\\n---\"             },             \"name\": \"text - 5\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5827, 5829, 5830]);\\r\\nEvent\\r\\n| where TimeGenerated between({SCTimeBrush:start}..({SCTimeBrush:end}+{TimeRange:grain}))\\r\\n| where EventID in (scEvents)\\r\\n| where EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\"\\r\\n| parse ParameterXml with \\\"\u003cParam\u003e\\\" Machine \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" Domain \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" AccountType \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" OperatingSystem \\\"\u003c/P\\\" *\\r\\n| extend Status = case(EventID == 5827 or EventID == 5828, \\\"Connection Denied\\\", EventID == 5829, \\\"Connection Allowed - Enforcement Mode Off\\\", EventID == 5830 or EventID == 5831, \\\"Connection Allowed - Policy\\\", \\\"Unknown\\\")\\r\\n| where Status =~ \\\"{Status}\\\" or \\\"{Status}\\\" =~ \\\"All\\\"\\r\\n| summarize Count=count() by Machine, Status\\r\\n| order by Count desc\",               \"size\": 0,               \"title\": \"By Machine - click to filter\",               \"exportFieldName\": \"Machine\",               \"exportParameterName\": \"Machine\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 1,                       \"palette\": \"orange\"                     }                   }                 ]               },               \"sortBy\": []             },             \"customWidth\": \"30\",             \"name\": \"By Machine\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5827, 5829, 5830]);\\r\\nEvent\\r\\n| where TimeGenerated between({SCTimeBrush:start}..({SCTimeBrush:end}+{TimeRange:grain}))\\r\\n| where EventID in (scEvents)\\r\\n| where EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\"\\r\\n| parse ParameterXml with \\\"\u003cParam\u003e\\\" Machine \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" Domain \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" AccountType \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" OperatingSystem \\\"\u003c/P\\\" *\\r\\n| where Machine =~ \\\"{Machine}\\\" or \\\"{Machine}\\\" =~ \\\"All\\\"\\r\\n| extend Status = case(EventID == 5827 or EventID == 5828, \\\"Connection Denied\\\", EventID == 5829, \\\"Connection Allowed - Enforcement Mode Off\\\", EventID == 5830 or EventID == 5831, \\\"Connection Allowed - Policy\\\", \\\"Unknown\\\")\\r\\n| where Status =~ \\\"{Status}\\\" or \\\"{Status}\\\" =~ \\\"All\\\"\\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by DomainController=Computer, Machine, Domain, AccountType, OperatingSystem, EventID, Status\\r\\n\",               \"size\": 0,               \"title\": \"Machine Account Connections\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ]             },             \"customWidth\": \"70\",             \"name\": \"query - 0\"           },           {             \"type\": 1,             \"content\": {               \"json\": \"### Trust Accounts\\r\\n---\"             },             \"name\": \"text - 6\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5828, 5831]);\\r\\nEvent\\r\\n| where TimeGenerated between({SCTimeBrush:start}..({SCTimeBrush:end}+{TimeRange:grain}))\\r\\n| where EventID in (scEvents)\\r\\n| where EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\"\\r\\n| parse ParameterXml with \\\"\u003cParam\u003e\\\" AccountType \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" TrustName \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" TrustTarget \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" ClientIP \\\"\u003c/P\\\" *\\r\\n| extend Status = case(EventID == 5827 or EventID == 5828, \\\"Connection Denied\\\", EventID == 5829, \\\"Connection Allowed - Enforcement Mode Off\\\", EventID == 5830 or EventID == 5831, \\\"Connection Allowed - Policy\\\", \\\"Unknown\\\")\\r\\n| where Status =~ \\\"{Status}\\\" or \\\"{Status}\\\" =~ \\\"All\\\"\\r\\n| summarize Count=count() by ClientIP, Status\\r\\n| order by Count desc\",               \"size\": 0,               \"title\": \"By Trust Account - click to filter\",               \"exportFieldName\": \"ClientIP\",               \"exportParameterName\": \"ClientIP\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 1,                       \"palette\": \"orange\"                     }                   }                 ]               }             },             \"customWidth\": \"30\",             \"name\": \"query - 7\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5828, 5831]);\\r\\nEvent\\r\\n| where TimeGenerated between({SCTimeBrush:start}..({SCTimeBrush:end}+{TimeRange:grain}))\\r\\n| where EventID in (scEvents)\\r\\n| where EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\"\\r\\n| parse ParameterXml with \\\"\u003cParam\u003e\\\" AccountType \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" TrustName \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" TrustTarget \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" ClientIP \\\"\u003c/P\\\" *\\r\\n| where ClientIP =~ \\\"{ClientIP}\\\" or \\\"{ClientIP}\\\" =~ \\\"All\\\"\\r\\n| extend Status = case(EventID == 5827 or EventID == 5828, \\\"Connection Denied\\\", EventID == 5829, \\\"Connection Allowed - Enforcement Mode Off\\\", EventID == 5830 or EventID == 5831, \\\"Connection Allowed - Policy\\\", \\\"Unknown\\\")\\r\\n| where Status =~ \\\"{Status}\\\" or \\\"{Status}\\\" =~ \\\"All\\\"\\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by DomainController=Computer, AccountType, TrustName, TrustTarget, ClientIP, EventID, Status\",               \"size\": 0,               \"title\": \"Trust Account Connections\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"sortBy\": [                   {                     \"itemKey\": \"ClientIP\",                     \"sortOrder\": 1                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"ClientIP\",                   \"sortOrder\": 1                 }               ]             },             \"customWidth\": \"70\",             \"name\": \"query - 0 - Copy\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"NetlogonSC\"       },       \"name\": \"NetlogonSC\"     }   ],   \"fromTemplateId\": \"sentinel-UserWorkbook\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('linux_id')]",
                          "properties":  {
                                             "displayName":  "Security - Linux Host Analytics",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"\"       },       \"customWidth\": \"100\",       \"name\": \"text - 5\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"crossComponentResources\": [           \"value::all\"         ],         \"parameters\": [           {             \"id\": \"f8d6705a-e284-4077-8113-aae1038a6b7c\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Workspaces\",             \"type\": 5,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| summarize by id, name\",             \"crossComponentResources\": [               \"value::all\"             ],             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::1\",                 \"value::all\"               ]             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           }         ],         \"style\": \"pills\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\"       },       \"name\": \"parameters - 11\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"# Azure Automation Linux Update Summary for All Subscriptions\\r\\n\\r\\nThis workbook can query multiple Log Analytics Workspaces. The Azure Automation Update Management solution needs to be linked to every Log Analytics Workspaces you wish to use it with.\"       },       \"name\": \"text - 6\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Update\\r\\n| where TimeGenerated\u003eago(5h) and OSType==\\\"Linux\\\"\\r\\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, UpdateState, Classification) by Computer, SourceComputerId, Product, ProductArch\\r\\n| where UpdateState=~\\\"Needed\\\"\\r\\n| summarize by Product, ProductArch, Classification, Computer\\r\\n| summarize count(Classification) by Computer\",         \"size\": 2,         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"piechart\",         \"tileSettings\": {           \"showBorder\": false,           \"titleContent\": {             \"columnMatch\": \"Classification\",             \"formatter\": 1           },           \"leftContent\": {             \"columnMatch\": \"UpdatesNeeded\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\"             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         }       },       \"customWidth\": \"50\",       \"name\": \"query - 0\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Update\\r\\n| where TimeGenerated\u003eago(5h) and OSType==\\\"Linux\\\"\\r\\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, UpdateState, Classification) by Computer, SourceComputerId, Product, ProductArch\\r\\n| where UpdateState=~\\\"Needed\\\"\\r\\n| summarize by Product, ProductArch, Classification, Computer\\r\\n| summarize count(Classification) by Classification\",         \"size\": 2,         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"piechart\",         \"chartSettings\": {           \"seriesLabelSettings\": [             {               \"seriesName\": \"Others\",               \"color\": \"purple\"             },             {               \"seriesName\": \"Security Updates\",               \"color\": \"redBright\"             }           ]         }       },       \"customWidth\": \"50\",       \"name\": \"top five Computers Needing Updates\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Update Count by Classification\"       },       \"customWidth\": \"50\",       \"name\": \"text - 7\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Top 5 Linux Machines by Update Count\"       },       \"customWidth\": \"50\",       \"name\": \"text - 8\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Heartbeat\\r\\n| where TimeGenerated\u003eago(12h) and OSType==\\\"Linux\\\" and notempty(Computer)\\r\\n| summarize arg_max(TimeGenerated, Solutions, Computer, ResourceId, ComputerEnvironment, VMUUID) by SourceComputerId\\r\\n| where Solutions has \\\"updates\\\"\\r\\n| extend vmuuId=VMUUID, azureResourceId=ResourceId, osType=1, environment=iff(ComputerEnvironment=~\\\"Azure\\\", 1, 2), scopedToUpdatesSolution=true, lastUpdateAgentSeenTime=\\\"\\\"\\r\\n| join kind=leftouter\\r\\n(\\r\\n    Update\\r\\n    | where TimeGenerated\u003eago(5h) and OSType==\\\"Linux\\\" and SourceComputerId in ((Heartbeat\\r\\n    | where TimeGenerated\u003eago(12h) and OSType==\\\"Linux\\\" and notempty(Computer)\\r\\n    | summarize arg_max(TimeGenerated, Solutions) by SourceComputerId\\r\\n    | where Solutions has \\\"updates\\\"\\r\\n    | distinct SourceComputerId))\\r\\n    | summarize hint.strategy=partitioned arg_max(TimeGenerated, UpdateState, Classification, Product, Computer, ComputerEnvironment) by SourceComputerId, Product, ProductArch\\r\\n    | summarize Computer=any(Computer), ComputerEnvironment=any(ComputerEnvironment), missingCriticalUpdatesCount=countif(Classification has \\\"Critical\\\" and UpdateState=~\\\"Needed\\\"), missingSecurityUpdatesCount=countif(Classification has \\\"Security\\\" and UpdateState=~\\\"Needed\\\"), missingOtherUpdatesCount=countif(Classification !has \\\"Critical\\\" and Classification !has \\\"Security\\\" and UpdateState=~\\\"Needed\\\"), lastAssessedTime=max(TimeGenerated), lastUpdateAgentSeenTime=\\\"\\\" by SourceComputerId\\r\\n    | extend compliance=iff(missingCriticalUpdatesCount \u003e 0 or missingSecurityUpdatesCount \u003e 0, 2, 1)\\r\\n    | extend ComplianceOrder=iff(missingCriticalUpdatesCount \u003e 0 or missingSecurityUpdatesCount \u003e 0 or missingOtherUpdatesCount \u003e 0, 1, 3)\\r\\n)\\r\\non SourceComputerId\\r\\n| project displayName=Computer, scopedToUpdatesSolution=true, CriticalUpdates=coalesce(missingCriticalUpdatesCount, -1), SecurityUpdates=coalesce(missingSecurityUpdatesCount, -1), OtherUpdates=coalesce(missingOtherUpdatesCount, -1), compliance=coalesce(compliance, 4), osType=1, environment=iff(ComputerEnvironment=~\\\"Azure\\\", 1, 2), lastAssessedTime, lastUpdateAgentSeenTime\\r\\n| extend osType = replace(@\\\"1\\\", @\\\"Linux\\\", tostring(osType))\\r\\n| extend environment = replace(@\\\"2\\\", @\\\"Non-Azure\\\", tostring(environment))\\r\\n| extend environment = replace(@\\\"1\\\", @\\\"Azure\\\", tostring(environment))\",         \"size\": 0,         \"exportFieldName\": \"displayName\",         \"exportParameterName\": \"Computer\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"displayName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"scopedToUpdatesSolution\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"CriticalUpdates\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"max\": 1,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SecurityUpdates\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"max\": 5,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OtherUpdates\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"max\": 5,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"compliance\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 1,                 \"max\": 2,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"osType\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Environment\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"lastAssessedTime\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"lastUpdateAgentSeenTime\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ]         }       },       \"name\": \"query - 2\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"parameters\": [],         \"style\": \"pills\",         \"queryType\": 0,         \"resourceType\": \"microsoft.insights/components\"       },       \"name\": \"parameters - 3\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Update\\r\\n| where TimeGenerated\u003eago(5h) and OSType==\\\"Linux\\\" and Computer == \\\"{Computer}\\\"\\r\\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, UpdateState, Classification, BulletinUrl, BulletinID) by Computer, SourceComputerId, Product, ProductArch\\r\\n| where UpdateState=~\\\"Needed\\\"\\r\\n| project-away UpdateState, TimeGenerated\\r\\n| summarize computersCount=dcount(SourceComputerId, 2), ClassificationWeight=max(iff(Classification has \\\"Critical\\\", 4, iff(Classification has \\\"Security\\\", 2, 1))) by Computer, id=strcat(Product, \\\"_\\\", ProductArch), displayName=Product, productArch=ProductArch, classification=Classification, InformationId=BulletinID, InformationUrl=tostring(split(BulletinUrl, \\\";\\\", 0)[0]), osType=1\\r\\n| sort by ClassificationWeight desc, computersCount desc, displayName asc\\r\\n| extend informationLink=(iff(isnotempty(InformationId) and isnotempty(InformationUrl), toobject(strcat('{ \\\"uri\\\": \\\"', InformationUrl, '\\\", \\\"text\\\": \\\"', InformationId, '\\\", \\\"target\\\": \\\"blank\\\" }')), toobject('')))\\r\\n| project-away ClassificationWeight, InformationId, InformationUrl\",         \"size\": 0,         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Computer\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"id\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"displayName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"productArch\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"classification\",               \"formatter\": 18,               \"formatOptions\": {                 \"showIcon\": true,                 \"thresholdsOptions\": \"colors\",                 \"thresholdsGrid\": [                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Security Updates\",                     \"representation\": \"redBright\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Others\",                     \"representation\": \"purple\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"Default\",                     \"thresholdValue\": null,                     \"representation\": \"blue\",                     \"text\": \"{0}{1}\"                   }                 ]               }             },             {               \"columnMatch\": \"osType\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"computersCount\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"informationLink\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ]         }       },       \"name\": \"query - 4\"     }   ],   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('LinuxMachines_id')]",
                          "properties":  {
                                             "displayName":  "Security - Linux Machines overview",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"## Linux Machines\"       },       \"name\": \"text - 0\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"query\": \"\",         \"crossComponentResources\": [],         \"parameters\": [           {             \"id\": \"1025a43d-241c-4e40-95dc-c9eb9c789bc5\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 1209600000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2419200000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ],               \"allowCustom\": true             }           },           {             \"id\": \"bc241870-7874-4927-8c74-d17e747522b1\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Computer\",             \"type\": 5,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"Syslog\\r\\n| summarize syslogEventsCount = count() by Computer\\r\\n| sort by syslogEventsCount desc\\r\\n| project Computer\\r\\n\",             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"selectAllValue\": \"All\"             },             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\"           },           {             \"id\": \"e073f36e-2fb5-421d-9099-217205b247f5\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Severity\",             \"type\": 2,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"selectAllValue\": \"*\"             },             \"jsonData\": \"[\\\"Emergency\\\", \\\"Alert\\\", \\\"Critical\\\", \\\"Error\\\", \\\"Warning\\\", \\\"Notice\\\", \\\"Informational\\\", \\\"Debug\\\"]\",             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\"           }         ],         \"style\": \"pills\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"name\": \"parameters - 1\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| summarize count() by SeverityLevel\\r\\n| extend severityNumber = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 0, iif(SeverityLevel == 'alert', 1, iif(SeverityLevel == 'crit', 2, iif(SeverityLevel == 'err' or SeverityLevel == 'error', 3, iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 4, iif(SeverityLevel == 'notice', 5, iif(SeverityLevel == 'info', 6, iif(SeverityLevel == 'debug', 7, 8))))))))\\r\\n| sort by severityNumber asc\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| project-away severityNumber\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n\",         \"size\": 4,         \"exportToExcelOptions\": \"visible\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"tiles\",         \"tileSettings\": {           \"titleContent\": {             \"columnMatch\": \"SeverityLevel\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"leftContent\": {             \"columnMatch\": \"count_\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"hotCold\",               \"showIcon\": true             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"style\": \"decimal\",                 \"maximumFractionDigits\": 2,                 \"maximumSignificantDigits\": 3               }             }           },           \"showBorder\": false,           \"sortOrderField\": 2         }       },       \"name\": \"query - 2\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where \\\"{Computer:lable}\\\" == \\\"All\\\" or Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n| where SeverityLevel in (\\\"emerg\\\")\\r\\n| summarize count() by Computer, TimeGenerated\\r\\n\",         \"size\": 1,         \"exportToExcelOptions\": \"visible\",         \"title\": \"\\\"Emergency\\\" level events, by computer\",         \"noDataMessage\": \"No emergency events within the defined scope\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\"       },       \"customWidth\": \"33\",       \"name\": \"query - 2 - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where \\\"{Computer:lable}\\\" == \\\"All\\\" or Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n| where SeverityLevel in (\\\"crit\\\")\\r\\n| summarize count() by Computer, TimeGenerated\\r\\n\",         \"size\": 1,         \"exportToExcelOptions\": \"visible\",         \"title\": \"\\\"Critical\\\" level events, by computer\",         \"noDataMessage\": \"No critical events within the defined scope\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\"       },       \"customWidth\": \"33\",       \"name\": \"query - 2 - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where \\\"{Computer:lable}\\\" == \\\"All\\\" or Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n| where SeverityLevel in (\\\"alert\\\")\\r\\n| summarize count() by Computer, TimeGenerated\\r\\n\",         \"size\": 1,         \"exportToExcelOptions\": \"visible\",         \"title\": \"\\\"Alert\\\" level events, by computer\",         \"noDataMessage\": \"No alert events within the defined scope\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\"       },       \"customWidth\": \"33\",       \"name\": \"query - 2 - Copy - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| extend SeverityNumber = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 0, iif(SeverityLevel == 'alert', 1, iif(SeverityLevel == 'crit', 2, iif(SeverityLevel == 'err' or SeverityLevel == 'error', 3, iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 4, iif(SeverityLevel == 'notice', 5, iif(SeverityLevel == 'info', 6, iif(SeverityLevel == 'debug', 7, 8))))))))\\r\\n| where Severity in ({Severity})\\r\\n|extend Computer = iif(isempty(_ResourceId), Computer, _ResourceId)\\r\\n| project TimeGenerated, Computer, SeverityLevel, SeverityNumber, Facility, HostIP, ProcessNameAndID = strcat(ProcessName, ' (', iff(isempty(ProcessID), \\\"-\\\", tostring(ProcessID)), ')')  \\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Events\",         \"noDataMessage\": \"No events\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"TimeGenerated\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Computer\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SeverityLevel\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SeverityNumber\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 7,                 \"max\": 0,                 \"palette\": \"redDark\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Facility\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"HostIP\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ProcessNameAndID\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"labelSettings\": []         }       },       \"name\": \"query - 2 - Copy - Copy - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where \\\"{Computer:lable}\\\" == \\\"All\\\" or Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n| summarize count() by SyslogMessage\\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Syslog messages of events\",         \"noDataMessage\": \"No messages\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"50\",       \"name\": \"query - 7\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where \\\"{Computer:lable}\\\" == \\\"All\\\" or Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n| summarize count() by Facility, ProcessName\\r\\n| project Process = strcat(ProcessName, ' (', Facility, ')'), Count = count_  \\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Process names of events\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"50\",       \"name\": \"query - 11\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where \\\"{Computer:lable}\\\" == \\\"All\\\" or Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n| summarize count() by Facility, SeverityLevel\\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Event distribution, by facility\",         \"noDataMessage\": \"No events\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"50\",       \"name\": \"query - 7 - Copy - Copy - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where \\\"{Computer:lable}\\\" == \\\"All\\\" or Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n| summarize count() by Facility, SeverityLevel\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Severity levels, by facility\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"categoricalbar\"       },       \"customWidth\": \"50\",       \"name\": \"query - 11 - Copy\"     }   ],   \"styleSettings\": {},   \"fromTemplateId\": \"sentinel-LinuxMachines\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('linuxwindows_id')]",
                          "properties":  {
                                             "displayName":  "Security - Linux And Windows VM overview",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"\"       },       \"customWidth\": \"100\",       \"name\": \"text - 5\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"crossComponentResources\": [           \"value::all\"         ],         \"parameters\": [           {             \"id\": \"f8d6705a-e284-4077-8113-aae1038a6b7c\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Workspaces\",             \"type\": 5,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| summarize by id, name\",             \"crossComponentResources\": [               \"value::all\"             ],             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::1\",                 \"value::all\"               ]             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           }         ],         \"style\": \"pills\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\"       },       \"name\": \"parameters - 11\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"# Azure Automation Windows and Linux Update Summary for All Subscriptions\\r\\n\\r\\nThis workbook can query multiple Log Analytics Workspaces. The Azure Automation Update Management solution needs to be linked to every Log Analytics Workspaces you wish to use it with.\"       },       \"name\": \"text - 6\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Windows Updates Needed by Classification\"       },       \"customWidth\": \"50\",       \"name\": \"text - 7\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Linux Updates Needed by Classification\"       },       \"customWidth\": \"50\",       \"name\": \"text - 8\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Update\\r\\n| where TimeGenerated\u003eago(14h) and OSType!=\\\"Linux\\\" and (Optional==false or Classification has \\\"Critical\\\" or Classification has \\\"Security\\\") and SourceComputerId in ((Heartbeat\\r\\n| where TimeGenerated\u003eago(12h) and OSType=~\\\"Windows\\\" and notempty(Computer)\\r\\n| summarize arg_max(TimeGenerated, Solutions) by SourceComputerId\\r\\n| where Solutions has \\\"updates\\\" | distinct SourceComputerId))\\r\\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, *) by Computer, SourceComputerId, UpdateID\\r\\n| where UpdateState=~\\\"Needed\\\" and Approved!=false\\r\\n| summarize UpdatesNeeded=count(Classification) by Classification\",         \"size\": 2,         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"piechart\",         \"tileSettings\": {           \"showBorder\": false,           \"titleContent\": {             \"columnMatch\": \"Classification\",             \"formatter\": 1           },           \"leftContent\": {             \"columnMatch\": \"UpdatesNeeded\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\"             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         },         \"chartSettings\": {           \"seriesLabelSettings\": [             {               \"seriesName\": \"Security Updates\",               \"color\": \"redBright\"             },             {               \"seriesName\": \"Updates\",               \"color\": \"orange\"             },             {               \"seriesName\": \"Definition Updates\",               \"color\": \"yellow\"             },             {               \"seriesName\": \"Update Rollups\",               \"color\": \"purple\"             },             {               \"seriesName\": \"Critical Updates\",               \"color\": \"red\"             }           ]         }       },       \"customWidth\": \"50\",       \"name\": \"query - 0\",       \"styleSettings\": {         \"maxWidth\": \"50\"       }     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Update\\r\\n| where TimeGenerated\u003eago(5h) and OSType==\\\"Linux\\\"\\r\\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, UpdateState, Classification) by Computer, SourceComputerId, Product, ProductArch\\r\\n| where UpdateState=~\\\"Needed\\\"\\r\\n| summarize by Product, ProductArch, Classification, Computer\\r\\n| summarize count(Classification) by Classification\",         \"size\": 2,         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"piechart\",         \"chartSettings\": {           \"seriesLabelSettings\": [             {               \"seriesName\": \"Others\",               \"color\": \"purple\"             },             {               \"seriesName\": \"Security Updates\",               \"color\": \"redBright\"             }           ]         }       },       \"customWidth\": \"50\",       \"name\": \"top five Computers Needing Updates\",       \"styleSettings\": {         \"maxWidth\": \"50\"       }     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Heatmap of Update Summary by Computer\\r\\n\\r\\nThis section is dynamic, by selecting a row that row's Computer name will be exported to populate Updates needed by Server\"       },       \"name\": \"text - 9\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Heartbeat\\r\\n| where TimeGenerated\u003eago(12h) and OSType==\\\"Linux\\\" and notempty(Computer)\\r\\n| summarize arg_max(TimeGenerated, Solutions, Computer, ResourceId, ComputerEnvironment, VMUUID) by SourceComputerId\\r\\n| where Solutions has \\\"updates\\\"\\r\\n| extend vmuuId=VMUUID, azureResourceId=ResourceId, osType=1, environment=iff(ComputerEnvironment=~\\\"Azure\\\", 1, 2), scopedToUpdatesSolution=true, lastUpdateAgentSeenTime=\\\"\\\"\\r\\n| join kind=leftouter\\r\\n(\\r\\n    Update\\r\\n    | where TimeGenerated\u003eago(5h) and OSType==\\\"Linux\\\" and SourceComputerId in ((Heartbeat\\r\\n    | where TimeGenerated\u003eago(12h) and OSType==\\\"Linux\\\" and notempty(Computer)\\r\\n    | summarize arg_max(TimeGenerated, Solutions) by SourceComputerId\\r\\n    | where Solutions has \\\"updates\\\"\\r\\n    | distinct SourceComputerId))\\r\\n    | summarize hint.strategy=partitioned arg_max(TimeGenerated, UpdateState, Classification, Product, Computer, ComputerEnvironment) by SourceComputerId, Product, ProductArch\\r\\n    | summarize Computer=any(Computer), ComputerEnvironment=any(ComputerEnvironment), missingCriticalUpdatesCount=countif(Classification has \\\"Critical\\\" and UpdateState=~\\\"Needed\\\"), missingSecurityUpdatesCount=countif(Classification has \\\"Security\\\" and UpdateState=~\\\"Needed\\\"), missingOtherUpdatesCount=countif(Classification !has \\\"Critical\\\" and Classification !has \\\"Security\\\" and UpdateState=~\\\"Needed\\\"), lastAssessedTime=max(TimeGenerated), lastUpdateAgentSeenTime=\\\"\\\" by SourceComputerId\\r\\n    | extend compliance=iff(missingCriticalUpdatesCount \u003e 0 or missingSecurityUpdatesCount \u003e 0, 2, 1)\\r\\n    | extend ComplianceOrder=iff(missingCriticalUpdatesCount \u003e 0 or missingSecurityUpdatesCount \u003e 0 or missingOtherUpdatesCount \u003e 0, 1, 3)\\r\\n)\\r\\non SourceComputerId\\r\\n| project id=SourceComputerId, displayName=Computer, sourceComputerId=SourceComputerId, scopedToUpdatesSolution=true, missingCriticalUpdatesCount=coalesce(missingCriticalUpdatesCount, -1), missingSecurityUpdatesCount=coalesce(missingSecurityUpdatesCount, -1), missingOtherUpdatesCount=coalesce(missingOtherUpdatesCount, -1), compliance=coalesce(compliance, 4), lastAssessedTime, lastUpdateAgentSeenTime, osType=1, environment=iff(ComputerEnvironment=~\\\"Azure\\\", 1, 2), ComplianceOrder=coalesce(ComplianceOrder, 2)\\r\\n| union(Heartbeat\\r\\n| where TimeGenerated\u003eago(12h) and OSType=~\\\"Windows\\\" and notempty(Computer)\\r\\n| summarize arg_max(TimeGenerated, Solutions, Computer, ResourceId, ComputerEnvironment, VMUUID) by SourceComputerId\\r\\n| where Solutions has \\\"updates\\\"\\r\\n| extend vmuuId=VMUUID, azureResourceId=ResourceId, osType=2, environment=iff(ComputerEnvironment=~\\\"Azure\\\", 1, 2), scopedToUpdatesSolution=true, lastUpdateAgentSeenTime=\\\"\\\"\\r\\n| join kind=leftouter\\r\\n(\\r\\n    Update\\r\\n    | where TimeGenerated\u003eago(14h) and OSType!=\\\"Linux\\\" and SourceComputerId in ((Heartbeat\\r\\n    | where TimeGenerated\u003eago(12h) and OSType=~\\\"Windows\\\" and notempty(Computer)\\r\\n    | summarize arg_max(TimeGenerated, Solutions) by SourceComputerId\\r\\n    | where Solutions has \\\"updates\\\"\\r\\n    | distinct SourceComputerId))\\r\\n    | summarize hint.strategy=partitioned arg_max(TimeGenerated, UpdateState, Classification, Title, Optional, Approved, Computer, ComputerEnvironment) by Computer, SourceComputerId, UpdateID\\r\\n    | summarize Computer=any(Computer), ComputerEnvironment=any(ComputerEnvironment), missingCriticalUpdatesCount=countif(Classification has \\\"Critical\\\" and UpdateState=~\\\"Needed\\\" and Approved!=false), missingSecurityUpdatesCount=countif(Classification has \\\"Security\\\" and UpdateState=~\\\"Needed\\\" and Approved!=false), missingOtherUpdatesCount=countif(Classification !has \\\"Critical\\\" and Classification !has \\\"Security\\\" and UpdateState=~\\\"Needed\\\" and Optional==false and Approved!=false), lastAssessedTime=max(TimeGenerated), lastUpdateAgentSeenTime=\\\"\\\" by SourceComputerId\\r\\n    | extend compliance=iff(missingCriticalUpdatesCount \u003e 0 or missingSecurityUpdatesCount \u003e 0, 2, 1)\\r\\n    | extend ComplianceOrder=iff(missingCriticalUpdatesCount \u003e 0 or missingSecurityUpdatesCount \u003e 0 or missingOtherUpdatesCount \u003e 0, 1, 3)\\r\\n)\\r\\non SourceComputerId\\r\\n| project id=SourceComputerId, displayName=Computer, sourceComputerId=SourceComputerId, scopedToUpdatesSolution=true, missingCriticalUpdatesCount=coalesce(missingCriticalUpdatesCount, -1), missingSecurityUpdatesCount=coalesce(missingSecurityUpdatesCount, -1), missingOtherUpdatesCount=coalesce(missingOtherUpdatesCount, -1), compliance=coalesce(compliance, 4), lastAssessedTime, lastUpdateAgentSeenTime, osType=2, environment=iff(ComputerEnvironment=~\\\"Azure\\\", 1, 2), ComplianceOrder=coalesce(ComplianceOrder, 2) )\\r\\n| order by ComplianceOrder asc, missingCriticalUpdatesCount desc, missingSecurityUpdatesCount desc, missingOtherUpdatesCount desc, displayName asc\\r\\n| project displayName, scopedToUpdatesSolution, CriticalUpdates=missingCriticalUpdatesCount, SecurityUpdates=missingSecurityUpdatesCount, OtherUpdates=missingOtherUpdatesCount, compliance, osType, Environment=environment, lastAssessedTime, lastUpdateAgentSeenTime\\r\\n| extend osType = replace(@\\\"2\\\", @\\\"Windows\\\", tostring(osType))\\r\\n| extend osType = replace(@\\\"1\\\", @\\\"Linux\\\", tostring(osType))\\r\\n| extend Environment = replace(@\\\"2\\\", @\\\"Non-Azure\\\", tostring(Environment))\\r\\n| extend Environment = replace(@\\\"1\\\", @\\\"Azure\\\", tostring(Environment))\",         \"size\": 0,         \"exportFieldName\": \"displayName\",         \"exportParameterName\": \"Computer\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"displayName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"scopedToUpdatesSolution\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"CriticalUpdates\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"max\": 1,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SecurityUpdates\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"max\": 5,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OtherUpdates\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"max\": 5,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"compliance\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 1,                 \"max\": 2,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"osType\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Environment\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"lastAssessedTime\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"lastUpdateAgentSeenTime\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ]         }       },       \"name\": \"query - 2\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Updates Needed by {Computer}\"       },       \"name\": \"text - 10\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"parameters\": [],         \"style\": \"pills\",         \"queryType\": 0,         \"resourceType\": \"microsoft.insights/components\"       },       \"name\": \"parameters - 3\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Update\\r\\n| where TimeGenerated\u003eago(14h) and OSType!=\\\"Linux\\\" and (Optional==false or Classification has \\\"Critical\\\" or Classification has \\\"Security\\\") and SourceComputerId in ((Heartbeat\\r\\n| where TimeGenerated\u003eago(12h) and OSType=~\\\"Windows\\\" and notempty(Computer)\\r\\n| summarize arg_max(TimeGenerated, Solutions) by SourceComputerId\\r\\n| where Solutions has \\\"updates\\\" | distinct SourceComputerId))\\r\\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, *) by Computer, SourceComputerId, UpdateID\\r\\n| where UpdateState=~\\\"Needed\\\" and Approved!=false and Computer=='{Computer}'\\r\\n| project Computer, Title, Classification, PublishedDate, UpdateState, Product\\r\\n| union( Update\\r\\n| where TimeGenerated\u003eago(5h) and OSType==\\\"Linux\\\" and Computer == \\\"{Computer}\\\"\\r\\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, UpdateState, Classification, BulletinUrl, BulletinID) by Computer, SourceComputerId, Product, ProductArch\\r\\n| where UpdateState=~\\\"Needed\\\"\\r\\n| project-away UpdateState, TimeGenerated\\r\\n| summarize computersCount=dcount(SourceComputerId, 2), ClassificationWeight=max(iff(Classification has \\\"Critical\\\", 4, iff(Classification has \\\"Security\\\", 2, 1))) by Computer, id=strcat(Product, \\\"_\\\", ProductArch), displayName=Product, productArch=ProductArch, classification=Classification, InformationId=BulletinID, InformationUrl=tostring(split(BulletinUrl, \\\";\\\", 0)[0]), osType=1\\r\\n| sort by ClassificationWeight desc, computersCount desc, displayName asc\\r\\n| extend informationLink=(iff(isnotempty(InformationId) and isnotempty(InformationUrl), toobject(strcat('{ \\\"uri\\\": \\\"', InformationUrl, '\\\", \\\"text\\\": \\\"', InformationId, '\\\", \\\"target\\\": \\\"blank\\\" }')), toobject('')))\\r\\n| project-away ClassificationWeight, InformationId, InformationUrl)\\r\\n\",         \"size\": 0,         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Computer\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Title\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Classification\",               \"formatter\": 18,               \"formatOptions\": {                 \"palette\": \"greenRed\",                 \"showIcon\": true,                 \"thresholdsOptions\": \"colors\",                 \"thresholdsGrid\": [                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Critical Updates\",                     \"representation\": \"redDark\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Security Updates\",                     \"representation\": \"redBright\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Definition Updates\",                     \"representation\": \"yellow\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Update Rollups\",                     \"representation\": \"purple\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Updates\",                     \"representation\": \"orange\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"Default\",                     \"thresholdValue\": null,                     \"representation\": \"blue\",                     \"text\": \"{0}{1}\"                   }                 ]               }             },             {               \"columnMatch\": \"PublishedDate\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"UpdateState\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Product\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"id\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"displayName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"productArch\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"classification\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"osType\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"computersCount\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"informationLink\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ]         },         \"sortBy\": []       },       \"name\": \"query - 4\"     }   ],   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('OneIdentity_id')]",
                          "properties":  {
                                             "displayName":  "Security - One Identity Analytics",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"## One Identity Safeguard for Privileged Sessions\\n---\\n\\nThis simple workbook gives an overview of sessions going through your Safeguard for Privileged Sessions device.\\n\\n### Number of sessions generating events per hour\"       },       \"name\": \"text - 2\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"CommonSecurityLog\\n| where DeviceVendor == \\\"OneIdentity\\\" and DeviceProduct == \\\"SPS\\\"\\n| where DeviceCustomString1Label == \\\"Session ID\\\"\\n| summarize count(TimeGenerated) by DeviceCustomString1, bin(TimeGenerated, 1d)\\n| summarize count() by bin(TimeGenerated, 1d)\\n\",         \"size\": 1,         \"exportToExcelOptions\": \"visible\",         \"timeContext\": {           \"durationMs\": 604800000         },         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"barchart\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Count\",               \"formatter\": 1,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"sortBy\": [             {               \"itemKey\": \"Count\",               \"sortOrder\": 1             }           ],           \"labelSettings\": [             {               \"columnId\": \"Count\",               \"label\": \"Session Count of the last 24 hours\"             }           ]         },         \"tileSettings\": {           \"titleContent\": {             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"subtitleContent\": {             \"columnMatch\": \"Count\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"showBorder\": false         }       },       \"name\": \"query - 2\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"### Number of sessions per severity per hour\\n\"       },       \"name\": \"text - 4\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"CommonSecurityLog\\n| where DeviceVendor == \\\"OneIdentity\\\" and DeviceProduct == \\\"SPS\\\"\\n| where Activity == \\\"ServerConnect\\\" or Activity == \\\"SessionClosed\\\"\\n| where DeviceCustomString1Label == \\\"Session ID\\\"\\n| where TimeGenerated \u003e ago(7d)\\n| summarize max(LogSeverity) by DeviceCustomString1, bin(TimeGenerated, 1h)\\n| summarize count() by max_LogSeverity, bin(TimeGenerated, 1h)\\n\\n\\n\\n\",         \"size\": 0,         \"aggregation\": 3,         \"exportToExcelOptions\": \"visible\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"barchart\"       },       \"name\": \"query - 3\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"### Latest logs\"       },       \"name\": \"text - 5\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"CommonSecurityLog\\n| where TimeGenerated \u003e ago(1d)\\n| where DeviceVendor == \\\"OneIdentity\\\" and DeviceProduct == \\\"SPS\\\"\\n| sort by TimeGenerated desc\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"TimeGenerated\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ReceiptTime\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceVendor\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceProduct\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceEventClassID\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"LogSeverity\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OriginalLogSeverity\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceAction\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SimplifiedDeviceAction\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Computer\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"CommunicationDirection\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceFacility\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DestinationPort\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DestinationIP\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceAddress\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Message\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Protocol\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourcePort\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourceIP\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"RemoteIP\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"RemotePort\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"MaliciousIP\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ThreatSeverity\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"IndicatorThreatType\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ThreatDescription\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ThreatConfidence\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ReportReferenceLink\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"MaliciousIPLongitude\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"MaliciousIPLatitude\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"MaliciousIPCountry\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceVersion\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Activity\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ApplicationProtocol\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"EventCount\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DestinationDnsDomain\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DestinationServiceName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DestinationTranslatedAddress\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DestinationTranslatedPort\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceDnsDomain\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceExternalID\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceInboundInterface\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceNtDomain\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceOutboundInterface\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DevicePayloadId\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ProcessName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceTranslatedAddress\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DestinationHostName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DestinationMACAddress\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DestinationNTDomain\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DestinationProcessId\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DestinationUserPrivileges\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DestinationProcessName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceTimeZone\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DestinationUserID\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DestinationUserName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceMacAddress\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ProcessID\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ExternalID\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"FileCreateTime\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"FileHash\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"FileID\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"FileModificationTime\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"FilePath\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"FilePermission\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"FileType\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"FileName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"FileSize\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ReceivedBytes\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OldFileCreateTime\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OldFileHash\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OldFileID\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OldFileModificationTime\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OldFileName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OldFilePath\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OldFilePermission\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OldFileSize\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OldFileType\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SentBytes\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"RequestURL\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"RequestClientApplication\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"RequestContext\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"RequestCookies\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"RequestMethod\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourceHostName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourceMACAddress\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourceNTDomain\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourceDnsDomain\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourceServiceName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourceTranslatedAddress\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourceTranslatedPort\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourceProcessId\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourceUserPrivileges\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourceProcessName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourceUserID\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourceUserName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"EventType\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"DeviceCustomIPv6Address1\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ]         }       },       \"name\": \"query - 5\"     }   ],   \"styleSettings\": {},   \"fromTemplateId\": \"sentinel-OneIdentity\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('SecurityStatus_id')]",
                          "properties":  {
                                             "displayName":  "Security - Security Status",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"crossComponentResources\": [           \"value::selected\"         ],         \"parameters\": [           {             \"id\": \"688dc7cb-bea3-41ae-ae94-32d22e09568c\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"DefaultWorkspace\",             \"type\": 5,             \"isRequired\": true,             \"value\": \"value::1\",             \"isHiddenWhenLocked\": true,             \"typeSettings\": {               \"resourceTypeFilter\": {                 \"microsoft.operationalinsights/workspaces\": true               },               \"additionalResourceOptions\": [                 \"value::1\"               ]             }           },           {             \"id\": \"c11b5651-cf86-4865-b23d-9ecc4f16b712\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"ContextFree\",             \"type\": 1,             \"query\": \"{\\\"version\\\":\\\"1.0.0\\\",\\\"content\\\":\\\"\\\\\\\"{DefaultWorkspace}\\\\\\\"\\\"}\",             \"isHiddenWhenLocked\": true,             \"queryType\": 8           },           {             \"id\": \"bbbc300a-6f91-4b2b-b4b5-842b4bf8577a\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Selection\",             \"type\": 1,             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend match = strcat(\\\"'\\\", id, \\\"'\\\") =~ \\\"{DefaultWorkspace:value}\\\"\\r\\n| order by match desc, name asc\\r\\n| take 1\\r\\n| project value = tostring(pack('sub', subscriptionId, 'rg', resourceGroup, 'ws', id))\",             \"crossComponentResources\": [               \"value::selected\"             ],             \"isHiddenWhenLocked\": true,             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           }         ],         \"style\": \"above\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\"       },       \"conditionalVisibility\": {         \"parameterName\": \"_\",         \"comparison\": \"isEqualTo\",         \"value\": \"_\"       },       \"name\": \"parameters - 0\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"# Computer Security Status\\r\\n\u003cbr\u003e\\r\\n### This report shows various security status messages from Azure Resource Graph and Log Analytics\"       },       \"conditionalVisibility\": {         \"parameterName\": \"ContextFree\",         \"comparison\": \"isEqualTo\",         \"value\": \"value::1\"       },       \"name\": \"text - 1\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"parameters\": [           {             \"id\": \"1db5ee15-fe52-458b-91d1-7ee39d8c2cd3\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Subscriptions\",             \"type\": 6,             \"isRequired\": true,             \"query\": \"summarize by subscriptionId\\r\\n| project value = strcat('/subscriptions/', subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ todynamic('{Selection}').sub, true, false)\",             \"crossComponentResources\": [               \"value::selected\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": []             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"9732eff8-fb57-4cbd-8ade-5ae746f33760\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Workspaces\",             \"type\": 5,             \"isRequired\": true,             \"query\": \"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| summarize by id, name\\r\\n| project id, selected = iff(id =~ todynamic('{Selection}').ws, true, false)\",             \"crossComponentResources\": [               \"{Subscriptions}\"             ],             \"value\": \"/subscriptions/\u003csubs_ID\u003e/resourcegroups/\u003crg_name\u003e/providers/microsoft.operationalinsights/workspaces/\u003cworkspace_name\u003e\",             \"typeSettings\": {               \"resourceTypeFilter\": {                 \"microsoft.operationalinsights/workspaces\": true               },               \"additionalResourceOptions\": []             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"5f8cce4b-9c4c-47da-8683-7e5ccc9faed3\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000,                   \"createdTime\": \"2018-10-04T22:01:18.372Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 900000,                   \"createdTime\": \"2018-10-04T22:01:18.372Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 1800000,                   \"createdTime\": \"2018-10-04T22:01:18.372Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 3600000,                   \"createdTime\": \"2018-10-04T22:01:18.372Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 14400000,                   \"createdTime\": \"2018-10-04T22:01:18.374Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 43200000,                   \"createdTime\": \"2018-10-04T22:01:18.374Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 86400000,                   \"createdTime\": \"2018-10-04T22:01:18.374Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 172800000,                   \"createdTime\": \"2018-10-04T22:01:18.374Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 259200000,                   \"createdTime\": \"2018-10-04T22:01:18.375Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 604800000,                   \"createdTime\": \"2018-10-04T22:01:18.375Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 1209600000,                   \"createdTime\": \"2018-10-04T22:01:18.375Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 2592000000,                   \"createdTime\": \"2018-10-04T22:01:18.375Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 5184000000,                   \"createdTime\": \"2018-10-04T22:01:18.375Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 },                 {                   \"durationMs\": 7776000000,                   \"createdTime\": \"2018-10-04T22:01:18.375Z\",                   \"isInitialTime\": false,                   \"grain\": 1,                   \"useDashboardTimeRange\": false                 }               ],               \"allowCustom\": true             },             \"value\": {               \"durationMs\": 604800000             }           },           {             \"id\": \"d6de19ff-cde4-41c2-9fba-b441312ea5c9\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Test\",             \"type\": 1,             \"query\": \"Perf\\r\\n| where TimeGenerated {TimeRange}\\r\\n| take 1\",             \"crossComponentResources\": [               \"{Workspaces}\"             ],             \"isHiddenWhenLocked\": true,             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\"           },           {             \"id\": \"4e5f340e-9ca8-4f16-aa10-48d30b486cce\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Computer\",             \"type\": 5,             \"query\": \"resources\\r\\n| where type == \\\"microsoft.compute/virtualmachines\\\" or type == \\\"microsoft.hybridcompute/machines\\\"\\r\\n| project name\",             \"crossComponentResources\": [               \"{Workspaces}\"             ],             \"value\": \"default\",             \"typeSettings\": {               \"additionalResourceOptions\": []             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           }         ],         \"style\": \"above\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\"       },       \"name\": \"parameters - 2\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"??A subscription has not yet been selected. Select a subscription under the `Subscriptions` dropdown or refresh the workbook.\"       },       \"conditionalVisibility\": {         \"parameterName\": \"Subscriptions\",         \"comparison\": \"isEqualTo\",         \"value\": null       },       \"name\": \"text - 29\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"---\"       },       \"name\": \"text - 4\"     },     {       \"type\": 11,       \"content\": {         \"version\": \"LinkItem/1.0\",         \"style\": \"tabs\",         \"links\": [           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Status\",             \"subTarget\": \"Status\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Events\",             \"subTarget\": \"Events\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Azure Arc\",             \"subTarget\": \"Arc\",             \"style\": \"link\"           }         ]       },       \"name\": \"links - 20\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"securityresources\\r\\n| where type == \\\"microsoft.security/securitystatuses\\\" or type == \\\"microsoft.security/securitystatuses/servers\\\" or type == \\\"microsoft.security/assessments\\\" \\r\\n//| where name startswith '{Computer}'\\r\\n| extend compute = tostring(properties.type)\\r\\n| where compute =~\\\"virtualmachine\\\"\\r\\n| summarize count() by name\",         \"size\": 4,         \"title\": \"Count of Computers with Securtity status info\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"piechart\",         \"chartSettings\": {           \"showMetrics\": false         }       },       \"customWidth\": \"50\",       \"name\": \"query - 20 - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"union Syslog,SecurityEvent,CommonSecurityLog \\r\\n| summarize count() by Type\",         \"size\": 4,         \"title\": \"Count of log entries by Type\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"piechart\"       },       \"customWidth\": \"50\",       \"name\": \"query - 20\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"securityresources\\r\\n| where type == \\\"microsoft.security/securitystatuses\\\" or type == \\\"microsoft.security/securitystatuses/servers\\\" or type == \\\"microsoft.security/assessments\\\" \\r\\n| where name startswith '{Computer}'\\r\\n| extend p=array_length(properties.resourceDetails) \\r\\n| extend compute = tostring(properties.type)\\r\\n| where compute =~\\\"virtualmachine\\\"\\r\\n| mvexpand prop=properties.resourceDetails\\r\\n| project ComputerName = name, Resource= prop.name, Status = prop.value \",         \"size\": 0,         \"title\": \"Security Status for {Computer}\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"ComputerName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Resource\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Status\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ]         }       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Status\"       },       \"name\": \"query - 7\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"securityresources\\r\\n| where type == \\\"microsoft.security/assessments\\\"\\r\\n| where properties contains '{Computer}'\\r\\n| project Resource = properties.displayName, Status = trim(@\\\"[^\\\\w]+\\\",tostring(split(properties.status,\\\":\\\",1))), Location =  trim(@\\\"[^\\\\w]+\\\",tostring(split(properties.resourceDetails,\\\":\\\",1)))\\r\\n| extend Status  = iif(Status has \\\",\\\",trim(@\\\"[^\\\\w]+\\\",tostring(split(Status,\\\",\\\",0))),Status)\\r\\n| extend Location = iif(Location has \\\"\\\\\\\\\\\",trim(@\\\"[^\\\\w]+\\\",tostring(split(Location,\\\"\\\\\\\\\\\",0))),Location)\\r\\n| summarize count() by Status, tostring(Resource), Location\",         \"size\": 1,         \"title\": \"Security Asessment findings for {Computer}\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"piechart\",         \"gridSettings\": {           \"filter\": true         }       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Status\"       },       \"name\": \"query - 18\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"securityresources\\r\\n| where type == \\\"microsoft.security/assessments\\\"\\r\\n| where properties contains '{Computer}'\\r\\n| project Resource = properties.displayName, Status = trim(@\\\"[^\\\\w]+\\\",tostring(split(properties.status,\\\":\\\",1))), Location =  trim(@\\\"[^\\\\w]+\\\",tostring(split(properties.resourceDetails,\\\":\\\",1)))\\r\\n| extend Status   = iif(Status has \\\",\\\",trim(@\\\"[^\\\\w]+\\\",tostring(split(Status,\\\",\\\",0))),Status)\\r\\n| extend Location = iif(Location has \\\"\\\\\\\\\\\",trim(@\\\"[^\\\\w]+\\\",tostring(split(Location,\\\"\\\\\\\\\\\",0))),Location)\\r\\n| summarize count() by Status, tostring(Resource), Location\\r\\n| order by count_ desc\",         \"size\": 0,         \"title\": \"Security Asessment findings for {Computer}\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"gridSettings\": {           \"filter\": true,           \"sortBy\": [             {               \"itemKey\": \"Status\",               \"sortOrder\": 2             }           ]         },         \"sortBy\": [           {             \"itemKey\": \"Status\",             \"sortOrder\": 2           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Status\"       },       \"name\": \"query - 18 - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"SecurityEvent\\r\\n| where Computer startswith \\\"{Computer}\\\"\\r\\n| summarize count() by Activity\\r\\n\",         \"size\": 1,         \"title\": \"Securtity Events for: {Computer} \",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"piechart\",         \"tileSettings\": {           \"showBorder\": false,           \"titleContent\": {             \"columnMatch\": \"Activity\",             \"formatter\": 1           },           \"leftContent\": {             \"columnMatch\": \"count_\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\"             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         },         \"graphSettings\": {           \"type\": 0,           \"topContent\": {             \"columnMatch\": \"Activity\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"centerContent\": {             \"columnMatch\": \"count_\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           },           \"nodeIdField\": \"Activity\",           \"nodeSize\": null,           \"staticNodeSize\": 100,           \"colorSettings\": null,           \"hivesMargin\": 5         }       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Events\"       },       \"name\": \"query - 8\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where Computer startswith \\\"{Computer}\\\"\\r\\n| summarize count() by Facility, SeverityLevel\\r\\n\",         \"size\": 1,         \"title\": \"Syslog for: {Computer}\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"piechart\"       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Events\"       },       \"name\": \"query - 10\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"CommonSecurityLog\\r\\n| where Computer startswith \\\"{Computer}\\\"\\r\\n| summarize count() by DeviceVendor, DeviceEventClassID, Message\\r\\n\",         \"size\": 1,         \"title\": \"CommonSecurityEvent (CEF) for: {Computer}\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"piechart\"       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Events\"       },       \"name\": \"query - 11\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"union isfuzzy=true     (W3CIISLog\\r\\n| extend TrafficDirection = \\\"InboundOrUnknown\\\", Country=RemoteIPCountry, Latitude=RemoteIPLatitude, Longitude=RemoteIPLongitude),     (DnsEvents\\r\\n| extend TrafficDirection = \\\"InboundOrUnknown\\\", Country= RemoteIPCountry, Latitude = RemoteIPLatitude, Longitude = RemoteIPLongitude),     (WireData\\r\\n| extend TrafficDirection = iff(Direction != \\\"Outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=RemoteIPCountry, Latitude=RemoteIPLatitude, Longitude=RemoteIPLongitude),     (WindowsFirewall\\r\\n| extend TrafficDirection = iff(CommunicationDirection != \\\"SEND\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=MaliciousIPCountry, Latitude=MaliciousIPLatitude, Longitude=MaliciousIPLongitude),     (CommonSecurityLog\\r\\n| extend TrafficDirection = iff(CommunicationDirection != \\\"Outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=MaliciousIPCountry, Latitude=MaliciousIPLatitude, Longitude=MaliciousIPLongitude, Confidence=ThreatDescription, Description=ThreatDescription),     (VMConnection\\r\\n| where Type == \\\"VMConnection\\\"\\r\\n| extend TrafficDirection = iff(Direction != \\\"outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=RemoteCountry, Latitude=RemoteLatitude, Longitude=RemoteLongitude)\\r\\n| where isnotempty(MaliciousIP) and isnotempty(Country) and isnotempty(Latitude) and isnotempty(Longitude)\\r\\n| where Computer startswith \\\"{Computer}\\\"\\r\\n| summarize MaliciousIPcount = count(MaliciousIP) by Country//, Latitude, Longitude\\r\\n| order by MaliciousIPcount desc\\r\\n| top 10 by Country\\r\\n\",         \"size\": 0,         \"title\": \"Potential Locations for: {Computer}\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"map\",         \"gridSettings\": {           \"sortBy\": [             {               \"itemKey\": \"MaliciousIPcount\",               \"sortOrder\": 2             }           ]         },         \"sortBy\": [           {             \"itemKey\": \"MaliciousIPcount\",             \"sortOrder\": 2           }         ],         \"mapSettings\": {           \"locInfo\": \"CountryRegion\",           \"locInfoColumn\": \"Country\",           \"latitude\": \"Latitude\",           \"longitude\": \"Longitude\",           \"sizeSettings\": \"MaliciousIPcount\",           \"sizeAggregation\": \"Sum\",           \"defaultSize\": 0,           \"labelSettings\": \"MaliciousIP\",           \"legendAggregation\": \"Sum\",           \"itemColorSettings\": {             \"nodeColorField\": \"MaliciousIPcount\",             \"colorAggregation\": \"Sum\",             \"type\": \"heatmap\",             \"heatmapPalette\": \"greenRed\"           }         }       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Events\"       },       \"name\": \"query - 14\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"union isfuzzy=true     (W3CIISLog\\r\\n| extend TrafficDirection = \\\"InboundOrUnknown\\\", Country=RemoteIPCountry, Latitude=RemoteIPLatitude, Longitude=RemoteIPLongitude),     (DnsEvents\\r\\n| extend TrafficDirection = \\\"InboundOrUnknown\\\", Country= RemoteIPCountry, Latitude = RemoteIPLatitude, Longitude = RemoteIPLongitude),     (WireData\\r\\n| extend TrafficDirection = iff(Direction != \\\"Outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=RemoteIPCountry, Latitude=RemoteIPLatitude, Longitude=RemoteIPLongitude),     (WindowsFirewall\\r\\n| extend TrafficDirection = iff(CommunicationDirection != \\\"SEND\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=MaliciousIPCountry, Latitude=MaliciousIPLatitude, Longitude=MaliciousIPLongitude),     (CommonSecurityLog\\r\\n| extend TrafficDirection = iff(CommunicationDirection != \\\"Outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=MaliciousIPCountry, Latitude=MaliciousIPLatitude, Longitude=MaliciousIPLongitude, Confidence=ThreatDescription, Description=ThreatDescription),     (VMConnection\\r\\n| where Type == \\\"VMConnection\\\"\\r\\n| extend TrafficDirection = iff(Direction != \\\"outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=RemoteCountry, Latitude=RemoteLatitude, Longitude=RemoteLongitude)\\r\\n| where isnotempty(MaliciousIP) and isnotempty(Country) and isnotempty(Latitude) and isnotempty(Longitude)\\r\\n| where Computer startswith \\\"{Computer}\\\"\\r\\n| summarize MaliciousIPcount = dcount(MaliciousIP), TableSource = make_set(Type) by Country, TrafficDirection\\r\\n| top 10 by MaliciousIPcount\\r\\n| order by MaliciousIPcount desc\\r\\n\\r\\n\",         \"size\": 0,         \"title\": \"Top10: Potential Locations for: {Computer}\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"table\",         \"gridSettings\": {           \"sortBy\": [             {               \"itemKey\": \"MaliciousIPcount\",               \"sortOrder\": 2             }           ]         },         \"sortBy\": [           {             \"itemKey\": \"MaliciousIPcount\",             \"sortOrder\": 2           }         ],         \"mapSettings\": {           \"locInfo\": \"CountryRegion\",           \"locInfoColumn\": \"Code\",           \"latitude\": \"Latitude\",           \"longitude\": \"Longitude\",           \"sizeSettings\": \"count_\",           \"sizeAggregation\": \"Sum\",           \"defaultSize\": 0,           \"labelSettings\": \"MaliciousIP\",           \"legendAggregation\": \"Sum\",           \"itemColorSettings\": {             \"nodeColorField\": \"MaliciousIPcount\",             \"colorAggregation\": \"Sum\",             \"type\": \"heatmap\",             \"heatmapPalette\": \"greenRed\"           }         }       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Events\"       },       \"name\": \"query - 14 - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \" resources\\r\\n| where type == \\\"microsoft.hybridcompute/machines\\\"\\r\\n//| extend p=array_length(properties.provisioningState) \\r\\n| mvexpand prop=properties.provisioningState\\r\\n| project ComputerName = id,  Status = properties.status, State=prop, location, resourceGroup, type\",         \"size\": 1,         \"title\": \"All Azure Arc resources\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\",         \"crossComponentResources\": [           \"{Subscriptions}\"         ],         \"sortBy\": []       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Arc\"       },       \"name\": \"query - 18\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"securityresources\\r\\n| where type == \\\"microsoft.security/assessments\\\"\\r\\n| where properties has '{Computer}'\\r\\n| project Resource = properties.displayName, Status = trim(@\\\"[^\\\\w]+\\\",tostring(split(properties.status,\\\":\\\",1))), Location =  trim(@\\\"[^\\\\w]+\\\",tostring(split(properties.resourceDetails,\\\":\\\",1)))\\r\\n| extend Status   = iif(Status has \\\",\\\",trim(@\\\"[^\\\\w]+\\\",tostring(split(Status,\\\",\\\",0))),Status)\\r\\n| extend Location = iif(Location has \\\"\\\\\\\\\\\",trim(@\\\"[^\\\\w]+\\\",tostring(split(Location,\\\"\\\\\\\\\\\",0))),Location)\\r\\n| where Location == \\\"OnPremise\\\"\\r\\n| summarize count() by Status, tostring(Resource), Location=\\\"Azure Arc\\\"\\r\\n| order by count_ desc\",         \"size\": 1,         \"title\": \"Azure Arc Security Status for: {Computer}\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\",         \"crossComponentResources\": [           \"{Subscriptions}\"         ],         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Status\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Resource\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Location\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"id\",               \"formatter\": 7,               \"formatOptions\": {                 \"linkTarget\": \"Resource\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"count_\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ]         },         \"sortBy\": []       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Arc\"       },       \"name\": \"query - 18 - Copy\"     }   ],   \"fromTemplateId\": \"sentinel-SecurityStatus\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('UserMap_id')]",
                          "properties":  {
                                             "displayName":  "Security - User Maps",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"crossComponentResources\": [           \"{Subscription}\"         ],         \"parameters\": [           {             \"id\": \"1ca69445-60fc-4806-b43d-ac7e6aad630a\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Subscription\",             \"type\": 6,             \"isRequired\": true,             \"value\": null,             \"typeSettings\": {               \"additionalResourceOptions\": [],               \"includeAll\": false             }           },           {             \"id\": \"e94aafa3-c5d9-4523-89f0-4e87aa754511\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Workspace\",             \"type\": 5,             \"isRequired\": true,             \"query\": \"Resources \\n| where type =~ \\\"microsoft.operationalinsights/workspaces\\\" \\n| order by name \\n| project id, name, selected=row_number()==1, group=resourceGroup\",             \"crossComponentResources\": [               \"{Subscription}\"             ],             \"typeSettings\": {               \"resourceTypeFilter\": {                 \"microsoft.operationalinsights/workspaces\": true               },               \"additionalResourceOptions\": []             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"c4b69c01-2263-4ada-8d9c-43433b739ff3\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 5184000000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ],               \"allowCustom\": true             }           },           {             \"id\": \"6ed3bbc6-be3f-44ed-84b3-9908e7c92315\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Help\",             \"type\": 10,             \"isRequired\": true,             \"typeSettings\": {               \"additionalResourceOptions\": []             },             \"jsonData\": \"[\\r\\n { \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true },\\r\\n { \\\"value\\\": \\\"Change Log\\\", \\\"label\\\": \\\"Change Log\\\"}\\r\\n]\"           }         ],         \"style\": \"above\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\"       },       \"customWidth\": \"70\",       \"name\": \"parameters - 1\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"parameters\": [           {             \"id\": \"e648443b-bf59-4ae6-8c04-a5edf7097da6\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Measurement\",             \"type\": 10,             \"isRequired\": true,             \"typeSettings\": {               \"additionalResourceOptions\": []             },             \"jsonData\": \"[\\r\\n{\\\"value\\\": \\\"KM\\\", \\\"label\\\": \\\"KM\\\"},\\r\\n{\\\"value\\\": \\\"Miles\\\", \\\"label\\\": \\\"Miles\\\", \\\"selected\\\":true}\\r\\n]\"           },           {             \"id\": \"ba4eb749-336e-4aa0-8a4b-2b7987507852\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Top\",             \"label\": \"Show Top locations\",             \"type\": 2,             \"description\": \"Only show this amount of locations om the map\",             \"isRequired\": true,             \"typeSettings\": {               \"additionalResourceOptions\": [],               \"showDefault\": false             },             \"jsonData\": \"[\\r\\n{ \\\"value\\\": \\\"5\\\", \\\"label\\\": \\\"5\\\"},\\r\\n{\\\"value\\\": \\\"10\\\", \\\"label\\\": \\\"10\\\", \\\"selected\\\":true },\\r\\n{\\\"value\\\": \\\"20\\\", \\\"label\\\": \\\"20\\\" },\\r\\n{\\\"value\\\": \\\"30\\\", \\\"label\\\": \\\"30\\\" },\\r\\n{\\\"value\\\": \\\"50\\\", \\\"label\\\": \\\"50\\\" }\\r\\n]\"           }         ],         \"style\": \"above\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"customWidth\": \"30\",       \"name\": \"parameters - settings\"     },     {       \"type\": 11,       \"content\": {         \"version\": \"LinkItem/1.0\",         \"style\": \"tabs\",         \"links\": [           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Malicious IP\",             \"subTarget\": \"MaliciousIP\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"User Data\",             \"subTarget\": \"UserData\",             \"style\": \"link\"           }         ]       },       \"name\": \"links - 5\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"#### Tab One. Malicious IP  \\r\\nThis report can get data from a number of sources (six are defined in this release) to show the distance from the Malicious IP addresses to a selected users default location.  \\r\\nYou may see an error if one or more data sources are missing.  There will be no entries if *all* sources are missing - there is a warning dialog box displayed if this happens.\\r\\nThis is a similar view to the one shown on the Summary page of Azure Sentinel, but this is showing distance data as well.\\r\\nThere are three options to aid filtering:\\r\\n1. Select a Location from a list (for that you will have to edit this workbook and amend the \\\"CityList\\\" parameter if you require changes to the capital cities I have provided).  Please save the JSON of any co-ordinates you add, as you will need to add them back if you ever update the workbook to a newer version.  This is useful if you have some office locations or important places  that you wish to add.\\r\\n2. Select from Azure Active Directory (AAD), if the SigninLogs table exists, this will populate from the latest record, a entry per City /( Country ) with Longitude and Latitude data.\\r\\n3. Enter a Latitude and Longitude of your choice, and a label to describe the location. \\r\\nYou may also select to show the data in Kilometers (KM) or Miles.  You can also set how many locations to show, 5, 10, 20 etc...\\r\\n\\r\\nDatasources: WireData, VMconnection, CommonSecurityLog, WindowsFirewall, W3CIISLog and DnsEvents \\r\\n\\t\\t\\t Note: SigninLogs is required to build the AAD list, if you dont have this critical datasource, please use options #1 or #3.\\r\\n\\r\\n#### Tab two. Locations and distances \\r\\nInformation using Azure Active Directory (AAD) Signinlogs data, this shows user Signin Locations and distane between as well as order visited (you select a User from a dropdown, ordered by their signin count).  \\r\\n\\r\\nDatasources:SigninLogs\\r\\n\",         \"style\": \"info\"       },       \"conditionalVisibility\": {         \"parameterName\": \"Help\",         \"comparison\": \"isEqualTo\",         \"value\": \"Yes\"       },       \"name\": \"text - 8\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"### Change Log\\r\\n\\tv1.0\\tInitial Version\\r\\n\\tV1.1.0\\tUpdated from 2019 version, combining new features and improving the look and feel.  \\r\\n\\r\\n\",         \"style\": \"info\"       },       \"conditionalVisibility\": {         \"parameterName\": \"Help\",         \"comparison\": \"isEqualTo\",         \"value\": \"Change Log\"       },       \"name\": \"text - 7\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: Malicious IP\",         \"items\": [           {             \"type\": 9,             \"content\": {               \"version\": \"KqlParameterItem/1.0\",               \"parameters\": [                 {                   \"id\": \"b12b1e24-c504-4ccb-9f00-3dc445232897\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"getLocation\",                   \"label\": \"Location selector\",                   \"type\": 10,                   \"isRequired\": true,                   \"typeSettings\": {                     \"additionalResourceOptions\": []                   },                   \"jsonData\": \"[\\r\\n { \\\"value\\\": \\\"mylist\\\", \\\"label\\\": \\\"From a list\\\",\\\"selected\\\":true},\\r\\n {\\\"value\\\": \\\"aad\\\", \\\"label\\\": \\\"From AAD\\\"},\\r\\n { \\\"value\\\": \\\"manual\\\", \\\"label\\\": \\\"Add a manual entry\\\"}\\r\\n]\",                   \"timeContext\": {                     \"durationMs\": 86400000                   }                 }               ],               \"style\": \"above\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\"             },             \"customWidth\": \"30\",             \"name\": \"parameters - 7\"           },           {             \"type\": 9,             \"content\": {               \"version\": \"KqlParameterItem/1.0\",               \"parameters\": [                 {                   \"id\": \"d14c2e32-c58e-4409-b2ea-14394a69e70e\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"CityList\",                   \"label\": \"Location - custom list\",                   \"type\": 2,                   \"description\": \"Edit this parameter to provide your own locations - please see Help\",                   \"isRequired\": true,                   \"value\": \"48.856613,2.352222\",                   \"typeSettings\": {                     \"additionalResourceOptions\": [],                     \"showDefault\": false                   },                   \"jsonData\": \"[\\r\\n{ \\\"value\\\": \\\"51.507351,-0.127758\\\" ,\\\"label\\\": \\\"London\\\"},\\r\\n{ \\\"value\\\": \\\"48.856613,2.352222\\\"  ,\\\"label\\\": \\\"Paris\\\"},\\r\\n{ \\\"value\\\": \\\"40.712776,-74.005974\\\",\\\"label\\\": \\\"New York\\\"},\\r\\n{ \\\"value\\\": \\\"47.608013,-122.335167\\\",\\\"label\\\": \\\"Seattle\\\"},\\r\\n{ \\\"value\\\": \\\"41.881832,-87.623177\\\",\\\"label\\\": \\\"Chicago\\\"},\\r\\n{ \\\"value\\\": \\\"-33.865143,151.209900\\\",\\\"label\\\": \\\"Sydney\\\"}\\r\\n]\"                 },                 {                   \"id\": \"a1c6c49d-c452-4010-851a-55f5f950df23\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"defaultCityList\",                   \"type\": 1,                   \"value\": \"Paris\",                   \"isHiddenWhenLocked\": true,                   \"criteriaData\": [                     {                       \"criteriaContext\": {                         \"leftOperand\": \"CityList\",                         \"operator\": \"isNotNull\",                         \"rightValType\": \"param\",                         \"resultValType\": \"static\",                         \"resultVal\": \"{CityList:label}\"                       }                     },                     {                       \"criteriaContext\": {                         \"operator\": \"Default\",                         \"rightValType\": \"param\",                         \"resultValType\": \"param\",                         \"resultVal\": \"CityList\"                       }                     }                   ]                 }               ],               \"style\": \"above\",               \"doNotRunWhenHidden\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\"             },             \"conditionalVisibility\": {               \"parameterName\": \"getLocation\",               \"comparison\": \"isEqualTo\",               \"value\": \"mylist\"             },             \"name\": \"parameters - mylist\"           },           {             \"type\": 9,             \"content\": {               \"version\": \"KqlParameterItem/1.0\",               \"parameters\": [                 {                   \"id\": \"d14c2e32-c58e-4409-b2ea-14394a69e70e\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"CityListAAD\",                   \"label\": \"Location - obtained from AAD \",                   \"type\": 2,                   \"description\": \"Locations found in AAD\",                   \"isRequired\": true,                   \"query\": \"SigninLogs\\r\\n| where UserDisplayName !=\\\"On-Premises Directory Synchronization Service Account\\\"\\r\\n| extend city_      = tostring(LocationDetails.city) \\r\\n| extend latitude_  = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).latitude) \\r\\n| extend longitude_ = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).longitude) \\r\\n| summarize count(), arg_max(TimeGenerated,*) by city_\\r\\n| where isnotempty(city_)\\r\\n| distinct city_ , count_, latitude_, longitude_, Location\\r\\n| extend city_ = strcat(city_,\\\" (\\\", Location ,\\\")\\\")\\r\\n| project label = strcat(city_,\\\",\\\",latitude_,\\\",\\\",longitude_), value = city_\\r\\n| order by label asc\\r\\n\",                   \"crossComponentResources\": [                     \"{Workspace}\"                   ],                   \"value\": null,                   \"typeSettings\": {                     \"additionalResourceOptions\": [],                     \"showDefault\": false                   },                   \"queryType\": 0,                   \"resourceType\": \"microsoft.operationalinsights/workspaces\"                 },                 {                   \"id\": \"56079538-c786-4a1f-8e20-c33232a46852\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"defaultCityListAAD\",                   \"type\": 1,                   \"isRequired\": true,                   \"value\": \"\\\"no AAD\\\"\",                   \"isHiddenWhenLocked\": true,                   \"criteriaData\": [                     {                       \"criteriaContext\": {                         \"leftOperand\": \"CityListAAD\",                         \"operator\": \"is Empty\",                         \"rightValType\": \"param\",                         \"resultValType\": \"static\",                         \"resultVal\": \"\\\"no AAD\\\"\"                       }                     },                     {                       \"criteriaContext\": {                         \"operator\": \"Default\",                         \"rightValType\": \"param\",                         \"resultValType\": \"param\",                         \"resultVal\": \"CityListAAD\"                       }                     }                   ]                 }               ],               \"style\": \"above\",               \"doNotRunWhenHidden\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\"             },             \"conditionalVisibility\": {               \"parameterName\": \"getLocation\",               \"comparison\": \"isEqualTo\",               \"value\": \"aad\"             },             \"name\": \"parameters - aad\"           },           {             \"type\": 1,             \"content\": {               \"json\": \"### Please select a Location, or confirm data source: SigninLogs exists\\r\\n\\tif there are no values you may not have the [SigninLogs] table in this workspace.\\r\\nPlease use a Location Selection of:\\r\\n\\r\\n\\tFrom a List\\r\\nor\\r\\n\\r\\n\\tAdd a manual entry\\r\\n\",               \"style\": \"warning\"             },             \"conditionalVisibilities\": [               {                 \"parameterName\": \"CityListAAD\",                 \"comparison\": \"isEqualTo\",                 \"value\": \"\"               },               {                 \"parameterName\": \"getLocation\",                 \"comparison\": \"isEqualTo\",                 \"value\": \"aad\"               }             ],             \"name\": \"text - 7\"           },           {             \"type\": 9,             \"content\": {               \"version\": \"KqlParameterItem/1.0\",               \"parameters\": [                 {                   \"id\": \"631833b1-6b7d-485c-ab7d-a101d8e1ef77\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"Latitude\",                   \"type\": 1,                   \"description\": \"Add a Latitude value\",                   \"value\": \"51.461377\",                   \"criteriaData\": [                     {                       \"criteriaContext\": {                         \"operator\": \"Default\",                         \"rightValType\": \"param\",                         \"resultValType\": \"static\",                         \"resultVal\": \"51.461377\"                       }                     }                   ]                 },                 {                   \"id\": \"e10c4b13-f3af-4faf-a5cd-605b7660c019\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"Longitude\",                   \"type\": 1,                   \"description\": \"Add a Longitude value\",                   \"value\": \"-0.925915\",                   \"criteriaData\": [                     {                       \"criteriaContext\": {                         \"operator\": \"Default\",                         \"rightValType\": \"param\",                         \"resultValType\": \"static\",                         \"resultVal\": \"-0.925915\"                       }                     }                   ]                 },                 {                   \"id\": \"e10c4b13-f3af-4faf-a5cd-605b7660c019\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"defaultLocationName\",                   \"type\": 1,                   \"description\": \"Add a name for your custom Latitude/Longitude\",                   \"value\": \"Microsoft Campus, Reading (UK)\",                   \"criteriaData\": [                     {                       \"criteriaContext\": {                         \"operator\": \"Default\",                         \"rightValType\": \"param\",                         \"resultValType\": \"static\",                         \"resultVal\": \"Microsoft Campus, Reading (UK)\"                       }                     }                   ]                 }               ],               \"style\": \"above\",               \"doNotRunWhenHidden\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\"             },             \"conditionalVisibility\": {               \"parameterName\": \"getLocation\",               \"comparison\": \"isEqualTo\",               \"value\": \"manual\"             },             \"name\": \"parameters -manual\"           },           {             \"type\": 9,             \"content\": {               \"version\": \"KqlParameterItem/1.0\",               \"crossComponentResources\": [                 \"{Subscription}\"               ],               \"parameters\": [                 {                   \"id\": \"b1bb0a06-ac1d-438a-931b-a255d0eb5611\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"locationName\",                   \"type\": 1,                   \"query\": \" // create a common location for chart titles\\r\\n extend locationName = case( \\r\\n                            '{getLocation}' == 'mylist', '{defaultCityList}',\\r\\n                            '{getLocation}' == 'aad' ,   '{defaultCityListAAD}',\\r\\n                            '{getLocation}' == 'manual', '{defaultLocationName}',\\r\\n                            //else\\r\\n                            \\\"fail\\\"\\r\\n                           )\\r\\n|project locationName | limit 1\",                   \"crossComponentResources\": [                     \"{Subscription}\"                   ],                   \"isHiddenWhenLocked\": true,                   \"timeContext\": {                     \"durationMs\": 86400000                   },                   \"queryType\": 1,                   \"resourceType\": \"microsoft.resourcegraph/resources\"                 }               ],               \"style\": \"above\",               \"queryType\": 1,               \"resourceType\": \"microsoft.resourcegraph/resources\"             },             \"name\": \"parameters - common Location Name\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"// Look back at data and see if any from six named tables have Malicious IP info \\r\\n// This query is based on the Sentinel home page \\\"Potential malicious events\\\" view \\r\\n// We'll also enrich the data with distance data (in KM or miles) of each entry to defined home location \\r\\n//\\r\\n// Please enter how many days worth of data to look at?\\r\\n// Microsoft Campus UK is used as a base parameter - adjust as required with your own Location Longitude / Latitude \\r\\n// isFuzzy will allow us to continue on errors or if a table is empty etc...\\r\\nunion isfuzzy=true \\r\\n(W3CIISLog\\r\\n| extend TrafficDirection = \\\"InboundOrUnknown\\\", Country=RemoteIPCountry, Latitude=RemoteIPLatitude, Longitude=RemoteIPLongitude), \\r\\n(DnsEvents\\r\\n| extend TrafficDirection = \\\"InboundOrUnknown\\\", Country= RemoteIPCountry, Latitude = RemoteIPLatitude, Longitude = RemoteIPLongitude),\\r\\n(WireData\\r\\n| extend TrafficDirection = iff(Direction != \\\"Outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=RemoteIPCountry, Latitude=RemoteIPLatitude, Longitude=RemoteIPLongitude), \\r\\n(WindowsFirewall\\r\\n| extend TrafficDirection = iff(CommunicationDirection != \\\"SEND\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=MaliciousIPCountry, Latitude=MaliciousIPLatitude, Longitude=MaliciousIPLongitude), \\r\\n(CommonSecurityLog\\r\\n| extend TrafficDirection = iff(CommunicationDirection != \\\"Outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=MaliciousIPCountry, Latitude=MaliciousIPLatitude, Longitude=MaliciousIPLongitude, Confidence=ThreatDescription, Description=ThreatDescription), \\r\\n(VMConnection\\r\\n| where Type == \\\"VMConnection\\\"\\r\\n| extend TrafficDirection = iff(Direction != \\\"outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=RemoteCountry, Latitude=RemoteLatitude, Longitude=RemoteLongitude)\\r\\n// Start of main logic\\r\\n// Supply a default location (long/lat) from selected parameter \\r\\n| extend myLatitude = case( \\r\\n                            '{getLocation}' == 'mylist', todouble(split('{CityList:value}',\\\",\\\").[0]),\\r\\n                            '{getLocation}' == 'aad' ,   todouble(split('{defaultCityListAAD:value}',\\\",\\\").[1]),\\r\\n                            '{getLocation}' == 'manual', todouble({Latitude}),\\r\\n                            //else\\r\\n                            todouble(0)\\r\\n                           )\\r\\n| extend myLongitude = case( \\r\\n                            '{getLocation}' == 'mylist', todouble(split('{CityList:value}',\\\",\\\").[1]),\\r\\n                            '{getLocation}' == 'aad' ,   todouble(split('{defaultCityListAAD:value}',\\\",\\\").[2]),\\r\\n                            '{getLocation}' == 'manual', todouble({Longitude}),\\r\\n                            //else\\r\\n                            todouble(0)\\r\\n                           )\\r\\n| where isnotempty(MaliciousIP) and isnotempty(Country) and isnotempty(Latitude) and isnotempty(Longitude)\\r\\n// measure the distance between the base/city and maliciousIP location in km or miles\\r\\n| extend distance_in = iif('{Measurement}' == \\\"KM\\\", geo_distance_2points(Longitude, Latitude, myLongitude, myLatitude)/1000.00, geo_distance_2points(Longitude, Latitude, myLongitude, myLatitude)/1609.344 )\\r\\n| summarize count(), arg_max(TimeGenerated,TimeGenerated) by Country, distance_in, Latitude , Longitude, '{getLocation}', myLatitude, myLongitude\\r\\n| top {Top} by count_\\r\\n\\r\\n\",               \"size\": 0,               \"title\": \"Top: '{Top}' Malicious IP distances from {locationName} in ('{Measurement}') \",               \"timeContext\": {                 \"durationMs\": 5184000000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"map\",               \"gridSettings\": {                 \"sortBy\": [                   {                     \"itemKey\": \"distance_in\",                     \"sortOrder\": 2                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"distance_in\",                   \"sortOrder\": 2                 }               ],               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"Country\",                   \"formatter\": 1                 },                 \"centerContent\": {                   \"columnMatch\": \"distance_in\",                   \"formatter\": 1,                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               },               \"mapSettings\": {                 \"locInfo\": \"LatLong\",                 \"latitude\": \"Latitude\",                 \"longitude\": \"Longitude\",                 \"sizeSettings\": \"count_\",                 \"sizeAggregation\": \"Sum\",                 \"labelSettings\": \"Country\",                 \"legendMetric\": \"distance_in\",                 \"legendAggregation\": \"Sum\",                 \"itemColorSettings\": {                   \"nodeColorField\": \"count_\",                   \"colorAggregation\": \"Sum\",                   \"type\": \"heatmap\",                   \"heatmapPalette\": \"orange\"                 }               }             },             \"name\": \"query - 8\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"// Show a summary of the map data \\r\\nunion isfuzzy=true \\r\\n(W3CIISLog\\r\\n| extend TrafficDirection = \\\"InboundOrUnknown\\\", Country=RemoteIPCountry, Latitude=RemoteIPLatitude, Longitude=RemoteIPLongitude), \\r\\n(DnsEvents\\r\\n| extend TrafficDirection = \\\"InboundOrUnknown\\\", Country= RemoteIPCountry, Latitude = RemoteIPLatitude, Longitude = RemoteIPLongitude),\\r\\n(WireData\\r\\n| extend TrafficDirection = iff(Direction != \\\"Outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=RemoteIPCountry, Latitude=RemoteIPLatitude, Longitude=RemoteIPLongitude), \\r\\n(WindowsFirewall\\r\\n| extend TrafficDirection = iff(CommunicationDirection != \\\"SEND\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=MaliciousIPCountry, Latitude=MaliciousIPLatitude, Longitude=MaliciousIPLongitude), \\r\\n(CommonSecurityLog\\r\\n| extend TrafficDirection = iff(CommunicationDirection != \\\"Outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=MaliciousIPCountry, Latitude=MaliciousIPLatitude, Longitude=MaliciousIPLongitude, Confidence=ThreatDescription, Description=ThreatDescription), \\r\\n(VMConnection\\r\\n| where Type == \\\"VMConnection\\\"\\r\\n| extend TrafficDirection = iff(Direction != \\\"outbound\\\",\\\"InboundOrUnknown\\\", \\\"Outbound\\\"), Country=RemoteCountry, Latitude=RemoteLatitude, Longitude=RemoteLongitude)\\r\\n// Start of main logic\\r\\n// Supply a default location (long/lat)\\r\\n| extend myLatitude = case( \\r\\n                            '{getLocation}' == 'mylist', todouble(split('{CityList:value}',\\\",\\\").[0]),\\r\\n                            '{getLocation}' == 'aad' ,   todouble(split('{defaultCityListAAD:value}',\\\",\\\").[1]),\\r\\n                            '{getLocation}' == 'manual', todouble({Latitude}),\\r\\n                            //else\\r\\n                            todouble(0)\\r\\n                           )\\r\\n| extend myLongitude = case( \\r\\n                            '{getLocation}' == 'mylist', todouble(split('{CityList:value}',\\\",\\\").[1]),\\r\\n                            '{getLocation}' == 'aad' ,   todouble(split('{defaultCityListAAD:value}',\\\",\\\").[2]),\\r\\n                            '{getLocation}' == 'manual', todouble({Longitude}),\\r\\n                            //else\\r\\n                            todouble(0)\\r\\n                           )                         \\r\\n| where isnotempty(MaliciousIP) and isnotempty(Country) and isnotempty(Latitude) and isnotempty(Longitude)\\r\\n// measure the distance between the base/city and maliciousIP location in km or miles\\r\\n| extend distance_in = iif('{Measurement}' == \\\"KM\\\", geo_distance_2points(Longitude, Latitude, myLongitude, myLatitude)/1000.00, geo_distance_2points(Longitude, Latitude, myLongitude, myLatitude)/1609.344 )\\r\\n| summarize count(), arg_max(TimeGenerated,TimeGenerated) by Country, \\r\\n                     distance_in,Latitude, Longitude,  toggle='{getLocation}', myLatitude, myLongitude\\r\\n| top {Top} by count_\\r\\n| order by distance_in desc\\r\\n\\r\\n\",               \"size\": 1,               \"showAnalytics\": true,               \"title\": \"Top: '{Top}' Malicious IP distances from {locationName} in ('{Measurement}') \",               \"timeContext\": {                 \"durationMs\": 5184000000               },               \"timeContextFromParameter\": \"TimeRange\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"distance_in\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"palette\": \"greenRed\"                     }                   },                   {                     \"columnMatch\": \"toggle\",                     \"formatter\": 5                   },                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"palette\": \"coldHot\"                     }                   },                   {                     \"columnMatch\": \"TimeGenerated1\",                     \"formatter\": 5                   }                 ],                 \"filter\": true,                 \"sortBy\": [                   {                     \"itemKey\": \"$gen_bar_distance_in_1\",                     \"sortOrder\": 2                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"Country\"                   },                   {                     \"columnId\": \"distance_in\",                     \"label\": \"Distance\"                   },                   {                     \"columnId\": \"Latitude\",                     \"label\": \"Destination Latitude\"                   },                   {                     \"columnId\": \"Longitude\",                     \"label\": \"Destination Longitude\"                   },                   {                     \"columnId\": \"toggle\",                     \"label\": \"\"                   },                   {                     \"columnId\": \"myLatitude\",                     \"label\": \"Source Latitude\"                   },                   {                     \"columnId\": \"myLongitude\",                     \"label\": \"Source Longitude\"                   },                   {                     \"columnId\": \"count_\"                   },                   {                     \"columnId\": \"TimeGenerated\"                   },                   {                     \"columnId\": \"TimeGenerated1\"                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"$gen_bar_distance_in_1\",                   \"sortOrder\": 2                 }               ],               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"Country\",                   \"formatter\": 1                 },                 \"centerContent\": {                   \"columnMatch\": \"distance_in\",                   \"formatter\": 1,                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               },               \"mapSettings\": {                 \"locInfo\": \"LatLong\",                 \"latitude\": \"Latitude\",                 \"longitude\": \"Longitude\",                 \"sizeSettings\": \"count_\",                 \"sizeAggregation\": \"Sum\",                 \"labelSettings\": \"Country\",                 \"legendMetric\": \"distance_in\",                 \"legendAggregation\": \"Sum\",                 \"itemColorSettings\": {                   \"nodeColorField\": \"count_\",                   \"colorAggregation\": \"Sum\",                   \"type\": \"heatmap\",                   \"heatmapPalette\": \"orange\"                 }               }             },             \"name\": \"query - 8 - Copy\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"MaliciousIP\"       },       \"name\": \"group - Malicious\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: UserMap\",         \"items\": [           {             \"type\": 9,             \"content\": {               \"version\": \"KqlParameterItem/1.0\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"parameters\": [                 {                   \"id\": \"4fd13b3f-9856-4e1d-93f5-c4681a6b4c16\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"SelectUser\",                   \"type\": 2,                   \"isRequired\": true,                   \"query\": \"SigninLogs\\r\\n| where TimeGenerated  {TimeRange:query}\\r\\n| where isnotempty(UserDisplayName) and  UserDisplayName !=\\\"On-Premises Directory Synchronization Service Account\\\"\\r\\n| summarize Count = count() by UserDisplayName\\r\\n| order by Count desc, UserDisplayName asc\\r\\n| project Value = UserDisplayName, Label = strcat(UserDisplayName, ' - ', Count, ' sign-ins'), Selected = false\\r\\n\",                   \"crossComponentResources\": [                     \"{Workspace}\"                   ],                   \"value\": null,                   \"typeSettings\": {                     \"additionalResourceOptions\": []                   },                   \"timeContext\": {                     \"durationMs\": 5184000000                   },                   \"timeContextFromParameter\": \"TimeRange\",                   \"queryType\": 0,                   \"resourceType\": \"microsoft.operationalinsights/workspaces\"                 }               ],               \"style\": \"above\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\"             },             \"name\": \"parameters - 7\"           },           {             \"type\": 1,             \"content\": {               \"json\": \"#### Please select a user, or confirm data source: SigninLogs exists\",               \"style\": \"warning\"             },             \"conditionalVisibility\": {               \"parameterName\": \"SelectUser\",               \"comparison\": \"isEqualTo\"             },             \"name\": \"text - 6\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where UserDisplayName !=\\\"On-Premises Directory Synchronization Service Account\\\"\\r\\n| where UserDisplayName == '{SelectUser}'\\r\\n| extend city_  = tostring(LocationDetails.city) \\r\\n| extend state_ = tostring(LocationDetails.state) \\r\\n| extend countryOrRegion_ = tostring(LocationDetails.countryOrRegion) \\r\\n| extend latitude_  = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).latitude) \\r\\n| extend longitude_ = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).longitude) \\r\\n| order by TimeGenerated asc , city_ asc\\r\\n| serialize \\r\\n| extend pLat = prev(latitude_,1)\\r\\n| extend pLon = prev(longitude_,1)\\r\\n| extend distanceType = iif('{Measurement}' == \\\"KM\\\", todouble(1000), todouble(1609.344))\\r\\n| extend distance_in = iif(row_number() \u003e 1,tostring(round(geo_distance_2points(todouble(longitude_), todouble(latitude_), todouble(pLon), todouble(pLat))/distanceType ,2)),\\\"FirstLocation\\\")\\r\\n| where distance_in !=\\\"0.0\\\"\\r\\n| summarize by bin(TimeGenerated, {TimeRange:grain}),\\r\\n                       UserDisplayName,\\r\\n                       City=city_ ,\\r\\n                       CountryorRegion=countryOrRegion_, \\r\\n                       visitedInThisOrder = row_number(),\\r\\n                       distanceTravelled = distance_in,\\r\\n                       distanceTravelled2 = strcat(distance_in,' ','{Measurement}'),\\r\\n                       latitude_,\\r\\n                       longitude_\\r\\n| order by TimeGenerated asc, visitedInThisOrder asc\",               \"size\": 0,               \"showAnalytics\": true,               \"title\": \"Map showing locations for user: '{SelectUser}'\",               \"timeContext\": {                 \"durationMs\": 5184000000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"Namespace\",               \"exportParameterName\": \"Namespace\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"map\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Table Entries\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"green\",                       \"showIcon\": true                     },                     \"numberFormat\": {                       \"unit\": 17,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   },                   {                     \"columnMatch\": \"Table Size\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true                     },                     \"numberFormat\": {                       \"unit\": 2,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   },                   {                     \"columnMatch\": \"Table Size Trend\",                     \"formatter\": 9,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               },               \"sortBy\": [],               \"tileSettings\": {                 \"titleContent\": {                   \"columnMatch\": \"visit_order\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"leftContent\": {                   \"columnMatch\": \"count_\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\",                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"showBorder\": false               },               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"UserDisplayName\",                   \"formatter\": 8,                   \"formatOptions\": {                     \"palette\": \"blue\",                     \"showIcon\": true                   }                 },                 \"centerContent\": {                   \"columnMatch\": \"count_\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"nodeIdField\": \"userNameLocation\",                 \"sourceIdField\": \"TimeGenerated\",                 \"targetIdField\": \"MilesTravelled\",                 \"nodeSize\": null,                 \"staticNodeSize\": 100,                 \"colorSettings\": null,                 \"hivesMargin\": 5               },               \"mapSettings\": {                 \"locInfo\": \"LatLong\",                 \"latitude\": \"latitude_\",                 \"longitude\": \"longitude_\",                 \"sizeSettings\": \"distanceTravelled\",                 \"sizeAggregation\": \"Sum\",                 \"labelSettings\": \"City\",                 \"legendMetric\": \"distanceTravelled\",                 \"numberOfMetrics\": 10,                 \"legendAggregation\": \"Sum\",                 \"itemColorSettings\": {                   \"nodeColorField\": \"distanceTravelled\",                   \"colorAggregation\": \"Sum\",                   \"type\": \"heatmap\",                   \"heatmapPalette\": \"blueDark\"                 }               }             },             \"name\": \"query - 6 - Copy - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where UserDisplayName !=\\\"On-Premises Directory Synchronization Service Account\\\"\\r\\n| where UserDisplayName == '{SelectUser}'\\r\\n| extend city_  = tostring(LocationDetails.city) \\r\\n| extend state_ = tostring(LocationDetails.state) \\r\\n| extend countryOrRegion_ = tostring(LocationDetails.countryOrRegion) \\r\\n| extend latitude_  = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).latitude) \\r\\n| extend longitude_ = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).longitude) \\r\\n| order by TimeGenerated asc , city_ asc\\r\\n| serialize \\r\\n| extend pLat = prev(latitude_,1)\\r\\n| extend pLon = prev(longitude_,1)\\r\\n| extend distanceType = iif('{Measurement}' == \\\"KM\\\", todouble(1000), todouble(1609.344))\\r\\n| extend distance_in = iif(row_number() \u003e 1,tostring(round(geo_distance_2points(todouble(longitude_), todouble(latitude_), todouble(pLon), todouble(pLat))/distanceType ,2)),\\\"FirstLocation\\\")\\r\\n| where distance_in !=\\\"0.0\\\"\\r\\n| summarize by bin(TimeGenerated, {TimeRange:grain}),\\r\\n                       UserDisplayName,\\r\\n                       City=city_ ,\\r\\n                       CountryorRegion=countryOrRegion_, \\r\\n                       visitedInThisOrder = row_number(),\\r\\n                       distanceBetweenLocations = strcat(distance_in,' ','({Measurement})')\\r\\n| order by TimeGenerated asc, visitedInThisOrder asc\",               \"size\": 1,               \"showAnalytics\": true,               \"title\": \"Looking for '{SelectUser}'\",               \"color\": \"green\",               \"timeContext\": {                 \"durationMs\": 5184000000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"Namespace\",               \"exportParameterName\": \"Namespace\",               \"exportDefaultValue\": \"All\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Table Entries\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"green\",                       \"showIcon\": true                     },                     \"numberFormat\": {                       \"unit\": 17,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   },                   {                     \"columnMatch\": \"Table Size\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true                     },                     \"numberFormat\": {                       \"unit\": 2,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   },                   {                     \"columnMatch\": \"Table Size Trend\",                     \"formatter\": 9,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               },               \"sortBy\": [],               \"tileSettings\": {                 \"titleContent\": {                   \"columnMatch\": \"visit_order\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"leftContent\": {                   \"columnMatch\": \"count_\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\",                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"showBorder\": false               },               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"UserDisplayName\",                   \"formatter\": 8,                   \"formatOptions\": {                     \"palette\": \"blue\",                     \"showIcon\": true                   }                 },                 \"centerContent\": {                   \"columnMatch\": \"count_\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"nodeIdField\": \"userNameLocation\",                 \"sourceIdField\": \"TimeGenerated\",                 \"targetIdField\": \"MilesTravelled\",                 \"nodeSize\": null,                 \"staticNodeSize\": 100,                 \"colorSettings\": null,                 \"hivesMargin\": 5               },               \"mapSettings\": {                 \"locInfo\": \"LatLong\",                 \"latitude\": \"latitude_\",                 \"longitude\": \"longitude_\",                 \"sizeSettings\": \"MilesTravelled\",                 \"sizeAggregation\": \"Sum\",                 \"labelSettings\": \"visit_order\",                 \"legendMetric\": \"MilesTravelled\",                 \"legendAggregation\": \"Sum\",                 \"itemColorSettings\": {                   \"nodeColorField\": \"MilesTravelled\",                   \"colorAggregation\": \"Sum\",                   \"type\": \"heatmap\",                   \"heatmapPalette\": \"redDark\"                 }               }             },             \"name\": \"query - 6 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where UserDisplayName !=\\\"On-Premises Directory Synchronization Service Account\\\"\\r\\n| where UserDisplayName == '{SelectUser}'\\r\\n| extend city_  = tostring(LocationDetails.city) \\r\\n| extend state_ = tostring(LocationDetails.state) \\r\\n| extend countryOrRegion_ = tostring(LocationDetails.countryOrRegion) \\r\\n| extend latitude_  = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).latitude) \\r\\n| extend longitude_ = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).longitude) \\r\\n| order by TimeGenerated asc , city_ asc\\r\\n| serialize \\r\\n| extend pLat = prev(latitude_,1)\\r\\n| extend pLon = prev(longitude_,1)\\r\\n| extend distanceType = iif('{Measurement}' == \\\"KM\\\", todouble(1000), todouble(1609.344))\\r\\n| extend distance_in = iif(isnotempty(pLat),tostring(round(geo_distance_2points(todouble(longitude_), todouble(latitude_), todouble(pLon), todouble(pLat))/distanceType ,2)),\\\"FirstLocation\\\")\\r\\n| where distance_in !=\\\"0.0\\\"\\r\\n| summarize by bin(TimeGenerated, {TimeRange:grain}),\\r\\n                       UserDisplayName,\\r\\n                       City=city_ ,\\r\\n                       CountryorRegion=countryOrRegion_, \\r\\n                       visitedInThisOrder = row_number(),\\r\\n                       distanceTravelled = strcat(distance_in,' ','{Measurement}')\\r\\n//| top {Top} by City\\r\\n| order by TimeGenerated asc, visitedInThisOrder asc\\r\\n\",               \"size\": 1,               \"showAnalytics\": true,               \"title\": \" '{SelectUser}' : Cities visitied\",               \"color\": \"green\",               \"timeContext\": {                 \"durationMs\": 5184000000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"Namespace\",               \"exportParameterName\": \"Namespace\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"unstackedbar\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Table Entries\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"green\",                       \"showIcon\": true                     },                     \"numberFormat\": {                       \"unit\": 17,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   },                   {                     \"columnMatch\": \"Table Size\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true                     },                     \"numberFormat\": {                       \"unit\": 2,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   },                   {                     \"columnMatch\": \"Table Size Trend\",                     \"formatter\": 9,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               },               \"sortBy\": [],               \"tileSettings\": {                 \"titleContent\": {                   \"columnMatch\": \"visit_order\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"leftContent\": {                   \"columnMatch\": \"count_\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\",                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"showBorder\": false               },               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"UserDisplayName\",                   \"formatter\": 8,                   \"formatOptions\": {                     \"palette\": \"blue\",                     \"showIcon\": true                   }                 },                 \"centerContent\": {                   \"columnMatch\": \"count_\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"nodeIdField\": \"userNameLocation\",                 \"sourceIdField\": \"TimeGenerated\",                 \"targetIdField\": \"MilesTravelled\",                 \"nodeSize\": null,                 \"staticNodeSize\": 100,                 \"colorSettings\": null,                 \"hivesMargin\": 5               },               \"chartSettings\": {                 \"group\": \"City\",                 \"createOtherGroup\": 10,                 \"showMetrics\": false,                 \"showLegend\": true               },               \"mapSettings\": {                 \"locInfo\": \"LatLong\",                 \"latitude\": \"latitude_\",                 \"longitude\": \"longitude_\",                 \"sizeSettings\": \"MilesTravelled\",                 \"sizeAggregation\": \"Sum\",                 \"labelSettings\": \"visit_order\",                 \"legendMetric\": \"MilesTravelled\",                 \"legendAggregation\": \"Sum\",                 \"itemColorSettings\": {                   \"nodeColorField\": \"MilesTravelled\",                   \"colorAggregation\": \"Sum\",                   \"type\": \"heatmap\",                   \"heatmapPalette\": \"redDark\"                 }               }             },             \"customWidth\": \"50\",             \"name\": \"query - 6 - by Location  - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where UserDisplayName !=\\\"On-Premises Directory Synchronization Service Account\\\"\\r\\n| where UserDisplayName == '{SelectUser}'\\r\\n| extend city_  = tostring(LocationDetails.city) \\r\\n| extend state_ = tostring(LocationDetails.state) \\r\\n| extend countryOrRegion_ = tostring(LocationDetails.countryOrRegion) \\r\\n| extend latitude_  = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).latitude) \\r\\n| extend longitude_ = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).longitude) \\r\\n| order by TimeGenerated asc , city_ asc\\r\\n| serialize \\r\\n| extend pLat = prev(latitude_,1)\\r\\n| extend pLon = prev(longitude_,1)\\r\\n| extend distanceType = iif('{Measurement}' == \\\"KM\\\", todouble(1000), todouble(1609.344))\\r\\n| extend distance_in = iif(isnotempty(pLat),tostring(round(geo_distance_2points(todouble(longitude_), todouble(latitude_), todouble(pLon), todouble(pLat))/distanceType ,2)),\\\"FirstLocation\\\")\\r\\n| where distance_in !=\\\"0.0\\\"\\r\\n| summarize by bin(TimeGenerated, {TimeRange:grain}),\\r\\n                       UserDisplayName,\\r\\n                       City=city_ ,\\r\\n                       CountryorRegion=countryOrRegion_, \\r\\n                       visitedInThisOrder = row_number(),\\r\\n                       distanceTravelled = strcat(distance_in,' ','{Measurement}')\\r\\n| order by TimeGenerated asc, visitedInThisOrder asc\",               \"size\": 1,               \"showAnalytics\": true,               \"title\": \" '{SelectUser}' : distance travelled\",               \"color\": \"green\",               \"timeContext\": {                 \"durationMs\": 5184000000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"Namespace\",               \"exportParameterName\": \"Namespace\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"unstackedbar\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Table Entries\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"green\",                       \"showIcon\": true                     },                     \"numberFormat\": {                       \"unit\": 17,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   },                   {                     \"columnMatch\": \"Table Size\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true                     },                     \"numberFormat\": {                       \"unit\": 2,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   },                   {                     \"columnMatch\": \"Table Size Trend\",                     \"formatter\": 9,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               },               \"sortBy\": [],               \"tileSettings\": {                 \"titleContent\": {                   \"columnMatch\": \"visit_order\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"leftContent\": {                   \"columnMatch\": \"count_\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\",                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"showBorder\": false               },               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"UserDisplayName\",                   \"formatter\": 8,                   \"formatOptions\": {                     \"palette\": \"blue\",                     \"showIcon\": true                   }                 },                 \"centerContent\": {                   \"columnMatch\": \"count_\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"nodeIdField\": \"userNameLocation\",                 \"sourceIdField\": \"TimeGenerated\",                 \"targetIdField\": \"MilesTravelled\",                 \"nodeSize\": null,                 \"staticNodeSize\": 100,                 \"colorSettings\": null,                 \"hivesMargin\": 5               },               \"chartSettings\": {                 \"group\": \"distanceTravelled\",                 \"createOtherGroup\": null,                 \"showMetrics\": false,                 \"showLegend\": true               },               \"mapSettings\": {                 \"locInfo\": \"LatLong\",                 \"latitude\": \"latitude_\",                 \"longitude\": \"longitude_\",                 \"sizeSettings\": \"MilesTravelled\",                 \"sizeAggregation\": \"Sum\",                 \"labelSettings\": \"visit_order\",                 \"legendMetric\": \"MilesTravelled\",                 \"legendAggregation\": \"Sum\",                 \"itemColorSettings\": {                   \"nodeColorField\": \"MilesTravelled\",                   \"colorAggregation\": \"Sum\",                   \"type\": \"heatmap\",                   \"heatmapPalette\": \"redDark\"                 }               }             },             \"customWidth\": \"50\",             \"name\": \"query - 6 - by Location \"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where UserDisplayName !=\\\"On-Premises Directory Synchronization Service Account\\\"\\r\\n| where UserDisplayName == '{SelectUser}'\\r\\n| extend city_  = tostring(LocationDetails.city) \\r\\n| extend state_ = tostring(LocationDetails.state) \\r\\n| extend countryOrRegion_ = tostring(LocationDetails.countryOrRegion) \\r\\n| extend latitude_  = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).latitude) \\r\\n| extend longitude_ = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).longitude) \\r\\n| order by TimeGenerated asc , city_ asc\\r\\n| serialize \\r\\n| extend pLat = prev(latitude_,1)\\r\\n| extend pLon = prev(longitude_,1)\\r\\n| extend distanceType = iif('{Measurement}' == \\\"KM\\\", todouble(1000), todouble(1609.344))\\r\\n| extend distance_in = iif(isnotempty(pLat),tostring(round(geo_distance_2points(todouble(longitude_), todouble(latitude_), todouble(pLon), todouble(pLat))/distanceType ,2)),\\\"FirstLocation\\\")\\r\\n| where distance_in !=\\\"0.0\\\"\\r\\n| summarize by bin(TimeGenerated, {TimeRange:grain}),\\r\\n                       UserDisplayName,\\r\\n                       City=city_ ,\\r\\n                       CountryorRegion=countryOrRegion_, \\r\\n                       visitedInThisOrder = row_number(),\\r\\n                       distanceTravelled = strcat(distance_in,' ','{Measurement}')\\r\\n| order by TimeGenerated asc, visitedInThisOrder asc\",               \"size\": 4,               \"showAnalytics\": true,               \"title\": \" '{SelectUser}' : Countries visitied \",               \"color\": \"green\",               \"timeContext\": {                 \"durationMs\": 5184000000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"Namespace\",               \"exportParameterName\": \"Namespace\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"piechart\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Table Entries\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"green\",                       \"showIcon\": true                     },                     \"numberFormat\": {                       \"unit\": 17,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   },                   {                     \"columnMatch\": \"Table Size\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true                     },                     \"numberFormat\": {                       \"unit\": 2,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   },                   {                     \"columnMatch\": \"Table Size Trend\",                     \"formatter\": 9,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               },               \"sortBy\": [],               \"tileSettings\": {                 \"titleContent\": {                   \"columnMatch\": \"visit_order\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"leftContent\": {                   \"columnMatch\": \"count_\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\",                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"showBorder\": false               },               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"UserDisplayName\",                   \"formatter\": 8,                   \"formatOptions\": {                     \"palette\": \"blue\",                     \"showIcon\": true                   }                 },                 \"centerContent\": {                   \"columnMatch\": \"count_\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"nodeIdField\": \"userNameLocation\",                 \"sourceIdField\": \"TimeGenerated\",                 \"targetIdField\": \"MilesTravelled\",                 \"nodeSize\": null,                 \"staticNodeSize\": 100,                 \"colorSettings\": null,                 \"hivesMargin\": 5               },               \"chartSettings\": {                 \"group\": \"CountryorRegion\",                 \"createOtherGroup\": null,                 \"showMetrics\": false,                 \"showLegend\": true               },               \"mapSettings\": {                 \"locInfo\": \"LatLong\",                 \"latitude\": \"latitude_\",                 \"longitude\": \"longitude_\",                 \"sizeSettings\": \"MilesTravelled\",                 \"sizeAggregation\": \"Sum\",                 \"labelSettings\": \"visit_order\",                 \"legendMetric\": \"MilesTravelled\",                 \"legendAggregation\": \"Sum\",                 \"itemColorSettings\": {                   \"nodeColorField\": \"MilesTravelled\",                   \"colorAggregation\": \"Sum\",                   \"type\": \"heatmap\",                   \"heatmapPalette\": \"redDark\"                 }               }             },             \"customWidth\": \"50\",             \"name\": \"query - 6 - by Location  - Copy - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where UserDisplayName !=\\\"On-Premises Directory Synchronization Service Account\\\"\\r\\n| extend city_  = tostring(LocationDetails.city) \\r\\n| extend state_ = tostring(LocationDetails.state) \\r\\n| extend countryOrRegion_ = tostring(LocationDetails.countryOrRegion) \\r\\n| order by TimeGenerated asc , city_ asc\\r\\n| summarize count() by bin(TimeGenerated, {TimeRange:grain}),\\r\\n                       City=city_ ,\\r\\n                       CountryorRegion=countryOrRegion_ \\r\\n| order by count_ desc\",               \"size\": 4,               \"showAnalytics\": true,               \"title\": \"All Users : Countries by most frequent\",               \"color\": \"green\",               \"timeContext\": {                 \"durationMs\": 5184000000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"Namespace\",               \"exportParameterName\": \"Namespace\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"piechart\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Table Entries\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"green\",                       \"showIcon\": true                     },                     \"numberFormat\": {                       \"unit\": 17,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   },                   {                     \"columnMatch\": \"Table Size\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true                     },                     \"numberFormat\": {                       \"unit\": 2,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   },                   {                     \"columnMatch\": \"Table Size Trend\",                     \"formatter\": 9,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               },               \"sortBy\": [],               \"tileSettings\": {                 \"titleContent\": {                   \"columnMatch\": \"visit_order\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"leftContent\": {                   \"columnMatch\": \"count_\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\",                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"showBorder\": false               },               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"UserDisplayName\",                   \"formatter\": 8,                   \"formatOptions\": {                     \"palette\": \"blue\",                     \"showIcon\": true                   }                 },                 \"centerContent\": {                   \"columnMatch\": \"count_\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"nodeIdField\": \"userNameLocation\",                 \"sourceIdField\": \"TimeGenerated\",                 \"targetIdField\": \"MilesTravelled\",                 \"nodeSize\": null,                 \"staticNodeSize\": 100,                 \"colorSettings\": null,                 \"hivesMargin\": 5               },               \"chartSettings\": {                 \"group\": \"CountryorRegion\",                 \"createOtherGroup\": null,                 \"showMetrics\": false,                 \"showLegend\": true               },               \"mapSettings\": {                 \"locInfo\": \"LatLong\",                 \"latitude\": \"latitude_\",                 \"longitude\": \"longitude_\",                 \"sizeSettings\": \"MilesTravelled\",                 \"sizeAggregation\": \"Sum\",                 \"labelSettings\": \"visit_order\",                 \"legendMetric\": \"MilesTravelled\",                 \"legendAggregation\": \"Sum\",                 \"itemColorSettings\": {                   \"nodeColorField\": \"MilesTravelled\",                   \"colorAggregation\": \"Sum\",                   \"type\": \"heatmap\",                   \"heatmapPalette\": \"redDark\"                 }               }             },             \"customWidth\": \"50\",             \"name\": \"query - 6 - by Location  - All User\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"UserData\"       },       \"name\": \"group - UserMap\"     }   ],   \"styleSettings\": {},   \"fromTemplateId\": \"community-Workbooks/Azure Sentinel - Workspaces/User Map\",   \"fallbackResourceIds\": [     \"Azure Monitor\"   ],   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('WebApplicationFirewallFirewallEvents_id')]",
                          "properties":  {
                                             "displayName":  "Security - Web Application Firewall - FirewallEvents",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"## Application gateway firewall events\"       },       \"name\": \"text - 10\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"query\": \"\",         \"crossComponentResources\": [],         \"parameters\": [           {             \"id\": \"49e2f511-592f-4d7f-8fda-d686803f3dbf\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 2592000000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2419200000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ],               \"allowCustom\": true             }           },           {             \"id\": \"d54c1639-d46c-4655-9d76-d5416926a453\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"WAF\",             \"type\": 2,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| summarize Count=count() by Resource\\r\\n| order by Count desc, Resource asc\\r\\n| project Value = Resource, Lable = strcat(Resource, \\\" - \\\", Count)\",             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"selectAllValue\": \"All\"             },             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\"           }         ],         \"style\": \"pills\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"name\": \"parameters - 2\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\" and (\\\"{WAF:lable}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where OperationName == \\\"ApplicationGatewayFirewall\\\"\\r\\n| where action_s == \\\"Blocked\\\" or action_s == \\\"Detected\\\" \\r\\n| summarize count() by requestUri_s \\r\\n| top 10 by count_ desc \",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Blocked URL addresses\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"30\",       \"name\": \"query - 9\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\" and (\\\"{WAF:lable}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where OperationName == \\\"ApplicationGatewayFirewall\\\"\\r\\n| summarize number = count() by action_s\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"WAF actions\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"30\",       \"name\": \"query - 11\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where  (\\\"{WAF:lable}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| where OperationName == \\\"ApplicationGatewayFirewall\\\" \\r\\n| summarize number = count() by instanceId_s, TimeGenerated\\r\\n| where instanceId_s contains \\\"role\\\"\\r\\n| extend roulenumber = extract(\\\"ApplicationGateway([a-zA-Z_a-zA-Z_0-9]*)\\\", 1, instanceId_s) \\r\\n| project roulenumber , number , TimeGenerated \\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Role use, by time\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"linechart\"       },       \"customWidth\": \"40\",       \"name\": \"query - 8\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where \\\"{WAF:lable}\\\" == \\\"All\\\" or Resource in ({WAF})\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| where OperationName == \\\"ApplicationGatewayFirewall\\\"\\r\\n| summarize count() by Message\\r\\n| top 10 by count_ \\r\\n\",         \"size\": 0,         \"exportFieldName\": \"Message\",         \"exportParameterName\": \"Selected\",         \"exportDefaultValue\": \"*\",         \"exportToExcelOptions\": \"visible\",         \"title\": \"Event trigger\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Message\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"count_\",               \"formatter\": 3,               \"formatOptions\": {                 \"palette\": \"blue\",                 \"showIcon\": true               }             }           ],           \"labelSettings\": [             {               \"columnId\": \"Message\"             },             {               \"columnId\": \"count_\",               \"label\": \"\"             }           ]         }       },       \"customWidth\": \"50\",       \"name\": \"query - 12\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where \\\"{WAF:lable}\\\" == \\\"All\\\" or Resource in ({WAF})\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| where OperationName == \\\"ApplicationGatewayFirewall\\\"\\r\\n| where ('{Selected}' == Message) or '{Selected}'==\\\"*\\\"\\r\\n| summarize count() by Message, TimeGenerated\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Messages, by time\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"barchart\",         \"tileSettings\": {           \"showBorder\": false,           \"titleContent\": {             \"columnMatch\": \"Message\",             \"formatter\": 1           },           \"leftContent\": {             \"columnMatch\": \"count_\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\"             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         }       },       \"customWidth\": \"50\",       \"name\": \"query - 13\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where \\\"{WAF:lable}\\\" == \\\"All\\\" or Resource in ({WAF})\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| where OperationName == \\\"ApplicationGatewayFirewall\\\"\\r\\n| where '{Selected}' == Message or '{Selected}' == \\\"*\\\"\\r\\n| extend Role =  extract(\\\"ApplicationGateway([a-zA-Z_a-zA-Z_0-9]*)\\\",1,instanceId_s) \\r\\n| project Message, TimeGenerated, SourceSystem, hostname_s, ResourceId, ResourceGroup, ResourceProvider, Category, Role, action_s, site_s, details_message_s, details_file_s, clientIp_s, requestUri_s\\r\\n| sort by TimeGenerated\\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Message, full details\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\"       },       \"name\": \"query - 11\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"---\"       },       \"name\": \"text - 12\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\" and (\\\"{WAF:lable}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where OperationName == \\\"ApplicationGatewayFirewall\\\"\\r\\n| where Message contains \\\"attack\\\"\\r\\n| extend Role =  extract(\\\"ApplicationGateway([a-zA-Z_a-zA-Z_0-9]*)\\\",1,instanceId_s) \\r\\n| summarize Amount = count() by Message, bin(TimeGenerated, 1h), hostName = hostname_s, ResourceId, Category, Role\\r\\n| project Amount, Message, TimeGenerated, hostName, ResourceId, Category, Role\\r\\n| order by Amount desc\",         \"size\": 0,         \"exportFieldName\": \"\",         \"exportParameterName\": \"MessageFilter\",         \"exportDefaultValue\": \"{\\\"Message\\\":\\\"*\\\"}\",         \"exportToExcelOptions\": \"visible\",         \"title\": \"Attacks events, by messages\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Amount\",               \"formatter\": 8,               \"formatOptions\": {                 \"showIcon\": true,                 \"aggregation\": \"Sum\"               }             },             {               \"columnMatch\": \"Message\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"TimeGenerated\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"hostName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ResourceId\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Category\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Role\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"$gen_group\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Count\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"TenantId\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SourceSystem\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"MG\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ManagementGroupName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Computer\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ruleGroup_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"transactionId_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"originalHost_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"_schema_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"error_code_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"error_message_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"instanceId_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"clientIp_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"clientPort_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"requestUri_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ruleSetType_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ruleSetVersion_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ruleId_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"action_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"site_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"details_message_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"details_data_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"details_file_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"details_line_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"hostname_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"clientIP_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"clientPort_d\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"httpMethod_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"requestQuery_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"userAgent_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"httpStatus_d\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"httpVersion_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"receivedBytes_d\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"sentBytes_d\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"timeTaken_d\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"sslEnabled_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"host_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"correlation_clientTrackingId_g\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"tags__type_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"msg_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"resource_originRunId_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"resource_actionName_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"correlation_actionTrackingId_g\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"workflowId_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Level\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OperationName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"status_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"tags_LogicAppsCategory_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"resource_resourceGroupName_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"resource_workflowName_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"resource_runId_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"resource_location_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"resource_triggerName_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SubscriptionId\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ResourceGroup\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ResourceProvider\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Resource\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ResourceType\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"code_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"correlation_clientTrackingId_s\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"resource_subscriptionId_g\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"resource_workflowId_g\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"startTime_t\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"endTime_t\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Type\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"_ResourceId\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"filter\": true,           \"hierarchySettings\": {             \"treeType\": 1,             \"groupBy\": [               \"Message\"             ],             \"expandTopLevel\": false           },           \"labelSettings\": []         }       },       \"name\": \"query - 16\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let SelectedMS = dynamic({MessageFilter}); // reference to the above list of messages (Event trigger)\\r\\nlet Child = SelectedMS.childRows; // Used to choose a group of messages - redirects to the message which was grouped\\r\\nAzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\" and (\\\"{WAF:lable}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where OperationName == \\\"ApplicationGatewayFirewall\\\"\\r\\n| where Message contains \\\"attack\\\"\\r\\n| where SelectedMS.Message == Message or SelectedMS.Message == \\\"*\\\" or Message == Child[0].Message\\r\\n| summarize count() by Message, TimeGenerated\",         \"size\": 0,         \"exportParameterName\": \"Message\",         \"exportDefaultValue\": \"{ \\\"Name\\\":\\\"\\\", \\\"Type\\\":\\\"*\\\"}\",         \"exportToExcelOptions\": \"visible\",         \"title\": \"Attack events, by time\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"barchart\"       },       \"customWidth\": \"70\",       \"name\": \"query - 14\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\" and (\\\"{WAF:lable}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where Message contains \\\"SQL Injection\\\" \\r\\n| summarize count() by hostname_s, Message\\r\\n| order by count_ desc \",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"SQL injection, by host name\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"customWidth\": \"30\",       \"name\": \"query - 15\"     }   ],   \"styleSettings\": {},   \"fromTemplateId\": \"sentinel-WebApplicationFirewallFirewallEvents\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('WebApplicationFirewallGatewayAccessEvents_id')]",
                          "properties":  {
                                             "displayName":  "Security - Web Application Firewall -GatewayAccessEvents",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"## Application gateway access events\\n\"       },       \"customWidth\": \"100\",       \"name\": \"text - 2\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"parameters\": [           {             \"id\": \"b3ac8870-500d-4dd8-a570-f49a2c2f1a76\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 86400000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2419200000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ],               \"allowCustom\": true             }           }         ],         \"style\": \"pills\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"customWidth\": \"50\",       \"name\": \"parameters - 2\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let ActivityData = AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| where OperationName == \\\"ApplicationGatewayAccess\\\";\\r\\nActivityData\\r\\n| summarize Count = count() by clientIP_s\\r\\n| join kind = inner (ActivityData\\r\\n | make-series Trend = count() default = 0 on bin(TimeGenerated, 1d) from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by clientIP_s)\\r\\n on clientIP_s\\r\\n | project-away clientIP_s1, TimeGenerated\\r\\n| extend clientIP = clientIP_s\\r\\n| union (\\r\\n ActivityData\\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (ActivityData\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend clientIP_s = 'All Clients', clientIP_ = '*' \\r\\n)\\r\\n| order by Count desc\\r\\n| take 10\",         \"size\": 4,         \"title\": \"Top 10 IP's by activity\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"tiles\",         \"tileSettings\": {           \"titleContent\": {             \"columnMatch\": \"clientIp_s\",             \"formatter\": 1           },           \"leftContent\": {             \"columnMatch\": \"Count\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\"             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"style\": \"decimal\",                 \"useGrouping\": false,                 \"maximumFractionDigits\": 2,                 \"maximumSignificantDigits\": 3               }             }           },           \"rightContent\": {             \"columnMatch\": \"clientIP_s\"           },           \"secondaryContent\": {             \"columnMatch\": \"Trend\",             \"formatter\": 9           },           \"showBorder\": false         }       },       \"name\": \"query - 2\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| where OperationName == \\\"ApplicationGatewayAccess\\\"\\r\\n| summarize Count= count() by clientIP_s, bin(TimeGenerated, 1d)\\r\\n\",         \"size\": 0,         \"title\": \"Activity, by cIient IP address\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\"       },       \"customWidth\": \"70\",       \"name\": \"query - 3\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| where OperationName == \\\"ApplicationGatewayAccess\\\"\\r\\n| summarize count() by clientIP_s, TimeGenerated\\r\\n\",         \"size\": 0,         \"title\": \"SSL use\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"30\",       \"name\": \"query - 4\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| where OperationName == \\\"ApplicationGatewayAccess\\\" \\r\\n| summarize receivedBytes = sum(receivedBytes_d)/1048576, sentBytes = sum(sentBytes_d)/1048576  by bin(TimeGenerated, 1d)\\r\\n//| project receivedBytes_d, sentBytes_d, TimeGenerated \\r\\n\",         \"size\": 0,         \"title\": \"Received and sent data, by time\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\"       },       \"customWidth\": \"70\",       \"name\": \"query - 5\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| where OperationName == \\\"ApplicationGatewayAccess\\\" \\r\\n| summarize number = count() by userAgent_s\\r\\n| top 10 by number desc nulls last \\r\\n\",         \"size\": 0,         \"title\": \"User agent use\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"30\",       \"name\": \"query - 6\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| where OperationName == \\\"ApplicationGatewayAccess\\\"\\r\\n| summarize number= count() by requestURI=requestUri_s, originalHost=originalHost_s, clientIP=clientIP_s\\r\\n| order by number desc\",         \"size\": 0,         \"title\": \"URL address use, by client IP address\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"number\",               \"formatter\": 4,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"blue\",                 \"showIcon\": true               }             }           ],           \"filter\": true         }       },       \"customWidth\": \"30\",       \"name\": \"query - 7\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| where OperationName == \\\"ApplicationGatewayAccess\\\" \\r\\n| summarize Count = count() by httpMethod=httpMethod_s\\r\\n| sort by Count desc\\r\\n\",         \"size\": 0,         \"title\": \"HTTP Methods\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Count\",               \"formatter\": 4,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"number\",               \"formatter\": 4,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"purple\",                 \"showIcon\": true               }             }           ],           \"filter\": true         }       },       \"customWidth\": \"35\",       \"name\": \"query - 8\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| where OperationName == \\\"ApplicationGatewayAccess\\\"\\r\\n| summarize Count = count() by requestQuery=requestQuery_s\\r\\n| sort by Count desc\",         \"size\": 0,         \"title\": \"Request queries\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Count\",               \"formatter\": 4,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"count_\",               \"formatter\": 4,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"turquoise\",                 \"showIcon\": true               }             }           ],           \"filter\": true         }       },       \"customWidth\": \"35\",       \"name\": \"query - 9\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| where OperationName == \\\"ApplicationGatewayAccess\\\"\\r\\n| summarize sentBytes = sum(sentBytes_d), recBytes= sum(receivedBytes_d), Count = count() by originalHost=originalHost_s ,clientIP=clientIP_s, requestURI=requestUri_s, httpMethod=httpMethod_s, requestQuery=requestQuery_s, userAgent=userAgent_s, httpVersion=httpVersion_s, httpStatus=httpStatus_d,sslEnabled=sslEnabled_s, bin(TimeGenerated, 1d)\\r\\n| order by sentBytes, recBytes\",         \"size\": 0,         \"title\": \"Detailed activity\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"sentB\",               \"formatter\": 4,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"coldHot\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"recB\",               \"formatter\": 4,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"coldHot\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"sentb\",               \"formatter\": 4,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"coldHot\",                 \"showIcon\": true               }             }           ],           \"rowLimit\": 1000,           \"filter\": true         }       },       \"name\": \"query - 10\"     }   ],   \"fromTemplateId\": \"sentinel-WebApplicationFirewallGatewayAccessEvents\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('WebApplicationFirewallOverview_id')]",
                          "properties":  {
                                             "displayName":  "Security - Web Application Firewall Overview",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"query\": \"\",         \"crossComponentResources\": [],         \"parameters\": [           {             \"id\": \"49e2f511-592f-4d7f-8fda-d686803f3dbf\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 2592000000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2419200000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ],               \"allowCustom\": true             }           },           {             \"id\": \"d54c1639-d46c-4655-9d76-d5416926a453\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"WAF\",             \"type\": 2,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| summarize Count=count() by Resource\\r\\n| order by Count desc, Resource asc\\r\\n| project Value = Resource, Lable = strcat(Resource, \\\" - \\\", Count)\",             \"value\": null,             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"selectAllValue\": \"All\"             },             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\"           },           {             \"id\": \"b1a1c99d-4498-4e02-82f0-d52c276d5657\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Events\",             \"type\": 2,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| summarize Count = count() by OperationName\\r\\n| order by Count desc, OperationName asc\\r\\n| project value = OperationName, Label = strcat(OperationName, ' - ', Count)\",             \"value\": null,             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"selectAllValue\": \"All\"             },             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\"           }         ],         \"style\": \"pills\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"name\": \"parameters - 2\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\" \\n| where \\\"{WAF:lable}\\\"==\\\"All\\\" or Resource in ({WAF})\\n| where \\\"{Events:lable}\\\"==\\\"All\\\" or OperationName in ({Events})\\n| summarize count() by Resource, TimeGenerated\",         \"size\": 1,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Resource events, by time\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"linechart\",         \"tileSettings\": {           \"showBorder\": false,           \"titleContent\": {             \"columnMatch\": \"Resource\",             \"formatter\": 1           },           \"leftContent\": {             \"columnMatch\": \"count_\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\"             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         }       },       \"customWidth\": \"70\",       \"name\": \"query - 2\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\"\\r\\n| where \\\"{WAF:lable}\\\"==\\\"All\\\" or Resource in ({WAF})\\r\\n| where \\\"{Events:lable}\\\"==\\\"All\\\" or OperationName in ({Events})\\r\\n| summarize number = count() by Resource\\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Resource use\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"30\",       \"name\": \"query - 4\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\" \\r\\n| where \\\"{WAF:lable}\\\"==\\\"All\\\" or Resource in ({WAF})\\r\\n| where \\\"{Events:lable}\\\"==\\\"All\\\" or OperationName in ({Events})\\r\\n| summarize number = count() by OperationName, TimeGenerated\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Firewall and access events, by time\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\"       },       \"customWidth\": \"70\",       \"name\": \"query - 5\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\" \\r\\n| where \\\"{WAF:lable}\\\"==\\\"All\\\" or Resource in ({WAF})\\r\\n| where \\\"{Events:lable}\\\"==\\\"All\\\" or OperationName in ({Events})\\r\\n| summarize number = count() by OperationName\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Events, by operation\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"30\",       \"name\": \"query - 6\"     }   ],   \"styleSettings\": {},   \"fromTemplateId\": \"sentinel-WebApplicationFirewallOverview\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('WebApplicationFirewallWAFTypeEvents_id')]",
                          "properties":  {
                                             "displayName":  "Security - Web Application Firewall - WAFTypeEvents",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"## Azure WAF Events\"       },       \"name\": \"text - 10\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"crossComponentResources\": [           \"{Subscription}\"         ],         \"parameters\": [           {             \"id\": \"afd56a69-16a5-436d-850e-16c24e839503\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"DefaultSubscription_Internal\",             \"type\": 1,             \"isRequired\": true,             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| take 1\\r\\n| project subscriptionId\",             \"crossComponentResources\": [               \"value::all\"             ],             \"isHiddenWhenLocked\": true,             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"e38cad87-ff16-40e6-9384-f6fd24fa9d6b\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Subscription\",             \"type\": 6,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"summarize by subscriptionId\\r\\n| project value=strcat(\\\"/subscriptions/\\\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)\",             \"crossComponentResources\": [               \"value::all\"             ],             \"value\": [               \"/subscriptions/6b1ceacd-5731-4780-8f96-2078dd96fd96\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"showDefault\": false             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"a125fc08-be6d-4b8b-87e2-7e0cd957db47\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"DefaultWorkspace_Internal\",             \"type\": 1,             \"isRequired\": true,             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n|take 1\\r\\n|project id\",             \"crossComponentResources\": [               \"{Subscription}\"             ],             \"isHiddenWhenLocked\": true,             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"65674a40-2869-4867-a24d-f86f05fd0354\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Workspaces\",             \"type\": 5,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| project id, selected = iff(id =~ '{DefaultWorkspace_Internal}', true, false)\\r\\n\",             \"crossComponentResources\": [               \"{Subscription}\"             ],             \"value\": [               \"/subscriptions/6b1ceacd-5731-4780-8f96-2078dd96fd96/resourceGroups/SOC-NS/providers/Microsoft.OperationalInsights/workspaces/SOC-NS-Logs\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"showDefault\": false             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"49e2f511-592f-4d7f-8fda-d686803f3dbf\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"label\": \"Time Range\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 86400000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 }               ],               \"allowCustom\": true             }           },           {             \"id\": \"604a42a0-deca-4a95-a15f-8977646a7fac\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"WAFType\",             \"type\": 5,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"let FakeData = (datatable (Message:string, ruleName_s:string, clientIp_s:string, clientIP_s:string, action_s:string, transactionId_s:string,trackingReference_s:string) [ \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\" ]);\\r\\nFakeData | union AzureDiagnostics\\r\\n| where ResourceType == \\\"APPLICATIONGATEWAYS\\\" or ResourceType == \\\"FRONTDOORS\\\" or ResourceType == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\"\\r\\n| summarize Count=count() by ResourceType\\r\\n| extend ResourceTypeImproved = iif(ResourceType == \\\"APPLICATIONGATEWAYS\\\", \\\"Application Gateway\\\", ResourceType)\\r\\n| extend ResourceTypeImproved = iif(ResourceTypeImproved == \\\"FRONTDOORS\\\", \\\"Azure Front Door\\\", ResourceTypeImproved)\\r\\n| extend ResourceTypeImproved = iif(ResourceTypeImproved == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\", \\\"Azure CDN\\\", ResourceTypeImproved)\\r\\n| order by Count desc, ResourceTypeImproved asc\\r\\n| project ResourceTypeImproved\",             \"crossComponentResources\": [               \"{Workspaces}\"             ],             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ]             },             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\",             \"label\": \"WAF Type\"           },           {             \"id\": \"d54c1639-d46c-4655-9d76-d5416926a453\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"WAF\",             \"label\": \"WAF Items\",             \"type\": 2,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"let FakeData = (datatable (Message:string, ruleName_s:string, clientIp_s:string, clientIP_s:string, action_s:string, transactionId_s:string,trackingReference_s:string) [ \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\" ]);\\r\\nFakeData | union AzureDiagnostics\\r\\n| where (ResourceType == \\\"APPLICATIONGATEWAYS\\\" or ResourceType == \\\"FRONTDOORS\\\" or ResourceType == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\") and (\\\"{WAFType:label}\\\" == \\\"All\\\" or (ResourceType == \\\"APPLICATIONGATEWAYS\\\" and \\\"{WAFType:label}\\\" contains \\\"application gateway\\\") or (ResourceType == \\\"FRONTDOORS\\\" and  \\\"{WAFType:label}\\\" contains \\\"azure front door\\\") or (ResourceType==\\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\" and \\\"{WAFType:label}\\\" contains \\\"cdn\\\"))\\r\\n| summarize Count=count() by Resource\\r\\n| order by Count desc, Resource asc\\r\\n| project Value = Resource, Label = strcat(Resource, \\\" - \\\", Count)\",             \"crossComponentResources\": [               \"{Workspaces}\"             ],             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ]             },             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\"           }         ],         \"style\": \"pills\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\"       },       \"name\": \"parameters - 2\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let FakeData = (datatable (Message:string, ruleName_s:string, clientIp_s:string, clientIP_s:string, action_s:string, transactionId_s:string,trackingReference_s:string) [ \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\" ]);\\r\\nFakeData | union AzureDiagnostics\\r\\n| where (ResourceType == \\\"APPLICATIONGATEWAYS\\\" or ResourceType == \\\"FRONTDOORS\\\" or ResourceType == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\") and (\\\"{WAFType:label}\\\" == \\\"All\\\" or (ResourceType == \\\"APPLICATIONGATEWAYS\\\" and \\\"{WAFType:label}\\\" contains \\\"application gateway\\\") or (ResourceType == \\\"FRONTDOORS\\\" and  \\\"{WAFType:label}\\\" contains \\\"azure front door\\\") or (ResourceType==\\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\" and \\\"{WAFType:label}\\\" contains \\\"cdn\\\")) and (\\\"{WAF:label}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where Category == \\\"FrontdoorWebApplicationFirewallLog\\\" or OperationName == \\\"ApplicationGatewayFirewall\\\" or Category == \\\"WebApplicationFirewallLogs\\\"\\r\\n| extend Rule = strcat(ruleName_s, Message), ClientIP = strcat(clientIp_s, clientIP_s)\\r\\n// Application Gateway has Matched, Blocked, Detected : translates to Matched, Block, Log\\r\\n// Azure Front Door has Matched, Block, Log : translates to Matched, Block, Log\\r\\n| extend Action = iif(action_s == \\\"Blocked\\\", Action = \\\"Block\\\", action_s)\\r\\n| extend Action = iif(Action == \\\"Detected\\\", Action = \\\"Log\\\", Action)\\r\\n| summarize number = count() by Action\",         \"size\": 3,         \"showAnalytics\": true,         \"title\": \"WAF actions filter\",         \"timeContext\": {           \"durationMs\": 86400000         },         \"timeContextFromParameter\": \"TimeRange\",         \"exportFieldName\": \"series\",         \"exportParameterName\": \"SelectedAction\",         \"exportDefaultValue\": \"*\",         \"showExportToExcel\": true,         \"exportToExcelOptions\": \"all\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"27\",       \"name\": \"query - 11\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let FakeData = (datatable (Message:string, ruleName_s:string, clientIp_s:string, clientIP_s:string, action_s:string, transactionId_s:string,trackingReference_s:string) [ \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\" ]);\\r\\nFakeData | union AzureDiagnostics\\r\\n| where (ResourceType == \\\"APPLICATIONGATEWAYS\\\" or ResourceType == \\\"FRONTDOORS\\\" or ResourceType == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\") and (\\\"{WAFType:label}\\\" == \\\"All\\\" or (ResourceType == \\\"APPLICATIONGATEWAYS\\\" and \\\"{WAFType:label}\\\" contains \\\"application gateway\\\") or (ResourceType == \\\"FRONTDOORS\\\" and  \\\"{WAFType:label}\\\" contains \\\"azure front door\\\") or (ResourceType==\\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\" and \\\"{WAFType:label}\\\" contains \\\"cdn\\\")) and (\\\"{WAF:label}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where Category == \\\"FrontdoorWebApplicationFirewallLog\\\" or OperationName == \\\"ApplicationGatewayFirewall\\\" or Category == \\\"WebApplicationFirewallLogs\\\"\\r\\n| extend Rule = strcat(ruleName_s, Message), ClientIP = strcat(clientIp_s, clientIP_s)\\r\\n| extend Action = iif(action_s == \\\"Blocked\\\", Action = \\\"Block\\\", action_s)\\r\\n| extend Action = iif(Action == \\\"Detected\\\", Action = \\\"Log\\\", Action)\\r\\n| where Action == \\\"Block\\\"\\r\\n| where requestUri_s \u003c\u003e \\\"/\\\"\\r\\n| summarize count() by requestUri_s \\r\\n| top 40 by count_ desc \",         \"size\": 3,         \"showAnalytics\": true,         \"title\": \"Top 40 Blocked Request URI addresses, filter to single URI address\",         \"noDataMessage\": \"The current data has no \\\"Blocked\\\" results\",         \"timeContext\": {           \"durationMs\": 86400000         },         \"timeContextFromParameter\": \"TimeRange\",         \"exportFieldName\": \"requestUri_s\",         \"exportParameterName\": \"RequestURI\",         \"exportDefaultValue\": \"*\",         \"showExportToExcel\": true,         \"exportToExcelOptions\": \"all\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"tiles\",         \"tileSettings\": {           \"titleContent\": {             \"columnMatch\": \"requestUri_s\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"leftContent\": {             \"columnMatch\": \"count_\",             \"formatter\": 8,             \"formatOptions\": {               \"palette\": \"auto\",               \"showIcon\": true             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"style\": \"decimal\",                 \"useGrouping\": false,                 \"maximumFractionDigits\": 2,                 \"maximumSignificantDigits\": 5               }             }           },           \"showBorder\": false         },         \"graphSettings\": {           \"type\": 0,           \"topContent\": {             \"columnMatch\": \"requestUri_s\",             \"formatter\": 1           },           \"centerContent\": {             \"columnMatch\": \"count_\",             \"formatter\": 1,             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         },         \"mapSettings\": {           \"locInfo\": \"LatLong\",           \"sizeSettings\": \"count_\",           \"sizeAggregation\": \"Sum\",           \"legendMetric\": \"count_\",           \"legendAggregation\": \"Sum\",           \"itemColorSettings\": {             \"type\": \"heatmap\",             \"colorAggregation\": \"Sum\",             \"nodeColorField\": \"count_\",             \"heatmapPalette\": \"greenRed\"           }         }       },       \"customWidth\": \"63\",       \"name\": \"query - 9\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let FakeData = (datatable (Message:string, ruleName_s:string, clientIp_s:string, clientIP_s:string, action_s:string, transactionId_s:string,trackingReference_s:string) [ \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\" ]);\\r\\nFakeData | union AzureDiagnostics\\r\\n| where (ResourceType == \\\"APPLICATIONGATEWAYS\\\" or ResourceType == \\\"FRONTDOORS\\\" or ResourceType == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\") and (\\\"{WAFType:label}\\\" == \\\"All\\\" or (ResourceType == \\\"APPLICATIONGATEWAYS\\\" and \\\"{WAFType:label}\\\" contains \\\"application gateway\\\") or (ResourceType == \\\"FRONTDOORS\\\" and  \\\"{WAFType:label}\\\" contains \\\"azure front door\\\") or (ResourceType==\\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\" and \\\"{WAFType:label}\\\" contains \\\"cdn\\\")) and (\\\"{WAF:label}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where Category == \\\"FrontdoorWebApplicationFirewallLog\\\" or OperationName == \\\"ApplicationGatewayFirewall\\\" or Category == \\\"WebApplicationFirewallLogs\\\"\\r\\n| extend Action = iif(action_s == \\\"Blocked\\\", Action = \\\"Block\\\", action_s)\\r\\n| extend Action = iif(Action == \\\"Detected\\\", Action = \\\"Log\\\", Action)\\r\\n| where '{SelectedAction}' == Action or '{SelectedAction}' == \\\"*\\\" \\r\\n| where '{RequestURI}' == requestUri_s or '{RequestURI}' == \\\"*\\\"\\r\\n| extend Rule = strcat(ruleName_s, Message), ClientIP = strcat(clientIp_s, clientIP_s)\\r\\n| extend Rule= iif(Rule contains \\\"Mandatory rule. Cannot be disabled.\\\", strcat_array(split(Rule, \\\"Mandatory rule. Cannot be disabled. Inbound \\\",1),\\\"\\\"), Rule) // Removes initial component for mandatory rule \\r\\n| extend Rule = iif(Rule contains \\\"Total Inbound Score\\\", strcat_array(array_concat(split(Rule, \\\" - SQLI=\\\", 0), parse_json('[\\\") -\\\"]'), split(Rule,\\\"):\\\",1)),\\\"\\\"),Rule) // Removes smaller information if more info is available for anomaly score\\r\\n| summarize count() by Rule\\r\\n| top 50 by count_ desc\\r\\n\",         \"size\": 0,         \"showAnalytics\": true,         \"title\": \"Top 50 event trigger, filter by rule name\",         \"timeContext\": {           \"durationMs\": 86400000         },         \"timeContextFromParameter\": \"TimeRange\",         \"exportFieldName\": \"Rule\",         \"exportParameterName\": \"Selected\",         \"exportDefaultValue\": \"*\",         \"showExportToExcel\": true,         \"exportToExcelOptions\": \"all\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"count_\",               \"formatter\": 3,               \"formatOptions\": {                 \"palette\": \"blue\",                 \"showIcon\": true               }             }           ],           \"sortBy\": [             {               \"itemKey\": \"$gen_bar_count__1\",               \"sortOrder\": 2             }           ],           \"labelSettings\": [             {               \"columnId\": \"count_\",               \"label\": \"\"             }           ]         },         \"sortBy\": [           {             \"itemKey\": \"$gen_bar_count__1\",             \"sortOrder\": 2           }         ]       },       \"customWidth\": \"30\",       \"name\": \"query - 12\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let FakeData = (datatable (Message:string, ruleName_s:string, clientIp_s:string, clientIP_s:string, action_s:string, transactionId_s:string,trackingReference_s:string) [ \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\" ]);\\r\\nFakeData | union AzureDiagnostics\\r\\n| where (ResourceType == \\\"APPLICATIONGATEWAYS\\\" or ResourceType == \\\"FRONTDOORS\\\" or ResourceType == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\") and (\\\"{WAFType:label}\\\" == \\\"All\\\" or (ResourceType == \\\"APPLICATIONGATEWAYS\\\" and \\\"{WAFType:label}\\\" contains \\\"application gateway\\\") or (ResourceType == \\\"FRONTDOORS\\\" and  \\\"{WAFType:label}\\\" contains \\\"azure front door\\\") or (ResourceType==\\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\" and \\\"{WAFType:label}\\\" contains \\\"cdn\\\")) and (\\\"{WAF:label}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where Category == \\\"FrontdoorWebApplicationFirewallLog\\\" or OperationName == \\\"ApplicationGatewayFirewall\\\" or Category == \\\"WebApplicationFirewallLogs\\\"\\r\\n| extend Action = iif(action_s == \\\"Blocked\\\", Action = \\\"Block\\\", action_s)\\r\\n| extend Action = iif(Action == \\\"Detected\\\", Action = \\\"Log\\\", Action)\\r\\n| where '{SelectedAction}' == Action or '{SelectedAction}' == \\\"*\\\" \\r\\n| where '{RequestURI}' == requestUri_s or '{RequestURI}' == \\\"*\\\"\\r\\n| extend Rule = strcat(ruleName_s, Message), ClientIP = strcat(clientIp_s, clientIP_s)\\r\\n| where '{Selected}' == Rule or '{Selected}' == \\\"*\\\"\\r\\n| summarize count() by Rule, bin(TimeGenerated, 1h)\\r\\n\",         \"size\": 0,         \"showAnalytics\": true,         \"title\": \"Messages, by time\",         \"timeContext\": {           \"durationMs\": 86400000         },         \"timeContextFromParameter\": \"TimeRange\",         \"timeBrushParameterName\": \"timeBrushUpperSection\",         \"showExportToExcel\": true,         \"exportToExcelOptions\": \"all\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"barchart\",         \"tileSettings\": {           \"showBorder\": false,           \"titleContent\": {             \"columnMatch\": \"Message\",             \"formatter\": 1           },           \"leftContent\": {             \"columnMatch\": \"count_\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\"             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         }       },       \"customWidth\": \"70\",       \"name\": \"query - 13\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let FakeData = (datatable (Message:string,ruleName_s:string,clientIp_s:string,clientIP_s:string,action_s:string,transactionId_s:string,site_s:string,details_message_sRole:string,details_file_sRole:string,hostname_sRole:string,Role:string,trackingReference_s:string,requestUri_s:string,ruleSetType_s:string,details_message_s:string,details_data_s:string,details_file_s:string,hostname_s:string,instanceId_s:string) [ \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\",\\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\" ]);\\r\\nFakeData | union AzureDiagnostics\\r\\n| where (ResourceType == \\\"APPLICATIONGATEWAYS\\\" or ResourceType == \\\"FRONTDOORS\\\" or ResourceType == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\") and (\\\"{WAFType:label}\\\" == \\\"All\\\" or (ResourceType == \\\"APPLICATIONGATEWAYS\\\" and \\\"{WAFType:label}\\\" contains \\\"application gateway\\\") or (ResourceType == \\\"FRONTDOORS\\\" and  \\\"{WAFType:label}\\\" contains \\\"azure front door\\\") or (ResourceType==\\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\" and \\\"{WAFType:label}\\\" contains \\\"cdn\\\")) and (\\\"{WAF:label}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where Category == \\\"FrontdoorWebApplicationFirewallLog\\\" or OperationName == \\\"ApplicationGatewayFirewall\\\" or Category == \\\"WebApplicationFirewallLogs\\\"\\r\\n| extend Rule = strcat(ruleName_s, Message), ClientIP = strcat(clientIp_s, clientIP_s)\\r\\n| extend Action = iif(action_s == \\\"Blocked\\\", Action = \\\"Block\\\", action_s)\\r\\n| extend Action = iif(Action == \\\"Detected\\\", Action = \\\"Log\\\", Action)\\r\\n| where '{SelectedAction}' == Action or '{SelectedAction}' == \\\"*\\\" \\r\\n| where '{RequestURI}' == requestUri_s or '{RequestURI}' == \\\"*\\\"\\r\\n| where '{Selected}' == Rule or '{Selected}' == \\\"*\\\" \\r\\n| extend Role =  extract(\\\"ApplicationGateway([a-zA-Z_a-zA-Z_0-9]*)\\\",1,instanceId_s) \\r\\n| extend RequestUri = requestUri_s, RuleSetType = ruleSetType_s, Message_Details = details_message_s, Data_Details = details_data_s, File_Details = details_file_s, Hostname = hostname_s, Site = site_s\\r\\n| project Rule, TimeGenerated, SourceSystem, Hostname, ResourceId, ResourceGroup, ResourceProvider, Category, Role, Action, Site, Message_Details, File_Details, ClientIP, RequestUri\\r\\n| sort by TimeGenerated\",         \"size\": 0,         \"showAnalytics\": true,         \"title\": \"Message, full details\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"timeBrushUpperSection\",         \"showExportToExcel\": true,         \"exportToExcelOptions\": \"all\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"filter\": true         },         \"sortBy\": []       },       \"name\": \"query - 11\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"---\"       },       \"name\": \"text - 12\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let FakeData = (datatable (Message:string, ruleName_s:string, clientIp_s:string, clientIP_s:string, action_s:string, transactionId_s:string,trackingReference_s:string) [ \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\" ]);\\r\\nFakeData | union AzureDiagnostics\\r\\n| where (ResourceType == \\\"APPLICATIONGATEWAYS\\\" or ResourceType == \\\"FRONTDOORS\\\" or ResourceType == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\") and (\\\"{WAFType:label}\\\" == \\\"All\\\" or (ResourceType == \\\"APPLICATIONGATEWAYS\\\" and \\\"{WAFType:label}\\\" contains \\\"application gateway\\\") or (ResourceType == \\\"FRONTDOORS\\\" and  \\\"{WAFType:label}\\\" contains \\\"azure front door\\\") or (ResourceType==\\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\" and \\\"{WAFType:label}\\\" contains \\\"cdn\\\")) and (\\\"{WAF:label}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where Category == \\\"FrontdoorWebApplicationFirewallLog\\\" or (OperationName == \\\"ApplicationGatewayFirewall\\\" and Message contains \\\"attack\\\") or Category == \\\"WebApplicationFirewallLogs\\\"\\r\\n| where '{RequestURI}' == requestUri_s or '{RequestURI}' == \\\"*\\\"\\r\\n| extend Rule = strcat(ruleName_s, Message), ClientIP = strcat(clientIp_s, clientIP_s)\\r\\n| extend Action = iif(action_s == \\\"Blocked\\\", Action = \\\"Block\\\", action_s)\\r\\n| extend Action = iif(Action == \\\"Detected\\\", Action = \\\"Log\\\", Action)\\r\\n| where '{SelectedAction}' == Action or '{SelectedAction}' == \\\"*\\\" \\r\\n| where '{Selected}' == Rule or '{Selected}' == \\\"*\\\" \\r\\n| summarize Amount = count() by Rule\\r\\n| order by Amount desc\\r\\n\\r\\n\",         \"size\": 0,         \"title\": \"Attacks events, by messages and filterable by rule name\",         \"noDataMessage\": \"Filtered messages are not attack events\",         \"timeContext\": {           \"durationMs\": 86400000         },         \"timeContextFromParameter\": \"TimeRange\",         \"exportFieldName\": \"\",         \"exportParameterName\": \"MessageFilter\",         \"exportDefaultValue\": \"{\\\"Rule\\\":\\\"*\\\"}\",         \"showExportToExcel\": true,         \"exportToExcelOptions\": \"all\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Amount\",               \"formatter\": 8,               \"formatOptions\": {                 \"palette\": \"blueDark\",                 \"showIcon\": true,                 \"aggregation\": \"Sum\"               }             }           ],           \"filter\": true         },         \"sortBy\": []       },       \"customWidth\": \"20\",       \"name\": \"query - 16\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let SelectedMS = dynamic({MessageFilter}); // reference to the above list of messages (Event trigger)\\r\\nlet Child = SelectedMS.Rule; // Used to choose a group of messages - redirects to the message which was grouped\\r\\nlet FakeData = (datatable (Message:string, ruleName_s:string, clientIp_s:string, clientIP_s:string, action_s:string, transactionId_s:string,trackingReference_s:string) [ \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\" ]);\\r\\nFakeData | union AzureDiagnostics\\r\\n| where '{RequestURI}' == requestUri_s or '{RequestURI}' == \\\"*\\\"\\r\\n| where (ResourceType == \\\"APPLICATIONGATEWAYS\\\" or ResourceType == \\\"FRONTDOORS\\\" or ResourceType == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\") and (\\\"{WAFType:label}\\\" == \\\"All\\\" or (ResourceType == \\\"APPLICATIONGATEWAYS\\\" and \\\"{WAFType:label}\\\" contains \\\"application gateway\\\") or (ResourceType == \\\"FRONTDOORS\\\" and  \\\"{WAFType:label}\\\" contains \\\"azure front door\\\") or (ResourceType==\\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\" and \\\"{WAFType:label}\\\" contains \\\"cdn\\\")) and (\\\"{WAF:label}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where Category == \\\"FrontdoorWebApplicationFirewallLog\\\" or (OperationName == \\\"ApplicationGatewayFirewall\\\" and Message contains \\\"attack\\\") or Category == \\\"WebApplicationFirewallLogs\\\" \\r\\n| extend Action = iif(action_s == \\\"Blocked\\\", Action = \\\"Block\\\", action_s)\\r\\n| extend Action = iif(Action == \\\"Detected\\\", Action = \\\"Log\\\", Action)\\r\\n| where '{SelectedAction}' == Action or '{SelectedAction}' == \\\"*\\\" \\r\\n| extend Rule = strcat(ruleName_s, Message), ClientIP = strcat(clientIp_s, clientIP_s)\\r\\n| where Rule == Child or Child == \\\"*\\\"\\r\\n| where '{Selected}' == Rule or '{Selected}' == \\\"*\\\"\\r\\n| summarize Amount = count() by Rule, bin(TimeGenerated, 1h), ResourceId\\r\\n| project Amount, Rule, TimeGenerated, ResourceId\\r\\n| order by Amount desc\",         \"size\": 0,         \"showAnalytics\": true,         \"title\": \"Attack events, by time\",         \"noDataMessage\": \"Filtered messages are not attack events\",         \"timeContext\": {           \"durationMs\": 86400000         },         \"timeContextFromParameter\": \"TimeRange\",         \"timeBrushParameterName\": \"timeBrushLowerSection\",         \"exportParameterName\": \"Message\",         \"exportDefaultValue\": \"{ \\\"Name\\\":\\\"\\\", \\\"Type\\\":\\\"*\\\"}\",         \"showExportToExcel\": true,         \"exportToExcelOptions\": \"all\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"areachart\"       },       \"customWidth\": \"80\",       \"name\": \"query - 14\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let SelectedMS = dynamic({MessageFilter}); // reference to the above list of messages (Event trigger)\\r\\nlet Child = SelectedMS.Rule; // Used to choose a group of messages - redirects to the message which was grouped\\r\\nlet FakeData = (datatable (Message:string, ruleName_s:string, clientIp_s:string, clientIP_s:string, action_s:string, transactionId_s:string,trackingReference_s:string) [ \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\" ]);\\r\\nFakeData | union AzureDiagnostics\\r\\n| where (ResourceType == \\\"APPLICATIONGATEWAYS\\\" or ResourceType == \\\"FRONTDOORS\\\" or ResourceType == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\") and (\\\"{WAFType:label}\\\" == \\\"All\\\" or (ResourceType == \\\"APPLICATIONGATEWAYS\\\" and \\\"{WAFType:label}\\\" contains \\\"application gateway\\\") or (ResourceType == \\\"FRONTDOORS\\\" and  \\\"{WAFType:label}\\\" contains \\\"azure front door\\\") or (ResourceType==\\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\" and \\\"{WAFType:label}\\\" contains \\\"cdn\\\")) and (\\\"{WAF:label}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where Category == \\\"FrontdoorWebApplicationFirewallLog\\\" or (OperationName == \\\"ApplicationGatewayFirewall\\\" and Message contains \\\"attack\\\") or Category == \\\"WebApplicationFirewallLogs\\\"\\r\\n| where '{RequestURI}' == requestUri_s or '{RequestURI}' == \\\"*\\\"\\r\\n| extend Rule = strcat(ruleName_s, Message), ClientIP = strcat(clientIp_s, clientIP_s)\\r\\n| extend Action = iif(action_s == \\\"Blocked\\\", Action = \\\"Block\\\", action_s)\\r\\n| extend Action = iif(Action == \\\"Detected\\\", Action = \\\"Log\\\", Action)\\r\\n| extend TrackingID = strcat(transactionId_s, trackingReference_s)\\r\\n| where '{SelectedAction}' == Action or '{SelectedAction}' == \\\"*\\\" \\r\\n| where '{Selected}' == Rule or '{Selected}' == \\\"*\\\"\\r\\n| where Rule == Child or Child == \\\"*\\\" \\r\\n| summarize count() by TrackingID\\r\\n| top 50 by count_ desc\\r\\n\",         \"size\": 0,         \"showAnalytics\": true,         \"title\": \"TrackingID filter\",         \"noDataMessage\": \"You've over filtered or you're missing this data.\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"timeBrushLowerSection\",         \"exportFieldName\": \"TrackingID\",         \"exportParameterName\": \"SelectedTrackingID\",         \"exportDefaultValue\": \"*\",         \"showExportToExcel\": true,         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"rowLimit\": 500,           \"filter\": true,           \"sortBy\": [             {               \"itemKey\": \"TrackingID\",               \"sortOrder\": 2             }           ]         },         \"sortBy\": [           {             \"itemKey\": \"TrackingID\",             \"sortOrder\": 2           }         ]       },       \"customWidth\": \"20\",       \"name\": \"query - 12\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let SelectedMS = dynamic({MessageFilter}); // reference to the above list of messages (Event trigger)\\r\\nlet Child = SelectedMS.Rule; // Used to choose a group of messages - redirects to the message which was grouped\\r\\nlet FakeData = (datatable (Message:string,ruleName_s:string,clientIp_s:string,clientIP_s:string,action_s:string,transactionId_s:string,site_s:string,details_message_sRole:string,details_file_sRole:string,hostname_sRole:string,Role:string,trackingReference_s:string,ruleGroup_s:string,instanceId_s:string,ruleSetType_s:string,details_message_s:string,details_data_s:string,details_file_s:string,hostname_s:string) [ \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\",\\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\" ]);\\r\\nFakeData | union AzureDiagnostics\\r\\n| where (ResourceType == \\\"APPLICATIONGATEWAYS\\\" or ResourceType == \\\"FRONTDOORS\\\" or ResourceType == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\") and (\\\"{WAFType:label}\\\" == \\\"All\\\" or (ResourceType == \\\"APPLICATIONGATEWAYS\\\" and \\\"{WAFType:label}\\\" contains \\\"application gateway\\\") or (ResourceType == \\\"FRONTDOORS\\\" and  \\\"{WAFType:label}\\\" contains \\\"azure front door\\\") or (ResourceType==\\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\" and \\\"{WAFType:label}\\\" contains \\\"cdn\\\")) and (\\\"{WAF:label}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where Category == \\\"FrontdoorWebApplicationFirewallLog\\\" or (OperationName == \\\"ApplicationGatewayFirewall\\\" and Message contains \\\"attack\\\") or Category == \\\"WebApplicationFirewallLogs\\\"\\r\\n| where '{RequestURI}' == requestUri_s or '{RequestURI}' == \\\"*\\\"\\r\\n| extend Rule = strcat(ruleName_s, Message), ClientIP = strcat(clientIp_s, clientIP_s)\\r\\n| extend Action = iif(action_s == \\\"Blocked\\\", Action = \\\"Block\\\", action_s)\\r\\n| extend Action = iif(Action == \\\"Detected\\\", Action = \\\"Log\\\", Action)\\r\\n| extend TrackingID = strcat(transactionId_s, trackingReference_s)\\r\\n| where '{SelectedTrackingID}' == TrackingID or '{SelectedTrackingID}' == \\\"*\\\" \\r\\n| where '{SelectedAction}' == Action or '{SelectedAction}' == \\\"*\\\" \\r\\n| where '{Selected}' == Rule or '{Selected}' == \\\"*\\\"\\r\\n| where Rule == Child or Child == \\\"*\\\"\\r\\n| extend RuleGroup = ruleGroup_s, InstandUri = instanceId_s, RequestUri = requestUri_s, RuleSetType = ruleSetType_s, Message_Details = details_message_s, Data_Details = details_data_s, File_Details = details_file_s, Hostname = hostname_s\\r\\n| project TrackingID, TimeGenerated, Rule, ClientIP, RuleGroup, InstandUri, RequestUri, RuleSetType, Action, Message_Details, File_Details, Data_Details, Hostname, Category\",         \"size\": 0,         \"showAnalytics\": true,         \"title\": \"TrackingID Messages\",         \"noDataMessage\": \"You've over filtered or you're missing this data.\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"timeBrushLowerSection\",         \"showExportToExcel\": true,         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"rowLimit\": 50         }       },       \"customWidth\": \"80\",       \"name\": \"query - 13\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let SelectedMS = dynamic({MessageFilter}); // reference to the above list of messages (Event trigger)\\r\\nlet Child = SelectedMS.Rule; // Used to choose a group of messages - redirects to the message which was grouped\\r\\nlet FakeData = (datatable (Message:string, ruleName_s:string, clientIp_s:string, clientIP_s:string, action_s:string, transactionId_s:string,trackingReference_s:string) [ \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\" ]);\\r\\nFakeData | union AzureDiagnostics\\r\\n| where '{RequestURI}' == requestUri_s or '{RequestURI}' == \\\"*\\\"\\r\\n| where (ResourceType == \\\"APPLICATIONGATEWAYS\\\" or ResourceType == \\\"FRONTDOORS\\\" or ResourceType == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\") and (\\\"{WAFType:label}\\\" == \\\"All\\\" or (ResourceType == \\\"APPLICATIONGATEWAYS\\\" and \\\"{WAFType:label}\\\" contains \\\"application gateway\\\") or (ResourceType == \\\"FRONTDOORS\\\" and  \\\"{WAFType:label}\\\" contains \\\"azure front door\\\") or (ResourceType==\\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\" and \\\"{WAFType:label}\\\" contains \\\"cdn\\\")) and (\\\"{WAF:label}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where Category == \\\"FrontdoorWebApplicationFirewallLog\\\" or (OperationName == \\\"ApplicationGatewayFirewall\\\" and Message contains \\\"attack\\\") or Category == \\\"WebApplicationFirewallLogs\\\"\\r\\n| extend Rule = strcat(ruleName_s, Message), ClientIP = strcat(clientIp_s, clientIP_s)\\r\\n| extend Action = iif(action_s == \\\"Blocked\\\", Action = \\\"Block\\\", action_s)\\r\\n| extend Action = iif(Action == \\\"Detected\\\", Action = \\\"Log\\\", Action)\\r\\n| extend TrackingID = strcat(transactionId_s, trackingReference_s)\\r\\n| where '{SelectedTrackingID}' == TrackingID or '{SelectedTrackingID}' == \\\"*\\\" \\r\\n| where Rule == Child or Child == \\\"*\\\"\\r\\n| where '{SelectedAction}' == Action or '{SelectedAction}' == \\\"*\\\"\\r\\n| where '{Selected}' == Rule or '{Selected}' == \\\"*\\\"\\r\\n| summarize count() by ClientIP\\r\\n| top 10 by count_ desc\",         \"size\": 0,         \"showAnalytics\": true,         \"title\": \"Top 10 Attacking IP Addresses, filter to single IP address\",         \"noDataMessage\": \"Filtered messages are not attack events\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"timeBrushLowerSection\",         \"exportFieldName\": \"x\",         \"exportParameterName\": \"ClientIP\",         \"exportDefaultValue\": \"*\",         \"showExportToExcel\": true,         \"exportToExcelOptions\": \"all\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"barchart\",         \"tileSettings\": {           \"showBorder\": false,           \"titleContent\": {             \"columnMatch\": \"ClientIP\",             \"formatter\": 1           },           \"leftContent\": {             \"columnMatch\": \"count_\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\"             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         },         \"graphSettings\": {           \"type\": 0,           \"topContent\": {             \"columnMatch\": \"ClientIP\",             \"formatter\": 1           },           \"centerContent\": {             \"columnMatch\": \"count_\",             \"formatter\": 1,             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         },         \"chartSettings\": {           \"showLegend\": true         },         \"mapSettings\": {           \"locInfo\": \"LatLong\",           \"sizeSettings\": \"count_\",           \"sizeAggregation\": \"Sum\",           \"legendMetric\": \"count_\",           \"legendAggregation\": \"Sum\",           \"itemColorSettings\": {             \"type\": \"heatmap\",             \"colorAggregation\": \"Sum\",             \"nodeColorField\": \"count_\",             \"heatmapPalette\": \"greenRed\"           }         }       },       \"customWidth\": \"25\",       \"name\": \"query - 12\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let SelectedMS = dynamic({MessageFilter}); // reference to the above list of messages (Event trigger)\\r\\nlet Child = SelectedMS.Rule; // Used to choose a group of messages - redirects to the message which was grouped\\r\\nlet FakeData = (datatable (Message:string,ruleName_s:string,clientIp_s:string,clientIP_s:string,action_s:string,transactionId_s:string,site_s:string,details_message_sRole:string,details_file_sRole:string,hostname_sRole:string,Role:string,trackingReference_s:string,ruleGroup_s:string,instanceId_s:string,ruleSetType_s:string,details_message_s:string,details_data_s:string,details_file_s:string,hostname_s:string,requestUri_s:string) [ \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\",\\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\" ]);\\r\\nFakeData | union AzureDiagnostics\\r\\n| where (ResourceType == \\\"APPLICATIONGATEWAYS\\\" or ResourceType == \\\"FRONTDOORS\\\" or ResourceType == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\") and (\\\"{WAFType:label}\\\" == \\\"All\\\" or (ResourceType == \\\"APPLICATIONGATEWAYS\\\" and \\\"{WAFType:label}\\\" contains \\\"application gateway\\\") or (ResourceType == \\\"FRONTDOORS\\\" and  \\\"{WAFType:label}\\\" contains \\\"azure front door\\\") or (ResourceType==\\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\" and \\\"{WAFType:label}\\\" contains \\\"cdn\\\")) and (\\\"{WAF:label}\\\" == \\\"All\\\" or Resource in ({WAF}))\\r\\n| where Category == \\\"FrontdoorWebApplicationFirewallLog\\\" or (OperationName == \\\"ApplicationGatewayFirewall\\\" and Message contains \\\"attack\\\") or Category == \\\"WebApplicationFirewallLogs\\\"\\r\\n| where '{RequestURI}' == requestUri_s or '{RequestURI}' == \\\"*\\\"\\r\\n| extend Rule = strcat(ruleName_s, Message), ClientIP = strcat(clientIp_s, clientIP_s)\\r\\n| where Rule == Child or Child == \\\"*\\\"\\r\\n| extend Action = iif(action_s == \\\"Blocked\\\", Action = \\\"Block\\\", action_s)\\r\\n| extend Action = iif(Action == \\\"Detected\\\", Action = \\\"Log\\\", Action)\\r\\n| extend TrackingID = strcat(transactionId_s, trackingReference_s)\\r\\n| where '{SelectedTrackingID}' == TrackingID or '{SelectedTrackingID}' == \\\"*\\\" \\r\\n| where '{SelectedAction}' == Action or '{SelectedAction}' == \\\"*\\\" \\r\\n| where '{Selected}' == Rule or '{Selected}' == \\\"*\\\"\\r\\n| where ('{ClientIP}' == ClientIP or '{ClientIP}' == \\\"*\\\")\\r\\n| extend RuleGroup = ruleGroup_s, InstandUri = instanceId_s, RequestUri = requestUri_s, RuleSetType = ruleSetType_s, Message_Details = details_message_s, Data_Details = details_data_s, File_Details = details_file_s, Hostname = hostname_s\\r\\n| project TimeGenerated, Rule, ClientIP, RuleGroup, InstandUri, RequestUri, RuleSetType, Action, Message_Details, File_Details, Data_Details, Hostname, Category\",         \"size\": 0,         \"title\": \"Attack messages of IP address\",         \"noDataMessage\": \"Filtered messages are not attack events\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"timeBrushLowerSection\",         \"showExportToExcel\": true,         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"table\",         \"gridSettings\": {           \"filter\": true         }       },       \"customWidth\": \"75\",       \"showPin\": true,       \"name\": \"query - 13\"     }   ],     \"fromTemplateId\": \"sentinel-WebApplicationFirewallWAFTypeEvents\",     \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"   }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('windows_id')]",
                          "properties":  {
                                             "displayName":  "Security - Windows Host Analytics",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"\"       },       \"customWidth\": \"100\",       \"name\": \"text - 5\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"crossComponentResources\": [           \"value::all\"         ],         \"parameters\": [           {             \"id\": \"f8d6705a-e284-4077-8113-aae1038a6b7c\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Workspaces\",             \"type\": 5,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| summarize by id, name\",             \"crossComponentResources\": [               \"value::all\"             ],             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::1\",                 \"value::all\"               ]             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           }         ],         \"style\": \"pills\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\"       },       \"name\": \"parameters - 11\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"# Azure Automation Windows Update Summary for All Subscriptions\\r\\n\\r\\nThis workbook can query multiple Log Analytics Workspaces. The Azure Automation Update Management solution needs to be linked to every Log Analytics Workspaces you wish to use it with.\"       },       \"name\": \"text - 6\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Windows Updates need by Classification\"       },       \"customWidth\": \"50\",       \"name\": \"text - 7\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Top 5 Windows Machines by Update Count\"       },       \"customWidth\": \"50\",       \"name\": \"text - 8\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Update\\r\\n| where TimeGenerated\u003eago(14h) and OSType!=\\\"Linux\\\" and (Optional==false or Classification has \\\"Critical\\\" or Classification has \\\"Security\\\") and SourceComputerId in ((Heartbeat\\r\\n| where TimeGenerated\u003eago(12h) and OSType=~\\\"Windows\\\" and notempty(Computer)\\r\\n| summarize arg_max(TimeGenerated, Solutions) by SourceComputerId\\r\\n| where Solutions has \\\"updates\\\" | distinct SourceComputerId))\\r\\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, *) by Computer, SourceComputerId, UpdateID\\r\\n| where UpdateState=~\\\"Needed\\\" and Approved!=false\\r\\n| summarize UpdatesNeeded=count(Classification) by Classification\",         \"size\": 2,         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"piechart\",         \"tileSettings\": {           \"showBorder\": false,           \"titleContent\": {             \"columnMatch\": \"Classification\",             \"formatter\": 1           },           \"leftContent\": {             \"columnMatch\": \"UpdatesNeeded\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\"             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         },         \"chartSettings\": {           \"seriesLabelSettings\": [             {               \"seriesName\": \"Definition Updates\",               \"color\": \"yellow\"             },             {               \"seriesName\": \"Updates\",               \"color\": \"orange\"             },             {               \"seriesName\": \"Security Updates\",               \"color\": \"redBright\"             },             {               \"seriesName\": \"Update Rollups\",               \"color\": \"purple\"             },             {               \"seriesName\": \"Critical Updates\",               \"color\": \"red\"             }           ]         }       },       \"customWidth\": \"50\",       \"name\": \"query - 0\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Update\\r\\n| where TimeGenerated\u003eago(14h) and OSType!=\\\"Linux\\\" and (Optional==false or Classification has \\\"Critical\\\" or Classification has \\\"Security\\\") and SourceComputerId in ((Heartbeat\\r\\n| where TimeGenerated\u003eago(12h) and OSType=~\\\"Windows\\\" and notempty(Computer)\\r\\n| summarize arg_max(TimeGenerated, Solutions) by SourceComputerId\\r\\n| where Solutions has \\\"updates\\\" | distinct SourceComputerId))\\r\\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, *) by Computer, SourceComputerId, UpdateID\\r\\n| where UpdateState=~\\\"Needed\\\" and Approved!=false\\r\\n| project Computer, Title, Classification, PublishedDate, UpdateState, Product\\r\\n| summarize count(Classification) by Computer \\r\\n| top 5 by count_Classification desc \",         \"size\": 2,         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"piechart\"       },       \"customWidth\": \"50\",       \"name\": \"top five Computers Needing Updates\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Heatmap of Update Summary by Computer\\r\\n\\r\\nThis section is dynamic, by selecting a row that row's Computer name will be exported to populate Updates needed by Server\"       },       \"name\": \"text - 9\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Heartbeat\\r\\n| where TimeGenerated\u003eago(12h) and OSType=~\\\"Windows\\\" and notempty(Computer)\\r\\n| summarize arg_max(TimeGenerated, Solutions, Computer, ResourceId, ComputerEnvironment, VMUUID) by SourceComputerId\\r\\n| where Solutions has \\\"updates\\\"\\r\\n| extend vmuuId=VMUUID, azureResourceId=ResourceId, osType=2, environment=iff(ComputerEnvironment=~\\\"Azure\\\", 1, 2), scopedToUpdatesSolution=true, lastUpdateAgentSeenTime=\\\"\\\"\\r\\n| join kind=leftouter\\r\\n(\\r\\n    Update\\r\\n    | where TimeGenerated\u003eago(14h) and OSType!=\\\"Linux\\\" and SourceComputerId in ((Heartbeat\\r\\n    | where TimeGenerated\u003eago(12h) and OSType=~\\\"Windows\\\" and notempty(Computer)\\r\\n    | summarize arg_max(TimeGenerated, Solutions) by SourceComputerId\\r\\n    | where Solutions has \\\"updates\\\"\\r\\n    | distinct SourceComputerId))\\r\\n    | summarize hint.strategy=partitioned arg_max(TimeGenerated, UpdateState, Classification, Title, Optional, Approved, Computer, ComputerEnvironment) by Computer, SourceComputerId, UpdateID\\r\\n    | summarize Computer=any(Computer), ComputerEnvironment=any(ComputerEnvironment), missingCriticalUpdatesCount=countif(Classification has \\\"Critical\\\" and UpdateState=~\\\"Needed\\\" and Approved!=false), missingSecurityUpdatesCount=countif(Classification has \\\"Security\\\" and UpdateState=~\\\"Needed\\\" and Approved!=false), missingOtherUpdatesCount=countif(Classification !has \\\"Critical\\\" and Classification !has \\\"Security\\\" and UpdateState=~\\\"Needed\\\" and Optional==false and Approved!=false), lastAssessedTime=max(TimeGenerated), lastUpdateAgentSeenTime=\\\"\\\" by SourceComputerId\\r\\n    | extend compliance=iff(missingCriticalUpdatesCount \u003e 0 or missingSecurityUpdatesCount \u003e 0, 2, 1)\\r\\n    | extend ComplianceOrder=iff(missingCriticalUpdatesCount \u003e 0 or missingSecurityUpdatesCount \u003e 0 or missingOtherUpdatesCount \u003e 0, 1, 3)\\r\\n)\\r\\non SourceComputerId\\r\\n| project id=SourceComputerId, displayName=Computer, sourceComputerId=SourceComputerId, scopedToUpdatesSolution=true, missingCriticalUpdatesCount=coalesce(missingCriticalUpdatesCount, -1), missingSecurityUpdatesCount=coalesce(missingSecurityUpdatesCount, -1), missingOtherUpdatesCount=coalesce(missingOtherUpdatesCount, -1), compliance=coalesce(compliance, 4), lastAssessedTime, lastUpdateAgentSeenTime, osType=2, environment=iff(ComputerEnvironment=~\\\"Azure\\\", 1, 2), ComplianceOrder=coalesce(ComplianceOrder, 2) \\r\\n| order by ComplianceOrder asc, missingCriticalUpdatesCount desc, missingSecurityUpdatesCount desc, missingOtherUpdatesCount desc, displayName asc\\r\\n| project displayName, scopedToUpdatesSolution, CriticalUpdates=missingCriticalUpdatesCount, SecurityUpdates=missingSecurityUpdatesCount, OtherUpdates=missingOtherUpdatesCount, compliance, osType, Environment=environment, lastAssessedTime, lastUpdateAgentSeenTime\\r\\n| extend osType = replace(@\\\"2\\\", @\\\"Windows\\\", tostring(osType))\\r\\n| extend osType = replace(@\\\"1\\\", @\\\"Linux\\\", tostring(osType))\\r\\n| extend Environment = replace(@\\\"2\\\", @\\\"Non-Azure\\\", tostring(Environment))\\r\\n| extend Environment = replace(@\\\"1\\\", @\\\"Azure\\\", tostring(Environment))\",         \"size\": 0,         \"exportFieldName\": \"displayName\",         \"exportParameterName\": \"Computer\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"displayName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"scopedToUpdatesSolution\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"CriticalUpdates\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"max\": 1,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SecurityUpdates\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"max\": 5,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OtherUpdates\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"max\": 5,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"compliance\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 1,                 \"max\": 2,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"osType\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Environment\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"lastAssessedTime\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"lastUpdateAgentSeenTime\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ]         }       },       \"name\": \"query - 2\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Updates Needed by Server\"       },       \"name\": \"text - 10\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Update\\r\\n| where TimeGenerated\u003eago(14h) and OSType!=\\\"Linux\\\" and (Optional==false or Classification has \\\"Critical\\\" or Classification has \\\"Security\\\") and SourceComputerId in ((Heartbeat\\r\\n| where TimeGenerated\u003eago(12h) and OSType=~\\\"Windows\\\" and notempty(Computer)\\r\\n| summarize arg_max(TimeGenerated, Solutions) by SourceComputerId\\r\\n| where Solutions has \\\"updates\\\" | distinct SourceComputerId))\\r\\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, *) by Computer, SourceComputerId, UpdateID\\r\\n| where UpdateState=~\\\"Needed\\\" and Approved!=false and Computer=='{Computer}'\\r\\n| project Computer, Title, Classification, PublishedDate, UpdateState, Product\",         \"size\": 0,         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Computer\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Title\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Classification\",               \"formatter\": 18,               \"formatOptions\": {                 \"showIcon\": true,                 \"thresholdsOptions\": \"colors\",                 \"thresholdsGrid\": [                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Updates\",                     \"representation\": \"orange\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Security Updates\",                     \"representation\": \"redBright\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Definition Updates\",                     \"representation\": \"yellow\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Update Rollups\",                     \"representation\": \"purple\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Critical Updates\",                     \"representation\": \"red\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"Default\",                     \"thresholdValue\": null,                     \"representation\": \"blue\",                     \"text\": \"{0}{1}\"                   }                 ]               }             },             {               \"columnMatch\": \"PublishedDate\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"UpdateState\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Product\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ]         }       },       \"name\": \"query - 4\"     }   ],   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      }
                  ]
}
